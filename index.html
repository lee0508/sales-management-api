<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>판매관리 시스템</title>
  <!-- 하워드 휴즈 & 멜빈 다마 -->
  <!-- jQuery & DataTables -->
  <script src="js/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="DataTable/datatables.css" />
  <script src="DataTable/datatables.min.js"></script>

  <!-- 다음 우편번호 API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

  <script src="js/dataTableInit.js" defer></script>

  <script src="js/customer.js" defer></script>
  <script src="js/supplier.js" defer></script>
  <script src="js/quotation.js" defer></script>
  <script src="js/order.js" defer></script>
  <script src="js/postoffice.js" defer></script>
  <script src="js/transaction.js" defer></script>

  <link rel="stylesheet" href="css/onstyles.css?v=5" />
  <!-- <link rel="stylesheet" href="css/default.css" /> -->
</head>

<body>
  <!-- 로그인 페이지 -->
  <div class="login-container" id="loginPage">
    <div class="login-box">
      <div class="login-header">
        <h1>판매관리 시스템</h1>
        <p id="workplaceNameLogin" style="font-size: 16px; font-weight: 600; color: var(--primary); margin-top: 8px;">사업장 정보 로딩 중...</p>
        <p>로그인하여 시스템을 사용하세요</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="loginDateText">접속일자</label>
          <div style="display: flex; gap: 12px; align-items: center">
            <input type="text" id="loginDateText" class="form-input" placeholder="YYYY-MM-DD 직접 입력"
              autocomplete="off" />
            <div style="position: relative; flex: 1">
              <input type="date" id="loginDatePicker" class="form-input" style="padding-right: 44px" />
              <button type="button" onclick="openLoginDatePicker()" aria-label="달력으로 일자 선택" style="
                    position: absolute;
                    top: 50%;
                    right: 12px;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    cursor: pointer;
                    padding: 0;
                    display: flex;
                  ">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="userId">사용자 아이디</label>
          <input type="text" id="userId" class="form-input" placeholder="아이디를 입력하세요" required />
        </div>
        <div class="form-group">
          <label for="password">비밀번호</label>
          <input type="password" id="password" class="form-input" placeholder="비밀번호를 입력하세요"
            autocomplete="current-password" required />
        </div>
        <button type="submit" class="btn-login">로그인</button>
      </form>
      <div class="login-message" id="loginMessage">시스템에 오신 것을 환영합니다.</div>
    </div>
  </div>

  <!-- 대시보드 -->
  <div class="dashboard" id="dashboard">
    <!-- 사이드바 -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>판매관리 시스템</h2>
        <p id="workplaceNameSidebar" style="font-size: 14px; color: #93c5fd; margin-top: 4px; font-weight: 500;"></p>
      </div>
      <nav class="sidebar-menu">
        <div class="menu-item">
          <a class="menu-link active" onclick="showPage('dashboard')">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
              </path>
            </svg>
            대시보드
          </a>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="jangbuMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
              </path>
            </svg>
            장부관리
            <span class="arrow">▼</span>
          </a>
          <!--  
            매입처장부관리 -> Purchaser's ledger management 
            매출처장부관리 -> Sales ledger management
            미수금관리 -> Accounts receivable management
            미지급금관리 -> Accounts Payable Management
            현금출납장관리 -> Cash receipt and disbursement management
            세금계산서관리 -> Tax invoice management
            -->
          <div class="submenu" id="jangbuSubmenu">
            <a class="submenu-link" onclick="showPage('item-catagory')">매입처장부관리</a>
            <a class="submenu-link" onclick="showPage('item-history')">매출처장부관리</a>
            <a class="submenu-link" onclick="showPage('item-stock')">미수금관리</a>
            <a class="submenu-link" onclick="showPage('item-stock')">미지급금관리</a>
            <a class="submenu-link" onclick="showPage('item-stock')">현금출납관리</a>
            <a class="submenu-link" onclick="showPage('item-stock')">세금계산서관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="purchaseMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
            </svg>
            매입관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="purchaseSubmenu">
            <a class="submenu-link" onclick="showPage('order')">발주관리</a>
            <a class="submenu-link" onclick="showPage('purchase')">매입전표관리</a>
            <a class="submenu-link" onclick="showPage('supplier')">매입처관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="salesMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
              </path>
            </svg>
            매출관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="salesSubmenu">
            <a class="submenu-link" onclick="showPage('quotation')">견적관리</a>
            <a class="submenu-link" onclick="showPage('transaction')">거래명세서관리</a>
            <a class="submenu-link" onclick="showPage('customer')">매출처관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="itemMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
            </svg>
            자재관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="itemsSubmenu">
            <a class="submenu-link" onclick="showPage('item-catagory')">자재분류관리</a>
            <a class="submenu-link" onclick="showPage('item-history')">자재내역관리</a>
            <a class="submenu-link" onclick="showPage('item-stock')">자재재고관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="accountMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
              </path>
            </svg>
            회계관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="accountSubmenu">
            <a class="submenu-link" onclick="showPage('account-catagory')">회계개정관리</a>
            <a class="submenu-link" onclick="showPage('account-history')">현금출납내역관리</a>
            <a class="submenu-link" onclick="showPage('total-balnace')">합계잔액시산표</a>
            <a class="submenu-link" onclick="showPage('account-balnace')">대차대조표</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="printMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z">
              </path>
            </svg>
            출력물관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="printSubmenu">
            <a class="submenu-link" onclick="showPage('itembook-printMenu')">자재대장출력관리</a>
            <a class="submenu-link" onclick="showPage('salesbook-printMenu')">매출처출력관리</a>
            <a class="submenu-link" onclick="showPage('quotation-printMenu')">매입처출력관리</a>
            <a class="submenu-link" onclick="showPage('account-balnace')">발주서출력관리</a>
            <a class="submenu-link" onclick="showPage('account-balnace')">견적서출력관리</a>
            <a class="submenu-link" onclick="showPage('account-balnace')">세금계산서출력관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="settingMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
              </path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            설정관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="settingSubmenu">
            <a class="submenu-link" onclick="showPage('paper-setting')">용지설정관리</a>
            <a class="submenu-link" onclick="showPage('salespaper-setting')">거래명세서설정관리</a>
            <a class="submenu-link" onclick="showPage('taxpaper-setting')">세금계산서설정관리</a>
            <a class="submenu-link" onclick="showPage('warehouse-setting')">창고설정관리</a>
            <a class="submenu-link" onclick="showPage('taxrate-setting')">부과세율설정관리</a>
          </div>
        </div>
      </nav>
    </aside>

    <!-- 메인 컨텐츠 -->
    <main class="main-content">
      <div class="top-bar">
        <h1 id="pageTitle">대시보드</h1>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <span id="userName">사용자</span>
          <button class="btn-logout" onclick="logout()">로그아웃</button>
        </div>
      </div>

      <div class="content-area">
        <!-- 대시보드 페이지 -->
        <div class="page-content active" id="dashboardPage">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">오늘 매출</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">이번달 매출</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">미수금</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <!-- 재고 현황 주석처리
            <div class="stat-card">
              <div class="stat-label">재고 현황</div>
              <div class="stat-value">0건</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            -->
          </div>

          <div class="content-card">
            <h3 class="card-title">판매관리 시스템에 오신 것을 환영합니다</h3>
            <p style="color: var(--text-gray); margin-top: 16px; line-height: 1.6">
              좌측 메뉴에서 원하시는 기능을 선택하세요.<br />
              • 매출관리: 견적, 거래명세서, 매출처 관리<br />
              • 매입관리: 발주, 매입전표, 매입처 관리<br />
              • 재고관리: 자재 및 재고 현황 조회
            </p>
          </div>

          <!-- 오늘의 문서 현황 -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 24px;">
            <!-- 견적서 리스트 -->
            <div class="content-card" style="padding: 20px;">
              <h3 class="card-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span>📋 오늘의 견적서</span>
                <span id="todayQuotationCount" style="font-size: 14px; color: #007bff; font-weight: normal;">0건</span>
              </h3>
              <div id="todayQuotationList" style="max-height: 300px; overflow-y: auto;">
                <p style="color: var(--text-gray); text-align: center; padding: 20px;">데이터 로딩중...</p>
              </div>
            </div>

            <!-- 발주서 리스트 -->
            <div class="content-card" style="padding: 20px;">
              <h3 class="card-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span>📦 오늘의 발주서</span>
                <span id="todayOrderCount" style="font-size: 14px; color: #28a745; font-weight: normal;">0건</span>
              </h3>
              <div id="todayOrderList" style="max-height: 300px; overflow-y: auto;">
                <p style="color: var(--text-gray); text-align: center; padding: 20px;">데이터 로딩중...</p>
              </div>
            </div>

            <!-- 거래명세서 리스트 -->
            <div class="content-card" style="padding: 20px;">
              <h3 class="card-title" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span>📄 오늘의 거래명세서</span>
                <span id="todayTransactionCount" style="font-size: 14px; color: #ffc107; font-weight: normal;">0건</span>
              </h3>
              <div id="todayTransactionList" style="max-height: 300px; overflow-y: auto;">
                <p style="color: var(--text-gray); text-align: center; padding: 20px;">데이터 로딩중...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- 매출처관리 페이지 -->
        <div id="customerPage" class="page-content hidden">
          <h2 style="display: none;">매출처관리</h2>
          <div class="toolbar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center;">
              <input
                type="text"
                id="customerSearchInput"
                placeholder="매출처코드 또는 매출처명 검색..."
                style="
                  padding: 10px 16px;
                  border: 1px solid #ddd;
                  border-radius: 8px;
                  font-size: 14px;
                  width: 280px;
                  outline: none;
                "
              />
              <button
                class="btn btn-primary"
                onclick="searchCustomers()"
                style="
                  padding: 10px 20px;
                  background: #007bff;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
                🔍 검색
              </button>
              <button
                class="btn btn-light"
                onclick="resetCustomerSearch()"
                style="
                  padding: 10px 16px;
                  background: #f8f9fa;
                  color: #333;
                  border: 1px solid #ddd;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-success" onclick="openNewCustomerModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px;">+</span> 신규 등록
              </button>
              <button class="btn btn-secondary" onclick="exportCustomersToGoogleSheets()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px;">📊</span> Google Sheets로 보내기
              </button>
            </div>
          </div>

          <!-- ✅ DataTables 적용용 테이블 -->
          <table id="customerTable" class="display" style="width:100%">
            <thead>
              <tr>
                <th style="width: 40px;">
                  <input type="checkbox" id="selectAllCustomers" title="전체 선택" aria-label="전체 선택" />
                </th>
                <th>순번</th>
                <th>매출처코드</th>
                <th>매출처명</th>
                <th>대표자</th>
                <th>사업자번호</th>
                <th>연락처</th>
                <th>거래상태</th>
                <th>등록일</th>
                <th style="width: 180px;">관리</th>
              </tr>
            </thead>
          </table>
        </div>        

        <!-- 견적관리 페이지 -->
        <div class="page-content hidden" id="quotationPage">
          <h2 style="display: none;">견적관리</h2>
          <div class="toolbar" style="justify-content: space-between;">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center;">
              <select id="quotationStatusFilter" class="form-control" style="width: 150px;" onchange="filterQuotations()">
                <option value="">전체 상태</option>
                <option value="1">작성중</option>
                <option value="2">승인</option>
                <option value="3">반려</option>
              </select>
              <input type="date" id="quotationStartDate" class="form-control" style="width: 150px;" />
              <span>~</span>
              <input type="date" id="quotationEndDate" class="form-control" style="width: 150px;" />
              <button class="btn btn-secondary" onclick="filterQuotations()">조회</button>
            </div>
            <div class="toolbar-right">
              <button class="btn btn-success" onclick="openQuotationModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px;">+</span> 견적서 작성
              </button>
              <button class="btn btn-secondary" onclick="exportQuotationsToExcel()" style="
                  padding: 10px 20px;
                  background: #6c757d;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 견적 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px;">
            총 견적 수: <span id="quotationCount" style="font-weight: bold;">0</span> 건
          </div>

          <!-- DataTable -->
          <table id="quotationTable" class="display" style="width:100%">
            <thead>
              <tr>
                <th style="width: 40px;"><input type="checkbox" id="selectAllQuotations" /></th>
                <th>순번</th>
                <th>견적번호</th>
                <th>매출처명</th>
                <th>견적일자</th>
                <th>출고희망일</th>
                <th>제목</th>
                <th>담당자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="quotationTableBody">
            </tbody>            
          </table>          
        </div>        

        <!-- ✅ 견적 상세보기 모달 -->
        <div id="quotationDetailModal" class="modal hidden">
          <div class="modal-content large" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">견적 상세 보기</h2>
              <button id="closeQuotationDetailModal" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 견적 기본 정보 (카드 스타일) -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">기본 정보</h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">견적번호</span>
                  <span id="q_no" style="color: #1f2937; font-weight: 600;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">견적일자</span>
                  <span id="q_date" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">매출처명</span>
                  <span id="q_customer" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">비고</span>
                  <span id="q_remark" style="color: #1f2937;">-</span>
                </div>
              </div>
            </div>

            <!-- ✅ 견적 상세 목록 -->
            <div>
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">견적 품목 내역</h3>
              <table id="quotationDetailTable" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>금액</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold;">
                    <td colspan="5" style="text-align: right; padding-right: 20px; color: #1f2937;">합계</td>
                    <td id="quotationDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px;">0</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 수정 모달 -->
        <div id="quotationEditModal" class="modal" style="display: none;">
          <div class="modal-content large" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">견적 수정</h2>
              <button id="closeQuotationEditModalBtn" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 견적 기본 정보 (카드 스타일) -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">기본 정보</h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">견적번호</span>
                  <span id="editQuotationNo" style="color: #1f2937; font-weight: 600;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">견적일자</span>
                  <span id="editQuotationDate" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">매출처명</span>
                  <span id="editCustomerName" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">출고희망일자</span>
                  <input type="date" id="editDeliveryDate" style="
                    padding: 8px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 6px;
                    font-size: 14px;
                  " />
                </div>
                <div style="display: flex; align-items: center; grid-column: 1 / -1;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">제목</span>
                  <input type="text" id="editTitle" style="
                    flex: 1;
                    padding: 8px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 6px;
                    font-size: 14px;
                  " placeholder="견적 제목" />
                </div>
                <div style="display: flex; align-items: flex-start; grid-column: 1 / -1;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280; padding-top: 8px;">적요</span>
                  <textarea id="editRemark" rows="2" style="
                    flex: 1;
                    padding: 8px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 6px;
                    font-size: 14px;
                    resize: vertical;
                  " placeholder="견적 적요"></textarea>
                </div>
              </div>
            </div>

            <!-- ✅ 견적 상세 목록 -->
            <div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151;">견적 품목 내역</h3>
                <div style="display: flex; gap: 8px;">
                  <button type="button" onclick="addQuotationDetailRow()" style="
                    padding: 8px 16px;
                    background: #10b981;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';"
                     onmouseout="this.style.background='#10b981';">
                    + 자재 추가
                  </button>
                  <button type="button" onclick="deleteSelectedQuotationDetails()" style="
                    padding: 8px 16px;
                    background: #ef4444;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#dc2626';"
                     onmouseout="this.style.background='#ef4444';">
                    선택 삭제
                  </button>
                </div>
              </div>

              <table id="quotationEditDetailTable" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th style="width: 40px;"><input type="checkbox" id="selectAllEditDetails" /></th>
                    <th style="width: 50px;">순번</th>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>금액</th>
                    <th style="width: 80px;">관리</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold;">
                    <td colspan="8" style="text-align: right; padding-right: 20px; color: #1f2937;">합계</td>
                    <td id="quotationEditDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px;">0</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
              <button type="button" onclick="closeQuotationEditModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="submitQuotationEdit()" style="
                padding: 12px 24px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#1d4ed8';"
                 onmouseout="this.style.background='#2563eb';">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 삭제 확인 모달 -->
        <div id="quotationDeleteModal" style="
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1000;
          align-items: center;
          justify-content: center;
        ">
          <div style="
            background: white;
            border-radius: 12px;
            padding: 32px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
          ">
            <!-- 아이콘 -->
            <div style="text-align: center; margin-bottom: 20px;">
              <div style="
                width: 64px;
                height: 64px;
                background: #fee2e2;
                border-radius: 50%;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 16px;
              ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"/>
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937;">견적 삭제</h2>
              <p id="deleteQuotationInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px;">견적번호: -</p>
              <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500;">정말로 이 견적을 삭제하시겠습니까?</p>
              <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px;">삭제된 견적은 복구할 수 없습니다.</p>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px;">
              <button onclick="closeQuotationDeleteModal()" style="
                flex: 1;
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationDelete()" style="
                flex: 1;
                padding: 12px 24px;
                background: #dc2626;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#b91c1c';"
                 onmouseout="this.style.background='#dc2626';">
                삭제하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 승인 확인 모달 -->
        <div id="quotationApproveModal" style="
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1000;
          align-items: center;
          justify-content: center;
        ">
          <div style="
            background: white;
            border-radius: 12px;
            padding: 32px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
          ">
            <!-- 아이콘 -->
            <div style="text-align: center; margin-bottom: 20px;">
              <div style="
                width: 64px;
                height: 64px;
                background: #dbeafe;
                border-radius: 50%;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 16px;
              ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937;">견적 승인</h2>
              <p id="approveQuotationInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px;">견적번호: -</p>
              <p style="margin: 0; color: #2563eb; font-size: 14px; font-weight: 500;">이 견적을 승인하시겠습니까?</p>
              <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px;">승인 후에는 상태가 변경됩니다.</p>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px;">
              <button onclick="closeQuotationApproveModal()" style="
                flex: 1;
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationApprove()" style="
                flex: 1;
                padding: 12px 24px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#1d4ed8';"
                 onmouseout="this.style.background='#2563eb';">
                승인하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 품목 추가 모달 -->
        <div id="quotationDetailAddModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 추가</h2>
              <button id="closeQuotationDetailAddModal" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px;">
              <!-- ✅ 자재 검색 영역 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">자재 검색</label>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="materialSearchInput" style="
                    flex: 1;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="자재명 또는 품목코드로 검색" />
                  <button onclick="searchMaterials()" style="
                    padding: 10px 20px;
                    background: #3b82f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                    white-space: nowrap;
                  " onmouseover="this.style.background='#2563eb';"
                     onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- ✅ 검색 결과 테이블 -->
              <div id="materialSearchResults" style="display: none;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">검색 결과 (클릭하여 선택)</label>
                <div style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                  <table id="materialSearchTable" style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f9fafb; position: sticky; top: 0;">
                      <tr>
                        <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품목코드</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품명</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">규격</th>
                      </tr>
                    </thead>
                    <tbody id="materialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ✅ 선택된 자재 정보 -->
              <div id="selectedMaterialInfo" style="display: none; background: #f0f9ff; padding: 12px; border-radius: 8px; border: 2px solid #bfdbfe;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
                    <div style="font-weight: 600; color: #1e40af;" id="selectedMaterialName">-</div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px;" id="selectedMaterialCode">-</div>
                  </div>
                  <button onclick="clearSelectedMaterial()" style="
                    padding: 6px 12px;
                    background: #ef4444;
                    border: none;
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                  ">취소</button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">수량</label>
                <input type="number" id="addDetailQuantity" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="수량 입력" value="1" min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">출고단가</label>
                <div style="display: flex; gap: 8px;">
                  <input type="number" id="addDetailPrice" style="
                    flex: 1;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="단가 입력" value="0" min="0" step="0.01" />
                  <button onclick="showPriceHistory()" style="
                    padding: 10px 16px;
                    background: #8b5cf6;
                    border: none;
                    border-radius: 8px;
                    font-size: 13px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                    white-space: nowrap;
                  " onmouseover="this.style.background='#7c3aed';"
                     onmouseout="this.style.background='#8b5cf6';">
                    이전 단가
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">금액 (자동계산)</label>
                <input type="text" id="addDetailAmount" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                  background: #f9fafb;
                " readonly value="0" />
              </div>
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
              <button onclick="closeQuotationDetailAddModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationDetailAdd()" style="
                padding: 12px 24px;
                background: #10b981;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#059669';"
                 onmouseout="this.style.background='#10b981';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 품목 수정 모달 -->
        <div id="quotationDetailEditModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 500px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 수정</h2>
              <button id="closeQuotationDetailEditModal" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 500; color: #6b7280;">품목코드:</span>
                <span id="editDetailCode" style="color: #1f2937; font-weight: 600;">-</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span style="font-weight: 500; color: #6b7280;">품명:</span>
                <span id="editDetailName" style="color: #1f2937;">-</span>
              </div>
              <div style="display: flex; justify-content: space-between;">
                <span style="font-weight: 500; color: #6b7280;">규격:</span>
                <span id="editDetailSpec" style="color: #1f2937;">-</span>
              </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px;">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">수량</label>
                <input type="number" id="editDetailQuantity" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">출고단가</label>
                <input type="number" id="editDetailPrice" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">금액 (자동계산)</label>
                <input type="text" id="editDetailAmount" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                  background: #f9fafb;
                " readonly />
              </div>
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
              <button onclick="closeQuotationDetailEditModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationDetailEdit()" style="
                padding: 12px 24px;
                background: #3b82f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#2563eb';"
                 onmouseout="this.style.background='#3b82f6';">
                수정하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 품목 삭제 확인 모달 -->
        <div id="quotationDetailDeleteModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 400px;">
            <div style="text-align: center; padding: 20px;">
              <div style="
                width: 64px;
                height: 64px;
                background: #fee2e2;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 auto 20px;
              ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </div>

              <h2 style="margin: 0 0 12px 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 삭제</h2>
              <p style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px;">이 품목을 삭제하시겠습니까?</p>
              <p id="deleteDetailInfo" style="margin: 0; color: #374151; font-weight: 600; font-size: 14px;">-</p>
            </div>

            <div style="display: flex; gap: 12px; padding: 0 20px 20px;">
              <button onclick="closeQuotationDetailDeleteModal()" style="
                flex: 1;
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationDetailDelete()" style="
                flex: 1;
                padding: 12px 24px;
                background: #ef4444;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#dc2626';"
                 onmouseout="this.style.background='#ef4444';">
                삭제하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 출고단가 이력 모달 -->
        <div id="priceHistoryModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 700px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-top: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">출고단가 이력</h2>
              <button id="closePriceHistoryModal" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- 자재 정보 -->
            <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 2px solid #fbbf24;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
                  <div style="font-weight: 600; color: #78350f;" id="priceHistoryMaterialName">-</div>
                  <div style="font-size: 12px; color: #92400e; margin-top: 2px;" id="priceHistoryMaterialCode">-</div>
                </div>
              </div>
            </div>

            <!-- ✅ 탭 메뉴 -->
            <div style="display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <button id="tabActualPrice" onclick="switchPriceHistoryTab('actual')" style="
                padding: 12px 20px;
                background: #3b82f6;
                border: none;
                border-bottom: 3px solid #3b82f6;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
                flex: 1;
              ">
                실제 출고가
              </button>
              <button id="tabQuotationPrice" onclick="switchPriceHistoryTab('quotation')" style="
                padding: 12px 20px;
                background: transparent;
                border: none;
                border-bottom: 3px solid transparent;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                color: #6b7280;
                transition: all 0.2s;
                flex: 1;
              " onmouseover="if(this.id !== 'tabActualPrice' || this.style.background === 'transparent') this.style.color='#1f2937';"
                 onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';">
                견적 제안가
              </button>
            </div>

            <!-- 이력 테이블 -->
            <div style="margin-bottom: 16px;">
              <label id="priceHistoryLabel" style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                이 거래처에 실제 출고한 이력 (클릭하여 단가 선택)
              </label>
              <div style="max-height: 300px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                <table id="priceHistoryTable" style="width: 100%; border-collapse: collapse;">
                  <thead id="priceHistoryTableHead" style="background: #f9fafb; position: sticky; top: 0;">
                    <tr>
                      <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 13px;">출고일자</th>
                      <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb; font-size: 13px;">출고단가</th>
                      <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb; font-size: 13px;">출고수량</th>
                      <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb; font-size: 13px;">적요</th>
                    </tr>
                  </thead>
                  <tbody id="priceHistoryTableBody">
                    <tr>
                      <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af;">
                        이력이 없습니다
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 2px solid #e5e7eb;">
              <button onclick="closePriceHistoryModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                닫기
              </button>
            </div>
          </div>
        </div>

        <!-- 거래명세서관리 페이지 -->
        <div class="page-content hidden" id="transactionPage">
          <h2 style="display: none;">거래명세서관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between;">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center;">
              <select id="transactionStatusFilter" class="form-control" style="width: 150px;" onchange="filterTransactions()">
                <option value="">전체 상태</option>
                <option value="1">작성중</option>
                <option value="2">확정</option>
                <option value="3">발행완료</option>
              </select>
              <input type="date" id="transactionStartDate" class="form-control" style="width: 150px;" />
              <span>~</span>
              <input type="date" id="transactionEndDate" class="form-control" style="width: 150px;" />
              <button class="btn btn-secondary" onclick="filterTransactions()">조회</button>
            </div>

            <div class="toolbar-right">
              <button class="btn btn-success" onclick="openTransactionModal()" style="
                  padding: 10px 20px;
                  background: #28a745;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;">
                <span style="font-size: 18px; margin-right: 4px;">+</span> 거래명세서 작성
              </button>
              <button class="btn btn-secondary" onclick="exportTransactionsToExcel()" style="
                  padding: 10px 20px;
                  background: #6c757d;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 거래명세서 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px;">
            총 거래명세서 수: <span id="transactionCount" style="font-weight: bold;">0</span> 건
          </div>

          <!-- ✅ 거래명세서 목록 DataTable -->
          <table id="transactionTable" class="display" style="width:100%">
            <thead>
              <tr>
                <th style="width: 40px;"><input type="checkbox" id="selectAllTransactions" /></th>
                <th>순번</th>
                <th>명세서번호</th>
                <th>거래일자</th>
                <th>매출처명</th>
                <th>공급가액</th>
                <th>부가세</th>
                <th>합계금액</th>
                <th>작성자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="transactionTableBody">
            </tbody>
          </table>
        </div>

        <!-- ✅ 거래명세서 상세보기 모달 -->
        <div id="transactionDetailModal" class="modal hidden">
          <div class="modal-content large" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">거래명세서 상세 보기</h2>
              <button onclick="closeTransactionDetailModal()" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 거래명세서 기본 정보 (카드 스타일) -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">기본 정보</h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">명세서번호</span>
                  <span id="detailTransactionNo" style="color: #1f2937; font-weight: 600;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">거래일자</span>
                  <span id="detailTransactionDate" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">매출처명</span>
                  <span id="detailCustomerName" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">작성자</span>
                  <span id="detailUserName" style="color: #1f2937;">-</span>
                </div>
              </div>
            </div>

            <!-- ✅ 거래명세서 상세 목록 -->
            <div>
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">거래 품목 내역</h3>
              <table id="transactionDetailTable" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th>순번</th>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>공급가액</th>
                    <th>세액</th>
                    <th>합계</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold;">
                    <td colspan="8" style="text-align: right; padding-right: 20px; color: #1f2937;">합계</td>
                    <td id="transactionDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px;">0</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 모달 -->
        <div id="transactionEditModal" class="modal" style="display: none;">
          <div class="modal-content large" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">거래명세서 수정</h2>
              <button id="closeTransactionEditModalBtn" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 거래명세서 기본 정보 (카드 스타일) -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">기본 정보</h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">명세서번호</span>
                  <span id="editTransactionNo" style="color: #1f2937; font-weight: 600;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">거래일자</span>
                  <span id="editTransactionDate" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">매출처명</span>
                  <span id="editTransactionCustomer" style="color: #1f2937;">-</span>
                </div>
                <div style="display: flex; align-items: center;">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280;">입출고구분</span>
                  <select id="editTransactionStatus" style="
                    padding: 8px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 6px;
                    font-size: 14px;
                  ">
                    <option value="1">작성중</option>
                    <option value="2">확정</option>
                    <option value="3">발행완료</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- ✅ 거래명세서 상세 목록 -->
            <div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151;">거래 품목 내역</h3>
                <div style="display: flex; gap: 8px;">
                  <button type="button" onclick="addTransactionDetailRow()" style="
                    padding: 8px 16px;
                    background: #10b981;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';"
                     onmouseout="this.style.background='#10b981';">
                    + 자재 추가
                  </button>
                  <button type="button" onclick="deleteSelectedTransactionDetails()" style="
                    padding: 8px 16px;
                    background: #ef4444;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#dc2626';"
                     onmouseout="this.style.background='#ef4444';">
                    선택 삭제
                  </button>
                </div>
              </div>

              <table id="transactionEditDetailTable" class="display" style="width:100%">
                <thead>
                  <tr>
                    <th style="width: 40px;"><input type="checkbox" id="selectAllEditTransactionDetails" /></th>
                    <th style="width: 50px;">순번</th>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>공급가액</th>
                    <th>세액</th>
                    <th>합계</th>
                    <th style="width: 80px;">관리</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold;">
                    <td colspan="10" style="text-align: right; padding-right: 20px; color: #1f2937;">합계</td>
                    <td id="transactionEditDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px;">0</td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
              <button type="button" onclick="closeTransactionEditModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="submitTransactionEdit()" style="
                padding: 12px 24px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#1d4ed8';"
                 onmouseout="this.style.background='#2563eb';">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 - 자재 추가 모달 -->
        <div id="transactionDetailAddModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 추가</h2>
              <button onclick="closeTransactionDetailAddModal()" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px;">
              <!-- ✅ 자재 검색 영역 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">자재 검색</label>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="transactionMaterialSearchInput" style="
                    flex: 1;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="자재명 또는 품목코드로 검색" />
                  <button onclick="searchTransactionMaterials()" style="
                    padding: 10px 20px;
                    background: #3b82f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                    white-space: nowrap;
                  " onmouseover="this.style.background='#2563eb';"
                     onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- ✅ 검색 결과 테이블 -->
              <div id="transactionMaterialSearchResults" style="display: none;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">검색 결과 (클릭하여 선택)</label>
                <div style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
                  <table id="transactionMaterialSearchTable" style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f9fafb; position: sticky; top: 0;">
                      <tr>
                        <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품목코드</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품명</th>
                        <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">규격</th>
                      </tr>
                    </thead>
                    <tbody id="transactionMaterialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ✅ 선택된 자재 정보 -->
              <div id="transactionSelectedMaterialInfo" style="display: none; background: #f0f9ff; padding: 12px; border-radius: 8px; border: 2px solid #bfdbfe;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
                    <div style="font-weight: 600; color: #1e40af;" id="transactionSelectedMaterialName">-</div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px;" id="transactionSelectedMaterialCode">-</div>
                  </div>
                  <button onclick="clearSelectedTransactionMaterial()" style="
                    padding: 6px 12px;
                    background: #ef4444;
                    border: none;
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                  ">취소</button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">수량</label>
                <input type="number" id="transactionAddDetailQuantity" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="수량 입력" value="1" min="0" step="0.01" oninput="calculateTransactionDetailAmount()" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">출고단가</label>
                <input type="number" id="transactionAddDetailPrice" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="단가 입력" value="0" min="0" step="0.01" oninput="calculateTransactionDetailAmount()" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">금액 (자동계산)</label>
                <input type="text" id="transactionAddDetailAmount" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                  background: #f9fafb;
                " readonly value="0" />
              </div>
            </div>

            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
              <button onclick="closeTransactionDetailAddModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmTransactionDetailAdd()" style="
                padding: 12px 24px;
                background: #10b981;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#059669';"
                 onmouseout="this.style.background='#10b981';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 - 품목 수정 모달 -->
        <div id="transactionDetailEditModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 500px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700;">품목 수정</h2>
              <button onclick="closeTransactionDetailEditModal()" style="
                width: 32px; height: 32px; border-radius: 50%; background: #f3f4f6;
                border: none; cursor: pointer; font-size: 18px; color: #6b7280;">
                &times;
              </button>
            </div>

            <!-- 품목 정보 -->
            <div style="background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 20px;">
              <div style="margin-bottom: 8px;"><span style="color: #6b7280;">자재코드:</span> <span id="transactionEditDetailCode" style="font-weight: 600;">-</span></div>
              <div style="margin-bottom: 8px;"><span style="color: #6b7280;">자재명:</span> <span id="transactionEditDetailName" style="font-weight: 600;">-</span></div>
              <div><span style="color: #6b7280;">규격:</span> <span id="transactionEditDetailSpec">-</span></div>
            </div>

            <!-- 수량/단가 수정 -->
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;">
              <div>
                <label style="display: block; margin-bottom: 4px; font-size: 14px; font-weight: 500;">수량</label>
                <input type="number" id="transactionEditDetailQuantity" value="1" min="0" step="0.01"
                  oninput="calculateTransactionEditDetailAmount()"
                  style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px;" />
              </div>
              <div>
                <label style="display: block; margin-bottom: 4px; font-size: 14px; font-weight: 500;">단가</label>
                <input type="number" id="transactionEditDetailPrice" value="0" min="0" step="1"
                  oninput="calculateTransactionEditDetailAmount()"
                  style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px;" />
              </div>
              <div>
                <label style="display: block; margin-bottom: 4px; font-size: 14px; font-weight: 500;">공급가액</label>
                <input type="text" id="transactionEditDetailAmount" value="0" readonly
                  style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; background: #f9fafb;" />
              </div>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px;">
              <button onclick="closeTransactionDetailEditModal()" style="
                flex: 1; padding: 12px; background: #f3f4f6; color: #374151;
                border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">
                취소
              </button>
              <button onclick="confirmTransactionDetailEdit()" style="
                flex: 1; padding: 12px; background: #2563eb; color: white;
                border: none; border-radius: 6px; font-weight: 500; cursor: pointer;">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 - 품목 삭제 확인 모달 -->
        <div id="transactionDetailDeleteModal" style="
          display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0, 0, 0, 0.5); z-index: 1001; align-items: center; justify-content: center;">
          <div style="background: white; border-radius: 12px; padding: 32px; width: 90%; max-width: 400px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);">
            <div style="text-align: center; margin-bottom: 20px;">
              <div style="width: 64px; height: 64px; background: #fee2e2; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"/>
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 삭제</h2>
              <p id="transactionDeleteDetailInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px;">-</p>
              <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500;">이 품목을 삭제하시겠습니까?</p>
            </div>

            <div style="display: flex; gap: 12px;">
              <button onclick="closeTransactionDetailDeleteModal()" style="
                flex: 1; padding: 12px 24px; background: #f3f4f6; color: #374151;
                border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                취소
              </button>
              <button onclick="confirmTransactionDetailDelete()" style="
                flex: 1; padding: 12px 24px; background: #dc2626; color: white;
                border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 삭제 확인 모달 -->
        <div id="transactionDeleteModal" style="
          display: none;
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 1000;
          align-items: center;
          justify-content: center;
        ">
          <div style="
            background: white;
            border-radius: 12px;
            padding: 32px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
          ">
            <!-- 아이콘 -->
            <div style="text-align: center; margin-bottom: 20px;">
              <div style="
                width: 64px;
                height: 64px;
                background: #fee2e2;
                border-radius: 50%;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 16px;
              ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"/>
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937;">거래명세서 삭제</h2>
              <p id="deleteTransactionInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px;">명세서번호: -</p>
              <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500;">정말로 이 거래명세서를 삭제하시겠습니까?</p>
              <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px;">삭제된 거래명세서는 복구할 수 없습니다.</p>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px;">
              <button onclick="closeTransactionDeleteModal()" style="
                flex: 1;
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmTransactionDelete()" style="
                flex: 1;
                padding: 12px 24px;
                background: #dc2626;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#b91c1c';"
                 onmouseout="this.style.background='#dc2626';">
                삭제하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 작성 모달 -->
        <div id="transactionCreateModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <!-- 헤더 -->
            <div style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 24px;
              padding-bottom: 16px;
              border-bottom: 2px solid #e5e7eb;
            ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">거래명세서 작성</h2>
              <button onclick="closeTransactionCreateModal()" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <form id="transactionCreateForm" onsubmit="submitTransactionCreate(event)">
              <!-- 기본 정보 섹션 -->
              <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
                <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">기본 정보</h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                  <!-- 거래일자 -->
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; color: #374151;">거래일자 *</label>
                    <input type="date" id="transactionCreateDate" required style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " />
                  </div>

                  <!-- 입출고구분 -->
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; color: #374151;">입출고구분 *</label>
                    <select id="transactionCreateType" required style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    ">
                      <option value="1">작성중</option>
                      <option value="2">확정</option>
                      <option value="3">발행완료</option>
                    </select>
                  </div>

                  <!-- 매출처 선택 -->
                  <div style="grid-column: 1 / -1;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; color: #374151;">매출처 *</label>
                    <div style="display: flex; gap: 8px;">
                      <input type="text" id="transactionCreateCustomerCode" readonly style="
                        width: 120px;
                        padding: 12px 16px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                        background: #f5f5f5;
                      " placeholder="코드" />
                      <input type="text" id="transactionCreateCustomerName" readonly required style="
                        flex: 1;
                        padding: 12px 16px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                        background: #f5f5f5;
                      " placeholder="매출처를 선택하세요" />
                      <button type="button" onclick="openTransactionCustomerSearchModal()" style="
                        padding: 10px 20px;
                        background: #2563eb;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#1d4ed8';"
                         onmouseout="this.style.background='#2563eb';">
                        매출처 검색
                      </button>
                    </div>
                  </div>

                  <!-- 적요 -->
                  <div style="grid-column: 1 / -1;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; color: #374151;">적요</label>
                    <textarea id="transactionCreateRemark" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      resize: vertical;
                      min-height: 80px;
                    " placeholder="비고사항을 입력하세요"></textarea>
                  </div>
                </div>
              </div>

              <!-- 상세내역 섹션 -->
              <div style="margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                  <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151;">거래 품목 내역</h3>
                  <button type="button" onclick="openNewTransactionDetailAddModal()" style="
                    padding: 8px 16px;
                    background: #10b981;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  " onmouseover="this.style.background='#059669';"
                     onmouseout="this.style.background='#10b981';">
                    + 자재 추가
                  </button>
                </div>

                <!-- 상세내역 테이블 -->
                <div style="overflow-x: auto; border: 1px solid #e5e7eb; border-radius: 8px;">
                  <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f9fafb;">
                      <tr>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb; width: 40px;">순번</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">자재코드</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">자재명</th>
                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">규격</th>
                        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #e5e7eb; width: 100px;">수량</th>
                        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #e5e7eb; width: 120px;">단가</th>
                        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #e5e7eb; width: 120px;">공급가액</th>
                        <th style="padding: 12px; text-align: right; border-bottom: 2px solid #e5e7eb; width: 100px;">부가세</th>
                        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb; width: 60px;">수정</th>
                        <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb; width: 60px;">삭제</th>
                      </tr>
                    </thead>
                    <tbody id="transactionCreateDetailTableBody">
                      <tr>
                        <td colspan="10" style="padding: 40px; text-align: center; color: #6b7280;">
                          자재 추가 버튼을 클릭하여 거래 상세내역을 입력하세요
                        </td>
                      </tr>
                    </tbody>
                    <tfoot style="background: #f9fafb; font-weight: 600;">
                      <tr>
                        <td colspan="6" style="padding: 12px; text-align: right; border-top: 2px solid #e5e7eb; color: #1f2937;">합계</td>
                        <td id="transactionCreateTotalSupply" style="padding: 12px; text-align: right; border-top: 2px solid #e5e7eb; color: #1f2937;">0</td>
                        <td id="transactionCreateTotalVat" style="padding: 12px; text-align: right; border-top: 2px solid #e5e7eb; color: #1f2937;">0</td>
                        <td colspan="2" style="padding: 12px; border-top: 2px solid #e5e7eb;"></td>
                      </tr>
                      <tr>
                        <td colspan="6" style="padding: 12px; text-align: right; color: #1f2937;">총액</td>
                        <td colspan="2" id="transactionCreateGrandTotal" style="padding: 12px; text-align: right; color: #2563eb; font-size: 16px;">0</td>
                        <td colspan="2"></td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

              <!-- 버튼 영역 -->
              <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 24px; border-top: 2px solid #e5e7eb;">
                <button type="button" onclick="closeTransactionCreateModal()" style="
                  padding: 12px 24px;
                  background: #f3f4f6;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: #374151;
                  transition: all 0.2s;
                " onmouseover="this.style.background='#e5e7eb';"
                   onmouseout="this.style.background='#f3f4f6';">
                  취소
                </button>
                <button type="submit" style="
                  padding: 12px 24px;
                  background: #2563eb;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: white;
                  transition: all 0.2s;
                " onmouseover="this.style.background='#1d4ed8';"
                   onmouseout="this.style.background='#2563eb';">
                  거래명세서 등록
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- ✅ 거래명세서 작성 - 자재 추가 모달 -->
        <div id="newTransactionDetailAddModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 추가</h2>
              <button onclick="closeNewTransactionDetailAddModal()" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px;">
              <!-- ✅ 자재 검색 영역 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">자재 검색</label>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="newTransactionMaterialSearchInput" style="
                    flex: 1;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="자재명 또는 품목코드로 검색"
                  onkeypress="if(event.key === 'Enter') searchNewTransactionMaterials()" />
                  <button onclick="searchNewTransactionMaterials()" style="
                    padding: 10px 20px;
                    background: #3b82f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                    white-space: nowrap;
                  " onmouseover="this.style.background='#2563eb';"
                     onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- ✅ 검색 결과 테이블 (3컬럼, 클릭 가능) -->
              <div id="newTransactionMaterialSearchResults" style="display: none;">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">검색 결과</label>
                <div style="max-height: 300px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px;">
                  <table id="newTransactionMaterialSearchTable" style="width: 100%; border-collapse: collapse;">
                    <thead style="background: #f9fafb; position: sticky; top: 0;">
                      <tr>
                        <th style="padding: 10px 12px; text-align: left; border-bottom: 2px solid #e5e7eb; font-weight: 600; font-size: 13px; color: #374151;">품목코드</th>
                        <th style="padding: 10px 12px; text-align: left; border-bottom: 2px solid #e5e7eb; font-weight: 600; font-size: 13px; color: #374151;">품명</th>
                        <th style="padding: 10px 12px; text-align: left; border-bottom: 2px solid #e5e7eb; font-weight: 600; font-size: 13px; color: #374151;">규격</th>
                      </tr>
                    </thead>
                    <tbody id="newTransactionMaterialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ✅ 선택된 자재 표시 (파란색 카드) -->
              <div id="newTransactionSelectedMaterialInfo" style="display: none; background: #f0f9ff; padding: 12px; border-radius: 8px; border: 2px solid #bfdbfe;">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 4px;">
                  <div>
                    <div style="font-weight: 600; color: #1e40af; font-size: 15px;" id="newTransactionSelectedMaterialName">-</div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px;" id="newTransactionSelectedMaterialCode">-</div>
                  </div>
                  <button onclick="clearNewSelectedTransactionMaterial()" style="
                    padding: 4px 12px;
                    background: white;
                    border: 1px solid #bfdbfe;
                    border-radius: 4px;
                    font-size: 12px;
                    cursor: pointer;
                    color: #2563eb;
                    font-weight: 500;
                  " onmouseover="this.style.background='#eff6ff';"
                     onmouseout="this.style.background='white';">
                    취소
                  </button>
                </div>
              </div>

              <!-- ✅ 수량 입력 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">수량 *</label>
                <input type="number" id="newTransactionAddDetailQuantity" value="1" min="0" step="0.01"
                  oninput="calculateNewTransactionDetailAmount()"
                  style="
                    width: 100%;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " />
              </div>

              <!-- ✅ 단가 입력 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">단가 (원) *</label>
                <input type="number" id="newTransactionAddDetailPrice" value="0" min="0" step="1"
                  oninput="calculateNewTransactionDetailAmount()"
                  style="
                    width: 100%;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " />
              </div>

              <!-- ✅ 공급가액 표시 (읽기 전용) -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">공급가액 (원)</label>
                <input type="text" id="newTransactionAddDetailAmount" readonly value="0" style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                  background: #f9fafb;
                  color: #1f2937;
                  font-weight: 600;
                " />
              </div>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div style="display: flex; gap: 10px; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
              <button type="button" onclick="closeNewTransactionDetailAddModal()" style="
                flex: 1;
                padding: 12px 20px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="confirmNewTransactionDetailAdd()" style="
                flex: 1;
                padding: 12px 20px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#1d4ed8';"
                 onmouseout="this.style.background='#2563eb';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 작성 - 품목 수정 모달 -->
        <div id="newTransactionDetailEditModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 500px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 수정</h2>
              <button onclick="closeNewTransactionDetailEditModal()" style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                color: #6b7280;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                 onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px;">
              <!-- 선택된 자재 정보 표시 -->
              <div style="background: #f9fafb; padding: 12px; border-radius: 8px; border: 1px solid #e5e7eb;">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px;">자재코드</div>
                <div style="font-weight: 600; color: #1f2937;" id="newTransactionEditDetailCode">-</div>
                <div style="font-size: 12px; color: #6b7280; margin-top: 8px; margin-bottom: 4px;">자재명</div>
                <div style="font-weight: 500; color: #1f2937;" id="newTransactionEditDetailName">-</div>
                <div style="font-size: 12px; color: #6b7280; margin-top: 8px; margin-bottom: 4px;">규격</div>
                <div style="color: #6b7280;" id="newTransactionEditDetailSpec">-</div>
              </div>

              <!-- 수량 입력 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">수량 *</label>
                <input type="number" id="newTransactionEditDetailQuantity" min="0" step="0.01"
                  oninput="calculateNewTransactionEditAmount()"
                  style="
                    width: 100%;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " />
              </div>

              <!-- 단가 입력 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">단가 (원) *</label>
                <input type="number" id="newTransactionEditDetailPrice" min="0" step="1"
                  oninput="calculateNewTransactionEditAmount()"
                  style="
                    width: 100%;
                    padding: 10px 12px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " />
              </div>

              <!-- 공급가액 표시 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">공급가액 (원)</label>
                <input type="text" id="newTransactionEditDetailAmount" readonly style="
                  width: 100%;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                  background: #f9fafb;
                  color: #1f2937;
                  font-weight: 600;
                " />
              </div>
            </div>

            <!-- 버튼 영역 -->
            <div style="display: flex; gap: 10px; margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
              <button type="button" onclick="closeNewTransactionDetailEditModal()" style="
                flex: 1;
                padding: 12px 20px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="confirmNewTransactionDetailEdit()" style="
                flex: 1;
                padding: 12px 20px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#1d4ed8';"
                 onmouseout="this.style.background='#2563eb';">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 매출처 검색 모달 -->
        <div id="transactionCustomerSearchModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 800px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1f2937;">매출처 검색</h3>
              <button onclick="closeTransactionCustomerSearchModal()" style="
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                font-size: 20px;
                color: #6b7280;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">×</button>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 16px;">
              <input type="text" id="transactionCustomerSearchInput" placeholder="매출처명 또는 코드 검색"
                onkeypress="if(event.key === 'Enter') searchTransactionCustomers()" style="
                flex: 1;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 6px;
                font-size: 14px;
              " />
              <button onclick="searchTransactionCustomers()" style="
                padding: 10px 20px;
                background: #2563eb;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 500;
              " onmouseover="this.style.background='#1d4ed8';"
                 onmouseout="this.style.background='#2563eb';">검색</button>
            </div>

            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
              <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f9fafb; position: sticky; top: 0;">
                  <tr>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">코드</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">매출처명</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">전화번호</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb;">선택</th>
                  </tr>
                </thead>
                <tbody id="transactionCustomerSearchTableBody">
                  <tr>
                    <td colspan="4" style="padding: 40px; text-align: center; color: #6b7280;">
                      검색 버튼을 클릭하여 매출처를 검색하세요
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 자재 검색 모달 -->
        <div id="transactionMaterialSearchModal" class="modal" style="display: none;">
          <div class="modal-content" style="max-width: 900px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
              <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1f2937;">자재 검색 및 추가</h3>
              <button onclick="closeTransactionMaterialSearchModal()" style="
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: #f3f4f6;
                border: none;
                cursor: pointer;
                font-size: 20px;
                color: #6b7280;
              " onmouseover="this.style.background='#e5e7eb';"
                 onmouseout="this.style.background='#f3f4f6';">×</button>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 16px;">
              <input type="text" id="transactionCreateMaterialSearchInput" placeholder="자재명 또는 코드 검색"
                onkeypress="if(event.key === 'Enter') searchTransactionMaterials()" style="
                flex: 1;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 6px;
                font-size: 14px;
              " />
              <button onclick="searchTransactionMaterials()" style="
                padding: 10px 20px;
                background: #2563eb;
                color: white;
                border: none;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 500;
              " onmouseover="this.style.background='#1d4ed8';"
                 onmouseout="this.style.background='#2563eb';">검색</button>
            </div>

            <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
              <table style="width: 100%; border-collapse: collapse;">
                <thead style="background: #f9fafb; position: sticky; top: 0;">
                  <tr>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">자재코드</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">자재명</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">규격</th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #e5e7eb;">단가</th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb;">선택</th>
                  </tr>
                </thead>
                <tbody id="transactionMaterialSearchTableBody">
                  <tr>
                    <td colspan="5" style="padding: 40px; text-align: center; color: #6b7280;">
                      검색 버튼을 클릭하여 자재를 검색하세요
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 발주관리 페이지 -->
        <div class="page-content hidden" id="orderPage">
          <h2 style="display: none;">발주관리</h2>
          <div class="toolbar" style="justify-content: space-between;">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center;">
              <select id="orderStatusFilter" class="form-control" style="width: 150px;" onchange="filterOrders()">
                <option value="">전체 상태</option>
                <option value="0">발주대기</option>
                <option value="1">발주완료</option>
                <option value="2">입고완료</option>
              </select>
              <input type="date" id="orderStartDate" class="form-control" style="width: 150px;" />
              <span>~</span>
              <input type="date" id="orderEndDate" class="form-control" style="width: 150px;" />
              <button class="btn btn-secondary" onclick="filterOrders()">조회</button>
            </div>
            <div class="toolbar-right">
              <button class="btn btn-success" onclick="openOrderModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px;">+</span> 발주서 작성
              </button>
              <button class="btn btn-secondary" onclick="exportOrdersToExcel()" style="
                  padding: 10px 20px;
                  background: #6c757d;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 발주 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px;">
            총 발주 수: <span id="orderCount" style="font-weight: bold;">0</span> 건
          </div>

          <!-- DataTable -->
          <table id="orderTable" class="display" style="width:100%">
            <thead>
              <tr>
                <th style="width: 40px;"><input type="checkbox" id="selectAllOrders" /></th>
                <th>순번</th>
                <th>발주번호</th>
                <th>매입처명</th>
                <th>발주일자</th>
                <th>입고희망일자</th>
                <th>제목</th>
                <th>담당자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="orderTableBody">
            </tbody>
          </table>
        </div>        

        <!-- 매입전표관리 페이지 -->
        <div class="page-content" id="purchasePage">
          <div class="toolbar">
            <div class="toolbar-left">
              <input type="date" class="form-control" style="width: 180px" />
              <span style="padding: 0 8px">~</span>
              <input type="date" class="form-control" style="width: 180px" />
              <button class="btn btn-secondary">조회</button>
            </div>
            <div class="toolbar-right">
              <button class="btn btn-success"><span>+</span> 매입전표 작성</button>
              <button class="btn btn-secondary"><span>📄</span> 출력</button>
            </div>
          </div>

          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>전표번호</th>
                  <th>매입처명</th>
                  <th>매입일자</th>
                  <th>공급가액</th>
                  <th>부가세</th>
                  <th>합계금액</th>
                  <th>담당자</th>
                  <th>상태</th>
                  <th>관리</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="9" class="loading">데이터를 불러오는 중...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>      

        <!-- 매입처관리 페이지 -->
        <div id="supplierPage" class="page-content hidden">
          <h2 style="display: none;">매입처관리</h2>
          <div class="toolbar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center;">
              <input
                type="text"
                id="supplierSearchInput"
                placeholder="매입처코드 또는 매입처명 검색..."
                style="
                  padding: 10px 16px;
                  border: 1px solid #ddd;
                  border-radius: 8px;
                  font-size: 14px;
                  width: 280px;
                  outline: none;
                "
              />
              <button
                class="btn btn-primary"
                onclick="searchSuppliers()"
                style="
                  padding: 10px 20px;
                  background: #007bff;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
                🔍 검색
              </button>
              <button
                class="btn btn-light"
                onclick="resetSupplierSearch()"
                style="
                  padding: 10px 16px;
                  background: #f8f9fa;
                  color: #333;
                  border: 1px solid #ddd;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px;">
              <button class="btn btn-success" onclick="openSupplierModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px;">+</span> 신규 등록
              </button>
              <button class="btn btn-secondary" onclick="exportSuppliersToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px;">📊</span> Google Sheets로 보내기
              </button>
            </div>
          </div>

          <!-- ✅ DataTables 적용용 테이블 -->
          <table id="supplierTable" class="display" style="width:100%">
            <thead>
              <tr>
                <th style="width: 40px;">
                  <input type="checkbox" id="selectAllSuppliers" title="전체 선택" aria-label="전체 선택" />
                </th>
                <th>순번</th>
                <th>매입처코드</th>
                <th>매입처명</th>
                <th>대표자</th>
                <th>사업자번호</th>
                <th>연락처</th>
                <th>거래상태</th>
                <th>등록일</th>
                <th style="width: 180px;">관리</th>
              </tr>
            </thead>
          </table>
        </div>
    </main>
  </div>

  <script>
    // 모달을 body 직속으로 이동 (dashboard CSS 영향 회피)
    document.addEventListener('DOMContentLoaded', function () {
      
      const today = new Date();
      const formatted = today.toISOString().slice(0, 10); // YYYY-MM-DD 형식

      const loginDateText = document.getElementById("loginDateText");
      const loginDatePicker = document.getElementById("loginDatePicker");

      // 두 입력창 모두 오늘 날짜 자동 설정
      if (loginDateText) loginDateText.value = formatted;
      if (loginDatePicker) loginDatePicker.value = formatted;

      console.log(`✅ 로그인 날짜 자동 설정 완료: ${formatted}`);
      
      const customerModal = document.getElementById('customerModal');
      const supplierModal = document.getElementById('supplierModal');

      if (customerModal && customerModal.parentElement !== document.body) {
        document.body.appendChild(customerModal);
        console.log('✅ 매출처 모달을 body로 이동 완료');
      }

      if (supplierModal && supplierModal.parentElement !== document.body) {
        document.body.appendChild(supplierModal);
        console.log('✅ 매입처 모달을 body로 이동 완료');
      }
    });

    // API 기본 URL
    // 포트 3000에서 접속한 경우: 같은 origin 사용
    // 다른 포트(8000 등)에서 접속한 경우: 127.0.0.1:3000 사용 (localhost 대신)
    const API_BASE_URL = window.location.port === '3000'
      ? `${window.location.origin}/api`
      : 'http://127.0.0.1:3000/api';

    // 현재 로그인 사용자 정보
    let currentUser = null;

    let currentCustomerPage = 1;
    let customerPageSizeSelected = 10;
    let customerPageSizeEffective = 10;

    let currentSupplierPage = 1;
    let supplierPageSizeSelected = 10;
    let supplierPageSizeEffective = 10;

    function getCustomerEffectivePageSize() {
      // 셀렉터 선택값을 그대로 사용 (화면 높이로 제한하지 않음)
      const select = document.getElementById('customerPageSizeSelect');
      const selected = Number(select?.value || customerPageSizeSelected || 10);
      customerPageSizeSelected = selected;
      customerPageSizeEffective = selected;
      return selected;
    }

    function getSupplierEffectivePageSize() {
      const select = document.getElementById('supplierPageSizeSelect');
      const selected = Number(select?.value || supplierPageSizeSelected || 10);
      supplierPageSizeSelected = selected;
      supplierPageSizeEffective = selected;
      return selected;
    }

    function debounce(fn, wait = 200) {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), wait);
      };
    }

    document.addEventListener('DOMContentLoaded', () => {
      // 주입식 페이지 사이즈 선택 박스 생성
      const toolbarLeft = document.querySelector('#customerPage .toolbar .toolbar-left');
      if (toolbarLeft && !document.getElementById('customerPageSizeSelect')) {
        const sel = document.createElement('select');
        sel.id = 'customerPageSizeSelect';
        sel.className = 'form-control';
        sel.style.width = '120px';
        sel.style.marginLeft = '8px';
        [10, 15, 20, 25, 50].forEach((n) => {
          const opt = document.createElement('option');
          opt.value = String(n);
          opt.textContent = n + '개';
          if (n === 10) opt.selected = true;
          sel.appendChild(opt);
        });
        toolbarLeft.appendChild(sel);
        // ❌ 주석: customer.js의 DataTable이 자동으로 페이지 사이즈 관리
        // sel.addEventListener('change', () => loadCustomers(1));
      }

      const supplierToolbarLeft = document.querySelector('#supplierPage .toolbar .toolbar-left');
      if (supplierToolbarLeft && !document.getElementById('supplierPageSizeSelect')) {
        const sel = document.createElement('select');
        sel.id = 'supplierPageSizeSelect';
        sel.className = 'form-control';
        sel.style.width = '120px';
        sel.style.marginLeft = '8px';
        [10, 15, 20, 25, 50].forEach((n) => {
          const opt = document.createElement('option');
          opt.value = String(n);
          opt.textContent = n + '개';
          if (n === 10) opt.selected = true;
          sel.appendChild(opt);
        });
        supplierToolbarLeft.appendChild(sel);
        sel.addEventListener('change', () => loadSuppliers(1));
      }

      window.addEventListener(
        'resize',
        debounce(() => {
          const customerActive = document
            .getElementById('customerPage')
            ?.classList.contains('active');
          // ❌ 주석: customer.js의 DataTable이 자동으로 리사이즈 처리
          // if (customerActive) loadCustomers(currentCustomerPage);

          const supplierActive = document
            .getElementById('supplierPage')
            ?.classList.contains('active');
          if (supplierActive) loadSuppliers(currentSupplierPage);
        }, 200),
      );
    });

    // API 호출 헬퍼 함수
    async function apiCall(endpoint, method = 'GET', data = null) {
      
      try {
        let url = `${API_BASE_URL}${endpoint}`;
        const options = {
          method,
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include', // 세션 쿠키 포함
        };

        // ✅ GET 요청일 때: data를 쿼리스트링으로 변환
        if (method.toUpperCase() === 'GET' && data && typeof data === 'object') {
          const queryString = new URLSearchParams(data).toString();
          if (queryString) url += (url.includes('?') ? '&' : '?') + queryString;
        }
        // ✅ POST/PUT/DELETE 요청일 때: body에 JSON으로 추가
        else if (data) {
          options.body = JSON.stringify(data);
        }

        const response = await fetch(url, options);
        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.message || '서버 오류');
        }

        return result;
      } catch (error) {
        console.error('API 호출 에러:', error);
        throw error;
      }
    }

    function openLoginDatePicker() {
      const input = document.getElementById('loginDatePicker');
      if (!input) return;

      if (typeof input.showPicker === 'function') {
        input.showPicker();
      } else {
        input.focus();
      }
    }

    const loginDateTextInput = document.getElementById('loginDateText');
    const loginDatePickerInput = document.getElementById('loginDatePicker');

    if (loginDatePickerInput && loginDateTextInput) {
      loginDatePickerInput.addEventListener('change', () => {
        loginDateTextInput.value = loginDatePickerInput.value;
      });
    }

    // 페이지 로드 시 사업장명 표시 (로그인 페이지)
    async function loadWorkplaceInfo() {
      try {
        // 기본 사업장(01) 정보 가져오기
        const result = await apiCall('/workplaces/01', 'GET');
        if (result.success && result.data) {
          document.getElementById('workplaceNameLogin').textContent = result.data.사업장명;
        } else {
          document.getElementById('workplaceNameLogin').textContent = '';
        }
      } catch (error) {
        console.error('사업장 정보 로드 실패:', error);
        document.getElementById('workplaceNameLogin').textContent = '';
      }
    }

    // 페이지 로드 시 사업장명 표시
    loadWorkplaceInfo();

    // Top-bar 스크롤 효과
    const mainContent = document.querySelector('.main-content');
    const topBar = document.querySelector('.top-bar');

    if (mainContent && topBar) {
      mainContent.addEventListener('scroll', function () {
        if (mainContent.scrollTop > 50) {
          topBar.classList.add('scrolled');
        } else {
          topBar.classList.remove('scrolled');
        }
      });
    }

    // 로그인 처리
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const userId = document.getElementById('userId').value;
      const password = document.getElementById('password').value;
      const loginDateTextValue = loginDateTextInput.value.trim();
      const loginDatePickerValue = loginDatePickerInput.value;
      const loginDate = loginDatePickerValue || loginDateTextValue;
      const messageEl = document.getElementById('loginMessage');

      if (!loginDate) {
        messageEl.textContent = '접속일자를 입력하거나 선택해 주세요.';
        messageEl.classList.add('error');
        messageEl.classList.add('show');
        loginDateTextInput.focus();
        return;
      }

      if (loginDatePickerValue && loginDateTextValue !== loginDatePickerValue) {
        loginDateTextInput.value = loginDatePickerValue;
      }

      try {
        messageEl.textContent = '로그인 중...';
        messageEl.classList.remove('error');
        messageEl.classList.add('show');

        const result = await apiCall('/auth/login', 'POST', {
          userId: userId,
          password: password,
          loginDate: loginDate,
        });

        if (result.success) {
          currentUser = result.data;

          messageEl.textContent = result.message;

          setTimeout(() => {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');

            document.getElementById('userName').textContent = currentUser.사용자명;
            document.getElementById('userAvatar').textContent = currentUser.사용자명.charAt(0);

            // 사이드바에 사업장명 표시
            if (currentUser.사업장명) {
              document.getElementById('workplaceNameSidebar').textContent = currentUser.사업장명;
            }

            // 대시보드 통계 로드
            loadDashboardStats();
          }, 800);
        }
      } catch (error) {
        messageEl.textContent = '로그인 실패: ' + error.message;
        messageEl.classList.add('error');
        messageEl.classList.add('show');
      }
    });

    // 대시보드 통계 로드
    async function loadDashboardStats() {
      try {
        const result = await apiCall(`/dashboard/stats?사업장코드=${currentUser.사업장코드}`);

        if (result.success) {
          const stats = result.data;
          const statCards = document.querySelectorAll('.stat-card');

          statCards[0].querySelector('.stat-value').textContent =
            '₩' + Number(stats.todaySales).toLocaleString();
          statCards[0].querySelector('.stat-change').textContent = '전일 대비';

          statCards[1].querySelector('.stat-value').textContent =
            '₩' + Number(stats.monthlySales).toLocaleString();
          statCards[1].querySelector('.stat-change').textContent = '전월 대비';

          statCards[2].querySelector('.stat-value').textContent =
            '₩' + Number(stats.unpaidAmount).toLocaleString();
          statCards[2].querySelector('.stat-change').textContent = '미수금 현황';

          // 재고 현황 주석처리
          // statCards[3].querySelector('.stat-value').textContent =
          //   Number(stats.inventoryCount).toLocaleString() + '건';
          // statCards[3].querySelector('.stat-change').textContent = '재고 품목';
        }

        // 오늘의 문서 리스트 로드
        await loadTodayDocuments();
      } catch (error) {
        console.error('통계 로드 실패:', error);
      }
    }

    // 오늘의 문서 리스트 로드
    async function loadTodayDocuments() {
      const today = new Date().toISOString().slice(0, 10).replace(/-/g, ''); // YYYYMMDD

      try {
        // 1. 오늘의 견적서
        await loadTodayQuotations(today);

        // 2. 오늘의 발주서
        await loadTodayOrders(today);

        // 3. 오늘의 거래명세서
        await loadTodayTransactions(today);
      } catch (error) {
        console.error('오늘의 문서 로드 실패:', error);
      }
    }

    // 오늘의 견적서 로드
    async function loadTodayQuotations(today) {
      try {
        const result = await apiCall(`/quotations?startDate=${today}&endDate=${today}`);

        const listEl = document.getElementById('todayQuotationList');
        const countEl = document.getElementById('todayQuotationCount');

        if (result.success && result.data && result.data.length > 0) {
          countEl.textContent = `${result.data.length}건`;

          listEl.innerHTML = result.data.map(item => `
            <div style="
              padding: 12px;
              border-bottom: 1px solid #f0f0f0;
              cursor: pointer;
              transition: background 0.2s;
            " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'"
               onclick="showPage('quotation')">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 500; color: #333;">${item.견적번호}</div>
                  <div style="font-size: 12px; color: #666; margin-top: 4px;">
                    ${item.매출처명 || '-'} | ${formatCurrency(item.합계금액 || 0)}
                  </div>
                </div>
                <div style="font-size: 11px; color: #999;">
                  ${formatDate(item.견적일자)}
                </div>
              </div>
            </div>
          `).join('');
        } else {
          countEl.textContent = '0건';
          listEl.innerHTML = '<p style="color: var(--text-gray); text-align: center; padding: 20px;">오늘 등록된 견적서가 없습니다.</p>';
        }
      } catch (error) {
        console.error('견적서 로드 실패:', error);
        document.getElementById('todayQuotationList').innerHTML = '<p style="color: #dc3545; text-align: center; padding: 20px;">로드 실패</p>';
      }
    }

    // 오늘의 발주서 로드
    async function loadTodayOrders(today) {
      try {
        const result = await apiCall(`/orders?startDate=${today}&endDate=${today}`);

        const listEl = document.getElementById('todayOrderList');
        const countEl = document.getElementById('todayOrderCount');

        if (result.success && result.data && result.data.length > 0) {
          countEl.textContent = `${result.data.length}건`;

          listEl.innerHTML = result.data.map(item => `
            <div style="
              padding: 12px;
              border-bottom: 1px solid #f0f0f0;
              cursor: pointer;
              transition: background 0.2s;
            " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'"
               onclick="showPage('order')">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 500; color: #333;">${item.발주번호}</div>
                  <div style="font-size: 12px; color: #666; margin-top: 4px;">
                    ${item.매입처명 || '-'} | ${formatCurrency(item.합계금액 || 0)}
                  </div>
                </div>
                <div style="font-size: 11px; color: #999;">
                  ${formatDate(item.발주일자)}
                </div>
              </div>
            </div>
          `).join('');
        } else {
          countEl.textContent = '0건';
          listEl.innerHTML = '<p style="color: var(--text-gray); text-align: center; padding: 20px;">오늘 등록된 발주서가 없습니다.</p>';
        }
      } catch (error) {
        console.error('발주서 로드 실패:', error);
        document.getElementById('todayOrderList').innerHTML = '<p style="color: #dc3545; text-align: center; padding: 20px;">로드 실패</p>';
      }
    }

    // 오늘의 거래명세서 로드
    async function loadTodayTransactions(today) {
      try {
        const result = await apiCall(`/transactions?startDate=${today}&endDate=${today}`);

        const listEl = document.getElementById('todayTransactionList');
        const countEl = document.getElementById('todayTransactionCount');

        if (result.success && result.data && result.data.length > 0) {
          countEl.textContent = `${result.data.length}건`;

          listEl.innerHTML = result.data.map(item => `
            <div style="
              padding: 12px;
              border-bottom: 1px solid #f0f0f0;
              cursor: pointer;
              transition: background 0.2s;
            " onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='transparent'"
               onclick="showPage('transaction')">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  <div style="font-weight: 500; color: #333;">${item.거래번호}</div>
                  <div style="font-size: 12px; color: #666; margin-top: 4px;">
                    ${item.거래처명 || '-'} | ${formatCurrency(item.합계금액 || 0)}
                  </div>
                </div>
                <div style="font-size: 11px; color: #999;">
                  ${formatDate(item.거래일자)}
                </div>
              </div>
            </div>
          `).join('');
        } else {
          countEl.textContent = '0건';
          listEl.innerHTML = '<p style="color: var(--text-gray); text-align: center; padding: 20px;">오늘 등록된 거래명세서가 없습니다.</p>';
        }
      } catch (error) {
        console.error('거래명세서 로드 실패:', error);
        document.getElementById('todayTransactionList').innerHTML = '<p style="color: #dc3545; text-align: center; padding: 20px;">로드 실패</p>';
      }
    }

    // 날짜 포맷 헬퍼 함수
    function formatDate(dateStr) {
      if (!dateStr || dateStr.length !== 8) return '-';
      return `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
    }

    // 금액 포맷 헬퍼 함수
    function formatCurrency(amount) {
      return '₩' + Number(amount).toLocaleString();
    }

    /**
     * 체크박스 선택 시 수정/삭제 버튼 표시/숨김
     * @param {HTMLElement} checkbox - 체크박스 엘리먼트
     */
    function toggleCustomerActionButtons(checkbox) {
      const customerCode = checkbox.value;
      const actionsDiv = document.getElementById(`actions-${customerCode}`);

      if (!actionsDiv) return;

      const viewBtn = actionsDiv.querySelector('.btn-view');
      const editBtn = actionsDiv.querySelector('.btn-edit');
      const deleteBtn = actionsDiv.querySelector('.btn-delete');

      if (checkbox.checked) {
        // 체크 시: 상세 버튼 숨기고 수정/삭제 버튼 표시
        viewBtn.style.display = 'none';
        editBtn.style.display = 'inline-block';
        deleteBtn.style.display = 'inline-block';
      } else {
        // 체크 해제 시: 수정/삭제 버튼 숨기고 상세 버튼 표시
        viewBtn.style.display = 'inline-block';
        editBtn.style.display = 'none';
        deleteBtn.style.display = 'none';
      }
    }

    /**
     * 전체 선택/해제 (수정된 버전)
     * @param {HTMLElement} checkbox - 전체 선택 체크박스
     */
    function toggleSelectAllCustomers(checkbox) {
      const checkboxes = document.querySelectorAll('.customerCheckbox');
      checkboxes.forEach((cb) => {
        cb.checked = checkbox.checked;
        // 각 체크박스의 버튼 상태도 업데이트
        toggleCustomerActionButtons(cb);
      });
    }

    function toggleSelectAllSuppliers(checkbox) {
      const supplierCheckboxes = document.querySelectorAll('.supplierCheckbox');
      supplierCheckboxes.forEach((cb) => (cb.checked = checkbox.checked));
    }

    /**
     * 매출처 수정 함수
     * @param {string} customerCode - 매출처코드
     */
    async function editCustomer(customerCode) {
      try {
        console.log('===== 매출처 수정 시작 =====');
        console.log('매출처코드:', customerCode);

        // 1. 매출처 상세 정보 조회
        const result = await apiCall(`/customers/${customerCode}`);

        if (!result.success) {
          throw new Error(result.message || '매출처 정보를 불러올 수 없습니다.');
        }

        const customer = result.data;
        console.log('조회된 매출처 정보:', customer);

        // 2. 모달 열기
        const modal = document.getElementById('customerModal');
        if (!modal) {
          throw new Error('모달을 찾을 수 없습니다.');
        }

        // 3. 모달 제목 변경
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 수정';
        }

        // 4. 폼 필드에 데이터 채우기
        document.getElementById('customerCode').value = customer.매출처코드 || '';
        document.getElementById('customerName').value = customer.매출처명 || '';
        document.getElementById('ceoName').value = customer.대표자명 || '';
        document.getElementById('businessNo').value = customer.사업자번호 || '';
        document.getElementById('businessType').value = customer.업태 || '';
        document.getElementById('businessCategory').value = customer.업종 || '';
        document.getElementById('phone').value = customer.전화번호 || '';
        document.getElementById('fax').value = customer.팩스번호 || '';
        document.getElementById('zipCode').value = customer.우편번호 || '';
        document.getElementById('address').value = customer.주소 || '';
        document.getElementById('addressDetail').value = customer.번지 || '';
        document.getElementById('bankCode').value = customer.은행코드 || '';
        document.getElementById('accountNo').value = customer.계좌번호 || '';
        document.getElementById('managerName').value = customer.담당자 || '';
        document.getElementById('status').value = customer.사용구분 || '0';
        document.getElementById('remark').value = customer.비고 || '';

        // 5. 폼에 수정 모드 표시를 위한 데이터 속성 추가
        const form = document.getElementById('customerForm');
        form.setAttribute('data-mode', 'edit');
        form.setAttribute('data-customer-code', customerCode);

        // 6. 모달 표시
        modal.style.display = 'flex';

        console.log('✅ 매출처 수정 모달 열기 완료');
      } catch (error) {
        console.error('❌ 매출처 수정 오류:', error);
        alert('매출처 수정 중 오류가 발생했습니다: ' + error.message);
      }
    }

    /**
     * 매출처 삭제 함수
     * @param {string} customerCode - 매출처코드
     */
    async function deleteCustomer(customerCode) {
      try {
        console.log('===== 매출처 삭제 시작 =====');
        console.log('매출처코드:', customerCode);

        // 1. 삭제 확인
        if (
          !confirm('정말로 이 매출처를 삭제하시겠습니까?\n\n삭제된 데이터는 복구할 수 없습니다.')
        ) {
          console.log('❌ 사용자가 삭제를 취소했습니다.');
          return;
        }

        // 2. API 호출로 매출처 삭제
        const result = await apiCall(`/customers/${customerCode}`, 'DELETE');

        if (!result.success) {
          throw new Error(result.message || '매출처 삭제에 실패했습니다.');
        }

        console.log('✅ 매출처 삭제 성공:', result);

        // 3. 성공 메시지 표시
        alert('매출처가 성공적으로 삭제되었습니다.');

        // 4. 목록 새로고침 (DataTable 자동 새로고침)
        try {
          $('#customerTable').DataTable().ajax.reload(null, false);
          console.log('✅ 매출처 목록 새로고침 완료');
        } catch (e) {
          console.warn('⚠️ DataTable 새로고침 실패 (수동 새로고침 필요):', e);
        }
      } catch (error) {
        console.error('❌ 매출처 삭제 오류:', error);
        alert('매출처 삭제 중 오류가 발생했습니다: ' + error.message);
      }
    }

    

    // ✅ 매입처 목록 로드는 supplier.js의 DataTable이 자동으로 처리합니다.

    // ✅ 견적 목록 로드는 quotation.js의 DataTable이 자동으로 처리합니다.

    // 발주 목록 로드
    async function loadOrders() {
      try {
        const searchValue = document.getElementById('orderSearch')?.value || '';
        const tbody = document.getElementById('orderTableBody');
        tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터를 불러오는 중...</td></tr>';

        const result = await apiCall(
          `/orders?사업장코드=${currentUser.사업장코드}&search=${searchValue}`,
        );

        if (result.success) {
          tbody.innerHTML = '';

          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터가 없습니다.</td></tr>';
            return;
          }

          result.data.forEach((order) => {
            const statusMap = {
              1: { class: 'status-pending', text: '발주대기' },
              2: { class: 'status-pending', text: '발주완료' },
              3: { class: 'status-completed', text: '입고완료' },
            };
            const status = statusMap[order.상태코드] || statusMap[1];

            const tr = document.createElement('tr');
            tr.innerHTML = `
                            <td>PO${order.발주일자}-${order.발주번호}</td>
                            <td>${order.매입처명 || '-'}</td>
                            <td>${order.발주일자}</td>
                            <td>${order.입고희망일자 || '-'}</td>
                            <td>₩0</td>
                            <td>${order.사용자명 || '-'}</td>
                            <td><span class="status-badge ${status.class}">${status.text
              }</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon" onclick="viewOrder('${order.발주일자
              }', ${order.발주번호})">상세</button>
                                </div>
                            </td>
                        `;
            tbody.appendChild(tr);
          });
        }
      } catch (error) {
        console.error('발주 목록 로드 실패:', error);
        const tbody = document.getElementById('orderTableBody');
        tbody.innerHTML = `<tr><td colspan="8" class="loading" style="color: red;">오류: ${error.message}</td></tr>`;
      }
    }

    // 서브메뉴 토글
    function toggleSubmenu(element) {
      element.classList.toggle('open');
      const submenu = element.nextElementSibling;
      submenu.classList.toggle('open');
    }

    // 페이지 전환
    function showPage(pageName) {
      document.querySelectorAll('.page-content').forEach((page) => {
        page.classList.remove('active');
      });

      document.querySelectorAll('.menu-link').forEach((link) => {
        link.classList.remove('active');
      });
      document.querySelectorAll('.submenu-link').forEach((link) => {
        link.classList.remove('active');
      });

      const pageMap = {
        dashboard: {
          element: 'dashboardPage',
          title: '대시보드',
          menu: null,
          loadFunc: loadDashboardStats,
        },
        supplier: {
          element: 'supplierPage',
          title: '매입처관리',
          menu: 'purchase',
          loadFunc: null, // ✅ supplier.js의 DataTable이 자동으로 로드
        },
        order: {
          element: 'orderPage',
          title: '발주관리',
          menu: 'purchase',
          loadFunc: null, // ✅ order.js의 DataTable이 자동으로 로드
        },
        purchase: {
          element: 'purchasePage',
          title: '매입전표관리',
          menu: 'purchase',
          loadFunc: null,
        },
        customer: {
          element: 'customerPage',
          title: '매출처관리',
          menu: 'sales',
          loadFunc: null, // ✅ customer.js의 DataTable이 자동으로 로드
        },
        quotation: {
          element: 'quotationPage',
          title: '견적관리',
          menu: 'sales',
          loadFunc: null, // ✅ quotation.js의 DataTable이 자동으로 로드
        },
        transaction: {
          element: 'transactionPage',
          title: '거래명세서관리',
          menu: 'sales',
          loadFunc: null,
        },
      };

      if (pageMap[pageName]) {
        document.getElementById(pageMap[pageName].element).classList.add('active');
        document.getElementById('pageTitle').textContent = pageMap[pageName].title;

        if (pageMap[pageName].menu === 'purchase') {
          document.getElementById('purchaseMenu').classList.add('open');
          document.getElementById('purchaseSubmenu').classList.add('open');
        } else if (pageMap[pageName].menu === 'sales') {
          document.getElementById('salesMenu').classList.add('open');
          document.getElementById('salesSubmenu').classList.add('open');
        }

        // 페이지별 데이터 로드
        if (currentUser && pageMap[pageName].loadFunc) {
          pageMap[pageName].loadFunc();
        }
      }
    }

    // 로그아웃
    async function logout() {
      if (confirm('로그아웃 하시겠습니까?')) {
        try {
          await apiCall('/auth/logout', 'POST', { userId: currentUser.사용자코드 });
        } catch (error) {
          console.error('로그아웃 에러:', error);
        }

        currentUser = null;
        document.getElementById('dashboard').classList.remove('active');
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('loginForm').reset();
        document.getElementById('loginMessage').classList.remove('show');
      }
    }

    // 상세 조회 함수들
    // ==================== 매출처 상세보기/수정/삭제 기능 ====================

    // 매출처 상세보기
    async function viewCustomerDetail(customerCode) {
      try {
        const result = await apiCall(`/customers/${customerCode}`);

        if (!result.success) {
          alert('매출처 정보를 불러올 수 없습니다.');
          return;
        }

        const data = result.data;

        // 상세 정보 HTML 생성
        const detailHtml = `
          <div style="grid-column: 1 / -1; padding: 12px; background: #f8f9fa; border-radius: 8px;">
            <strong>매출처코드:</strong> ${data.매출처코드}
          </div>
          <div style="padding: 12px;">
            <strong>매출처명</strong><br/>
            ${data.매출처명 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>대표자명</strong><br/>
            ${data.대표자명 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>사업자번호</strong><br/>
            ${data.사업자번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>법인번호</strong><br/>
            ${data.법인번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>전화번호</strong><br/>
            ${data.전화번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>팩스번호</strong><br/>
            ${data.팩스번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>업태</strong><br/>
            ${data.업태 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>업종</strong><br/>
            ${data.업종 || '-'}
          </div>
          <div style="grid-column: 1 / -1; padding: 12px;">
            <strong>주소</strong><br/>
            ${data.주소 || ''} ${data.번지 || ''}
          </div>
          <div style="padding: 12px;">
            <strong>은행</strong><br/>
            ${data.은행코드 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>계좌번호</strong><br/>
            ${data.계좌번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>담당자명</strong><br/>
            ${data.담당자명 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>거래상태</strong><br/>
            <span class="status-badge ${data.사용구분 === 0 ? 'status-active' : 'status-pending'}">
              ${data.사용구분 === 0 ? '정상거래' : '거래보류'}
            </span>
          </div>
          <div style="grid-column: 1 / -1; padding: 12px;">
            <strong>비고</strong><br/>
            ${data.비고란 || '-'}
          </div>
        `;

        document.getElementById('customerDetailContent').innerHTML = detailHtml;
        document.getElementById('customerDetailModal').style.display = 'flex';
      } catch (error) {
        console.error('매출처 상세 조회 오류:', error);
        alert('매출처 정보를 불러오는 중 오류가 발생했습니다.');
      }
    }

    // 매출처 상세보기 모달 닫기
    function closeCustomerDetailModal() {
      document.getElementById('customerDetailModal').style.display = 'none';
    }

    // 매출처 수정
    async function editCustomer(customerCode) {
      try {
        // 1. 매출처 상세 정보 조회
        const result = await apiCall(`/customers/${customerCode}`);

        if (!result.success) {
          alert('매출처 정보를 불러올 수 없습니다.');
          return;
        }

        const data = result.data;

        // 2. 모달 열기
        const modal = document.getElementById('customerModal');
        if (!modal) {
          console.error('매출처 모달을 찾을 수 없습니다.');
          return;
        }

        // 3. 모달 제목 변경
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 수정';
        }

        // 4. 폼 필드에 데이터 채우기
        document.getElementById('customerCode').value = data.매출처코드;
        document.getElementById('customerName').value = data.매출처명 || '';
        document.getElementById('ceoName').value = data.대표자명 || '';
        document.getElementById('businessNo').value = data.사업자번호 || '';
        document.getElementById('businessType').value = data.업태 || '';
        document.getElementById('businessCategory').value = data.업종 || '';
        document.getElementById('phone').value = data.전화번호 || '';
        document.getElementById('fax').value = data.팩스번호 || '';
        document.getElementById('zipCode').value = data.우편번호 || '';
        document.getElementById('address').value = data.주소 || '';
        document.getElementById('addressDetail').value = data.번지 || '';
        document.getElementById('bankCode').value = data.은행코드 || '';
        document.getElementById('accountNo').value = data.계좌번호 || '';
        document.getElementById('managerName').value = data.담당자명 || '';
        document.getElementById('status').value = data.사용구분 || 0;
        document.getElementById('remark').value = data.비고란 || '';

        // 5. 폼에 수정 모드 표시를 위한 데이터 속성 추가
        const form = document.getElementById('customerForm');
        form.dataset.mode = 'edit';
        form.dataset.code = customerCode;

        // 6. 모달 표시
        modal.style.display = 'flex';
      } catch (error) {
        console.error('매출처 수정 준비 오류:', error);
        alert('매출처 정보를 불러오는 중 오류가 발생했습니다.');
      }
    }

    // 매출처 등록/수정 폼 제출
    async function submitCustomer(event) {
      event.preventDefault();

      try {
        const form = document.getElementById('customerForm');
        const isEditMode = form.dataset.mode === 'edit';
        const customerCode = form.dataset.code;

        // 폼 데이터 수집
        const formData = {
          매출처명: document.getElementById('customerName').value,
          사업자번호: document.getElementById('businessNo').value,
          대표자명: document.getElementById('ceoName').value,
          업태: document.getElementById('businessType').value,
          업종: document.getElementById('businessCategory').value,
          전화번호: document.getElementById('phone').value,
          팩스번호: document.getElementById('fax').value,
          우편번호: document.getElementById('zipCode').value,
          주소: document.getElementById('address').value,
          번지: document.getElementById('addressDetail').value,
          은행코드: document.getElementById('bankCode').value,
          계좌번호: document.getElementById('accountNo').value,
          담당자명: document.getElementById('managerName').value,
          사용구분: parseInt(document.getElementById('status').value),
          비고란: document.getElementById('remark').value,
        };

        let result;

        if (isEditMode) {
          // 수정 모드
          result = await apiCall(`/customers/${customerCode}`, 'PUT', formData);
        } else {
          // 신규 등록 모드
          formData.매출처코드 = document.getElementById('customerCode').value;
          result = await apiCall('/customers', 'POST', formData);
        }

        if (result.success) {
          alert(isEditMode ? '매출처가 수정되었습니다.' : '매출처가 등록되었습니다.');
          closeCustomerModal();

          // DataTable 새로고침
          try {
            $('#customerTable').DataTable().ajax.reload(null, false);
          } catch (e) {
            console.warn('DataTable 새로고침 실패:', e);
          }
        } else {
          alert('오류: ' + (result.message || '알 수 없는 오류'));
        }
      } catch (error) {
        console.error('매출처 저장 오류:', error);
        alert('매출처 저장 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 매출처 모달 닫기
    function closeCustomerModal() {
      const modal = document.getElementById('customerModal');
      if (modal) {
        modal.style.display = 'none';

        // 폼 초기화
        const form = document.getElementById('customerForm');
        form.reset();
        delete form.dataset.mode;
        delete form.dataset.code;

        // 모달 제목 복원
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 신규등록';
        }
      }
    }

    // 매출처 삭제 (모달 열기)
    async function deleteCustomer(customerCode) {
      try {
        console.log('===== 매출처 삭제 모달 열기 =====');
        console.log('매출처코드:', customerCode);

        // 1. API 호출로 매출처 정보 가져오기
        const result = await apiCall(`/customers/${customerCode}`, 'GET');

        if (!result.success || !result.data) {
          throw new Error(result.message || '매출처 정보를 불러올 수 없습니다.');
        }

        const customer = result.data;
        console.log('✅ 매출처 정보 로드 성공:', customer);

        // 2. 삭제할 매출처 정보를 모달에 표시
        const deleteContent = document.getElementById('customerDeleteContent');
        deleteContent.innerHTML = `
          <div style="
                background: #f8f9fa;
                border: 1px solid var(--border);
                border-radius: 8px;
                padding: 20px;
              ">
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">매출처코드</span>
              <p style="margin: 4px 0 0 0; font-size: 16px; font-weight: 600; color: var(--text-dark);">${customer.매출처코드}</p>
            </div>
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">매출처명</span>
              <p style="margin: 4px 0 0 0; font-size: 16px; font-weight: 600; color: var(--text-dark);">${customer.매출처명}</p>
            </div>
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">대표자</span>
              <p style="margin: 4px 0 0 0; font-size: 14px; color: var(--text-dark);">${customer.대표자명 || '-'}</p>
            </div>
            <div>
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">사업자번호</span>
              <p style="margin: 4px 0 0 0; font-size: 14px; color: var(--text-dark);">${customer.사업자번호 || '-'}</p>
            </div>
          </div>
        `;

        // 3. 모달에 매출처코드 저장 (삭제 시 사용)
        document.getElementById('customerDeleteModal').setAttribute('data-customer-code', customerCode);

        // 4. 모달 표시
        document.getElementById('customerDeleteModal').style.display = 'flex';
        console.log('✅ 삭제 모달 표시 완료');
      } catch (error) {
        console.error('❌ 매출처 삭제 모달 열기 오류:', error);
        alert('매출처 정보를 불러오는 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 매출처 삭제 모달 닫기
    function closeCustomerDeleteModal() {
      document.getElementById('customerDeleteModal').style.display = 'none';
      document.getElementById('customerDeleteContent').innerHTML = '';
      document.getElementById('customerDeleteModal').removeAttribute('data-customer-code');
      console.log('✅ 삭제 모달 닫기 완료');
    }

    // 매출처 삭제 확인 (실제 삭제)
    async function confirmDeleteCustomer() {
      try {
        const customerCode = document.getElementById('customerDeleteModal').getAttribute('data-customer-code');

        if (!customerCode) {
          throw new Error('삭제할 매출처 코드가 없습니다.');
        }

        console.log('===== 매출처 삭제 실행 =====');
        console.log('매출처코드:', customerCode);

        // 1. API 호출로 매출처 삭제
        const result = await apiCall(`/customers/${customerCode}`, 'DELETE');

        if (!result.success) {
          throw new Error(result.message || '매출처 삭제에 실패했습니다.');
        }

        console.log('✅ 매출처 삭제 성공:', result);

        // 2. 성공 메시지 표시
        alert('매출처가 성공적으로 삭제되었습니다.');

        // 3. 모달 닫기
        closeCustomerDeleteModal();

        // 4. 목록 새로고침 (DataTable)
        try {
          $('#customerTable').DataTable().ajax.reload(null, false);
          console.log('✅ 매출처 목록 새로고침 완료');
        } catch (e) {
          console.warn('⚠️ DataTable 새로고침 실패 (수동 새로고침 필요):', e);
        }
      } catch (error) {
        console.error('❌ 매출처 삭제 오류:', error);
        alert('매출처 삭제 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 신규 매출처 등록 모달 열기
    async function openNewCustomerModal() {
      try {
        console.log('===== 신규 매출처 등록 모달 열기 =====');

        // 1. 서버에서 새로운 매출처코드 생성 요청
        const result = await apiCall('/customer_new', 'GET');

        if (!result.success || !result.data) {
          throw new Error(result.message || '매출처코드를 생성할 수 없습니다.');
        }

        const newCustomerCode = result.data.매출처코드;
        console.log('✅ 생성된 매출처코드:', newCustomerCode);

        // 2. 모달 열기
        const modal = document.getElementById('customerModal');
        if (!modal) {
          throw new Error('모달을 찾을 수 없습니다.');
        }

        // 3. 폼 초기화
        const form = document.getElementById('customerForm');
        form.reset();
        form.removeAttribute('data-mode');
        form.removeAttribute('data-customer-code');

        // 4. 모달 제목 설정
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 신규등록';
        }

        // 5. 자동 생성된 매출처코드 설정
        document.getElementById('customerCode').value = newCustomerCode;
        document.getElementById('customerCode').readOnly = true;

        // 6. 모달 표시
        modal.style.display = 'flex';

        console.log('✅ 신규 등록 모달 열기 완료');
      } catch (error) {
        console.error('❌ 신규 등록 모달 열기 오류:', error);
        alert('신규 등록 모달을 열 수 없습니다: ' + error.message);
      }
    }

    // Google Sheets로 내보내기 (CSV 다운로드)
    function exportCustomersToGoogleSheets() {
      try {
        console.log('===== Google Sheets로 내보내기 시작 =====');

        // 1. DataTable에서 선택된 행 가져오기
        const table = $('#customerTable').DataTable();
        const selectedRows = [];

        // 체크박스가 선택된 행만 가져오기
        $('.customerCheckbox:checked').each(function () {
          const customerCode = $(this).data('code');
          const rowData = table.rows().data().toArray().find(row => row.매출처코드 === customerCode);
          if (rowData) {
            selectedRows.push(rowData);
          }
        });

        // 선택된 행이 없으면 전체 데이터 내보내기
        let dataToExport = selectedRows.length > 0 ? selectedRows : table.rows().data().toArray();

        if (dataToExport.length === 0) {
          alert('내보낼 데이터가 없습니다.');
          return;
        }

        console.log(`✅ 내보낼 데이터 수: ${dataToExport.length}건`);

        // 2. CSV 형식으로 변환
        const headers = ['매출처코드', '매출처명', '대표자', '사업자번호', '연락처', '거래상태', '등록일'];
        let csvContent = '\uFEFF'; // UTF-8 BOM 추가 (엑셀에서 한글 깨짐 방지)
        csvContent += headers.join(',') + '\n';

        dataToExport.forEach(row => {
          const rowArray = [
            row.매출처코드 || '',
            row.매출처명 || '',
            row.대표자명 || '',
            row.사업자번호 || '',
            row.전화번호 || '',
            row.사용구분 === 0 ? '정상거래' : '거래보류',
            row.등록일자 || ''
          ];

          // CSV 특수문자 처리 (쉼표, 따옴표, 줄바꿈 있으면 큰따옴표로 감싸기)
          const csvRow = rowArray.map(field => {
            const fieldStr = String(field);
            if (fieldStr.includes(',') || fieldStr.includes('"') || fieldStr.includes('\n')) {
              return '"' + fieldStr.replace(/"/g, '""') + '"';
            }
            return fieldStr;
          });

          csvContent += csvRow.join(',') + '\n';
        });

        // 3. Blob 생성 및 다운로드
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        if (link.download !== undefined) {
          const url = URL.createObjectURL(blob);
          const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');
          const filename = `매출처관리_${today}.csv`;

          link.setAttribute('href', url);
          link.setAttribute('download', filename);
          link.style.visibility = 'hidden';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          console.log('✅ CSV 파일 다운로드 완료:', filename);
          alert(`CSV 파일이 다운로드되었습니다.\n\nGoogle Sheets에서:\n1. 파일 > 가져오기\n2. 업로드 탭 선택\n3. 다운로드된 CSV 파일 선택\n4. 가져오기를 클릭하세요.`);
        }
      } catch (error) {
        console.error('❌ CSV 내보내기 오류:', error);
        alert('CSV 파일 생성 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 기존 viewCustomer 함수 (호환성 유지)
    async function viewCustomer(id) {
      // 새로운 상세보기 함수로 리다이렉트
      viewCustomerDetail(id);
    }

    async function viewSupplier(id) {
      try {
        const result = await apiCall(`/suppliers/${id}`);
        if (result.success) {
          alert(
            '매입처 정보:\n\n' +
            `매입처명: ${result.data.매입처명}\n` +
            `대표자: ${result.data.대표자명}\n` +
            `사업자번호: ${result.data.사업자번호}\n` +
            `전화번호: ${result.data.전화번호}\n` +
            `주소: ${result.data.주소} ${result.data.번지}`,
          );
        }
      } catch (error) {
        alert('매입처 조회 실패: ' + error.message);
      }
    }

    async function viewQuotation(date, no) {
      try {
        const result = await apiCall(`/quotations/${date}/${no}`);
        if (result.success) {
          console.log('견적 상세:', result.data);
          alert('견적 정보가 콘솔에 출력되었습니다.');
        }
      } catch (error) {
        alert('견적 조회 실패: ' + error.message);
      }
    }

    async function viewOrder(date, no) {
      try {
        const result = await apiCall(`/orders/${date}/${no}`);
        if (result.success) {
          console.log('발주 상세:', result.data);
          alert('발주 정보가 콘솔에 출력되었습니다.');
        }
      } catch (error) {
        alert('발주 조회 실패: ' + error.message);
      }
    }

    // ==================== Google Sheets 내보내기 기능 ====================

    // 매출처 Google Sheets 내보내기
    function exportCustomersToExcel() {
      try {
        console.log('===== 매출처 Google Sheets 내보내기 시작 =====');

        // 선택된 행 가져오기
        const checkboxes = document.querySelectorAll('.customerCheckbox:checked');

        if (checkboxes.length === 0) {
          alert('선택된 매출처가 없습니다.');
          return;
        }

        // 선택된 레코드의 데이터 수집
        const selectedData = [];
        checkboxes.forEach((checkbox) => {
          const row = checkbox.closest('tr');
          const cells = row.querySelectorAll('td');

          selectedData.push({
            번호: cells[1].textContent.trim(),
            매출처코드: cells[2].textContent.trim(),
            매출처명: cells[3].textContent.trim(),
            대표자: cells[4].textContent.trim(),
            사업자번호: cells[5].textContent.trim(),
            연락처: cells[6].textContent.trim(),
            거래상태: cells[7].textContent.trim(),
            등록일: cells[8].textContent.trim(),
          });
        });

        console.log('선택된 데이터:', selectedData);

        // CSV 형식으로 변환
        const headers = [
          '번호',
          '매출처코드',
          '매출처명',
          '대표자',
          '사업자번호',
          '연락처',
          '거래상태',
          '등록일',
        ];
        let csvContent = '\uFEFF' + headers.join(',') + '\n'; // UTF-8 BOM 추가

        selectedData.forEach((data) => {
          const row = [
            data.번호,
            data.매출처코드,
            `"${data.매출처명}"`, // 쉼표가 포함될 수 있으므로 따옴표로 감싸기
            data.대표자,
            data.사업자번호,
            data.연락처,
            data.거래상태,
            data.등록일,
          ];
          csvContent += row.join(',') + '\n';
        });

        // Blob 생성 및 다운로드
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        // 파일명 생성
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const date = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const fileName = `매출처_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

        // 다운로드 실행
        if (navigator.msSaveBlob) {
          // IE 10+
          navigator.msSaveBlob(blob, fileName);
        } else {
          link.href = URL.createObjectURL(blob);
          link.download = fileName;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        console.log('✅ CSV 파일 다운로드 완료:', fileName);

        // Google Sheets 안내
        alert(
          `${selectedData.length}개의 매출처 정보가 CSV로 다운로드되었습니다.\n\n📊 Google Sheets로 가져오기:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드 탭\n3. 다운로드된 CSV 파일 선택`,
        );
      } catch (error) {
        console.error('❌ Google Sheets 내보내기 오류:', error);
        alert('내보내기 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 매입처 Google Sheets 내보내기
    function exportSuppliersToExcel() {
      try {
        console.log('===== 매입처 Google Sheets 내보내기 시작 =====');

        // 선택된 행 가져오기
        const checkboxes = document.querySelectorAll('.supplierCheckbox:checked');

        if (checkboxes.length === 0) {
          alert('선택된 매입처가 없습니다.');
          return;
        }

        // 선택된 레코드의 데이터 수집
        const selectedData = [];
        checkboxes.forEach((checkbox) => {
          const row = checkbox.closest('tr');
          const cells = row.querySelectorAll('td');

          selectedData.push({
            번호: cells[1].textContent.trim(),
            매입처코드: cells[2].textContent.trim(),
            매입처명: cells[3].textContent.trim(),
            대표자: cells[4].textContent.trim(),
            사업자번호: cells[5].textContent.trim(),
            연락처: cells[6].textContent.trim(),
            거래상태: cells[7].textContent.trim(),
            작성자: cells[8].textContent.trim(),
          });
        });

        console.log('선택된 데이터:', selectedData);

        // CSV 형식으로 변환
        const headers = [
          '번호',
          '매입처코드',
          '매입처명',
          '대표자',
          '사업자번호',
          '연락처',
          '거래상태',
          '작성자',
        ];
        let csvContent = '\uFEFF' + headers.join(',') + '\n'; // UTF-8 BOM 추가

        selectedData.forEach((data) => {
          const row = [
            data.번호,
            data.매입처코드,
            `"${data.매입처명}"`, // 쉼표가 포함될 수 있으므로 따옴표로 감싸기
            data.대표자,
            data.사업자번호,
            data.연락처,
            data.거래상태,
            data.작성자,
          ];
          csvContent += row.join(',') + '\n';
        });

        // Blob 생성 및 다운로드
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        // 파일명 생성
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const date = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const fileName = `매입처_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

        // 다운로드 실행
        if (navigator.msSaveBlob) {
          // IE 10+
          navigator.msSaveBlob(blob, fileName);
        } else {
          link.href = URL.createObjectURL(blob);
          link.download = fileName;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        console.log('✅ CSV 파일 다운로드 완료:', fileName);

        // Google Sheets 안내
        alert(
          `${selectedData.length}개의 매입처 정보가 CSV로 다운로드되었습니다.\n\n📊 Google Sheets로 가져오기:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드 탭\n3. 다운로드된 CSV 파일 선택`,
        );
      } catch (error) {
        console.error('❌ Google Sheets 내보내기 오류:', error);
        alert('내보내기 중 오류가 발생했습니다: ' + error.message);
    }
  }

    // 견적 Google Sheets 내보내기
    function exportQuotationsToExcel() {
      try {
        console.log('===== 견적 Google Sheets 내보내기 시작 =====');

        const checkboxes = document.querySelectorAll('.quotationCheckbox:checked');

        if (checkboxes.length === 0) {
          alert('내보낼 견적을 선택해 주세요.');
          return;
        }

        const selectedData = [];
        checkboxes.forEach((checkbox) => {
          const row = checkbox.closest('tr');
          if (!row) return;
          const cells = row.querySelectorAll('td');
          if (cells.length < 9) return;

          selectedData.push({
            번호: cells[1]?.textContent.trim() || '',
            견적번호: cells[2]?.textContent.trim() || '',
            매출처명: cells[3]?.textContent.trim() || '',
            견적일자: cells[4]?.textContent.trim() || '',
            출고희망일: cells[5]?.textContent.trim() || '',
            비고: cells[6]?.textContent.trim() || '',
            담당자: cells[7]?.textContent.trim() || '',
            상태: cells[8]?.textContent.trim() || '',
          });
        });

        if (selectedData.length === 0) {
          alert('선택한 견적 행 정보를 불러오지 못했습니다. 다시 시도해 주세요.');
          return;
        }

        const headers = [
          '번호',
          '견적번호',
          '매출처명',
          '견적일자',
          '출고희망일',
          '비고',
          '담당자',
          '상태',
        ];

        const escapeCsv = (value) => {
          const text = (value ?? '').replace(/"/g, '""');
          return `"${text}"`;
        };

        let csvContent = '\uFEFF' + headers.join(',') + '\n';
        selectedData.forEach((item) => {
          const row = [
            item.번호,
            item.견적번호,
            item.매출처명,
            item.견적일자,
            item.출고희망일,
            item.비고,
            item.담당자,
            item.상태,
          ].map(escapeCsv);
          csvContent += row.join(',') + '\n';
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const date = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const fileName = `견적_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

        if (navigator.msSaveBlob) {
          navigator.msSaveBlob(blob, fileName);
        } else {
          link.href = URL.createObjectURL(blob);
          link.download = fileName;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        console.log('CSV 파일 다운로드 완료:', fileName);
        alert(
          `${selectedData.length}개의 견적 정보가 CSV로 내려받아졌습니다.\n\nGoogle Sheets에서 불러오려면:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드\n3. 방금 다운로드한 CSV 파일 선택`,
        );
      } catch (error) {
        console.error('견적 Google Sheets 내보내기 오류:', error);
        alert('내보내기 중 오류가 발생했습니다: ' + error.message);
      }
    }
  </script>

  <!-- HTML의 </body> 직전에 모달 HTML 추가 -->

  <!-- 매출처 신규등록 모달 -->
  <div id="customerModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      ">
    <div style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        ">
      <!-- 고정된 제목 영역 -->
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
          매출처 신규등록
        </h2>
        <button onclick="closeCustomerModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <form id="customerForm" onsubmit="submitCustomer(event)">
        <!-- 1. 매출처코드 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매출처코드</label>
          <input type="text" id="customerCode" name="customerCode" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="자동생성" />
        </div>

        <!-- 2. 매출처명 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매출처명 *</label>
          <input type="text" id="customerName" name="customerName" required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="매출처명" />
        </div>

        <!-- 3. 대표자명 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">대표자명</label>
          <input type="text" id="ceoName" name="ceoName" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="대표자명" />
        </div>

        <!-- 4. 사업자번호 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">사업자번호</label>
          <input type="text" id="businessNo" name="businessNo" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="000-00-00000" />
        </div>

        <!-- 5. 업태 & 업종 (1:1 비율) -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px">
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업태</label>
            <input type="text" id="businessType" name="businessType" style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="업태" />
          </div>
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업종</label>
            <input type="text" id="businessCategory" name="businessCategory" style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="업종" />
          </div>
        </div>

        <!-- 6. 연락처 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">연락처</label>
          <input type="tel" id="phone" name="phone" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="010-0000-0000" />
        </div>

        <!-- 7. 팩스번호 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">팩스번호</label>
          <input type="tel" id="fax" name="fax" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="02-0000-0000" />
        </div>

        <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">우편번호</label>
          <div style="display: flex; gap: 8px">
            <input type="text" id="zipCode" name="zipCode" readonly style="
                  flex: 1;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                  background-color: #f5f5f5;
                " placeholder="00000" />
            <button type="button" onclick="execDaumPostcode()" style="
                  padding: 10px 20px;
                  background: var(--primary);
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  white-space: nowrap;
                ">
              찾기
            </button>
          </div>
        </div>

        <!-- 9. 주소 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">주소</label>
          <input type="text" id="address" name="address" readonly style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                background-color: #f5f5f5;
              " placeholder="주소" />
        </div>

        <!-- 10. 상세주소 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">상세주소</label>
          <input type="text" id="addressDetail" name="addressDetail" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="상세주소를 입력하세요" />
        </div>

        <!-- 11. 은행 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">은행</label>
          <select id="bankCode" name="bankCode" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              ">
            <option value="">선택하세요</option>
            <option value="01">한국은행</option>
            <option value="02">산업은행</option>
            <option value="03">기업은행</option>
            <option value="04">국민은행</option>
            <option value="05">농협</option>
            <option value="06">하나은행</option>
            <option value="07">우리은행</option>
            <option value="08">SC은행</option>
            <option value="09">씨티은행</option>
          </select>
        </div>

        <!-- 12. 계좌번호 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">계좌번호</label>
          <input type="text" id="accountNo" name="accountNo" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="계좌번호" />
        </div>

        <!-- 13. 담당자명 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">담당자명</label>
          <input type="text" id="managerName" name="managerName" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="담당자명" />
        </div>

        <!-- 14. 거래상태 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">거래상태</label>
          <select id="status" name="status" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              ">
            <option value="0">정상거래</option>
            <option value="1">거래보류</option>
          </select>
        </div>

        <!-- 15. 비고란 (전체 너비) -->
        <div style="margin-bottom: 24px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">비고란</label>
          <textarea id="remark" name="remark" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
                min-height: 80px;
              " placeholder="비고"></textarea>
        </div>

        <!-- 버튼 영역 -->
        <div style="display: flex; gap: 12px; justify-content: flex-end">
          <button type="button" onclick="closeCustomerModal()" style="
                padding: 10px 24px;
                background: var(--bg-light);
                border: 1px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: var(--text-dark);
              ">
            취소
          </button>
          <button type="submit" style="
                padding: 10px 24px;
                background: var(--primary);
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
              ">
            등록
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 매출처 삭제 확인 모달 -->
  <div id="customerDeleteModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <!-- 헤더 -->
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
          매출처 삭제
        </h2>
        <button onclick="closeCustomerDeleteModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <!-- 삭제할 매출처 정보 표시 -->
      <div id="customerDeleteContent" style="margin-bottom: 24px;">
        <!-- 매출처 정보가 여기에 동적으로 로드됩니다 -->
      </div>

      <!-- 경고 메시지 -->
      <div style="
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
          ">
        <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6;">
          <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.<br>
          삭제된 데이터는 복구할 수 없습니다.
        </p>
      </div>

      <!-- 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end">
        <button type="button" onclick="closeCustomerDeleteModal()" style="
              padding: 10px 24px;
              background: var(--bg-light);
              border: 1px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: var(--text-dark);
            ">
          취소
        </button>
        <button type="button" onclick="confirmDeleteCustomer()" style="
              padding: 10px 24px;
              background: #dc3545;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            ">
          삭제
        </button>
      </div>
    </div>
  </div>

  <!-- 매출처 상세보기 모달 -->
  <div id="customerDetailModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700;">매출처 상세정보</h2>
        <button onclick="closeCustomerDetailModal()" style="
          background: none; border: none; font-size: 28px; cursor: pointer; color: #999;">×</button>
      </div>

      <div id="customerDetailContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <!-- 상세 정보가 여기에 동적으로 로드됩니다 -->
      </div>

      <div style="margin-top: 24px; display: flex; justify-content: flex-end;">
        <button onclick="closeCustomerDetailModal()" class="btn btn-secondary">닫기</button>
      </div>
    </div>
  </div>

  <!-- 견적서 작성/수정 모달 -->
  <div id="quotationModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
      <!-- 헤더 -->
      <div id="quotationModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
            user-select: none;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)" id="quotationModalTitle">
          견적서 작성
        </h2>
        <button onclick="closeQuotationModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <form id="quotationForm" onsubmit="submitQuotation(event)">
        <!-- 마스터 정보 섹션 -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 24px;">
          <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">기본 정보</h3>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <!-- 견적일자 -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">견적일자 *</label>
              <input type="date" id="quotationDate" required style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid var(--border);
                    border-radius: 8px;
                    font-size: 14px;
                  " />
            </div>

            <!-- 출고희망일자 -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">출고희망일자</label>
              <input type="date" id="deliveryDate" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid var(--border);
                    border-radius: 8px;
                    font-size: 14px;
                  " />
            </div>

            <!-- 매출처 선택 -->
            <div style="grid-column: 1 / -1;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">매출처 *</label>
              <div style="display: flex; gap: 8px;">
                <input type="text" id="selectedCustomerCode" readonly style="
                      width: 120px;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f5f5f5;
                    " placeholder="코드" />
                <input type="text" id="selectedCustomerName" readonly required style="
                      flex: 1;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f5f5f5;
                    " placeholder="매출처를 선택하세요" />
                <button type="button" onclick="openCustomerSearchModal()" style="
                      padding: 10px 20px;
                      background: var(--primary);
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      white-space: nowrap;
                    ">
                  매출처 검색
                </button>
              </div>
            </div>

            <!-- 제목 -->
            <div style="grid-column: 1 / -1;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">제목</label>
              <input type="text" id="quotationTitle" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid var(--border);
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="견적서 제목을 입력하세요" />
            </div>

            <!-- 적요 -->
            <div style="grid-column: 1 / -1;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">적요</label>
              <textarea id="quotationRemark" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid var(--border);
                    border-radius: 8px;
                    font-size: 14px;
                    resize: vertical;
                    min-height: 80px;
                  " placeholder="비고사항을 입력하세요"></textarea>
            </div>
          </div>
        </div>

        <!-- 상세내역 섹션 -->
        <div style="margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">견적 상세내역</h3>
            <button type="button" onclick="openMaterialSearchModal()" style="
                  padding: 8px 16px;
                  background: #007bff;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
              + 자재 추가
            </button>
          </div>

          <!-- 상세내역 테이블 -->
          <div style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px;">
            <table id="quotationDetailTable" style="width: 100%; border-collapse: collapse;">
              <thead style="background: #f8f9fa;">
                <tr>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); width: 40px;">순번</th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">자재코드</th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">자재명</th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border);">규격</th>
                  <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 100px;">수량</th>
                  <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 120px;">단가</th>
                  <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 120px;">공급가</th>
                  <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 100px;">부가세</th>
                  <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); width: 60px;">삭제</th>
                </tr>
              </thead>
              <tbody id="quotationDetailTableBody">
                <tr>
                  <td colspan="9" style="padding: 40px; text-align: center; color: #999;">
                    자재 추가 버튼을 클릭하여 견적 상세내역을 입력하세요
                  </td>
                </tr>
              </tbody>
              <tfoot style="background: #f8f9fa; font-weight: 600;">
                <tr>
                  <td colspan="6" style="padding: 12px; text-align: right; border-top: 2px solid var(--border);">합계</td>
                  <td id="totalSupplyPrice" style="padding: 12px; text-align: right; border-top: 2px solid var(--border);">0</td>
                  <td id="totalVat" style="padding: 12px; text-align: right; border-top: 2px solid var(--border);">0</td>
                  <td style="padding: 12px; border-top: 2px solid var(--border);"></td>
                </tr>
                <tr>
                  <td colspan="6" style="padding: 12px; text-align: right;">총액</td>
                  <td colspan="2" id="grandTotal" style="padding: 12px; text-align: right; color: #007bff; font-size: 16px;">0</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- 버튼 영역 -->
        <div style="display: flex; gap: 12px; justify-content: flex-end;">
          <button type="button" onclick="closeQuotationModal()" style="
                padding: 10px 24px;
                background: var(--bg-light);
                border: 1px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: var(--text-dark);
              ">
            취소
          </button>
          <button type="submit" style="
                padding: 10px 24px;
                background: var(--primary);
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
              ">
            견적서 등록
          </button>
        </div>
      </form>
    </div>
  </div>


  <!-- ✅ 매출처 검색 모달 -->
  <div id="customerSearchModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">매출처 검색</h3>
        <button onclick="closeCustomerSearchModal()" style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        ">×</button>
      </div>

      <div style="display: flex; gap: 10px; margin-bottom: 16px;">
        <input type="text" id="customerSearchInput" placeholder="매출처명 또는 코드 검색"
          onkeypress="if(event.key === 'Enter') searchCustomers()" style="
          flex: 1;
          padding: 10px 12px;
          border: 2px solid #e5e7eb;
          border-radius: 6px;
        " />
        <button onclick="searchCustomers()" style="
          padding: 10px 20px;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        ">검색</button>
      </div>

      <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
        <table id="customerSearchTable" style="width: 100%; border-collapse: collapse;">
          <thead style="background: #f8f9fa; position: sticky; top: 0;">
            <tr>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">코드</th>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">매출처명</th>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">전화번호</th>
              <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb;">선택</th>
            </tr>
          </thead>
          <tbody id="customerSearchTableBody">
            <tr>
              <td colspan="4" style="padding: 40px; text-align: center; color: #999;">
                검색 버튼을 클릭하여 매출처를 검색하세요
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ✅ 자재 선택 모달 (견적서 작성용) -->
  <div id="materialSearchModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 900px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">자재 검색 및 추가</h3>
        <button onclick="closeMaterialSearchModal()" style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        ">×</button>
      </div>

      <div style="display: flex; gap: 10px; margin-bottom: 16px;">
        <input type="text" id="materialSearchInput2" placeholder="자재명 또는 코드 검색"
          onkeypress="if(event.key === 'Enter') searchMaterialsForQuotation()" style="
          flex: 1;
          padding: 10px 12px;
          border: 2px solid #e5e7eb;
          border-radius: 6px;
        " />
        <button onclick="searchMaterialsForQuotation()" style="
          padding: 10px 20px;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        ">검색</button>
      </div>

      <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
        <table id="materialSearchTable" style="width: 100%; border-collapse: collapse;">
          <thead style="background: #f8f9fa; position: sticky; top: 0;">
            <tr>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">자재코드</th>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">자재명</th>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">규격</th>
              <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb;">출고단가</th>
              <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb;">이전단가</th>
              <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb;">선택</th>
            </tr>
          </thead>
          <tbody id="materialSearchTableBody">
            <tr>
              <td colspan="6" style="padding: 40px; text-align: center; color: #999;">
                검색 버튼을 클릭하여 자재를 검색하세요
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ✅ 자재 선택 모달 (기존 - 견적 수정용) -->
  <div id="materialSelectModal" class="modal hidden">
    <div class="modal-content large">
      <span id="closeMaterialModal" class="close">&times;</span>
      <h3>자재 선택</h3>

      <div style="display:flex; gap:10px; margin-bottom:10px;">
        <input type="text" id="materialSearch" placeholder="자재명 또는 코드 검색" class="form-input" style="flex:1;">
        <button class="btn btn-primary" onclick="searchMaterials()">검색</button>
      </div>

      <table id="materialTable" class="display" style="width:100%;">
        <thead>
          <tr>
            <th>자재코드</th>
            <th>자재명</th>
            <th>규격</th>
            <th>단가</th>
            <th>선택</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- 테스트용 간단한 모달 -->
  <div id="testSimpleModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">자재 목록 (테스트)</h3>
        <button onclick="closeTestSimpleModal()" style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        ">×</button>
      </div>
      <div style="padding: 40px; text-align: center; color: #666;">
        테스트용 간단한 모달입니다.
      </div>
    </div>
  </div>

  <!-- 신규 견적서용 품목 추가 모달 -->
  <div id="newQuotationMaterialModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 추가</h2>
        <button onclick="closeNewQuotationMaterialModal()" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px;">
        <!-- 자재 검색 영역 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">자재 검색</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" id="newMaterialSearchInput" style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " placeholder="자재명 또는 품목코드로 검색" onkeypress="if(event.key === 'Enter') searchNewMaterials()" />
            <button onclick="searchNewMaterials()" style="
              padding: 10px 20px;
              background: #3b82f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            " onmouseover="this.style.background='#2563eb';"
               onmouseout="this.style.background='#3b82f6';">
              검색
            </button>
          </div>
        </div>

        <!-- 검색 결과 테이블 -->
        <div id="newMaterialSearchResults" style="display: none;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">검색 결과 (클릭하여 선택)</label>
          <div style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead style="background: #f9fafb; position: sticky; top: 0;">
                <tr>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품목코드</th>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품명</th>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">규격</th>
                </tr>
              </thead>
              <tbody id="newMaterialSearchTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- 선택된 자재 정보 -->
        <div id="newSelectedMaterialInfo" style="display: none; background: #f0f9ff; padding: 12px; border-radius: 8px; border: 2px solid #bfdbfe;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
              <div style="font-weight: 600; color: #1e40af;" id="newSelectedMaterialName">-</div>
              <div style="font-size: 12px; color: #6b7280; margin-top: 2px;" id="newSelectedMaterialCode">-</div>
            </div>
            <button onclick="clearNewSelectedMaterial()" style="
              padding: 6px 12px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 12px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            ">취소</button>
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">수량</label>
          <input type="number" id="newDetailQuantity" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          " placeholder="수량 입력" value="1" min="0" step="0.01" />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">출고단가</label>
          <div style="display: flex; gap: 8px;">
            <input type="number" id="newDetailPrice" style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " placeholder="단가 입력" value="0" min="0" step="0.01" />
            <button onclick="showNewPriceHistory()" style="
              padding: 10px 16px;
              background: #8b5cf6;
              border: none;
              border-radius: 8px;
              font-size: 13px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            " onmouseover="this.style.background='#7c3aed';"
               onmouseout="this.style.background='#8b5cf6';">
              이전 단가
            </button>
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">금액 (자동계산)</label>
          <input type="text" id="newDetailAmount" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: #f9fafb;
          " readonly value="0" />
        </div>
      </div>

      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
        <button onclick="closeNewQuotationMaterialModal()" style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb';"
           onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button onclick="confirmNewQuotationMaterialAdd()" style="
          padding: 12px 24px;
          background: #10b981;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        " onmouseover="this.style.background='#059669';"
           onmouseout="this.style.background='#10b981';">
          추가하기
        </button>
      </div>
    </div>
  </div>

  <!-- 신규 견적서 전용 단가 이력 모달 -->
  <div id="newQuotationPriceHistoryModal" class="modal" style="display: none; position: fixed; z-index: 10000;">
    <div class="modal-content" style="max-width: 700px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-top: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">출고단가 이력</h2>
        <button id="closeNewPriceHistoryModal" onclick="closeNewPriceHistoryModal()" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 자재 정보 -->
      <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 2px solid #fbbf24;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
            <div style="font-weight: 600; color: #78350f;" id="newPriceHistoryMaterialName">-</div>
            <div style="font-size: 12px; color: #92400e; margin-top: 2px;" id="newPriceHistoryMaterialCode">-</div>
          </div>
        </div>
      </div>

      <!-- ✅ 탭 메뉴 -->
      <div style="display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <button id="newTabActualPrice" onclick="switchNewPriceHistoryTab('actual')" style="
          padding: 12px 20px;
          background: #3b82f6;
          border: none;
          border-bottom: 3px solid #3b82f6;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
          flex: 1;
        ">
          실제 출고가
        </button>
        <button id="newTabQuotationPrice" onclick="switchNewPriceHistoryTab('quotation')" style="
          padding: 12px 20px;
          background: transparent;
          border: none;
          border-bottom: 3px solid transparent;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s;
          flex: 1;
        " onmouseover="if(this.id !== 'newTabActualPrice' || this.style.background === 'transparent') this.style.color='#1f2937';"
           onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';">
          견적 제안가
        </button>
      </div>

      <!-- 이력 테이블 -->
      <div style="margin-bottom: 16px;">
        <label id="newPriceHistoryLabel" style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
          이 거래처에 실제 출고한 이력 (클릭하여 단가 선택)
        </label>
        <div style="max-height: 300px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
          <table id="newPriceHistoryTable" style="width: 100%; border-collapse: collapse;">
            <thead id="newPriceHistoryTableHead" style="background: #f9fafb; position: sticky; top: 0;">
              <tr>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 13px;">출고일자</th>
                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb; font-size: 13px;">출고단가</th>
                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb; font-size: 13px;">출고수량</th>
                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb; font-size: 13px;">적요</th>
              </tr>
            </thead>
            <tbody id="newPriceHistoryTableBody">
              <tr>
                <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af;">
                  이력이 없습니다
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 2px solid #e5e7eb;">
        <button onclick="closeNewPriceHistoryModal()" style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb';"
           onmouseout="this.style.background='#f3f4f6';">
          닫기
        </button>
      </div>
    </div>
  </div>

  <!-- 매입처 신규등록 모달 -->
  <div id="supplierModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      ">
    <div style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        ">
      <!-- 고정된 제목 영역 -->
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
          매입처 신규등록
        </h2>
        <button onclick="closeSupplierModal()" style="
              background: none;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: var(--text-gray);
            ">
          ×
        </button>
      </div>

      <form id="supplierForm" onsubmit="submitSupplier(event)">
        <!-- 1. 매입처코드 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매입처코드</label>
          <input type="text" id="supplierCode" name="supplierCode" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="자동생성" />
        </div>

        <!-- 2. 매입처명 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매입처명 *</label>
          <input type="text" id="supplierName" name="supplierName" required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="매입처명" />
        </div>

        <!-- 3. 대표자명 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">대표자명</label>
          <input type="text" id="supplierCeoName" name="supplierCeoName" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="대표자명" />
        </div>

        <!-- 4. 사업자번호 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">사업자번호</label>
          <input type="text" id="supplierBusinessNo" name="supplierBusinessNo" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="000-00-00000" />
        </div>

        <!-- 5. 업태 & 업종 (1:1 비율) -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px">
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업태</label>
            <input type="text" id="supplierBusinessType" name="supplierBusinessType" style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="업태" />
          </div>
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업종</label>
            <input type="text" id="supplierBusinessCategory" name="supplierBusinessCategory" style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="업종" />
          </div>
        </div>

        <!-- 6. 연락처 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">연락처</label>
          <input type="tel" id="supplierPhone" name="supplierPhone" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="010-0000-0000" />
        </div>

        <!-- 7. 팩스번호 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">팩스번호</label>
          <input type="tel" id="supplierFax" name="supplierFax" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="02-0000-0000" />
        </div>

        <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">우편번호</label>
          <div style="display: flex; gap: 8px">
            <input type="text" id="supplierZipCode" name="supplierZipCode" readonly style="
                  flex: 1;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                  background-color: #f5f5f5;
                " placeholder="00000" />
            <button type="button" onclick="execDaumPostcode('supplier')" style="
                  padding: 10px 20px;
                  background: var(--primary);
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  white-space: nowrap;
                ">
              찾기
            </button>
          </div>
        </div>

        <!-- 9. 주소 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">주소</label>
          <input type="text" id="supplierAddress" name="supplierAddress" readonly style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                background-color: #f5f5f5;
              " placeholder="주소" />
        </div>

        <!-- 10. 상세주소 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">상세주소</label>
          <input type="text" id="supplierAddressDetail" name="supplierAddressDetail" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="상세주소를 입력하세요" />
        </div>

        <!-- 11. 은행 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">은행</label>
          <select id="supplierBankCode" name="supplierBankCode" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              ">
            <option value="">선택하세요</option>
            <option value="01">한국은행</option>
            <option value="02">산업은행</option>
            <option value="03">기업은행</option>
            <option value="04">국민은행</option>
            <option value="05">농협</option>
            <option value="06">하나은행</option>
            <option value="07">우리은행</option>
            <option value="08">SC은행</option>
            <option value="09">씨티은행</option>
          </select>
        </div>

        <!-- 12. 계좌번호 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">계좌번호</label>
          <input type="text" id="supplierAccountNo" name="supplierAccountNo" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="계좌번호" />
        </div>

        <!-- 13. 담당자명 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">담당자명</label>
          <input type="text" id="supplierManagerName" name="supplierManagerName" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              " placeholder="담당자명" />
        </div>

        <!-- 14. 거래상태 (전체 너비) -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">거래상태</label>
          <select id="supplierStatus" name="supplierStatus" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              ">
            <option value="0">정상거래</option>
            <option value="1">거래보류</option>
          </select>
        </div>

        <!-- 15. 비고란 (전체 너비) -->
        <div style="margin-bottom: 24px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">비고란</label>
          <textarea id="supplierRemark" name="supplierRemark" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
                min-height: 80px;
              " placeholder="비고"></textarea>
        </div>

        <!-- 버튼 영역 -->
        <div style="display: flex; gap: 12px; justify-content: flex-end">
          <button type="button" onclick="closeSupplierModal()" style="
                padding: 10px 24px;
                background: var(--bg-light);
                border: 1px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: var(--text-dark);
              ">
            취소
          </button>
          <button type="submit" style="
                padding: 10px 24px;
                background: var(--primary);
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
              ">
            등록
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 매입처 상세보기 모달 -->
  <div id="supplierDetailModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700;">매입처 상세정보</h2>
        <button onclick="closeSupplierDetailModal()" style="
          background: none; border: none; font-size: 28px; cursor: pointer; color: #999;">×</button>
      </div>

      <div id="supplierDetailContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
        <!-- 상세 정보가 여기에 동적으로 로드됩니다 -->
      </div>

      <div style="margin-top: 24px; display: flex; justify-content: flex-end;">
        <button onclick="closeSupplierDetailModal()" class="btn btn-secondary">닫기</button>
      </div>
    </div>
  </div>

  <!-- 매입처 삭제 확인 모달 -->
  <div id="supplierDeleteModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <!-- 헤더 -->
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
          매입처 삭제
        </h2>
        <button onclick="closeSupplierDeleteModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <!-- 삭제할 매입처 정보 표시 -->
      <div id="supplierDeleteContent" style="margin-bottom: 24px;">
        <!-- 매입처 정보가 여기에 동적으로 로드됩니다 -->
      </div>

      <!-- 경고 메시지 -->
      <div style="
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
          ">
        <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6;">
          <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.<br>
          삭제된 데이터는 복구할 수 없습니다.
        </p>
      </div>

      <!-- 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end">
        <button type="button" onclick="closeSupplierDeleteModal()" style="
              padding: 10px 24px;
              background: var(--bg-light);
              border: 1px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: var(--text-dark);
            ">
          취소
        </button>
        <button type="button" onclick="confirmDeleteSupplier()" style="
              padding: 10px 24px;
              background: #dc3545;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            ">
          삭제
        </button>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!-- 발주관리 모달들 -->
  <!-- ========================= -->

  <!-- 발주 상세보기 모달 -->
  <div id="orderDetailModal" class="modal hidden">
    <div class="modal-content large" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
      <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">발주 상세 보기</h2>
        <button id="closeOrderDetailModal" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 발주 상세 정보 (동적으로 로드) -->
      <div id="orderDetailContent">
        <!-- order.js에서 동적으로 채워집니다 -->
      </div>
    </div>
  </div>

  <!-- 발주 작성/수정 모달 -->
  <div id="orderModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
      <!-- ✅ 헤더 영역 -->
      <div id="orderModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
            user-select: none;
          ">
        <h2 id="orderModalTitle" style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark);">발주서 작성</h2>
        <button onclick="closeOrderModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <form id="orderForm" onsubmit="submitNewOrder(event)">
        <!-- ✅ 발주 마스터 정보 (카드 스타일) -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 24px;">
          <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">발주 기본 정보</h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
            <!-- 사업장코드 -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                사업장 <span style="color: #ef4444;">*</span>
              </label>
              <select id="orderWorkplace" class="form-control" required style="width: 100%;">
                <option value="">사업장 선택</option>
              </select>
            </div>

            <!-- 매입처 선택 -->
            <div style="grid-column: 1 / -1;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;">매입처 *</label>
              <div style="display: flex; gap: 8px;">
                <!-- 숨겨진 매입처 코드 필드 (실제 값 저장용) -->
                <input type="hidden" id="selectedSupplierCode" />

                <!-- 통합 검색 입력란 -->
                <input type="text" id="selectedSupplierName" required style="
                      flex: 1;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="매입처 코드 또는 이름 입력 후 엔터" onkeypress="if(event.key === 'Enter') { event.preventDefault(); openSupplierSearchModal(); }" />
                <button type="button" onclick="openSupplierSearchModal()" style="
                      padding: 10px 20px;
                      background: var(--primary);
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      white-space: nowrap;
                    ">
                  검색
                </button>
              </div>
              <!-- 선택된 매입처 정보 표시 -->
              <div id="selectedSupplierInfo" style="display: none; margin-top: 8px; padding: 8px 12px; background: #f0f9ff; border-radius: 6px; border: 1px solid #bfdbfe;">
                <span style="font-size: 12px; color: #3b82f6; font-weight: 600;">선택된 매입처:</span>
                <span id="selectedSupplierDisplay" style="margin-left: 8px; font-weight: 600; color: #1e40af;"></span>
              </div>
            </div>

            <!-- 발주일자 -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                발주일자 <span style="color: #ef4444;">*</span>
              </label>
              <input type="date" id="orderDate" class="form-control" required style="width: 100%;" />
            </div>

            <!-- 입고희망일자 -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                입고희망일자
              </label>
              <input type="date" id="orderDeliveryDate" class="form-control" style="width: 100%;" />
            </div>

            <!-- 결제방법 -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                결제방법
              </label>
              <select id="orderPaymentMethod" class="form-control" style="width: 100%;">
                <option value="">선택</option>
                <option value="현금">현금</option>
                <option value="카드">카드</option>
                <option value="계좌이체">계좌이체</option>
                <option value="어음">어음</option>
              </select>
            </div>

            <!-- 상태 -->
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                상태
              </label>
              <select id="orderStatus" class="form-control" style="width: 100%;">
                <option value="0">발주대기</option>
                <option value="1">발주완료</option>
                <option value="2">입고완료</option>
              </select>
            </div>

            <!-- 제목 (전체 너비) -->
            <div style="grid-column: 1 / -1;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                제목 <span style="color: #ef4444;">*</span>
              </label>
              <input type="text" id="orderTitle" class="form-control" required placeholder="발주 제목을 입력하세요" style="width: 100%;" />
            </div>

            <!-- 적요 (전체 너비) -->
            <div style="grid-column: 1 / -1;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
                적요
              </label>
              <textarea id="orderRemarks" class="form-control" rows="3" placeholder="발주 내용을 입력하세요" style="width: 100%; resize: vertical;"></textarea>
            </div>
          </div>
        </div>

        <!-- ✅ 발주 품목 내역 -->
        <div style="margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h3 style="margin: 0; font-size: 18px; font-weight: 600;">발주 상세내역</h3>
            <button type="button" onclick="openOrderMaterialSearchModal()" style="
                  padding: 8px 16px;
                  background: #007bff;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
              + 자재 추가
            </button>
          </div>

          <div id="newOrderDetailTableContainer" style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background: white; border: 1px solid #e5e7eb;">
              <thead style="background: #f3f4f6;">
                <tr>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: center; width: 50px;">No</th>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: left;">자재명</th>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: center; width: 120px;">규격</th>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: right; width: 100px;">발주량</th>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: right; width: 120px;">입고단가</th>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: right; width: 120px;">출고단가</th>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: right; width: 130px;">공급가액</th>
                  <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: center; width: 80px;">삭제</th>
                </tr>
              </thead>
              <tbody id="newOrderDetailTableBody">
                <tr>
                  <td colspan="8" style="padding: 40px; text-align: center; color: #999; border: 1px solid #e5e7eb;">
                    자재를 추가해주세요
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- ✅ 저장 버튼 -->
        <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 2px solid #e5e7eb;">
          <button type="button" onclick="closeOrderModal()" style="
            padding: 12px 24px;
            background: #f3f4f6;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: #374151;
            transition: all 0.2s;
          " onmouseover="this.style.background='#e5e7eb';"
             onmouseout="this.style.background='#f3f4f6';">
            취소
          </button>
          <button type="submit" style="
            padding: 12px 24px;
            background: #3b82f6;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: white;
            transition: all 0.2s;
          " onmouseover="this.style.background='#2563eb';"
             onmouseout="this.style.background='#3b82f6';">
            저장하기
          </button>
        </div>
      </form>
    </div>
  </div>

    <!-- ✅ 매입처 검색 모달 -->
  <div id="supplierSearchModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0;">매입처 검색</h3>
        <button onclick="closeSupplierSearchModal()" style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        ">×</button>
      </div>

      <div style="display: flex; gap: 10px; margin-bottom: 16px;">
        <input type="text" id="supplierSearchInput" placeholder="매입처명 또는 코드 검색"
          onkeypress="if(event.key === 'Enter') searchSuppliers()" style="
          flex: 1;
          padding: 10px 12px;
          border: 2px solid #e5e7eb;
          border-radius: 6px;
        " />
        <button onclick="searchSuppliers()" style="
          padding: 10px 20px;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        ">검색</button>
      </div>

      <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px;">
        <table id="supplierSearchTable" style="width: 100%; border-collapse: collapse;">
          <thead style="background: #f8f9fa; position: sticky; top: 0;">
            <tr>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">코드</th>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">매입처명</th>
              <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb;">전화번호</th>
              <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb;">선택</th>
            </tr>
          </thead>
          <tbody id="supplierSearchTableBody">
            <tr>
              <td colspan="4" style="padding: 40px; text-align: center; color: #999;">
                검색 버튼을 클릭하여 매입처를 검색하세요
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 신규 발주서용 품목 추가 모달 -->
  <div id="newOrderMaterialModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 추가</h2>
        <button onclick="closeNewOrderMaterialModal()" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px;">
        <!-- 자재 검색 영역 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">자재 검색</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" id="newOrderMaterialSearchInput" style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " placeholder="자재명 또는 품목코드로 검색" onkeypress="if(event.key === 'Enter') searchNewOrderMaterials()" />
            <button onclick="searchNewOrderMaterials()" style="
              padding: 10px 20px;
              background: #3b82f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            " onmouseover="this.style.background='#2563eb';"
               onmouseout="this.style.background='#3b82f6';">
              검색
            </button>
          </div>
        </div>

        <!-- 검색 결과 테이블 -->
        <div id="newOrderMaterialSearchResults" style="display: none;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">검색 결과</label>
          <div style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead style="background: #f9fafb; position: sticky; top: 0;">
                <tr>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품목코드</th>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품명</th>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">규격</th>
                  <th style="padding: 8px; text-align: right; border-bottom: 1px solid #e5e7eb; font-size: 13px;">입고단가</th>
                  <th style="padding: 8px; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 13px;">선택</th>
                </tr>
              </thead>
              <tbody id="newOrderMaterialSearchTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- 선택된 자재 정보 -->
        <div id="newOrderSelectedMaterialInfo" style="display: none; background: #f0f9ff; padding: 12px; border-radius: 8px; border: 2px solid #bfdbfe;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
              <div style="font-weight: 600; color: #1e40af;" id="newOrderSelectedMaterialName">-</div>
              <div style="font-size: 12px; color: #6b7280; margin-top: 2px;" id="newOrderSelectedMaterialCode">-</div>
            </div>
            <button onclick="clearNewOrderSelectedMaterial()" style="
              padding: 6px 12px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 12px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            ">취소</button>
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">수량</label>
          <input type="number" id="newOrderDetailQuantity" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          " placeholder="수량 입력" value="1" min="0" step="0.01" />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">입고단가</label>
          <div style="display: flex; gap: 8px;">
            <input type="number" id="newOrderDetailPrice" style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " placeholder="단가 입력" value="0" min="0" step="0.01" />
            <button onclick="showNewOrderPriceHistory()" style="
              padding: 10px 16px;
              background: #8b5cf6;
              border: none;
              border-radius: 8px;
              font-size: 13px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            " onmouseover="this.style.background='#7c3aed';"
               onmouseout="this.style.background='#8b5cf6';">
              이전 단가
            </button>
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">금액 (자동계산)</label>
          <input type="text" id="newOrderDetailAmount" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: #f9fafb;
          " readonly value="0" />
        </div>
      </div>

      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
        <button onclick="closeNewOrderMaterialModal()" style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb';"
           onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button onclick="confirmNewOrderMaterialAdd()" style="
          padding: 12px 24px;
          background: #10b981;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        " onmouseover="this.style.background='#059669';"
           onmouseout="this.style.background='#10b981';">
          추가하기
        </button>
      </div>
    </div>
  </div>

  <!-- 발주 수정 모달 -->
  <div id="orderEditModal" class="modal" style="display: none;">
    <div class="modal-content large" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
      <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
      <div id="orderEditModalHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937;">발주 수정</h2>
        <button id="closeOrderEditModalBtn" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- ✅ 발주 기본 정보 (카드 스타일) -->
      <div style="background: #f9fafb; padding: 20px; border-radius: 12px; margin-bottom: 24px; border: 1px solid #e5e7eb;">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151;">기본 정보</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px;">
          <div style="display: flex; align-items: center;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280;">발주번호</span>
            <span id="editOrderNo" style="color: #1f2937; font-weight: 600;">-</span>
          </div>
          <div style="display: flex; align-items: center;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280;">발주일자</span>
            <span id="editOrderDate" style="color: #1f2937;">-</span>
          </div>
          <div style="display: flex; align-items: center;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280;">매입처명</span>
            <span id="editSupplierName" style="color: #1f2937;">-</span>
          </div>
          <div style="display: flex; align-items: center;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280;">입고희망일자</span>
            <input type="date" id="editOrderDeliveryDate" style="
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            " />
          </div>
          <div style="display: flex; align-items: center;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280;">결제방법</span>
            <select id="editOrderPaymentMethod" style="
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            ">
              <option value="">선택</option>
              <option value="현금">현금</option>
              <option value="카드">카드</option>
              <option value="계좌이체">계좌이체</option>
              <option value="어음">어음</option>
            </select>
          </div>
          <div style="display: flex; align-items: center;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280;">상태</span>
            <select id="editOrderStatus" style="
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            ">
              <option value="0">발주대기</option>
              <option value="1">발주완료</option>
              <option value="2">입고완료</option>
            </select>
          </div>
          <div style="display: flex; align-items: center; grid-column: 1 / -1;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280;">제목</span>
            <input type="text" id="editOrderTitle" style="
              flex: 1;
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            " placeholder="발주 제목" />
          </div>
          <div style="display: flex; align-items: flex-start; grid-column: 1 / -1;">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280; padding-top: 8px;">적요</span>
            <textarea id="editOrderRemark" rows="2" style="
              flex: 1;
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
              resize: vertical;
            " placeholder="발주 적요"></textarea>
          </div>
        </div>
      </div>

      <!-- ✅ 발주 상세 목록 -->
      <div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151;">발주 품목 내역</h3>
          <div style="display: flex; gap: 8px;">
            <button type="button" onclick="addOrderDetailRowInEdit()" style="
              padding: 8px 16px;
              background: #10b981;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#059669';"
               onmouseout="this.style.background='#10b981';">
              + 품목 추가
            </button>
            <button type="button" onclick="deleteSelectedOrderDetails()" style="
              padding: 8px 16px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#dc2626';"
               onmouseout="this.style.background='#ef4444';">
              선택 삭제
            </button>
          </div>
        </div>

        <table id="orderEditDetailTable" class="display" style="width:100%">
          <thead>
            <tr>
              <th style="width: 40px;"><input type="checkbox" id="selectAllEditOrderDetails" /></th>
              <th style="width: 50px;">순번</th>
              <th>자재코드</th>
              <th>자재명</th>
              <th>규격</th>
              <th>발주량</th>
              <th>입고단가</th>
              <th>출고단가</th>
              <th style="width: 120px;">관리</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- ✅ 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
        <button type="button" onclick="closeOrderEditModal()" style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb';"
           onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button type="button" onclick="submitOrderEdit()" style="
          padding: 12px 24px;
          background: #2563eb;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        " onmouseover="this.style.background='#1d4ed8';"
           onmouseout="this.style.background='#2563eb';">
          수정 완료
        </button>
      </div>
    </div>
  </div>

  <!-- 발주 삭제 확인 모달 -->
  <div id="orderDeleteModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <!-- 헤더 -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">발주 삭제</h2>
        <button onclick="closeOrderDeleteModal()" style="
              background: #f0f0f0;
              border: none;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';" onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <!-- 삭제할 발주 정보 표시 -->
      <div id="orderDeleteContent" style="margin-bottom: 24px;">
        <!-- 발주 정보가 여기에 동적으로 로드됩니다 -->
      </div>

      <!-- 경고 메시지 -->
      <div style="
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
          ">
        <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6;">
          <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.<br>
          삭제된 데이터는 복구할 수 없습니다.
        </p>
      </div>

      <!-- 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end">
        <button type="button" onclick="closeOrderDeleteModal()" style="
              padding: 10px 24px;
              background: var(--bg-light);
              border: 1px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: var(--text-dark);
            ">
          취소
        </button>
        <button type="button" onclick="confirmDeleteOrder()" style="
              padding: 10px 24px;
              background: #dc3545;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            ">
          삭제
        </button>
      </div>
    </div>
  </div>

  <!-- 발주 품목 추가 모달 -->
  <div id="orderDetailAddModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 600px;">
      <div id="orderDetailAddModalHeader" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 추가</h2>
        <button id="closeOrderDetailAddModal" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px;">
        <!-- ✅ 자재 검색 영역 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">자재 검색</label>
          <div style="display: flex; gap: 8px;">
            <input type="text" id="orderMaterialSearchInput" style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " placeholder="자재명 또는 품목코드로 검색" onkeypress="if(event.key === 'Enter') searchOrderMaterials()" />
            <button onclick="searchOrderMaterials()" style="
              padding: 10px 20px;
              background: #3b82f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            " onmouseover="this.style.background='#2563eb';"
               onmouseout="this.style.background='#3b82f6';">
              검색
            </button>
          </div>
        </div>

        <!-- ✅ 검색 결과 테이블 -->
        <div id="orderMaterialSearchResults" style="display: none;">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">검색 결과 (클릭하여 선택)</label>
          <div style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
            <table id="orderMaterialSearchTable" style="width: 100%; border-collapse: collapse;">
              <thead style="background: #f9fafb; position: sticky; top: 0;">
                <tr>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품목코드</th>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">품명</th>
                  <th style="padding: 8px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 13px;">규격</th>
                  <th style="padding: 8px; text-align: right; border-bottom: 1px solid #e5e7eb; font-size: 13px;">입고단가</th>
                  <th style="padding: 8px; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 13px;">선택</th>
                </tr>
              </thead>
              <tbody id="orderMaterialSearchTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- ✅ 선택된 자재 정보 -->
        <div id="selectedOrderMaterialInfo" style="display: none; background: #f0f9ff; padding: 12px; border-radius: 8px; border: 2px solid #bfdbfe;">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
              <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
              <div style="font-weight: 600; color: #1e40af;" id="selectedOrderMaterialName">-</div>
              <div style="font-size: 12px; color: #6b7280; margin-top: 2px;" id="selectedOrderMaterialCode">-</div>
            </div>
            <button onclick="clearSelectedOrderMaterial()" style="
              padding: 6px 12px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 12px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            ">취소</button>
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">발주 수량</label>
          <input type="number" id="addOrderDetailQuantity" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          " placeholder="발주 수량 입력" value="1" min="0" step="0.01" />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">입고단가</label>
          <div style="display: flex; gap: 8px;">
            <input type="number" id="addOrderDetailInPrice" style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " placeholder="입고단가 입력" value="0" min="0" step="0.01" />
            <button onclick="showEditOrderPriceHistory()" style="
              padding: 10px 16px;
              background: #f59e0b;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            " onmouseover="this.style.background='#d97706';"
               onmouseout="this.style.background='#f59e0b';">
              이전단가
            </button>
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">입고단가</label>
          <input type="number" id="addOrderDetailOutPrice" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          " placeholder="입고단가 입력" value="0" min="0" step="0.01" />
        </div>
      </div>

      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
        <button onclick="closeOrderDetailAddModal()" style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb';"
           onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button onclick="confirmAddOrderDetail()" style="
          padding: 12px 24px;
          background: #10b981;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        " onmouseover="this.style.background='#059669';"
           onmouseout="this.style.background='#10b981';">
          추가하기
        </button>
      </div>
    </div>
  </div>

  <!-- 발주 품목 수정 모달 -->
  <div id="orderDetailEditModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">품목 수정</h2>
        <button id="closeOrderDetailEditModal" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px;">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">자재명</label>
          <input type="text" id="editOrderDetailMaterialName" readonly style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: #f9fafb;
          " />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">발주량</label>
          <input type="number" id="editOrderDetailQuantity" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          " min="0" step="0.01" />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">입고단가</label>
          <input type="number" id="editOrderDetailInPrice" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          " min="0" step="0.01" />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">출고단가</label>
          <input type="number" id="editOrderDetailOutPrice" style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          " min="0" step="0.01" />
        </div>
      </div>

      <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; padding-top: 24px; border-top: 2px solid #e5e7eb;">
        <button onclick="closeOrderDetailEditModal()" style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb';"
           onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button onclick="confirmEditOrderDetail()" style="
          padding: 12px 24px;
          background: #3b82f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        " onmouseover="this.style.background='#2563eb';"
           onmouseout="this.style.background='#3b82f6';">
          수정하기
        </button>
      </div>
    </div>
  </div>

  <!-- ✅ 발주 입고단가 이력 모달 -->
  <div id="orderPriceHistoryModal" class="modal" style="display: none; z-index: 10000;">
    <div class="modal-content" style="max-width: 700px;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; padding-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">입고단가 이력</h2>
        <button id="closeOrderPriceHistoryModal" onclick="closeOrderPriceHistoryModal()" style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
           onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 자재 정보 -->
      <div style="background: #fef3c7; padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 2px solid #fbbf24;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px;">선택된 자재</div>
            <div style="font-weight: 600; color: #78350f;" id="orderPriceHistoryMaterialName">-</div>
            <div style="font-size: 12px; color: #92400e; margin-top: 2px;" id="orderPriceHistoryMaterialCode">-</div>
          </div>
        </div>
      </div>

      <!-- ✅ 탭 메뉴 -->
      <div style="display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 2px solid #e5e7eb;">
        <button id="tabActualPurchasePrice" onclick="switchOrderPriceHistoryTab('actual')" style="
          padding: 12px 20px;
          background: #3b82f6;
          border: none;
          border-bottom: 3px solid #3b82f6;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
          flex: 1;
        ">
          실제 입고가
        </button>
        <button id="tabOrderPrice" onclick="switchOrderPriceHistoryTab('order')" style="
          padding: 12px 20px;
          background: transparent;
          border: none;
          border-bottom: 3px solid transparent;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s;
          flex: 1;
        " onmouseover="if(this.style.background === 'transparent') this.style.color='#1f2937';"
           onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';">
          발주 제안가
        </button>
      </div>

      <!-- 이력 테이블 -->
      <div style="margin-bottom: 16px;">
        <label id="orderPriceHistoryLabel" style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">
          이 거래처에 실제 입고한 이력 (클릭하여 단가 선택)
        </label>
        <div style="max-height: 300px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px;">
          <table id="orderPriceHistoryTable" style="width: 100%; border-collapse: collapse;">
            <thead id="orderPriceHistoryTableHead" style="background: #f9fafb; position: sticky; top: 0;">
              <tr>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb; font-size: 13px;">입고일자</th>
                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb; font-size: 13px;">입고단가</th>
                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb; font-size: 13px;">입고수량</th>
                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb; font-size: 13px;">적요</th>
              </tr>
            </thead>
            <tbody id="orderPriceHistoryTableBody">
              <tr>
                <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af;">
                  이력이 없습니다
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div style="display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 2px solid #e5e7eb;">
        <button onclick="closeOrderPriceHistoryModal()" style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        " onmouseover="this.style.background='#e5e7eb';"
           onmouseout="this.style.background='#f3f4f6';">
          닫기
        </button>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!-- 거래명세서관리 페이지 -->
  <!-- ========================= -->
  <div class="page-content" id="transactionPage">
    <div class="toolbar">
      <div class="toolbar-left">
        <!-- 기준일자 -->
        <input type="date" id="transactionDate" class="form-input" />
        <!-- 거래처 선택 -->
        <select id="customerSelect" class="form-input">
          <option value="">전체 거래처</option>
        </select>
        <button class="btn btn-secondary" onclick="loadTransactions()">조회</button>
      </div>
      <div class="toolbar-right">
        <button class="btn btn-success" onclick="openTransactionModal()">
          <span>+</span> 신규 등록
        </button>
      </div>
    </div>

    <!-- 거래명세서 목록 -->
    <div class="table-container">
      <table class="data-table" id="transactionHeaderTable">
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAllTransactions" /></th>
            <th>거래번호</th>
            <th>거래일자</th>
            <th>거래처명</th>
            <th>공급가액</th>
            <th>부가세</th>
            <th>합계금액</th>
            <th>담당자</th>
            <th>비고</th>
          </tr>
        </thead>
        <tbody id="transactionHeaderBody">
          <tr>
            <td colspan="9" class="loading">데이터를 불러오는 중...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 거래명세서 상세내역 -->
    <div class="table-container" style="margin-top: 20px">
      <h4>📦 상세 품목 내역</h4>
      <table class="data-table" id="transactionDetailTable">
        <thead>
          <tr>
            <th>품목코드</th>
            <th>품명</th>
            <th>규격</th>
            <th>단위</th>
            <th>수량</th>
            <th>단가</th>
            <th>공급가액</th>
            <th>부가세</th>
            <th>합계금액</th>
            <th>단가조회</th>
          </tr>
        </thead>
        <tbody id="transactionDetailBody">
          <tr>
            <td colspan="10" class="loading">거래명세서를 선택하세요.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ========================= -->
  <!-- 거래명세서 신규등록 모달 -->
  <!-- ========================= -->
  <div id="transactionModal" class="modal hidden">
    <div class="modal-content">
      <h3>거래명세서 신규등록</h3>

      <div class="form-group">
        <label>거래일자</label>
        <input type="date" id="newTransactionDate" />
      </div>

      <div class="form-group">
        <label>매출처</label>
        <div style="display: flex; gap: 8px">
          <input type="text" id="newCustomerName" placeholder="매출처 선택" readonly />
          <button class="btn btn-secondary" onclick="openCustomerModal()">조회</button>
        </div>
      </div>

      <div class="form-group">
        <label>자재추가</label>
        <button class="btn btn-primary" onclick="openItemModal()">자재조회</button>
      </div>

      <div id="newTransactionItems"></div>

      <div style="margin-top: 16px; text-align: right">
        <button class="btn btn-success" onclick="saveTransaction()">저장</button>
        <button class="btn btn-secondary" onclick="closeTransactionModal()">닫기</button>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!-- 자재조회 모달 -->
  <!-- ========================= -->
  <div id="itemModal" class="modal hidden">
    <div class="modal-content">
      <h3>자재 조회</h3>
      <input type="text" id="itemSearch" placeholder="자재명 또는 코드 검색..." />
      <button class="btn btn-secondary" onclick="searchItems()">검색</button>
      <table class="data-table">
        <thead>
          <tr>
            <th>코드</th>
            <th>자재명</th>
            <th>규격</th>
            <th>단위</th>
            <th>선택</th>
          </tr>
        </thead>
        <tbody id="itemTableBody">
          <tr>
            <td colspan="5">검색 결과가 없습니다.</td>
          </tr>
        </tbody>
      </table>
      <div style="text-align: right">
        <button class="btn btn-secondary" onclick="closeItemModal()">닫기</button>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!-- 매출처조회 모달 -->
  <!-- ========================= -->
  <div id="customerModal" class="modal hidden">
    <div class="modal-content">
      <h3>매출처 조회</h3>
      <input type="text" id="customerSearchSimple" placeholder="매출처명 검색..." />
      <button class="btn btn-secondary" onclick="searchCustomers()">검색</button>
      <table class="data-table">
        <thead>
          <tr>
            <th>코드</th>
            <th>매출처명</th>
            <th>사업자번호</th>
            <th>연락처</th>
            <th>선택</th>
          </tr>
        </thead>
        <tbody id="customerTableBodyModal">
          <tr>
            <td colspan="5">검색 결과가 없습니다.</td>
          </tr>
        </tbody>
      </table>
      <div style="text-align: right">
        <button class="btn btn-secondary" onclick="closeCustomerModal()">닫기</button>
      </div>
    </div>
  </div>

  <!-- ========================= -->
  <!-- 단가조회 모달 -->
  <!-- ========================= -->
  <div id="priceModal" class="modal hidden">
    <div class="modal-content">
      <h3>최근 1년 거래단가 조회</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>거래일자</th>
            <th>매출처</th>
            <th>자재명</th>
            <th>수량</th>
            <th>단가</th>
          </tr>
        </thead>
        <tbody id="priceTableBody">
          <tr>
            <td colspan="5">데이터를 불러오는 중...</td>
          </tr>
        </tbody>
      </table>
      <div style="text-align: right">
        <button class="btn btn-secondary" onclick="closePriceModal()">닫기</button>
      </div>
    </div>
  </div>

  <!-- 거래명세서 미리보기 모달 style="width: 800px" -->
  <div id="previewModal" class="modal">
    <div class="modal-content" style="display:none;">
      <span class="close" onclick="closePreviewModal()">&times;</span>
      <h2>거래명세서 미리보기</h2>

      <div id="previewHeader">
        <p><strong>거래일자:</strong> <span id="previewDate"></span></p>
        <p><strong>거래번호:</strong> <span id="previewNo"></span></p>
        <p><strong>거래처명:</strong> <span id="previewCustomer"></span></p>
      </div>

      <table class="table preview-table">
        <thead>
          <tr>
            <th>자재명</th>
            <th>규격</th>
            <th>단위</th>
            <th>수량</th>
            <th>단가</th>
            <th>공급가액</th>
            <th>부가세</th>
            <th>합계금액</th>
          </tr>
        </thead>
        <tbody id="previewBody"></tbody>
      </table>

      <div class="preview-total">
        <p><strong>총 공급가액:</strong> <span id="previewSubtotal"></span> 원</p>
        <p><strong>총 부가세:</strong> <span id="previewTax"></span> 원</p>
        <p><strong>총 합계금액:</strong> <span id="previewTotal"></span> 원</p>
      </div>

      <div style="text-align: right; margin-top: 15px">
        <button class="btn btn-primary" onclick="printPreview()">🖨 인쇄</button>
        <button class="btn btn-secondary" onclick="closePreviewModal()">닫기</button>
      </div>
    </div>
  </div>
</body>

</html>
