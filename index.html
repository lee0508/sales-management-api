<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>판매관리 시스템</title>
  <!-- 하워드 휴즈 & 멜빈 다마 -->
  <!-- jQuery & DataTables -->
  <script src="js/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="DataTable/datatables.css" />
  <script src="DataTable/datatables.min.js"></script>

  <!-- 다음 우편번호 API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

  <!-- 공통 유틸리티 함수 (다른 모듈보다 먼저 로드) -->
  <script src="js/common.js" defer></script>

  <script src="js/dataTableInit.js" defer></script>
  <script src="js/modal-draggable.js" defer></script>

  <script src="js/customer.js?v=251212_improvement" defer></script>
  <script src="js/account.js" defer></script>
  <script src="js/supplier.js?v=251212_improvement" defer></script>
  <script src="js/quotation.js?v=251212_improvement" defer></script>
  <script src="js/order.js?v=251212_improvement" defer></script>
  <script src="js/postoffice.js?v=1031M" defer></script>
  <!-- print.js를 transaction.js, quotation.js보다 먼저 로드하여 각 모듈의 인쇄 함수를 덮어쓸 수 있도록 함 -->
  <script src="js/print.js?v=1114.js" defer></script>
  <script src="js/transaction.js?v=251212_btnfix" defer></script>
  <script src="js/cash-history.js" defer></script>
  <script src="js/trial-balance.js" defer></script>
  <script src="js/balance-sheet.js" defer></script>
  <script src="js/transaction-price-history.js?v=1101" defer></script>
  <script src="js/purchase.js?v=251212_improvement" defer></script>
  <script src="js/material-history.js?v=251211_fix3" defer></script>
  <script src="js/material-inventory.js?v=1101" defer></script>
  <script src="js/material-category.js?v=1101" defer></script>
  <script src="js/taxinvoice.js?v=1113_v4" defer></script>
  <script src="js/accounts-payable.js" defer></script>
  <script src="js/accounts-receivable.js" defer></script>

  <link rel="stylesheet" href="css/onstyles.css?v=251212_btnstyles" />
  <!-- <link rel="stylesheet" href="css/shadcn-ui.css" /> -->
  <!-- <link rel="stylesheet" href="css/default.css" /> -->
</head>

<body>
  <!-- 로그인 페이지 -->
  <div class="login-container" id="loginPage" style="display: flex">
    <div class="login-box">
      <div class="login-header">
        <h1>판매관리 시스템</h1>
        <p id="workplaceNameLogin" style="font-size: 16px; font-weight: 600; color: var(--primary); margin-top: 8px">
          사업장 정보 로딩 중...
        </p>
        <p>로그인하여 시스템을 사용하세요</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="workplaceCode">사업장 선택</label>
          <select id="workplaceCode" class="form-input" required style="cursor: pointer">
            <option value="">사업장을 선택하세요</option>
          </select>
        </div>
        <div class="form-group">
          <label for="loginDateText">접속일자</label>
          <div style="display: flex; gap: 12px; align-items: center">
            <input type="text" id="loginDateText" class="form-input" placeholder="YYYY-MM-DD 직접 입력"
              autocomplete="off" />
            <div style="position: relative; flex: 1">
              <input type="date" id="loginDatePicker" class="form-input" style="padding-right: 44px" />
              <button type="button" onclick="openLoginDatePicker()" aria-label="달력으로 일자 선택" style="
                    position: absolute;
                    top: 50%;
                    right: 12px;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    cursor: pointer;
                    padding: 0;
                    display: flex;
                  ">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="userId">사용자 아이디</label>
          <input type="text" id="userId" class="form-input" placeholder="아이디를 입력하세요" required />
        </div>
        <div class="form-group">
          <label for="password">비밀번호</label>
          <input type="password" id="password" class="form-input" placeholder="비밀번호를 입력하세요"
            autocomplete="current-password" required />
        </div>
        <button type="submit" class="btn-login">로그인</button>
      </form>
      <div class="login-message" id="loginMessage">시스템에 오신 것을 환영합니다.</div>
    </div>
  </div>

  <!-- 대시보드 -->
  <div class="dashboard" id="dashboard" style="display: none">
    <!-- 사이드바 -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>판매관리 시스템</h2>
        <p id="workplaceNameSidebar" style="font-size: 14px; color: #93c5fd; margin-top: 4px; font-weight: 500"></p>
      </div>
      <nav class="sidebar-menu">
        <div class="menu-item">
          <a class="menu-link active" onclick="showPage('dashboard')">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
              </path>
            </svg>
            대시보드
          </a>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="jangbuMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
              </path>
            </svg>
            장부관리
            <span class="arrow">▼</span>
          </a>
          <!--
            매입처장부관리 -> Purchaser's ledger management (TODO: Not implemented)
            매출처장부관리 -> Sales ledger management (TODO: Not implemented)
            미수금관리 -> Accounts receivable management (TODO: Not implemented)
            미지급금관리 -> Accounts Payable Management (TODO: Not implemented)
            세금계산서관리 -> Tax invoice management (TODO: Not implemented)

            NOTE: 현금출납관리는 회계관리 메뉴의 "현금출납내역관리"로 이동됨
            -->
          <div class="submenu" id="jangbuSubmenu">
            <a class="submenu-link" onclick="alert('매입처장부관리 기능은 준비 중입니다.')">매입처장부관리</a>
            <a class="submenu-link" onclick="alert('매출처장부관리 기능은 준비 중입니다.')">매출처장부관리</a>
            <a class="submenu-link" onclick="showPage('receivable')">미수금관리</a>
            <a class="submenu-link" onclick="showPage('payable')">미지급금관리</a>
            <a class="submenu-link" onclick="showPage('taxInvoice')">세금계산서관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="purchaseMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
            </svg>
            매입관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="purchaseSubmenu">
            <a class="submenu-link" onclick="showPage('order')">발주관리</a>
            <a class="submenu-link" onclick="showPage('purchase')">매입전표관리</a>
            <a class="submenu-link" onclick="showPage('supplier')">매입처관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="salesMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
              </path>
            </svg>
            매출관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="salesSubmenu">
            <a class="submenu-link" onclick="showPage('quotation')">견적관리</a>
            <a class="submenu-link" onclick="showPage('transaction')">거래명세서관리</a>
            <a class="submenu-link" onclick="showPage('customer')">매출처관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="itemMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
            </svg>
            자재관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="itemsSubmenu">
            <a class="submenu-link" onclick="showPage('materialCategory')">자재분류관리</a>
            <a class="submenu-link" onclick="showPage('materialHistory')">자재내역관리</a>
            <a class="submenu-link" onclick="showPage('materialInventory')">자재재고관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="accountMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
              </path>
            </svg>
            회계관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="accountSubmenu">
            <a class="submenu-link" onclick="showPage('account-catagory')">계정과목관리</a>
            <a class="submenu-link" onclick="showPage('account-history')">현금출납관리</a>
            <a class="submenu-link" onclick="showPage('accounting-voucher')">회계전표관리</a>
            <a class="submenu-link" onclick="showPage('total-balnace')">합계잔액시산표</a>
            <a class="submenu-link" onclick="showPage('account-balnace')">대차대조표</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="printMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z">
              </path>
            </svg>
            출력물관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="printSubmenu">
            <!-- 일계표 -->
            <a class="submenu-link" onclick="showPage('daily-report-print')">일계표</a>

            <!-- 미지급금 -->
            <div class="submenu-group">
              <span class="submenu-group-title">미지급금</span>
              <a class="submenu-link submenu-indent" onclick="showPage('payable-summary-print')">업체별 미지급금 현황(집계표)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('payable-daily-print')">업체별 지급 현황(일자별)</a>
            </div>

            <!-- 매입현황 -->
            <div class="submenu-group">
              <span class="submenu-group-title">매입현황</span>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-item-print')">품목별 매입 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-item-print')">업체별 매입
                현황(품목별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-daily-print')">업체별 매입
                현황(일자별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-print')">업체별 매입 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-tax-ledger-print')">매입세금계산서 장부 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-3months-print')">업체별 매입
                현황(3개월)</a>
            </div>

            <!-- 미수금 -->
            <div class="submenu-group">
              <span class="submenu-group-title">미수금</span>
              <a class="submenu-link submenu-indent" onclick="showPage('receivable-summary-print')">업체별 미수금 현황(집계표)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('receivable-daily-print')">업체별 수금 현황(일자별)</a>
            </div>

            <!-- 매출현황 -->
            <div class="submenu-group">
              <span class="submenu-group-title">매출현황</span>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-item-print')">품목별 매출 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-item-print')">업체별 매출
                현황(품목별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-daily-print')">업체별 매출
                현황(일자별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-print')">업체별 매출 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-tax-ledger-print')">매출세금계산서 장부 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-tax-status-print')">매출세금계산서 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-3months-print')">업체별 매출
                현황(3개월간)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-daily-cost-print')">업체별 매출
                현황(일자별, 매입단가출력)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-cost-print')">업체별 매출
                현황(매입단가출력)</a>
            </div>

            <!-- 회계관리 -->
            <div class="submenu-group">
              <span class="submenu-group-title">회계관리</span>
              <a class="submenu-link submenu-indent" onclick="showPage('cashbook-daily-print')">출납관리(일자별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('cashbook-account-print')">출납관리(계정과목별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('cashbook-summary-print')">출납관리(계정별집계)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('trial-balance-print')">합계시산표</a>
            </div>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="settingMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
              </path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            설정관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="settingSubmenu">
            <a class="submenu-link" onclick="showPage('paper-setting')">용지설정관리</a>
            <a class="submenu-link" onclick="showPage('salespaper-setting')">거래명세서설정관리</a>
            <a class="submenu-link" onclick="showPage('taxpaper-setting')">세금계산서설정관리</a>
            <a class="submenu-link" onclick="showPage('warehouse-setting')">창고설정관리</a>
            <a class="submenu-link" onclick="showPage('taxrate-setting')">부과세율설정관리</a>
          </div>
        </div>
      </nav>
    </aside>

    <!-- 메인 컨텐츠 -->
    <main class="main-content">
      <div class="top-bar">
        <div style="display: flex; align-items: center; gap: 16px">
          <h1 id="pageTitle">대시보드</h1>
          <div style="
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 16px;
                background: #f0f9ff;
                border-radius: 8px;
                border: 1px solid #bfdbfe;
              ">
            <span style="font-size: 16px">📅</span>
            <span id="currentWorkingDate" style="font-size: 14px; font-weight: 600; color: #1e40af">2025-11-01</span>
            <span style="font-size: 12px; color: #6b7280" id="currentWorkingDay">(금)</span>
            <button onclick="openDateChangeModal()" style="
                  padding: 4px 12px;
                  background: white;
                  border: 1px solid #bfdbfe;
                  border-radius: 6px;
                  font-size: 12px;
                  cursor: pointer;
                  color: #2563eb;
                  font-weight: 500;
                  margin-left: 8px;
                " onmouseover="this.style.background='#eff6ff';" onmouseout="this.style.background='white';">
              변경
            </button>
          </div>
        </div>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <span id="userName">사용자</span>
          <button class="btn-logout" onclick="logout()">로그아웃</button>
        </div>
      </div>
      <!-- content-area start -->
      <div class="content-area">
        <!-- 대시보드 페이지 -->
        <div class="page-content active" id="dashboardPage">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">오늘 매출</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">이번달 매출</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">미수금</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <!-- 재고 현황 주석처리
            <div class="stat-card">
              <div class="stat-label">재고 현황</div>
              <div class="stat-value">0건</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            -->
          </div>

          <div class="content-card">
            <h3 class="card-title">판매관리 시스템에 오신 것을 환영합니다</h3>
            <p style="color: var(--text-gray); margin-top: 16px; line-height: 1.6">
              좌측 메뉴에서 원하시는 기능을 선택하세요.<br />
              • 매출관리: 견적, 거래명세서, 매출처 관리<br />
              • 매입관리: 발주, 매입전표, 매입처 관리<br />
              • 재고관리: 자재 및 재고 현황 조회
            </p>
          </div>

          <!-- 오늘의 문서 현황 -->
          <div style="
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                margin-top: 24px;
              ">
            <!-- 견적서 리스트 -->
            <div class="content-card" style="padding: 20px">
              <h3 class="card-title" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <span>📋 오늘의 견적서</span>
                <span id="todayQuotationCount" style="font-size: 14px; color: #007bff; font-weight: normal">0건</span>
              </h3>
              <div style="height: 400px; overflow: hidden">
                <div style="height: 100%; overflow-y: auto">
                  <table id="todayQuotationTable" class="display" style="width: 100%; font-size: 13px">
                    <thead>
                      <tr>
                        <th style="width: 60px">번호</th>
                        <th>매출처</th>
                        <th style="width: 100px">금액</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- 발주서 리스트 -->
            <div class="content-card" style="padding: 20px">
              <h3 class="card-title" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <span>📦 오늘의 발주서</span>
                <span id="todayOrderCount" style="font-size: 14px; color: #28a745; font-weight: normal">0건</span>
              </h3>
              <div style="height: 400px; overflow: hidden">
                <div style="height: 100%; overflow-y: auto">
                  <table id="todayOrderTable" class="display" style="width: 100%; font-size: 13px">
                    <thead>
                      <tr>
                        <th style="width: 60px">번호</th>
                        <th>매입처</th>
                        <th style="width: 100px">금액</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- 거래명세서 리스트 -->
            <div class="content-card" style="padding: 20px">
              <h3 class="card-title" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <span>📄 오늘의 거래명세서</span>
                <span id="todayTransactionCount" style="font-size: 14px; color: #ffc107; font-weight: normal">0건</span>
              </h3>
              <div style="height: 400px; overflow: hidden">
                <div style="height: 100%; overflow-y: auto">
                  <table id="todayTransactionTable" class="display" style="width: 100%; font-size: 13px">
                    <thead>
                      <tr>
                        <th style="width: 60px">번호</th>
                        <th>매출처</th>
                        <th style="width: 100px">금액</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 매출처관리 페이지 -->
        <div id="salesCustomerPage" class="page-content hidden">
          <h2 style="display: none">매출처관리</h2>
          <div class="toolbar" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
              ">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center">
              <input type="text" id="salesCustomerSearchInput" placeholder="매출처코드 또는 매출처명 검색..." style="
                    padding: 10px 16px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    width: 280px;
                    outline: none;
                  " />
              <button id="salesCustomerBtnSearch" class="btn btn-primary" onclick="searchSalesCustomers()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                🔍 검색
              </button>
              <button id="salesCustomerBtnReset" class="btn btn-light" onclick="resetSalesCustomerSearch()" style="
                    padding: 10px 16px;
                    background: #f8f9fa;
                    color: #333;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px">
              <button id="salesCustomerBtnNew" class="btn btn-success" onclick="openNewSalesCustomerModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 신규 등록
              </button>
              <button id="salesCustomerBtnExport" class="btn btn-secondary" onclick="exportSalesCustomersToGoogleSheets()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">📊</span> Google Sheets로 보내기
              </button>
            </div>
          </div>

          <!-- ✅ DataTables 적용용 테이블 -->
          <table id="salesCustomerTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="salesCustomerSelectAll" title="전체 선택" aria-label="전체 선택" />
                </th>
                <th>순번</th>
                <th>매출처코드</th>
                <th>매출처명</th>
                <th>대표자</th>
                <th>사업자번호</th>
                <th>연락처</th>
                <th>거래상태</th>
                <th>등록일</th>
                <th style="width: 180px">관리</th>
              </tr>
            </thead>
          </table>
        </div>

        <!-- 매출처 상세보기 모달 -->
        <div id="salesCustomerViewModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div class="modal-content" style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 고정된 제목 영역 (드래그 핸들) -->
            <div id="salesCustomerViewModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  position: sticky;
                  top: -32px;
                  background: white;
                  padding: 0 0 16px 0;
                  border-bottom: 2px solid var(--border);
                  z-index: 10;
                  cursor: move;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
                매출처 상세정보
              </h2>
              <button id="salesCustomerViewModalCloseBtn" onclick="closeSalesCustomerViewModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <div id="salesCustomerViewContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <!-- 상세 정보가 여기에 동적으로 로드됩니다 -->
            </div>

            <div style="margin-top: 24px; display: flex; justify-content: flex-end">
              <button onclick="closeSalesCustomerViewModal()" class="btn btn-secondary">닫기</button>
            </div>
          </div>
        </div>

        <!-- ========================= -->
        <!-- 매출처 조회 모달 (견적서 등에서 사용)-->
        <!-- ========================= -->
        <div id="salesCustomerSearchModal" class="modal hidden">
          <div class="modal-content">
            <h3>매출처 조회</h3>
            <input type="text" id="customerSearchSimple" placeholder="매출처명 검색..." />
            <button class="btn btn-secondary" onclick="searchCustomers()">검색</button>
            <table class="data-table">
              <thead>
                <tr>
                  <th>코드</th>
                  <th>매출처명</th>
                  <th>사업자번호</th>
                  <th>연락처</th>
                  <th>선택</th>
                </tr>
              </thead>
              <tbody id="customerTableBodyModal">
                <tr>
                  <td colspan="5">검색 결과가 없습니다.</td>
                </tr>
              </tbody>
            </table>
            <div style="text-align: right">
              <button class="btn btn-secondary" onclick="closeCustomerSearchModal()">닫기</button>
            </div>
          </div>
        </div>

        <!-- 매출처 삭제 확인 모달 -->
        <div id="customerDeleteModal" class="modal" style="display: none">
          <div class="modal-content" style="width: 90%; max-width: 600px">
            <!-- 헤더 -->
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  position: sticky;
                  top: -32px;
                  background: white;
                  padding: 0 0 16px 0;
                  border-bottom: 2px solid var(--border);
                  z-index: 10;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
                매출처 삭제
              </h2>
              <button onclick="closeCustomerDeleteModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <!-- 삭제할 매출처 정보 표시 -->
            <div id="customerDeleteContent" style="margin-bottom: 24px">
              <!-- 매출처 정보가 여기에 동적으로 로드됩니다 -->
            </div>

            <!-- 경고 메시지 -->
            <div style="
                  background: #fff3cd;
                  border: 1px solid #ffc107;
                  border-radius: 8px;
                  padding: 16px;
                  margin-bottom: 24px;
                ">
              <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6">
                <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.<br />
                삭제된 데이터는 복구할 수 없습니다.
              </p>
            </div>

            <!-- 버튼 영역 -->
            <div style="display: flex; gap: 12px; justify-content: flex-end">
              <button type="button" onclick="closeCustomerDeleteModal()" style="
                    padding: 10px 24px;
                    background: var(--bg-light);
                    border: 1px solid var(--border);
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: var(--text-dark);
                  ">
                취소
              </button>
              <button type="button" onclick="confirmDeleteCustomer()" style="
                    padding: 10px 24px;
                    background: #dc3545;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                  ">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 매출처 검색 모달 (공통 1개만 사용) -->
        <div id="customerSearchModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 800px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 20px;
                ">
              <h3 style="margin: 0">매출처 검색</h3>
              <button onclick="closeCustomerSearchModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                  ">
                ×
              </button>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 16px">
              <input type="text" id="customerSearchModalInput" placeholder="매출처명 또는 코드 검색"
                onkeypress="if(event.key === 'Enter') searchCustomersForModal()"
                style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px" />
              <button onclick="searchCustomersForModal()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                  ">
                검색
              </button>
            </div>

            <div style="
                  max-height: 400px;
                  overflow-y: auto;
                  border: 1px solid #e5e7eb;
                  border-radius: 6px;
                ">
              <table id="customerSearchTable" style="width: 100%; border-collapse: collapse">
                <thead style="background: #f8f9fa; position: sticky; top: 0">
                  <tr>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      코드
                    </th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      매출처명
                    </th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      전화번호
                    </th>
                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb">
                      선택
                    </th>
                  </tr>
                </thead>
                <tbody id="customerSearchTableBody">
                  <tr>
                    <td colspan="4" style="padding: 40px; text-align: center; color: #999">
                      검색 버튼을 클릭하여 매출처를 검색하세요
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 매출처 신규등록/수정 모달 (공용) -->
        <div id="salesCustomerEditModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div class="modal-content" style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 고정된 제목 영역 (드래그 핸들) -->
            <div id="salesCustomerEditModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  position: sticky;
                  top: -32px;
                  background: white;
                  padding: 0 0 16px 0;
                  border-bottom: 2px solid var(--border);
                  z-index: 10;
                  cursor: move;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
                매출처 신규등록
              </h2>
              <button id="salesCustomerEditModalCloseBtn" onclick="closeSalesCustomerEditModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <form id="salesCustomerEditForm" onsubmit="submitSalesCustomer(event)">
              <!-- 1. 매출처코드 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매출처코드</label>
                <input type="text" id="customerCode" name="customerCode" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="매출처코드를 입력하세요" />
              </div>

              <!-- 2. 매출처명 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매출처명 *</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="customerName" name="customerName" required style="
                        flex: 1;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="매출처명" />
                  <button type="button" onclick="openCustomerSearchFromEditForm()" style="
                        padding: 12px 16px;
                        background: #4a5568;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-size: 16px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: background 0.2s;
                      " onmouseover="this.style.background='#2d3748'" onmouseout="this.style.background='#4a5568'">🔍</button>
                </div>
              </div>

              <!-- 3. 대표자명 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">대표자명</label>
                <input type="text" id="ceoName" name="ceoName" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="대표자명" />
              </div>

              <!-- 4. 사업자번호 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">사업자번호</label>
                <input type="text" id="businessNo" name="businessNo" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="000-00-00000" />
              </div>

              <!-- 5. 업태 & 업종 (1:1 비율) -->
              <div style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 16px;
                    margin-bottom: 16px;
                  ">
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업태</label>
                  <input type="text" id="businessType" name="businessType" style="
                        width: 100%;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="업태" />
                </div>
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업종</label>
                  <input type="text" id="businessCategory" name="businessCategory" style="
                        width: 100%;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="업종" />
                </div>
              </div>

              <!-- 6. 연락처 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">연락처</label>
                <input type="tel" id="phone" name="phone" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="010-0000-0000" />
              </div>

              <!-- 7. 팩스번호 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">팩스번호</label>
                <input type="tel" id="fax" name="fax" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="02-0000-0000" />
              </div>

              <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">우편번호</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="zipCode" name="zipCode" readonly style="
                        flex: 1;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                        background-color: #f5f5f5;
                      " placeholder="00000" />
                  <button type="button" onclick="execDaumPostcode()" style="
                        padding: 10px 20px;
                        background: var(--primary);
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        white-space: nowrap;
                      ">
                    찾기
                  </button>
                </div>
              </div>

              <!-- 9. 주소 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">주소</label>
                <input type="text" id="address" name="address" readonly style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      background-color: #f5f5f5;
                    " placeholder="주소" />
              </div>

              <!-- 10. 상세주소 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">상세주소</label>
                <input type="text" id="addressDetail" name="addressDetail" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="상세주소를 입력하세요" />
              </div>

              <!-- 11. 은행 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">은행</label>
                <select id="bankCode" name="bankCode" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    ">
                  <option value="">선택하세요</option>
                  <option value="01">한국은행</option>
                  <option value="02">산업은행</option>
                  <option value="03">기업은행</option>
                  <option value="04">국민은행</option>
                  <option value="05">농협</option>
                  <option value="06">하나은행</option>
                  <option value="07">우리은행</option>
                  <option value="08">SC은행</option>
                  <option value="09">씨티은행</option>
                </select>
              </div>

              <!-- 12. 계좌번호 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">계좌번호</label>
                <input type="text" id="accountNo" name="accountNo" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="계좌번호" />
              </div>

              <!-- 13. 담당자명 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">담당자명</label>
                <input type="text" id="managerName" name="managerName" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="담당자명" />
              </div>

              <!-- 14. 거래상태 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">거래상태</label>
                <select id="status" name="status" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    ">
                  <option value="0">정상거래</option>
                  <option value="1">거래보류</option>
                </select>
              </div>

              <!-- 15. 비고란 (전체 너비) -->
              <div style="margin-bottom: 24px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">비고란</label>
                <textarea id="remark" name="remark" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      resize: vertical;
                      min-height: 80px;
                    " placeholder="비고"></textarea>
              </div>

              <!-- 버튼 영역 -->
              <div style="display: flex; gap: 12px; justify-content: flex-end">
                <button type="button" onclick="closeSalesCustomerEditModal()" style="
                      padding: 10px 24px;
                      background: var(--bg-light);
                      border: 1px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: var(--text-dark);
                    ">
                  취소
                </button>
                <button type="submit" style="
                      padding: 10px 24px;
                      background: var(--primary);
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: white;
                    ">
                  등록
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- 계정과목관리 페이지 -->
        <div id="accountCatagoryPage" class="page-content hidden">
          <h2 style="display: none">계정과목관리</h2>
          <div class="toolbar" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
              ">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center">
              <input type="text" id="accountListSearchInput" placeholder="계정코드 또는 계정명 검색..." style="
                    padding: 10px 16px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    width: 280px;
                    outline: none;
                  " />
              <button class="btn btn-primary" onclick="searchAccounts()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                🔍 검색
              </button>
              <button class="btn btn-light" onclick="resetAccountSearch()" style="
                    padding: 10px 16px;
                    background: #f8f9fa;
                    color: #333;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px">
              <button class="btn btn-success" onclick="openAccountModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 신규 등록
              </button>
            </div>
          </div>

          <!-- ✅ DataTables 적용용 테이블 -->
          <table id="accountTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="selectAllAccounts" title="전체 선택" aria-label="전체 선택" />
                </th>
                <th>순번</th>
                <th>계정코드</th>
                <th>계정명</th>
                <th>합계시산표</th>
                <th>적요</th>
                <th>사용구분</th>
                <th>수정일자</th>
                <th style="width: 180px">관리</th>
              </tr>
            </thead>
          </table>
        </div>

        <!-- 현금출납내역관리 페이지 -->
        <div class="page-content hidden" id="accountHistoryPage">
          <h2 style="display: none">현금출납내역관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                flex-wrap: nowrap;
              ">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="cashStatusFilter" class="form-control" style="width: 120px" onchange="filterCashHistory()">
                <option value="">전체 상태</option>
                <option value="1">입금</option>
                <option value="2">출금</option>
              </select>
              <input type="date" id="cashStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="cashEndDate" class="form-control" style="width: 150px" />
              <button class="btn btn-secondary" onclick="filterCashHistory()">조회</button>
            </div>

            <div class="toolbar-right" style="display: flex; gap: 12px; align-items: center">
              <button class="btn btn-success" onclick="openNewCashModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 현금출납 등록
              </button>
              <button class="btn btn-warning" onclick="openMonthCloseModal()" style="
                    padding: 10px 20px;
                    background: #ffc107;
                    color: #000;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>📅</span> 월마감 처리
              </button>
              <button class="btn btn-secondary" onclick="exportCashToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 현금출납 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 현금출납 건수: <span id="cashCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- ✅ 현금출납 목록 DataTable -->
          <table id="cashHistoryTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="selectAllCash" /></th>
                <th>순번</th>
                <th>출납번호</th>
                <th>출납일자</th>
                <th>구분</th>
                <th>입금액</th>
                <th>출금액</th>
                <th>잔액</th>
                <th>거래처</th>
                <th>적요</th>
                <th>작성자</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="cashHistoryTableBody"></tbody>
          </table>
        </div>

        <!-- 회계전표관리 페이지 -->
        <div class="page-content hidden" id="accountingVoucherPage">
          <h2 style="display: none">회계전표관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="display: flex; justify-content: space-between; align-items: center">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="voucherTypeFilter" class="form-control" style="width: 150px" onchange="filterVouchers()">
                <option value="">전체 유형</option>
                <option value="매입">매입전표</option>
                <option value="출고">거래명세서</option>
                <option value="세금">세금계산서</option>
                <option value="현금">현금출납</option>
              </select>
              <input type="date" id="voucherStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="voucherEndDate" class="form-control" style="width: 150px" />
              <button class="btn btn-secondary" onclick="filterVouchers()">조회</button>
            </div>

            <div class="toolbar-right" style="display: flex; gap: 12px; align-items: center">
              <button id="voucherEditBtn" class="btn btn-primary" onclick="editSelectedVouchers()"
                style="display: none; padding: 10px 20px">
                <span>&#9998;</span> 수정
              </button>
              <button id="voucherDeleteBtn" class="btn btn-danger" onclick="deleteSelectedVouchers()"
                style="display: none; padding: 10px 20px">
                <span>&#128465;</span> 삭제
              </button>
              <button class="btn btn-secondary" onclick="exportVouchersToExcel()" style="padding: 10px 20px">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 회계전표 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 전표 건수: <span id="voucherCount" style="font-weight: bold">0</span> 건 | 차변
            합계: <span id="debitTotal" style="font-weight: bold; color: #007bff">0</span> 원 |
            대변 합계:
            <span id="creditTotal" style="font-weight: bold; color: #28a745">0</span> 원
          </div>

          <!-- ✅ 회계전표 목록 DataTable -->
          <table id="accountingVoucherTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="selectAllVouchers" /></th>
                <th>작성일자</th>
                <th>전표번호</th>
                <th>순번</th>
                <th>계정코드</th>
                <th>계정명</th>
                <th>차대</th>
                <th>금액</th>
                <th>적요</th>
                <th>참조전표</th>
                <th>작성자</th>
                <th style="width: 80px">관리</th>
              </tr>
            </thead>
            <tbody id="accountingVoucherTableBody"></tbody>
          </table>

          <!-- 회계전표 상세보기 모달 -->
          <div id="voucherDetailModal" class="modal" style="display: none">
            <div class="modal-content" style="
                  width: 900px;
                  max-width: 95%;
                  max-height: 90vh;
                  display: flex;
                  flex-direction: column;
                  position: relative;
                ">
              <button class="close-btn" onclick="closeVoucherDetailModal()" style="
                    position: absolute;
                    top: 15px;
                    right: 15px;
                    width: 35px;
                    height: 35px;
                    border-radius: 50%;
                    background: #e0e0e0;
                    border: none;
                    font-size: 24px;
                    line-height: 1;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 10;
                    transition: all 0.2s;
                  ">
                &times;
              </button>
              <div class="modal-header" style="padding-right: 50px">
                <h3>회계전표 상세</h3>
              </div>
              <div class="modal-body" style="overflow-y: auto; flex: 1; max-height: calc(90vh - 140px)">
                <div id="voucherDetailContent" style="padding: 20px"></div>
              </div>
              <div class="modal-footer" style="text-align: right; padding: 10px 20px">
                <button class="btn btn-primary" onclick="printVoucherDetail()">
                  <span>&#128438;</span> 출력
                </button>
                <button class="btn btn-secondary" onclick="closeVoucherDetailModal()">
                  닫기
                </button>
              </div>
            </div>
          </div>

          <!-- 회계전표 수정 모달 -->
          <div id="voucherEditModal" class="modal" style="display: none">
            <div class="modal-content" style="width: 800px; max-width: 95%">
              <div class="modal-header">
                <h3>회계전표 수정</h3>
                <button class="close-btn" onclick="closeVoucherEditModal()">&times;</button>
              </div>
              <div class="modal-body" style="padding: 20px">
                <table id="voucherEditTable" class="display" style="width: 100%">
                  <thead>
                    <tr>
                      <th>전표번호</th>
                      <th>전표일자</th>
                      <th>순번</th>
                      <th>계정코드</th>
                      <th>계정명</th>
                      <th>차대</th>
                      <th>금액</th>
                      <th>적요</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveVoucherEdit()">
                  <span>&#128190;</span> 저장
                </button>
                <button class="btn btn-secondary" onclick="closeVoucherEditModal()">취소</button>
              </div>
            </div>
          </div>

          <!-- 회계전표 삭제 모달 -->
          <div id="voucherDeleteModal" class="modal" style="display: none">
            <div class="modal-content" style="width: 500px; max-width: 95%">
              <div class="modal-header">
                <h3>회계전표 삭제</h3>
                <button class="close-btn" onclick="closeVoucherDeleteModal()">&times;</button>
              </div>
              <div class="modal-body" style="padding: 30px; text-align: center">
                <p style="font-size: 16px; margin-bottom: 20px">
                  선택한
                  <span id="deleteVoucherCount" style="font-weight: bold; color: #dc3545">0</span>건의 회계전표를 삭제하시겠습니까?
                </p>
                <p style="color: #dc3545; font-size: 14px">
                  ⚠️ 삭제된 전표는 복구할 수 없습니다.<br />
                  원천 거래(매입/매출)와의 연동 정보도 함께 제거됩니다.
                </p>
              </div>
              <div class="modal-footer">
                <button class="btn btn-danger" onclick="confirmVoucherDelete()">
                  <span>&#128465;</span> 삭제
                </button>
                <button class="btn btn-secondary" onclick="closeVoucherDeleteModal()">
                  취소
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- 합계잔액시산표 페이지 -->
        <div class="page-content hidden" id="totalBalancePage">
          <h2 style="display: none">합계잔액시산표</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="trialBalancePeriod" class="form-control" style="width: 150px" onchange="filterTrialBalance()">
                <option value="">기간 선택</option>
                <option value="month">월별</option>
                <option value="quarter">분기별</option>
                <option value="year">연간</option>
              </select>
              <input type="date" id="trialBalanceStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="trialBalanceEndDate" class="form-control" style="width: 150px" />
              <button class="btn btn-secondary" onclick="filterTrialBalance()">조회</button>
            </div>

            <div class="toolbar-right" style="display: flex; gap: 12px; align-items: center">
              <button class="btn btn-secondary" onclick="printTrialBalance()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>🖨️</span> 출력
              </button>
              <button class="btn btn-secondary" onclick="exportTrialBalanceToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 합계잔액시산표 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            조회 기간: <span id="trialBalancePeriodInfo" style="font-weight: bold">-</span>
          </div>

          <!-- ✅ 합계잔액시산표 DataTable -->
          <table id="trialBalanceTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="selectAllTrialBalance" /></th>
                <th>순번</th>
                <th>계정코드</th>
                <th>계정명</th>
                <th>차변당월</th>
                <th>차변누계</th>
                <th>대변당월</th>
                <th>대변누계</th>
                <th>차변잔액</th>
                <th>대변잔액</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="trialBalanceTableBody"></tbody>
          </table>
        </div>

        <!-- 합계잔액시산표 상세보기 모달 -->
        <div id="trialBalanceDetailModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 95%;
                max-width: 1400px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 제목 영역 -->
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <div>
                <h2 style="margin: 0 0 8px 0; font-size: 24px; font-weight: 700; color: #1f2937">
                  💰 계정과목별 거래내역
                </h2>
                <div style="font-size: 14px; color: #6b7280">
                  <span id="trialBalanceDetailAccountCode" style="font-weight: 600">-</span>
                  <span style="margin: 0 8px">|</span>
                  <span id="trialBalanceDetailAccountName" style="font-weight: 600">-</span>
                  <span style="margin: 0 8px">|</span>
                  <span id="trialBalanceDetailPeriod">-</span>
                </div>
              </div>
              <button onclick="closeTrialBalanceDetailModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <!-- 요약 정보 -->
            <div style="
                  display: grid;
                  grid-template-columns: repeat(4, 1fr);
                  gap: 16px;
                  margin-bottom: 24px;
                  padding: 20px;
                  background: #f9fafb;
                  border-radius: 8px;
                ">
              <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px">차변당월</div>
                <div id="detailDebitMonth" style="font-size: 18px; font-weight: 600; color: #1f2937">
                  0원
                </div>
              </div>
              <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px">차변누계</div>
                <div id="detailDebitTotal" style="font-size: 18px; font-weight: 600; color: #1f2937">
                  0원
                </div>
              </div>
              <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px">대변당월</div>
                <div id="detailCreditMonth" style="font-size: 18px; font-weight: 600; color: #1f2937">
                  0원
                </div>
              </div>
              <div>
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px">대변누계</div>
                <div id="detailCreditTotal" style="font-size: 18px; font-weight: 600; color: #1f2937">
                  0원
                </div>
              </div>
            </div>

            <!-- 거래내역 테이블 -->
            <div style="margin-bottom: 20px">
              <h3 id="trialBalanceDetailTableTitle"
                style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #1f2937">
                📋 거래내역
              </h3>
              <table id="trialBalanceDetailTable" class="display" style="width: 100%">
                <thead id="trialBalanceDetailTableHead">
                  <tr>
                    <th>순번</th>
                    <th>작성일자</th>
                    <th>입출구분</th>
                    <th>계정명</th>
                    <th>입금금액</th>
                    <th>출금금액</th>
                    <th>적요</th>
                    <th>작성자</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 대차대조표 페이지 -->
        <div class="page-content hidden" id="accountBalancePage">
          <h2 style="display: none">대차대조표</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="balanceSheetPeriod" class="form-control" style="width: 150px" onchange="filterBalanceSheet()">
                <option value="">기간 선택</option>
                <option value="month">월별</option>
                <option value="quarter">분기별</option>
                <option value="year">연간</option>
              </select>
              <input type="date" id="balanceSheetDate" class="form-control" style="width: 150px" />
              <button class="btn btn-secondary" onclick="filterBalanceSheet()">조회</button>
            </div>

            <div class="toolbar-right">
              <button class="btn btn-secondary" onclick="exportBalanceSheetToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 대차대조표 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            기준일: <span id="balanceSheetDateInfo" style="font-weight: bold">-</span>
          </div>

          <!-- ✅ 대차대조표 DataTable -->
          <table id="balanceSheetTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="selectAllBalanceSheet" /></th>
                <th>순번</th>
                <th>계정과목코드</th>
                <th>계정과목명</th>
                <th>자산</th>
                <th>부채</th>
                <th>자본</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="balanceSheetTableBody"></tbody>
          </table>
        </div>

        <!-- 계정과목 상세보기 모달 -->
        <div id="accountDetailModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 고정된 제목 영역 -->
            <div id="accountDetailModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                계정과목 상세정보
              </h2>
              <button onclick="closeAccountDetailModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <div>
                <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280">계정코드</label>
                <div id="detailAccountCode" style="padding: 8px 0; color: #1f2937">-</div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280">계정명</label>
                <div id="detailAccountName" style="padding: 8px 0; color: #1f2937">-</div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280">합계시산표연결</label>
                <div id="detailAccountTrialBalance" style="padding: 8px 0; color: #1f2937">-</div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280">사용구분</label>
                <div id="detailAccountStatus" style="padding: 8px 0; color: #1f2937">-</div>
              </div>
              <div style="grid-column: 1 / -1">
                <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280">적요</label>
                <div id="detailAccountDescription" style="padding: 8px 0; color: #1f2937">-</div>
              </div>
              <div>
                <label style="display: block; margin-bottom: 4px; font-weight: 500; color: #6b7280">수정일자</label>
                <div id="detailAccountModifiedDate" style="padding: 8px 0; color: #1f2937">-</div>
              </div>
            </div>

            <div style="margin-top: 24px; display: flex; justify-content: flex-end">
              <button onclick="closeAccountDetailModal()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                닫기
              </button>
            </div>
          </div>
        </div>

        <!-- 계정과목 신규등록 모달 -->
        <div id="accountCreateModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 고정된 제목 영역 -->
            <div id="accountCreateModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                계정과목 신규등록
              </h2>
              <button onclick="closeAccountModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <!-- 계정코드 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                계정코드 * (4자리)
              </label>
              <input type="text" id="accountCode" maxlength="4" required style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="4자리 계정코드" />
            </div>

            <!-- 계정명 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                계정명 *
              </label>
              <input type="text" id="accountName" required style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="계정명" />
            </div>

            <!-- 합계시산표연결여부 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                합계시산표연결
              </label>
              <select id="accountTrialBalance" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  ">
                <option value="Y">연결</option>
                <option value="N">미연결</option>
              </select>
            </div>

            <!-- 적요 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                적요
              </label>
              <textarea id="accountDescription" rows="3" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                    resize: vertical;
                  " placeholder="적요"></textarea>
            </div>

            <!-- 사용구분 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                사용구분
              </label>
              <select id="accountStatus" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  ">
                <option value="0">사용중</option>
                <option value="1">미사용</option>
              </select>
            </div>

            <div style="margin-top: 24px; display: flex; justify-content: flex-end; gap: 8px">
              <button onclick="closeAccountModal()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                취소
              </button>
              <button onclick="saveAccount()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                저장
              </button>
            </div>
          </div>
        </div>

        <!-- 계정과목 수정 모달 -->
        <div id="accountEditModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 고정된 제목 영역 -->
            <div id="accountEditModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                계정과목 수정
              </h2>
              <button onclick="closeAccountEditModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <!-- 계정코드 (읽기 전용) -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                계정코드
              </label>
              <input type="text" id="editAccountCode" readonly style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                    background: #f9fafb;
                  " />
            </div>

            <!-- 계정명 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                계정명 *
              </label>
              <input type="text" id="editAccountName" required style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " placeholder="계정명" />
            </div>

            <!-- 합계시산표연결여부 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                합계시산표연결
              </label>
              <select id="editAccountTrialBalance" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  ">
                <option value="Y">연결</option>
                <option value="N">미연결</option>
              </select>
            </div>

            <!-- 적요 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                적요
              </label>
              <textarea id="editAccountDescription" rows="3" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                    resize: vertical;
                  " placeholder="적요"></textarea>
            </div>

            <!-- 사용구분 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
                사용구분
              </label>
              <select id="editAccountStatus" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  ">
                <option value="0">사용중</option>
                <option value="1">미사용</option>
              </select>
            </div>

            <div style="margin-top: 24px; display: flex; justify-content: flex-end; gap: 8px">
              <button onclick="closeAccountEditModal()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                취소
              </button>
              <button onclick="updateAccount()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                수정
              </button>
            </div>
          </div>
        </div>

        <!-- 계정과목 삭제 확인 모달 -->
        <div id="accountDeleteModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 450px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <div id="accountDeleteModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #fee2e2;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #dc2626">
                계정과목 삭제
              </h2>
              <button onclick="closeAccountDeleteModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <div style="margin-bottom: 24px">
              <p style="font-size: 16px; color: #1f2937; margin: 0 0 16px 0">
                다음 계정과목을 삭제하시겠습니까?
              </p>
              <div id="accountDeleteInfo" style="
                    padding: 16px;
                    background: #fef2f2;
                    border: 1px solid #fecaca;
                    border-radius: 8px;
                    font-weight: 500;
                    color: #991b1b;
                  ">
                계정코드: -
              </div>
              <p style="font-size: 14px; color: #6b7280; margin: 16px 0 0 0">
                ※ 삭제된 계정과목은 사용구분이 '삭제'로 변경됩니다.
              </p>
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 8px">
              <button onclick="closeAccountDeleteModal()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                취소
              </button>
              <button onclick="confirmAccountDelete()" style="
                    padding: 10px 20px;
                    background: #dc2626;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- 견적관리 페이지 -->
        <div class="page-content hidden" id="quotationPage">
          <h2 style="display: none">견적관리</h2>
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="quotationStatusFilter" class="form-control" style="width: 150px"
                onchange="filterQuotations()">
                <option value="">전체 상태</option>
                <option value="1">작성중</option>
                <option value="2">승인</option>
                <option value="3">반려</option>
              </select>
              <input type="date" id="quotationStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="quotationEndDate" class="form-control" style="width: 150px" />
              <button id="quotationBtnFilter" class="btn btn-secondary" onclick="filterQuotations()">조회</button>
            </div>
            <div class="toolbar-right">
              <button id="quotationBtnNew" class="btn btn-success" onclick="openNewQuotationModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 견적서 작성
              </button>
              <button id="quotationBtnExport" class="btn btn-secondary" onclick="exportQuotationsToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 견적 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 견적 수: <span id="quotationCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- DataTable -->
          <table id="quotationTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="quotationSelectAll" /></th>
                <th>순번</th>
                <th>견적번호</th>
                <th>매출처명</th>
                <th>견적일자</th>
                <th>제목</th>
                <th>견적금액</th>
                <th>담당자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="quotationTableBody"></tbody>
          </table>
        </div>

        <!-- ✅ 견적 상세 보기 모달 -->
        <div id="quotationDetailModal" class="modal hidden">
          <div id="quotationDetailModalContent" class="modal-content large"
            style="max-width: 1000px; max-height: 90vh; overflow-y: auto; position: relative">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="quotationDetailModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                견적 상세 보기
              </h2>
              <button id="closeQuotationDetailModal" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 견적 기본 정보 (카드 스타일) -->
            <div style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                기본 정보
              </h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">견적번호</span>
                  <span id="q_no" style="color: #1f2937; font-weight: 600">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">견적일자</span>
                  <span id="q_date" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">매출처명</span>
                  <span id="q_customer" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">비고</span>
                  <span id="q_remark" style="color: #1f2937">-</span>
                </div>
              </div>
            </div>

            <!-- ✅ 견적 상세 목록 -->
            <div id="quotationDetailSection" style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                견적 품목 내역
              </h3>
              <table id="quotationDetailTable" class="display" style="width: 100%">
                <thead>
                  <tr>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>단위</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>금액</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold">
                    <td colspan="6" style="text-align: right; padding-right: 20px; color: #1f2937">
                      합계
                    </td>
                    <td id="quotationDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px">
                      0
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- ✅ 출력 버튼 영역 -->
            <div style="
                  margin-top: 24px;
                  display: flex;
                  justify-content: flex-end;
                  gap: 12px;
                  padding-top: 16px;
                  border-top: 1px solid #e5e7eb;
                ">
              <button id="quotationDetailCloseBtn" onclick="closeQuotationDetailModal()" style="
                    padding: 10px 24px;
                    background: #dc2626;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                    box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
                  "
                onmouseover="this.style.background='#b91c1c'; this.style.boxShadow='0 4px 8px rgba(220, 38, 38, 0.3)';"
                onmouseout="this.style.background='#dc2626'; this.style.boxShadow='0 2px 4px rgba(220, 38, 38, 0.2)';">
                ✕ 닫기
              </button>
              <button id="quotationDetailPrintBtn" onclick="printQuotationFromDetail()" style="
                    padding: 10px 24px;
                    background: #9333ea;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                    box-shadow: 0 2px 4px rgba(147, 51, 234, 0.2);
                  "
                onmouseover="this.style.background='#7c3aed'; this.style.boxShadow='0 4px 8px rgba(147, 51, 234, 0.3)';"
                onmouseout="this.style.background='#9333ea'; this.style.boxShadow='0 2px 4px rgba(147, 51, 234, 0.2)';">
                📄 출력
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 수정 모달 -->
        <div id="quotationEditModal" class="modal" style="display: none">
          <div id="quotationEditModalContent" class="modal-content large" style="
                max-width: 1200px;
                max-height: 90vh;
                overflow-y: auto;
                padding: 32px;
                position: relative;
              ">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="quotationEditModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                견적 수정
              </h2>
              <button id="closeQuotationEditModalBtn" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 견적 기본 정보 (카드 스타일) -->
            <div style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                기본 정보
              </h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">견적번호</span>
                  <span id="editQuotationNo" style="color: #1f2937; font-weight: 600">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">견적일자</span>
                  <span id="editQuotationDate" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">매출처명</span>
                  <span id="editCustomerName" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">출고희망일자</span>
                  <input type="date" id="editDeliveryDate" style="
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                      " />
                </div>
                <div style="display: flex; align-items: center; grid-column: 1 / -1">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">제목</span>
                  <input type="text" id="editTitle" style="
                        flex: 1;
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                      " placeholder="견적 제목" />
                </div>
                <div style="display: flex; align-items: flex-start; grid-column: 1 / -1">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280; padding-top: 8px">적요</span>
                  <textarea id="editRemark" rows="2" style="
                        flex: 1;
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                        resize: vertical;
                      " placeholder="견적 적요"></textarea>
                </div>
              </div>
            </div>

            <!-- ✅ 견적 상세 목록 -->
            <div id="quotationDetailListForEdit" style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  border: 1px solid #e5e7eb;
                ">
              <div style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
                  견적 품목 내역
                </h3>
                <div style="display: flex; gap: 8px">
                  <button type="button" onclick="addQuotationDetailRow()" style="
                        padding: 8px 16px;
                        background: #10b981;
                        border: none;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                      " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                    + 자재 추가
                  </button>
                </div>
              </div>

              <table id="quotationEditDetailTable" class="display" style="width: 100%">
                <thead>
                  <tr>
                    <th style="width: 50px">순번</th>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>단위</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>금액</th>
                    <th style="width: 80px">관리</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold">
                    <td colspan="8" style="text-align: right; padding-right: 20px; color: #1f2937">
                      합계
                    </td>
                    <td id="quotationEditDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px">
                      0
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button type="button" onclick="closeQuotationEditModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="submitQuotationEdit()" style="
                    padding: 12px 24px;
                    background: #2563eb;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 삭제 확인 모달 -->
        <div id="quotationDeleteModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 450px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <div id="quotationDeleteModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #fee2e2;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #dc2626">
                견적 삭제
              </h2>
              <button onclick="closeQuotationDeleteModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <div style="margin-bottom: 24px">
              <p style="font-size: 16px; color: #1f2937; margin: 0 0 16px 0">
                다음 견적을 삭제하시겠습니까?
              </p>
              <div id="deleteQuotationInfo" style="
                    padding: 16px;
                    background: #fef2f2;
                    border: 1px solid #fecaca;
                    border-radius: 8px;
                    font-weight: 500;
                    color: #991b1b;
                  ">
                견적번호: -
              </div>
              <p style="font-size: 14px; color: #6b7280; margin: 16px 0 0 0">
                ※ 삭제된 견적은 복구할 수 없습니다.
              </p>
            </div>

            <div style="display: flex; justify-content: flex-end; gap: 8px">
              <button onclick="closeQuotationDeleteModal()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                취소
              </button>
              <button onclick="confirmQuotationDelete()" style="
                    padding: 10px 20px;
                    background: #dc2626;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    cursor: pointer;
                  ">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 승인 확인 모달 -->
        <div id="quotationApproveModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 400px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 아이콘 -->
            <div style="text-align: center; margin-bottom: 20px">
              <div style="
                    width: 64px;
                    height: 64px;
                    background: #dbeafe;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 16px;
                  ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2">
                  <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937">
                견적 승인
              </h2>
              <p id="approveQuotationInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px">
                견적번호: -
              </p>
              <p style="margin: 0; color: #2563eb; font-size: 14px; font-weight: 500">
                이 견적을 승인하시겠습니까?
              </p>
              <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px">
                승인 후에는 상태가 변경됩니다.
              </p>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px">
              <button onclick="closeQuotationApproveModal()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationApprove()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #2563eb;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                승인하기
              </button>
            </div>
          </div>
        </div>

        <!-- 신규 견적서용 품목 추가 모달 -->
        <div id="newQuotationMaterialModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 600px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 추가
              </h2>
              <button onclick="closeNewQuotationMaterialModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <!-- 자재 검색 영역 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="newMaterialSearchInput" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="자재명 또는 품목코드로 검색" onkeypress="if(event.key === 'Enter') searchNewMaterials()" />
                  <button onclick="searchNewMaterials()" style="
                        padding: 10px 20px;
                        background: #3b82f6;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- 검색 결과 테이블 -->
              <div id="newMaterialSearchResults" style="display: none">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과 (클릭하여
                  선택)</label>
                <div style="
                      max-height: 200px;
                      overflow-y: auto;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                    ">
                  <table style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f9fafb; position: sticky; top: 0">
                      <tr>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품목코드
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품명
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          규격
                        </th>
                      </tr>
                    </thead>
                    <tbody id="newMaterialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- 선택된 자재 정보 -->
              <div id="newSelectedMaterialInfo" style="
                    display: none;
                    background: #f0f9ff;
                    padding: 12px;
                    border-radius: 8px;
                    border: 2px solid #bfdbfe;
                  ">
                <div style="display: flex; justify-content: space-between; align-items: center">
                  <div>
                    <div style="
                          font-size: 12px;
                          color: #3b82f6;
                          font-weight: 600;
                          margin-bottom: 4px;
                        ">
                      선택된 자재
                    </div>
                    <div style="font-weight: 600; color: #1e40af" id="newSelectedMaterialName">
                      -
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="newSelectedMaterialCode">
                      -
                    </div>
                  </div>
                  <button onclick="clearNewSelectedMaterial()" style="
                        padding: 6px 12px;
                        background: #ef4444;
                        border: none;
                        border-radius: 6px;
                        font-size: 12px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                      ">
                    취소
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
                <input type="number" id="newDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="수량 입력" value="1" min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가</label>
                <div style="display: flex; gap: 8px">
                  <input type="number" id="newDetailPrice" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="단가 입력" value="0" min="0" step="0.01" />
                  <button onclick="showNewPriceHistory()" style="
                        padding: 10px 16px;
                        background: #8b5cf6;
                        border: none;
                        border-radius: 8px;
                        font-size: 13px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#7c3aed';" onmouseout="this.style.background='#8b5cf6';">
                    이전 단가
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">금액 (자동계산)</label>
                <input type="text" id="newDetailAmount" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                    " readonly value="0" />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeNewQuotationMaterialModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmNewQuotationMaterialAdd()" style="
                    padding: 12px 24px;
                    background: #10b981;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- 견적서 작성/수정 모달 -->
        <div id="quotationModal" class="modal" style="display: none">
          <div id="quotationModalContent" class="modal-content" style="
                max-width: 1200px;
                max-height: 90vh;
                overflow-y: auto;
                padding: 32px;
                position: relative;
              ">
            <!-- 헤더 -->
            <div id="quotationModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid var(--border);
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)"
                id="quotationModalTitle">
                견적서 작성
              </h2>
              <button onclick="closeQuotationModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <form id="quotationForm" onsubmit="submitQuotation(event)">
              <!-- 마스터 정보 섹션 -->
              <div style="
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 8px;
                    margin-bottom: 24px;
                  ">
                <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600">기본 정보</h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
                  <!-- 견적일자 -->
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                        ">견적일자 *</label>
                    <input type="date" id="quotationDate" required style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                        " />
                  </div>

                  <!-- 출고희망일자 -->
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                        ">출고희망일자</label>
                    <input type="date" id="deliveryDate" style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                        " />
                  </div>

                  <!-- 매출처 선택 -->
                  <div style="grid-column: 1 / -1">
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                        ">매출처 *</label>
                    <div style="display: flex; gap: 8px">
                      <!-- 숨겨진 매출처 코드 필드 (실제 값 저장용) -->
                      <input type="hidden" id="selectedCustomerCode" />

                      <!-- 통합 검색 입력란 -->
                      <input type="text" id="selectedCustomerName" required style="
                            flex: 1;
                            padding: 12px 16px;
                            border: 2px solid var(--border);
                            border-radius: 8px;
                            font-size: 14px;
                          " placeholder="매출처 코드 또는 이름 입력 후 엔터"
                        onkeypress="if(event.key === 'Enter') { event.preventDefault(); openCustomerSearchModal(); }" />
                      <button type="button" onclick="openCustomerSearchModal()" style="
                            padding: 10px 20px;
                            background: var(--primary);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 500;
                            cursor: pointer;
                            white-space: nowrap;
                          ">
                        검색
                      </button>
                    </div>
                    <!-- 선택된 매출처 정보 표시 -->
                    <div id="selectedCustomerInfo" style="
                          display: none;
                          margin-top: 8px;
                          padding: 8px 12px;
                          background: #f0f9ff;
                          border-radius: 6px;
                          border: 1px solid #bfdbfe;
                        ">
                      <span style="font-size: 12px; color: #3b82f6; font-weight: 600">선택된 매출처:</span>
                      <span id="selectedCustomerDisplay"
                        style="margin-left: 8px; font-weight: 600; color: #1e40af"></span>
                    </div>
                  </div>

                  <!-- 제목 -->
                  <div style="grid-column: 1 / -1">
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                        ">제목</label>
                    <input type="text" id="quotationTitle" style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                        " placeholder="견적서 제목을 입력하세요" />
                  </div>

                  <!-- 적요 -->
                  <div style="grid-column: 1 / -1">
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                        ">적요</label>
                    <textarea id="quotationRemark" style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                          resize: vertical;
                          min-height: 80px;
                        " placeholder="비고사항을 입력하세요"></textarea>
                  </div>
                </div>
              </div>

              <!-- 상세내역 섹션 -->
              <div style="margin-bottom: 24px">
                <div style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 16px;
                    ">
                  <h3 style="margin: 0; font-size: 18px; font-weight: 600">견적 상세내역</h3>
                  <button type="button" onclick="openMaterialSearchModal()" style="
                        padding: 8px 16px;
                        background: #007bff;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                      ">
                    + 자재 추가
                  </button>
                </div>

                <!-- 상세내역 테이블 -->
                <div style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px">
                  <table id="quotationCreateDetailTable" style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f8f9fa">
                      <tr>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid var(--border);
                              width: 40px;
                            ">
                          순번
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid var(--border);
                            ">
                          자재코드
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid var(--border);
                            ">
                          자재명
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid var(--border);
                            ">
                          규격
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid var(--border);
                              width: 100px;
                            ">
                          수량
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid var(--border);
                              width: 120px;
                            ">
                          단가
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid var(--border);
                              width: 120px;
                            ">
                          공급가
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid var(--border);
                              width: 100px;
                            ">
                          부가세
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: center;
                              border-bottom: 2px solid var(--border);
                              width: 60px;
                            ">
                          삭제
                        </th>
                      </tr>
                    </thead>
                    <tbody id="quotationDetailTableBody">
                      <tr>
                        <td colspan="9" style="padding: 40px; text-align: center; color: #999">
                          자재 추가 버튼을 클릭하여 견적 상세내역을 입력하세요
                        </td>
                      </tr>
                    </tbody>
                    <tfoot style="background: #f8f9fa; font-weight: 600">
                      <tr>
                        <td colspan="6" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid var(--border);
                            ">
                          합계
                        </td>
                        <td id="totalSupplyPrice" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid var(--border);
                            ">
                          0
                        </td>
                        <td id="totalVat" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid var(--border);
                            ">
                          0
                        </td>
                        <td style="padding: 12px; border-top: 2px solid var(--border)"></td>
                      </tr>
                      <tr>
                        <td colspan="6" style="padding: 12px; text-align: right">총액</td>
                        <td colspan="2" id="grandTotal" style="
                              padding: 12px;
                              text-align: right;
                              color: #007bff;
                              font-size: 16px;
                            ">
                          0
                        </td>
                        <td></td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

              <!-- 버튼 영역 -->
              <div style="display: flex; gap: 12px; justify-content: flex-end">
                <button type="button" onclick="closeQuotationModal()" style="
                      padding: 10px 24px;
                      background: var(--bg-light);
                      border: 1px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: var(--text-dark);
                    ">
                  취소
                </button>
                <button type="submit" style="
                      padding: 10px 24px;
                      background: var(--primary);
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: white;
                    ">
                  견적서 등록
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- ✅ 견적 품목 추가 모달 -->
        <div id="quotationDetailAddModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 600px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 추가
              </h2>
              <button id="closeQuotationDetailAddModal" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <!-- ✅ 자재 검색 영역 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="materialSearchInput" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="자재명 또는 품목코드로 검색" />
                  <button onclick="searchMaterials()" style="
                        padding: 10px 20px;
                        background: #3b82f6;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- ✅ 검색 결과 테이블 -->
              <div id="materialSearchResults" style="display: none">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과 (클릭하여
                  선택)</label>
                <div style="
                      max-height: 200px;
                      overflow-y: auto;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                    ">
                  <table id="materialSearchTable" style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f9fafb; position: sticky; top: 0">
                      <tr>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품목코드
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품명
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          규격
                        </th>
                      </tr>
                    </thead>
                    <tbody id="materialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ✅ 선택된 자재 정보 -->
              <div id="selectedMaterialInfo" style="
                    display: none;
                    background: #f0f9ff;
                    padding: 12px;
                    border-radius: 8px;
                    border: 2px solid #bfdbfe;
                  ">
                <div style="display: flex; justify-content: space-between; align-items: center">
                  <div>
                    <div style="
                          font-size: 12px;
                          color: #3b82f6;
                          font-weight: 600;
                          margin-bottom: 4px;
                        ">
                      선택된 자재
                    </div>
                    <div style="font-weight: 600; color: #1e40af" id="selectedMaterialName">
                      -
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="selectedMaterialCode">
                      -
                    </div>
                  </div>
                  <button onclick="clearSelectedMaterial()" style="
                        padding: 6px 12px;
                        background: #ef4444;
                        border: none;
                        border-radius: 6px;
                        font-size: 12px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                      ">
                    취소
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
                <input type="number" id="addDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="수량 입력" value="1" min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가</label>
                <div style="display: flex; gap: 8px">
                  <input type="number" id="addDetailPrice" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="단가 입력" value="0" min="0" step="0.01" />
                  <button onclick="showPriceHistory()" style="
                        padding: 10px 16px;
                        background: #8b5cf6;
                        border: none;
                        border-radius: 8px;
                        font-size: 13px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#7c3aed';" onmouseout="this.style.background='#8b5cf6';">
                    이전 단가
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">금액 (자동계산)</label>
                <input type="text" id="addDetailAmount" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                    " readonly value="0" />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeQuotationDetailAddModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationDetailAdd()" style="
                    padding: 12px 24px;
                    background: #10b981;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 품목 수정 모달 -->
        <div id="quotationDetailEditModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 500px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 수정
              </h2>
              <button id="closeQuotationDetailEditModal" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 16px">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px">
                <span style="font-weight: 500; color: #6b7280">품목코드:</span>
                <span id="editDetailCode" style="color: #1f2937; font-weight: 600">-</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px">
                <span style="font-weight: 500; color: #6b7280">품명:</span>
                <span id="editDetailName" style="color: #1f2937">-</span>
              </div>
              <div style="display: flex; justify-content: space-between">
                <span style="font-weight: 500; color: #6b7280">규격:</span>
                <span id="editDetailSpec" style="color: #1f2937">-</span>
              </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
                <input type="number" id="editDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가</label>
                <input type="number" id="editDetailPrice" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">금액 (자동계산)</label>
                <input type="text" id="editDetailAmount" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                    " readonly />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeQuotationDetailEditModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationDetailEdit()" style="
                    padding: 12px 24px;
                    background: #3b82f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                수정하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 견적 품목 삭제 확인 모달 -->
        <div id="quotationDetailDeleteModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 400px">
            <div style="text-align: center; padding: 20px">
              <div style="
                    width: 64px;
                    height: 64px;
                    background: #fee2e2;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin: 0 auto 20px;
                  ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6">
                  </path>
                  <line x1="10" y1="11" x2="10" y2="17"></line>
                  <line x1="14" y1="11" x2="14" y2="17"></line>
                </svg>
              </div>

              <h2 style="margin: 0 0 12px 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 삭제
              </h2>
              <p style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px">
                이 품목을 삭제하시겠습니까?
              </p>
              <p id="deleteDetailInfo" style="margin: 0; color: #374151; font-weight: 600; font-size: 14px">
                -
              </p>
            </div>

            <div style="display: flex; gap: 12px; padding: 0 20px 20px">
              <button onclick="closeQuotationDetailDeleteModal()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmQuotationDetailDelete()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #ef4444;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#dc2626';" onmouseout="this.style.background='#ef4444';">
                삭제하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 출고단가 이력 모달 -->
        <div id="priceHistoryModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 700px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-top: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                출고단가 이력
              </h2>
              <button id="closePriceHistoryModal" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- 자재 정보 -->
            <div style="
                  background: #fef3c7;
                  padding: 12px;
                  border-radius: 8px;
                  margin-bottom: 16px;
                  border: 2px solid #fbbf24;
                ">
              <div style="display: flex; justify-content: space-between; align-items: center">
                <div>
                  <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px">
                    선택된 자재
                  </div>
                  <div style="font-weight: 600; color: #78350f" id="priceHistoryMaterialName">
                    -
                  </div>
                  <div style="font-size: 12px; color: #92400e; margin-top: 2px" id="priceHistoryMaterialCode">
                    -
                  </div>
                </div>
              </div>
            </div>

            <!-- ✅ 탭 메뉴 -->
            <div style="
                  display: flex;
                  gap: 8px;
                  margin-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <button id="tabActualPrice" onclick="switchPriceHistoryTab('actual')" style="
                    padding: 12px 20px;
                    background: #3b82f6;
                    border: none;
                    border-bottom: 3px solid #3b82f6;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                    flex: 1;
                  ">
                실제 출고가
              </button>
              <button id="tabQuotationPrice" onclick="switchPriceHistoryTab('quotation')" style="
                    padding: 12px 20px;
                    background: transparent;
                    border: none;
                    border-bottom: 3px solid transparent;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    color: #6b7280;
                    transition: all 0.2s;
                    flex: 1;
                  "
                onmouseover="if(this.id !== 'tabActualPrice' || this.style.background === 'transparent') this.style.color='#1f2937';"
                onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';">
                견적 제안가
              </button>
            </div>

            <!-- 이력 테이블 -->
            <div style="margin-bottom: 16px">
              <label id="priceHistoryLabel"
                style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                이 거래처에 실제 출고한 이력 (클릭하여 단가 선택)
              </label>
              <div style="
                    max-height: 300px;
                    overflow-y: auto;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                  ">
                <table id="priceHistoryTable" style="width: 100%; border-collapse: collapse">
                  <thead id="priceHistoryTableHead" style="background: #f9fafb; position: sticky; top: 0">
                    <tr>
                      <th style="
                            padding: 10px;
                            text-align: left;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고일자
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고단가
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고수량
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: center;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        적요
                      </th>
                    </tr>
                  </thead>
                  <tbody id="transactionPriceHistoryTableBody">
                    <tr>
                      <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af">
                        이력이 없습니다
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  padding-top: 16px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closePriceHistoryModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                닫기
              </button>
            </div>
          </div>
        </div>

        <!-- 거래명세서관리 페이지 -->
        <div class="page-content hidden" id="transactionPage">
          <h2 style="display: none">거래명세서관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="transactionStatusFilter" class="form-control" style="width: 150px"
                onchange="filterTransactions()">
                <option value="">전체 상태</option>
                <option value="1">작성중</option>
                <option value="2">확정</option>
                <option value="3">발행완료</option>
              </select>
              <input type="date" id="transactionStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="transactionEndDate" class="form-control" style="width: 150px" />
              <button id="transactionBtnFilter" class="btn btn-secondary" onclick="filterTransactions()">조회</button>
            </div>

            <div class="toolbar-right">
              <button id="transactionBtnNew" class="btn btn-success" onclick="openNewTransactionModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 거래명세서 작성
              </button>
              <button id="transactionBtnExport" class="btn btn-secondary" onclick="exportTransactionsToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 거래명세서 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 거래명세서 수: <span id="transactionCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- ✅ 거래명세서 목록 DataTable -->
          <table id="transactionTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="transactionSelectAll" /></th>
                <th>순번</th>
                <th>명세서번호</th>
                <th>거래일자</th>
                <th>매출처명</th>
                <th>공급가액</th>
                <th>부가세</th>
                <th>합계금액</th>
                <th>작성자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="transactionTableBody"></tbody>
          </table>
        </div>

        <!-- ✅ 거래명세서 상세보기 모달 -->
        <!-- ✅ 거래명세서 상세보기 모달 (Prefix 규칙: transactionViewModal) -->
        <div id="transactionViewModal" class="modal hidden">
          <div class="modal-content large" style="max-width: 1000px; max-height: 90vh; overflow-y: auto">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="transactionViewModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                거래명세서 상세 보기
              </h2>
              <button id="transactionViewModalCloseBtn" onclick="closeTransactionViewModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 거래명세서 기본 정보 (카드 스타일) -->
            <div style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                기본 정보
              </h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">명세서번호</span>
                  <span id="transactionDetailTransactionNo" style="color: #1f2937; font-weight: 600">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">거래일자</span>
                  <span id="transactionDetailTransactionDate" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">매출처명</span>
                  <span id="transactionDetailCustomerName" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">작성자</span>
                  <span id="transactionDetailUserName" style="color: #1f2937">-</span>
                </div>
              </div>
            </div>

            <!-- ✅ 거래명세서 상세 목록 -->
            <div>
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                거래 품목 내역
              </h3>
              <table id="transactionViewDetailTable" class="display" style="width: 100%">
                <thead>
                  <tr>
                    <th>순번</th>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>공급가액</th>
                    <th>세액</th>
                    <th>합계</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold">
                    <td colspan="8" style="text-align: right; padding-right: 20px; color: #1f2937">
                      합계
                    </td>
                    <td id="transactionDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px">
                      0
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- ✅ 출력 버튼 영역 -->
            <div style="
                  margin-top: 24px;
                  display: flex;
                  justify-content: flex-end;
                  gap: 12px;
                  padding-top: 16px;
                  border-top: 1px solid #e5e7eb;
                ">
              <button id="transactionViewModalCloseBtn2" onclick="closeTransactionViewModal()" style="
                    padding: 10px 24px;
                    background: #dc2626;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                    box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
                  "
                onmouseover="this.style.background='#b91c1c'; this.style.boxShadow='0 4px 8px rgba(220, 38, 38, 0.3)';"
                onmouseout="this.style.background='#dc2626'; this.style.boxShadow='0 2px 4px rgba(220, 38, 38, 0.2)';">
                ✕ 닫기
              </button>
              <button id="transactionDetailPrintBtn" onclick="printTransactionFromDetail()" style="
                    padding: 10px 24px;
                    background: #9333ea;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                    box-shadow: 0 2px 4px rgba(147, 51, 234, 0.2);
                  "
                onmouseover="this.style.background='#7c3aed'; this.style.boxShadow='0 4px 8px rgba(147, 51, 234, 0.3)';"
                onmouseout="this.style.background='#9333ea'; this.style.boxShadow='0 2px 4px rgba(147, 51, 234, 0.2)';">
                📄 출력
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정버튼 모달창 -->
        <div id="transactionEditModal" class="modal" style="display: none">
          <div id="transactionEditModalContent" class="modal-content large"
            style="max-width: 1200px; max-height: 90vh; overflow-y: auto; padding: 32px">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="transactionEditModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                거래명세서 수정
              </h2>
              <button id="closeTransactionEditModalBtn" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 거래명세서 수정 모달창 기본정보 -->
            <div id="transactionEditModalBasicInfo" style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                기본 정보
              </h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">명세서번호</span>
                  <span id="editTransactionNo" style="color: #1f2937; font-weight: 600">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">거래일자</span>
                  <span id="editTransactionDate" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">매출처명</span>
                  <span id="editTransactionCustomer" style="color: #1f2937">-</span>
                </div>
                <!-- 입출고구분 (거래명세서는 항상 2=출고, hidden) -->
                <input type="hidden" id="editTransactionStatus" value="2" />
              </div>
            </div>

            <!-- ✅ 거래명세서 수정 모달창 자재 목록 -->
            <div id="transactionEditModalDetailMaterial">
              <div style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
                  거래 품목 내역
                </h3>
                <div style="display: flex; gap: 8px">
                  <button type="button" onclick="addTransactionDetailRow()" style="
                        padding: 8px 16px;
                        background: #10b981;
                        border: none;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                      " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                    + 자재 추가
                  </button>
                </div>
              </div>

              <table id="transactionEditDetailTable" class="display" style="width: 100%">
                <thead>
                  <tr>
                    <th style="width: 50px">순번</th>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>공급가액</th>
                    <th>세액</th>
                    <th>합계</th>
                    <th style="width: 80px">관리</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold">
                    <td colspan="8" style="text-align: right; padding-right: 20px; color: #1f2937">
                      합계
                    </td>
                    <td id="transactionEditDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px">
                      0
                    </td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button type="button" onclick="closeTransactionEditModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="submitTransactionEdit()" style="
                    padding: 12px 24px;
                    background: #2563eb;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 - 품목 추가 모달 (Prefix 규칙: transactionItemCreateModal) -->
        <div id="transactionItemCreateModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 600px">
            <div id="transactionItemCreateModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 추가
              </h2>
              <button id="transactionItemCreateModalCloseBtn" onclick="closeTransactionItemCreateModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <!-- ✅ 자재 검색 영역 -->
              <div id="transactionEditModalAddMaterial">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="transactionMaterialSearchInput" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="자재명 또는 품목코드로 검색" />
                  <button onclick="searchTransactionMaterials()" style="
                        padding: 10px 20px;
                        background: #3b82f6;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- ✅ 검색 결과 테이블 -->
              <div id="transactionMaterialSearchResults" style="display: none">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과 (클릭하여
                  선택)</label>
                <div style="
                      max-height: 200px;
                      overflow-y: auto;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                    ">
                  <table id="transactionMaterialSearchTable" style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f9fafb; position: sticky; top: 0">
                      <tr>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품목코드
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품명
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          규격
                        </th>
                      </tr>
                    </thead>
                    <tbody id="transactionMaterialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ✅ 선택된 자재 정보 -->
              <div id="transactionSelectedMaterialInfo" style="
                    display: none;
                    background: #f0f9ff;
                    padding: 12px;
                    border-radius: 8px;
                    border: 2px solid #bfdbfe;
                  ">
                <div style="display: flex; justify-content: space-between; align-items: center">
                  <div>
                    <div style="
                          font-size: 12px;
                          color: #3b82f6;
                          font-weight: 600;
                          margin-bottom: 4px;
                        ">
                      선택된 자재
                    </div>
                    <div style="font-weight: 600; color: #1e40af" id="transactionSelectedMaterialName">
                      -
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="transactionSelectedMaterialCode">
                      -
                    </div>
                  </div>
                  <button onclick="clearSelectedTransactionMaterial()" style="
                        padding: 6px 12px;
                        background: #ef4444;
                        border: none;
                        border-radius: 6px;
                        font-size: 12px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                      ">
                    취소
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
                <input type="number" id="transactionAddDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="수량 입력" value="1" min="0" step="0.01" oninput="calculateTransactionDetailAmount()" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가 *</label>
                <div style="display: flex; gap: 8px; align-items: center">
                  <input type="number" id="transactionAddDetailPrice" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="단가 입력" value="0" min="0" step="0.01"
                    oninput="calculateTransactionDetailAmount()" />
                  <button onclick="showTransactionEditPriceHistoryButton()" style="
                        padding: 10px 20px;
                        background: #9333ea;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#7e22ce';" onmouseout="this.style.background='#9333ea';">
                    이전 단가
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">금액 (자동계산)</label>
                <input type="text" id="transactionAddDetailAmount" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                    " readonly value="0" />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeTransactionDetailAddModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmTransactionDetailAdd()" style="
                    padding: 12px 24px;
                    background: #10b981;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 - 품목 수정 모달 (Prefix 규칙: transactionItemEditModal) -->
        <div id="transactionItemEditModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 500px">
            <div id="transactionItemEditModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 수정
              </h2>
              <button id="transactionItemEditModalCloseBtn" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 16px">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px">
                <span style="font-weight: 500; color: #6b7280">품목코드:</span>
                <span id="transactionEditDetailCode" style="color: #1f2937; font-weight: 600">-</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px">
                <span style="font-weight: 500; color: #6b7280">품명:</span>
                <span id="transactionEditDetailName" style="color: #1f2937">-</span>
              </div>
              <div style="display: flex; justify-content: space-between">
                <span style="font-weight: 500; color: #6b7280">규격:</span>
                <span id="transactionEditDetailSpec" style="color: #1f2937">-</span>
              </div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
                <input type="number" id="transactionEditDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " min="0" step="0.01" oninput="calculateTransactionEditDetailAmount()" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">단가</label>
                <input type="number" id="transactionEditDetailPrice" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " min="0" step="0.01" oninput="calculateTransactionEditDetailAmount()" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">공급가액 (자동계산)</label>
                <input type="text" id="transactionEditDetailAmount" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                    " readonly />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeTransactionDetailEditModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmTransactionDetailEdit()" style="
                    padding: 12px 24px;
                    background: #10b981;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                수정하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 - 품목 삭제 확인 모달 (Prefix 규칙: transactionItemDeleteModal) -->
        <div id="transactionItemDeleteModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1001;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 400px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <div style="text-align: center; margin-bottom: 20px">
              <div style="
                    width: 64px;
                    height: 64px;
                    background: #fee2e2;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 16px;
                  ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path
                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" />
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 삭제
              </h2>
              <p id="transactionDeleteDetailInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px">
                -
              </p>
              <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500">
                이 품목을 삭제하시겠습니까?
              </p>
            </div>

            <div style="display: flex; gap: 12px">
              <button onclick="closeTransactionDetailDeleteModal()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #f3f4f6;
                    color: #374151;
                    border: none;
                    border-radius: 8px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                취소
              </button>
              <button onclick="confirmTransactionDetailDelete()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #dc2626;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 삭제 확인 모달 -->
        <div id="transactionDeleteModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 400px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 아이콘 -->
            <div style="text-align: center; margin-bottom: 20px">
              <div style="
                    width: 64px;
                    height: 64px;
                    background: #fee2e2;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 16px;
                  ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path
                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" />
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937">
                거래명세서 삭제
              </h2>
              <p id="transactionDeleteTransactionInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px">
                명세서번호: -
              </p>
              <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500">
                정말로 이 거래명세서를 삭제하시겠습니까?
              </p>
              <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px">
                삭제된 거래명세서는 복구할 수 없습니다.
              </p>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px">
              <button onclick="closeTransactionDeleteModal()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmTransactionDelete()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #dc2626;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#b91c1c';" onmouseout="this.style.background='#dc2626';">
                삭제하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 작성 모달 -->
        <div id="transactionCreateModal" class="modal" style="display: none">
          <div id="transactionCreateModalContent" class="modal-content"
            style="max-width: 1000px; max-height: 90vh; overflow-y: auto; padding: 32px">
            <!-- 헤더 -->
            <div id="transactionCreateModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                거래명세서 작성
              </h2>
              <button onclick="closeTransactionCreateModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <form id="transactionCreateForm" onsubmit="submitTransactionCreate(event)">
              <!-- 기본 정보 섹션 -->
              <div style="
                    background: #f9fafb;
                    padding: 20px;
                    border-radius: 12px;
                    margin-bottom: 24px;
                    border: 1px solid #e5e7eb;
                  ">
                <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                  기본 정보
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
                  <!-- 거래일자 -->
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">거래일자 *</label>
                    <input type="date" id="transactionCreateDate" required style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid #e5e7eb;
                          border-radius: 8px;
                          font-size: 14px;
                        " />
                  </div>

                  <!-- 입출고구분 (거래명세서는 항상 2=출고) -->
                  <input type="hidden" id="transactionCreateType" value="2" />

                  <!-- 매출처 선택 -->
                  <div style="grid-column: 1 / -1">
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">매출처 *</label>
                    <div style="display: flex; gap: 8px">
                      <!-- 숨겨진 매출처 코드 필드 (실제 값 저장용) -->
                      <input type="hidden" id="transactionCreateCustomerCode" />

                      <!-- 통합 검색 입력란 -->
                      <input type="text" id="transactionCreateCustomerSearch" required style="
                            flex: 1;
                            padding: 12px 16px;
                            border: 2px solid #e5e7eb;
                            border-radius: 8px;
                            font-size: 14px;
                          " placeholder="매출처 코드 또는 이름 입력 후 엔터"
                        onkeypress="if(event.key === 'Enter') { event.preventDefault(); openTransactionCustomerSearchModal(); }" />
                      <button type="button" onclick="openTransactionCustomerSearchModal()" style="
                            padding: 10px 20px;
                            background: #2563eb;
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 500;
                            cursor: pointer;
                            white-space: nowrap;
                          " onmouseover="this.style.background='#1d4ed8';"
                        onmouseout="this.style.background='#2563eb';">
                        검색
                      </button>
                    </div>
                    <!-- 선택된 매출처 정보 표시 -->
                    <div id="transactionSelectedCustomerDisplay" style="
                          display: none;
                          margin-top: 8px;
                          padding: 8px 12px;
                          background: #f0f9ff;
                          border-left: 4px solid #3b82f6;
                          border-radius: 4px;
                        ">
                      <div style="display: flex; justify-content: space-between; align-items: center">
                        <span id="transactionSelectedCustomerInfo"
                          style="font-size: 14px; color: #1e40af; font-weight: 500">-</span>
                        <button type="button" onclick="clearTransactionSelectedCustomer()" style="
                              padding: 4px 12px;
                              background: #ef4444;
                              color: white;
                              border: none;
                              border-radius: 4px;
                              font-size: 12px;
                              cursor: pointer;
                              font-weight: 500;
                            " onmouseover="this.style.background='#dc2626';"
                          onmouseout="this.style.background='#ef4444';">
                          선택 취소
                        </button>
                      </div>
                    </div>
                    <!-- 숨겨진 필드 (폼 검증용) -->
                    <input type="hidden" id="transactionCreateCustomerName" required />
                  </div>

                  <!-- 적요 -->
                  <div style="grid-column: 1 / -1">
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">적요</label>
                    <textarea id="transactionCreateRemark" style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid #e5e7eb;
                          border-radius: 8px;
                          font-size: 14px;
                          resize: vertical;
                          min-height: 80px;
                        " placeholder="비고사항을 입력하세요"></textarea>
                  </div>
                </div>
              </div>

              <!-- 상세내역 섹션 -->
              <div style="margin-bottom: 24px">
                <div style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 16px;
                    ">
                  <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
                    거래 품목 내역
                  </h3>
                  <button type="button" onclick="openNewTransactionDetailAddModal()" style="
                        padding: 8px 16px;
                        background: #10b981;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                      " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                    + 자재 추가
                  </button>
                </div>

                <!-- 상세내역 테이블 -->
                <div style="overflow-x: auto; border: 1px solid #e5e7eb; border-radius: 8px">
                  <table style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f9fafb">
                      <tr>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                              width: 40px;
                            ">
                          순번
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                            ">
                          자재코드
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                            ">
                          자재명
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                            ">
                          규격
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid #e5e7eb;
                              width: 100px;
                            ">
                          수량
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid #e5e7eb;
                              width: 120px;
                            ">
                          단가
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid #e5e7eb;
                              width: 120px;
                            ">
                          공급가액
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border-bottom: 2px solid #e5e7eb;
                              width: 100px;
                            ">
                          부가세
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: center;
                              border-bottom: 2px solid #e5e7eb;
                              width: 60px;
                            ">
                          수정
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: center;
                              border-bottom: 2px solid #e5e7eb;
                              width: 60px;
                            ">
                          삭제
                        </th>
                      </tr>
                    </thead>
                    <tbody id="transactionCreateDetailTableBody">
                      <tr>
                        <td colspan="10" style="padding: 40px; text-align: center; color: #6b7280">
                          자재 추가 버튼을 클릭하여 거래 상세내역을 입력하세요
                        </td>
                      </tr>
                    </tbody>
                    <tfoot style="background: #f9fafb; font-weight: 600">
                      <tr>
                        <td colspan="6" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid #e5e7eb;
                              color: #1f2937;
                            ">
                          합계
                        </td>
                        <td id="transactionCreateTotalSupply" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid #e5e7eb;
                              color: #1f2937;
                            ">
                          0
                        </td>
                        <td id="transactionCreateTotalVat" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid #e5e7eb;
                              color: #1f2937;
                            ">
                          0
                        </td>
                        <td colspan="2" style="padding: 12px; border-top: 2px solid #e5e7eb"></td>
                      </tr>
                      <tr>
                        <td colspan="6" style="padding: 12px; text-align: right; color: #1f2937">
                          총액
                        </td>
                        <td colspan="2" id="transactionCreateGrandTotal" style="
                              padding: 12px;
                              text-align: right;
                              color: #2563eb;
                              font-size: 16px;
                            ">
                          0
                        </td>
                        <td colspan="2"></td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

              <!-- 버튼 영역 -->
              <div style="
                    display: flex;
                    gap: 12px;
                    justify-content: flex-end;
                    padding-top: 24px;
                    border-top: 2px solid #e5e7eb;
                  ">
                <button type="button" onclick="closeTransactionCreateModal()" style="
                      padding: 12px 24px;
                      background: #f3f4f6;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: #374151;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                  취소
                </button>
                <button type="submit" style="
                      padding: 12px 24px;
                      background: #2563eb;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: white;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                  거래명세서 등록
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- ✅ 거래명세서 작성 - 자재 추가 모달 -->
        <div id="newTransactionDetailAddModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 600px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 추가
              </h2>
              <button onclick="closeNewTransactionDetailAddModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <!-- ✅ 자재 검색 영역 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="newTransactionMaterialSearchInput" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="자재명 또는 품목코드로 검색"
                    onkeypress="if(event.key === 'Enter') searchNewTransactionMaterials()" />
                  <button onclick="searchNewTransactionMaterials()" style="
                        padding: 10px 20px;
                        background: #3b82f6;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- ✅ 검색 결과 테이블 (3컬럼, 클릭 가능) -->
              <div id="newTransactionMaterialSearchResults" style="display: none">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과</label>
                <div style="
                      max-height: 300px;
                      overflow-y: auto;
                      border: 1px solid #e5e7eb;
                      border-radius: 8px;
                    ">
                  <table id="newTransactionMaterialSearchTable" style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f9fafb; position: sticky; top: 0">
                      <tr>
                        <th style="
                              padding: 10px 12px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                              font-weight: 600;
                              font-size: 13px;
                              color: #374151;
                            ">
                          품목코드
                        </th>
                        <th style="
                              padding: 10px 12px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                              font-weight: 600;
                              font-size: 13px;
                              color: #374151;
                            ">
                          품명
                        </th>
                        <th style="
                              padding: 10px 12px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                              font-weight: 600;
                              font-size: 13px;
                              color: #374151;
                            ">
                          규격
                        </th>
                      </tr>
                    </thead>
                    <tbody id="newTransactionMaterialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ✅ 선택된 자재 표시 (파란색 카드) -->
              <div id="newTransactionSelectedMaterialInfo" style="
                    display: none;
                    background: #f0f9ff;
                    padding: 12px;
                    border-radius: 8px;
                    border: 2px solid #bfdbfe;
                  ">
                <div style="
                      display: flex;
                      justify-content: space-between;
                      align-items: start;
                      margin-bottom: 4px;
                    ">
                  <div>
                    <div style="font-weight: 600; color: #1e40af; font-size: 15px"
                      id="newTransactionSelectedMaterialName">
                      -
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px"
                      id="newTransactionSelectedMaterialCode">
                      -
                    </div>
                  </div>
                  <button onclick="clearNewSelectedTransactionMaterial()" style="
                        padding: 4px 12px;
                        background: white;
                        border: 1px solid #bfdbfe;
                        border-radius: 4px;
                        font-size: 12px;
                        cursor: pointer;
                        color: #2563eb;
                        font-weight: 500;
                      " onmouseover="this.style.background='#eff6ff';" onmouseout="this.style.background='white';">
                    취소
                  </button>
                </div>
              </div>

              <!-- ✅ 수량 입력 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량 *</label>
                <input type="number" id="newTransactionAddDetailQuantity" value="1" min="0" step="0.01"
                  oninput="calculateNewTransactionDetailAmount()" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " />
              </div>

              <!-- ✅ 단가 입력 + 이전단가 버튼 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가 (원) *</label>
                <div style="display: flex; gap: 8px; align-items: center">
                  <input type="number" id="newTransactionAddDetailPrice" value="0" min="0" step="1"
                    oninput="calculateNewTransactionDetailAmount()" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " />
                  <button onclick="showNewTransactionPriceHistory()" style="
                        padding: 10px 20px;
                        background: #9333ea;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#7e22ce';" onmouseout="this.style.background='#9333ea';">
                    이전 단가
                  </button>
                </div>
              </div>

              <!-- ✅ 공급가액 표시 (읽기 전용) -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">공급가액 (원)</label>
                <input type="text" id="newTransactionAddDetailAmount" readonly value="0" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                      color: #1f2937;
                      font-weight: 600;
                    " />
              </div>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div style="
                  display: flex;
                  gap: 10px;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 1px solid #e5e7eb;
                ">
              <button type="button" onclick="closeNewTransactionDetailAddModal()" style="
                    flex: 1;
                    padding: 12px 20px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="confirmNewTransactionDetailAdd()" style="
                    flex: 1;
                    padding: 12px 20px;
                    background: #2563eb;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 작성 - 품목 수정 모달 -->
        <div id="newTransactionDetailEditModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 500px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 수정
              </h2>
              <button onclick="closeNewTransactionDetailEditModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <!-- 선택된 자재 정보 표시 -->
              <div style="
                    background: #f9fafb;
                    padding: 12px;
                    border-radius: 8px;
                    border: 1px solid #e5e7eb;
                  ">
                <div style="font-size: 12px; color: #6b7280; margin-bottom: 4px">자재코드</div>
                <div style="font-weight: 600; color: #1f2937" id="newTransactionEditDetailCode">
                  -
                </div>
                <div style="font-size: 12px; color: #6b7280; margin-top: 8px; margin-bottom: 4px">
                  자재명
                </div>
                <div style="font-weight: 500; color: #1f2937" id="newTransactionEditDetailName">
                  -
                </div>
                <div style="font-size: 12px; color: #6b7280; margin-top: 8px; margin-bottom: 4px">
                  규격
                </div>
                <div style="color: #6b7280" id="newTransactionEditDetailSpec">-</div>
              </div>

              <!-- 수량 입력 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량 *</label>
                <input type="number" id="newTransactionEditDetailQuantity" min="0" step="0.01"
                  oninput="calculateNewTransactionEditAmount()" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " />
              </div>

              <!-- 단가 입력 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">단가 (원) *</label>
                <input type="number" id="newTransactionEditDetailPrice" min="0" step="1"
                  oninput="calculateNewTransactionEditAmount()" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " />
              </div>

              <!-- 공급가액 표시 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">공급가액 (원)</label>
                <input type="text" id="newTransactionEditDetailAmount" readonly style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                      color: #1f2937;
                      font-weight: 600;
                    " />
              </div>
            </div>

            <!-- 버튼 영역 -->
            <div style="
                  display: flex;
                  gap: 10px;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 1px solid #e5e7eb;
                ">
              <button type="button" onclick="closeNewTransactionDetailEditModal()" style="
                    flex: 1;
                    padding: 12px 20px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="confirmNewTransactionDetailEdit()" style="
                    flex: 1;
                    padding: 12px 20px;
                    background: #2563eb;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 매출처 검색 모달 -->
        <div id="transactionCustomerSearchModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 800px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 20px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1f2937">
                매출처 검색
              </h3>
              <button onclick="closeTransactionCustomerSearchModal()" style="
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    font-size: 20px;
                    color: #6b7280;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                ×
              </button>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 16px">
              <input type="text" id="transactionCustomerSearchInput" placeholder="매출처명 또는 코드 검색"
                onkeypress="if(event.key === 'Enter') searchTransactionCustomers()" style="
                    flex: 1;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 6px;
                    font-size: 14px;
                  " />
              <button onclick="searchTransactionCustomers()" style="
                    padding: 10px 20px;
                    background: #2563eb;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 500;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                검색
              </button>
            </div>

            <div style="
                  max-height: 400px;
                  overflow-y: auto;
                  border: 1px solid #e5e7eb;
                  border-radius: 6px;
                ">
              <table style="width: 100%; border-collapse: collapse">
                <thead style="background: #f9fafb; position: sticky; top: 0">
                  <tr>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      코드
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      매출처명
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      전화번호
                    </th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb">
                      선택
                    </th>
                  </tr>
                </thead>
                <tbody id="transactionCustomerSearchTableBody">
                  <tr>
                    <td colspan="4" style="padding: 40px; text-align: center; color: #6b7280">
                      검색 버튼을 클릭하여 매출처를 검색하세요
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 자재 검색 모달 -->
        <div id="transactionMaterialSearchModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 900px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 20px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1f2937">
                자재 검색 및 추가
              </h3>
              <button onclick="closeTransactionMaterialSearchModal()" style="
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    font-size: 20px;
                    color: #6b7280;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                ×
              </button>
            </div>

            <div style="display: flex; gap: 10px; margin-bottom: 16px">
              <input type="text" id="transactionCreateMaterialSearchInput" placeholder="자재명 또는 코드 검색"
                onkeypress="if(event.key === 'Enter') searchTransactionMaterials()" style="
                    flex: 1;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 6px;
                    font-size: 14px;
                  " />
              <button onclick="searchTransactionMaterials()" style="
                    padding: 10px 20px;
                    background: #2563eb;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                    font-weight: 500;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                검색
              </button>
            </div>

            <div style="
                  max-height: 400px;
                  overflow-y: auto;
                  border: 1px solid #e5e7eb;
                  border-radius: 6px;
                ">
              <table style="width: 100%; border-collapse: collapse">
                <thead style="background: #f9fafb; position: sticky; top: 0">
                  <tr>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      자재코드
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      자재명
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      규격
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid #e5e7eb">
                      단가
                    </th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb">
                      선택
                    </th>
                  </tr>
                </thead>
                <tbody id="transactionMaterialSearchTableBody">
                  <tr>
                    <td colspan="5" style="padding: 40px; text-align: center; color: #6b7280">
                      검색 버튼을 클릭하여 자재를 검색하세요
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 이전단가 조회 모달 -->
        <div id="transactionPriceHistoryModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 700px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                출고단가 이력
              </h2>
              <button onclick="closeTransactionPriceHistoryModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- 자재 정보 -->
            <div style="
                  background: #fef3c7;
                  padding: 12px;
                  border-radius: 8px;
                  margin-bottom: 16px;
                  border: 2px solid #fbbf24;
                ">
              <div style="display: flex; justify-content: space-between; align-items: center">
                <div>
                  <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px">
                    선택된 자재
                  </div>
                  <div style="font-weight: 600; color: #78350f" id="transactionPriceHistoryMaterialName">
                    -
                  </div>
                  <div style="font-size: 12px; color: #92400e; margin-top: 2px"
                    id="transactionPriceHistoryMaterialCode">
                    -
                  </div>
                </div>
              </div>
            </div>

            <!-- 탭 메뉴 -->
            <div style="
                  display: flex;
                  gap: 8px;
                  margin-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <button style="
                    padding: 12px 20px;
                    background: #3b82f6;
                    border: none;
                    border-bottom: 3px solid #3b82f6;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: default;
                    color: white;
                    flex: 1;
                  ">
                실제 출고가
              </button>
            </div>

            <!-- 이력 테이블 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                이 거래처에 실제 출고한 이력 (클릭하여 단가 선택)
              </label>
              <div style="
                    max-height: 300px;
                    overflow-y: auto;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                  ">
                <table style="width: 100%; border-collapse: collapse">
                  <thead style="background: #f9fafb; position: sticky; top: 0">
                    <tr>
                      <th style="
                            padding: 10px;
                            text-align: left;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고일자
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고단가
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고수량
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: center;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        적요
                      </th>
                    </tr>
                  </thead>
                  <tbody id="transactionPriceHistoryTableBody">
                    <tr>
                      <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af">
                        이 거래처에 출고한 이력이 없습니다
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  padding-top: 16px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeTransactionPriceHistoryModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                닫기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 수정 - 이전단가 조회 모달 -->
        <div id="transactionEditPriceHistoryModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 700px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                출고단가 이력
              </h2>
              <button onclick="closeTransactionEditPriceHistoryModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- 자재 정보 -->
            <div style="
                  background: #fef3c7;
                  padding: 12px;
                  border-radius: 8px;
                  margin-bottom: 16px;
                  border: 2px solid #fbbf24;
                ">
              <div style="display: flex; justify-content: space-between; align-items: center">
                <div>
                  <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px">
                    선택된 자재
                  </div>
                  <div style="font-weight: 600; color: #78350f" id="transactionEditPriceHistoryMaterialName">
                    -
                  </div>
                  <div style="font-size: 12px; color: #92400e; margin-top: 2px"
                    id="transactionEditPriceHistoryMaterialCode">
                    -
                  </div>
                </div>
              </div>
            </div>

            <!-- 탭 메뉴 -->
            <div style="
                  display: flex;
                  gap: 8px;
                  margin-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <button style="
                    padding: 12px 20px;
                    background: #3b82f6;
                    border: none;
                    border-bottom: 3px solid #3b82f6;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: default;
                    color: white;
                    flex: 1;
                  ">
                실제 출고가
              </button>
            </div>

            <!-- 이력 테이블 -->
            <div style="margin-bottom: 16px">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                이 거래처에 실제 출고한 이력 (클릭하여 단가 선택)
              </label>
              <div style="
                    max-height: 300px;
                    overflow-y: auto;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                  ">
                <table style="width: 100%; border-collapse: collapse">
                  <thead style="background: #f9fafb; position: sticky; top: 0">
                    <tr>
                      <th style="
                            padding: 10px;
                            text-align: left;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고일자
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고단가
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        출고수량
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: center;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        적요
                      </th>
                    </tr>
                  </thead>
                  <tbody id="transactionEditPriceHistoryTableBody">
                    <tr>
                      <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af">
                        이 거래처에 출고한 이력이 없습니다
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  padding-top: 16px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeTransactionEditPriceHistoryModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                닫기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 거래명세서 삭제 확인 모달 -->
        <div id="transactionDeleteModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 400px">
            <h3 style="margin-bottom: 16px">거래명세서 삭제</h3>
            <p id="transactionDeleteTransactionInfo" style="margin-bottom: 20px"></p>
            <div style="display: flex; gap: 8px; justify-content: flex-end">
              <button onclick="closeTransactionDeleteModal()" class="btn btn-secondary">
                취소
              </button>
              <button onclick="confirmTransactionDelete()" class="btn btn-danger">삭제</button>
            </div>
          </div>
        </div>

        <!-- ✅ 메인 스크립트 (페이지 라우팅 및 이벤트 핸들러) -->
        <script>
          // 전역 변수 선언
          let currentUser = null;
          let heartbeatInterval = null; // Heartbeat 타이머

          // 페이지 라우팅
          const pageMap = {
            dashboard: {
              element: 'dashboardPage',
              title: '대시보드',
              menu: null,
              loadFunc: null,
            },
            quotation: {
              element: 'quotationPage',
              title: '견적관리',
              menu: 'sales',
              loadFunc: () => {
                if (typeof window.loadQuotations === 'function') {
                  window.loadQuotations();
                }
              },
            },
            transaction: {
              element: 'transactionPage',
              title: '거래명세서관리',
              menu: 'sales',
              loadFunc: () => {
                if (typeof window.initTransactionPage === 'function') {
                  window.initTransactionPage();
                }
              },
            },
            taxInvoice: {
              element: 'taxInvoicePage',
              title: '세금계산서관리',
              menu: 'jangbu',
              loadFunc: () => {
                if (typeof window.loadTaxInvoices === 'function') {
                  window.loadTaxInvoices();
                }
              },
            },
            receivable: {
              element: 'receivablePage',
              title: '미수금관리',
              menu: 'ledger',
              loadFunc: null,
            },
            customer: {
              element: 'salesCustomerPage',
              title: '매출처관리',
              menu: 'sales',
              loadFunc: () => {
                if (typeof window.loadSalesCustomers === 'function') {
                  window.loadSalesCustomers();
                }
              },
            },
            order: {
              element: 'orderPage',
              title: '발주관리',
              menu: 'purchase',
              loadFunc: () => {
                if (typeof window.loadOrderList === 'function') {
                  window.loadOrderList();
                }
              },
            },
            purchase: {
              element: 'purchaseStatementPage',
              title: '매입전표관리',
              menu: 'purchase',
              loadFunc: () => {
                if (typeof window.loadPurchaseStatements === 'function') {
                  window.loadPurchaseStatements();
                }
              },
            },
            payable: {
              element: 'payablePage',
              title: '미지급금관리',
              menu: 'purchase',
              loadFunc: null, // accounts-payable.js에서 DOMContentLoaded 시 설정
            },
            supplier: {
              element: 'supplierPage',
              title: '매입처관리',
              menu: 'purchase',
              loadFunc: () => {
                if (typeof window.loadSuppliers === 'function') {
                  window.loadSuppliers();
                }
              },
            },
            materialCategory: {
              element: 'materialCategoryPage',
              title: '자재분류관리',
              menu: 'material',
              loadFunc: () => {
                if (typeof initMaterialCategoryTable === 'function') {
                  initMaterialCategoryTable();
                }
                if (typeof loadMaterialCategories === 'function') {
                  loadMaterialCategories();
                }
              },
            },
            materialHistory: {
              element: 'materialHistoryPage',
              title: '자재내역관리',
              menu: 'material',
              loadFunc: () => {
                // 페이지 표시만 하고 데이터는 검색 시에만 로드
                if (typeof initMaterialHistoryTable === 'function') {
                  initMaterialHistoryTable();
                }
              },
            },
            materialInventory: {
              element: 'materialInventoryPage',
              title: '자재재고관리',
              menu: 'material',
              loadFunc: () => {
                if (typeof window.loadMaterialInventoryPage === 'function') {
                  window.loadMaterialInventoryPage();
                }
              },
            },
            financialClosing: {
              element: 'financialClosingPage',
              title: '회계마감관리',
              menu: 'accounting',
              loadFunc: null,
            },
            'account-catagory': {
              element: 'accountCatagoryPage',
              title: '계정과목관리',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadAccounts === 'function') {
                  loadAccounts();
                }
              },
            },
            'account-history': {
              element: 'accountHistoryPage',
              title: '현금출납내역관리',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadCashHistory === 'function') {
                  loadCashHistory();
                }
              },
            },
            'accounting-voucher': {
              element: 'accountingVoucherPage',
              title: '회계전표관리',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadAccountingVouchers === 'function') {
                  loadAccountingVouchers();
                }
              },
            },
            'total-balnace': {
              element: 'totalBalancePage',
              title: '합계잔액시산표',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadTrialBalance === 'function') {
                  loadTrialBalance();
                }
              },
            },
            'account-balnace': {
              element: 'accountBalancePage',
              title: '대차대조표',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadBalanceSheet === 'function') {
                  loadBalanceSheet();
                }
              },
            },
            settings: {
              element: 'settingsPage',
              title: '시스템설정',
              menu: 'settings',
              loadFunc: null,
            },
            'paper-setting': {
              element: 'paperSettingPage',
              title: '용지설정관리',
              menu: 'settings',
              loadFunc: () => {
                if (typeof loadPaperMargins === 'function') {
                  loadPaperMargins();
                }
              },
            },
            'daily-report-print': {
              element: 'dailyReportPrintPage',
              title: '일계표',
              menu: 'print',
              loadFunc: () => {
                // 오늘 날짜 자동 설정
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('dailyReportStartDate').value = today;
                document.getElementById('dailyReportEndDate').value = today;
              },
            },
          };

          // pageMap을 전역 스코프로 노출
          window.pageMap = pageMap;

          let currentPage = 'dashboard';

          function showPage(pageName) {
            // 모든 페이지 숨김 (.active 클래스 제거, .hidden 클래스 추가)
            document.querySelectorAll('.page-content').forEach((page) => {
              page.classList.remove('active');
              page.classList.add('hidden');
            });

            // 모든 사이드바 메뉴 비활성화
            document.querySelectorAll('.sidebar-menu li').forEach((item) => {
              item.classList.remove('active');
            });

            // 선택한 페이지 표시
            const selectedPage = pageMap[pageName];
            if (selectedPage && selectedPage.element) {
              const pageElement = document.getElementById(selectedPage.element);
              if (pageElement) {
                pageElement.classList.remove('hidden');
                pageElement.classList.add('active');

                // 페이지 제목 업데이트
                const pageTitleEl = document.getElementById('pageTitle');
                if (pageTitleEl && selectedPage.title) {
                  pageTitleEl.textContent = selectedPage.title;
                }

                // 선택한 메뉴 활성화
                const menuItem = document
                  .querySelector(`[onclick="showPage('${pageName}')"]`)
                  ?.closest('li');
                if (menuItem) {
                  menuItem.classList.add('active');
                }

                // loadFunc 실행 (로그인 여부와 상관없이 실행)
                if (selectedPage.loadFunc) {
                  selectedPage.loadFunc();
                }

                currentPage = pageName;
              }
            }
          }

          // showPage와 toggleMenu를 전역 스코프로 노출
          window.showPage = showPage;
          window.toggleMenu = toggleMenu;

          // 사이드바 메뉴 토글
          function toggleMenu(menuId) {
            const menuElement = document.getElementById(menuId);
            if (menuElement) {
              menuElement.classList.toggle('active');
            }
          }

          // 로그인 체크
          async function checkAuth() {
            try {
              const response = await fetch('/api/auth/me', { credentials: 'include' });

              // ✅ HTTP 상태 코드 먼저 확인
              if (!response.ok) {
                // 401 Unauthorized 또는 기타 에러 - 로그인 페이지 표시
                console.log('🔴 로그인 필요 - 로그인 페이지 표시');
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
                console.log(
                  'loginPage display:',
                  document.getElementById('loginPage').style.display,
                );
                console.log(
                  'dashboard display:',
                  document.getElementById('dashboard').style.display,
                );
                return false;
              }

              const result = await response.json();

              if (!result.success) {
                // 로그인 페이지 표시
                console.log('🔴 인증 실패 - 로그인 페이지 표시');
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
                return false;
              }

              const user = result.data;

              // currentUser에 사용자 정보 저장
              currentUser = user;

              document.getElementById('userName').textContent = user.사용자명 || '사용자';

              // 로그인된 상태 - 대시보드 표시
              console.log('✅ 로그인 성공 - 대시보드 표시');
              document.getElementById('loginPage').style.display = 'none';
              document.getElementById('dashboard').style.display = 'flex';

              // Heartbeat 시작
              startHeartbeat();

              return true;
            } catch (err) {
              console.error('인증 확인 오류:', err);
              // 로그인 페이지 표시
              console.log('🔴 에러 발생 - 로그인 페이지 표시');
              document.getElementById('loginPage').style.display = 'flex';
              document.getElementById('dashboard').style.display = 'none';
              return false;
            }
          }

          // 로그인 날짜 자동 설정 함수
          function setLoginDateToToday() {
            const today = new Date();

            // 한국 시간 기준으로 날짜 계산 (UTC+9)
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formatted = `${year}-${month}-${day}`; // YYYY-MM-DD 형식

            const loginDateText = document.getElementById('loginDateText');
            const loginDatePicker = document.getElementById('loginDatePicker');

            // 두 입력창 모두 오늘 날짜 자동 설정
            if (loginDateText) loginDateText.value = formatted;
            if (loginDatePicker) loginDatePicker.value = formatted;

            console.log(`✅ 로그인 날짜 자동 설정 완료 (로컬 시간 기준): ${formatted}`);
          }

          // ==================== Heartbeat 관리 ====================

          /**
           * Heartbeat 시작 - 5분마다 서버에 활동 신호 전송
           */
          function startHeartbeat() {
            // 기존 타이머가 있으면 중지
            stopHeartbeat();

            console.log('✅ Heartbeat 시작 (5분 간격)');

            // 5분마다 heartbeat 전송
            heartbeatInterval = setInterval(async () => {
              try {
                const response = await fetch('/api/auth/heartbeat', {
                  method: 'POST',
                  credentials: 'include',
                });

                if (!response.ok) {
                  console.warn('⚠️  Heartbeat 실패 - 세션이 만료되었을 수 있습니다.');
                  // 세션 만료 시 로그인 페이지로 리다이렉트
                  if (response.status === 401) {
                    stopHeartbeat();
                    alert('세션이 만료되었습니다. 다시 로그인해주세요.');
                    location.reload();
                  }
                } else {
                  console.log('💓 Heartbeat 전송 성공');
                }
              } catch (error) {
                console.error('❌ Heartbeat 전송 중 오류:', error);
              }
            }, 5 * 60 * 1000); // 5분 (300,000ms)
          }

          /**
           * Heartbeat 중지
           */
          function stopHeartbeat() {
            if (heartbeatInterval) {
              clearInterval(heartbeatInterval);
              heartbeatInterval = null;
              console.log('🛑 Heartbeat 중지');
            }
          }

          // 로그아웃
          async function logout() {
            if (!confirm('로그아웃 하시겠습니까?')) {
              return;
            }

            try {
              // Heartbeat 중지
              stopHeartbeat();

              // 서버에 로그아웃 요청
              await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });

              // currentUser 초기화
              if (typeof currentUser !== 'undefined') {
                currentUser = null;
              }

              // localStorage 정리
              localStorage.removeItem('workingDate');

              // 로그인 페이지 표시
              document.getElementById('loginPage').style.display = 'flex';
              document.getElementById('dashboard').style.display = 'none';

              // 폼 초기화
              document.getElementById('loginForm').reset();

              // 로그인 메시지 초기화
              const loginMessage = document.getElementById('loginMessage');
              if (loginMessage) {
                loginMessage.textContent = '시스템에 오신 것을 환영합니다.';
                loginMessage.className = 'login-message';
              }

              // 날짜 자동 설정
              setLoginDateToToday();

              console.log('✅ 로그아웃 완료');
            } catch (err) {
              console.error('로그아웃 오류:', err);
              alert('로그아웃 중 오류가 발생했습니다.');
            }
          }

          // 사업장 정보 로드 (로그인 페이지 제목에 표시)
          async function loadWorkplaceInfo() {
            try {
              const response = await fetch('/api/workplaces');
              const result = await response.json();

              if (result.success && result.data && result.data.length > 0) {
                // 첫 번째 사업장 정보 표시 (추후 사업장 선택 기능 추가 가능)
                const workplace = result.data[0];
                const workplaceNameEl = document.getElementById('workplaceNameLogin');
                if (workplaceNameEl) {
                  workplaceNameEl.textContent = workplace.사업장명 || '사업장';
                }
              }
            } catch (err) {
              console.error('사업장 정보 로드 실패:', err);
              const workplaceNameEl = document.getElementById('workplaceNameLogin');
              if (workplaceNameEl) {
                workplaceNameEl.textContent = '판매관리 시스템';
              }
            }
          }

          // ==================== 모달 드래그 기능 ====================

          /**
           * 모달을 드래그 가능하게 만드는 함수
           * @param {string} modalId - 모달 컨테이너 ID
           * @param {string} headerId - 드래그 핸들(헤더) ID 또는 클래스
           */
          window.makeModalDraggable = function (modalId, headerId) {
            const modalContent = document.getElementById(modalId);
            if (!modalContent) {
              console.warn('Modal content not found:', modalId);
              return;
            }

            // 이미 드래그 설정되어 있으면 제거
            if (modalContent._dragHandler) {
              const oldHandle = modalContent._dragHandler.handle;
              const oldHandlers = modalContent._dragHandler.handlers;
              oldHandle.removeEventListener('mousedown', oldHandlers.dragStart);
              document.removeEventListener('mousemove', oldHandlers.drag);
              document.removeEventListener('mouseup', oldHandlers.dragEnd);
            }

            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            // 헤더 영역을 드래그 핸들로 설정
            let dragHandle;
            if (headerId.startsWith('.')) {
              dragHandle = modalContent.querySelector(headerId);
            } else {
              dragHandle = document.getElementById(headerId);
            }

            if (!dragHandle) {
              console.warn('Drag handle not found:', headerId);
              dragHandle = modalContent;
            }

            console.log('✅ Setting up draggable modal:', modalId, headerId);

            // 드래그를 위한 위치 설정
            // Flex 레이아웃에서는 transform이 제대로 작동하지 않으므로 absolute로 변경
            const parentModal = modalContent.closest('.modal');
            if (parentModal) {
              // 모달이 이미 flex로 설정되어 있는 경우
              const modalDisplay = window.getComputedStyle(parentModal).display;
              if (modalDisplay === 'flex' || parentModal.style.display === 'flex') {
                // 모달 컨텐츠를 absolute positioning으로 변경
                modalContent.style.position = 'absolute';
                modalContent.style.top = '50%';
                modalContent.style.left = '50%';
                modalContent.style.transform = 'translate(-50%, -50%)';
                modalContent.style.margin = '0';

                console.log('🔄 Modal positioning changed to absolute for dragging');
              }
            }

            dragHandle.style.cursor = 'move';

            function dragStart(e) {
              // 버튼이나 입력 필드 클릭 시 드래그 방지
              if (
                e.target.tagName === 'BUTTON' ||
                e.target.tagName === 'INPUT' ||
                e.target.tagName === 'TEXTAREA' ||
                e.target.tagName === 'SELECT'
              ) {
                return;
              }

              initialX = e.clientX - xOffset;
              initialY = e.clientY - yOffset;

              if (e.target === dragHandle || dragHandle.contains(e.target)) {
                isDragging = true;
                console.log('🎯 Drag started');
              }
            }

            function drag(e) {
              if (isDragging) {
                e.preventDefault();

                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, modalContent);
              }
            }

            function dragEnd(e) {
              if (isDragging) {
                console.log('🛑 Drag ended');
              }
              initialX = currentX;
              initialY = currentY;
              isDragging = false;
            }

            function setTranslate(xPos, yPos, el) {
              el.style.transform = `translate(${xPos}px, ${yPos}px)`;
            }

            // 이벤트 리스너 등록
            dragHandle.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            // 핸들러 저장 (나중에 제거용)
            modalContent._dragHandler = {
              handle: dragHandle,
              handlers: { dragStart, drag, dragEnd },
            };

            // 모달이 닫힐 때 위치 초기화
            const modal = modalContent.closest('.modal');
            if (modal) {
              if (!modal._observer) {
                const observer = new MutationObserver((mutations) => {
                  mutations.forEach((mutation) => {
                    if (mutation.attributeName === 'style') {
                      if (modal.style.display === 'none') {
                        xOffset = 0;
                        yOffset = 0;
                        modalContent.style.transform = 'translate(0px, 0px)';
                        console.log('↩️  Modal position reset');
                      }
                    }
                  });
                });

                observer.observe(modal, { attributes: true, attributeFilter: ['style'] });
                modal._observer = observer;
              }
            }
          };

          // ==================== 브라우저 종료 시 자동 로그아웃 ====================

          /**
           * 브라우저 닫기/새로고침 시 강제 로그아웃
           */
          window.addEventListener('beforeunload', function (e) {
            if (currentUser && currentUser.사용자코드) {
              // sendBeacon을 사용하여 비동기로 로그아웃 요청 전송
              // 브라우저 종료 시에도 확실하게 전송됨
              const data = new URLSearchParams();
              data.append('사용자코드', currentUser.사용자코드);

              navigator.sendBeacon('/api/auth/force-logout', data);
              console.log('🚪 브라우저 종료 - 강제 로그아웃 요청 전송');
            }
          });

          // 초기 로드
          document.addEventListener('DOMContentLoaded', async () => {
            // 사업장 정보 로드
            await loadWorkplaceInfo();

            // 로그인 날짜 초기 설정
            setLoginDateToToday();

            // 프린트 마진 초기화
            initPrintMargins();

            const isLoggedIn = await checkAuth();
            if (isLoggedIn) {
              showPage('dashboard');
            }
          });
        </script>

        <!-- 발주관리 페이지 -->
        <div class="page-content hidden" id="orderPage">
          <h2 style="display: none">발주관리</h2>
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="orderStatusFilter" class="form-control" style="width: 150px" onchange="filterOrders()">
                <option value="">전체 상태</option>
                <option value="0">발주대기</option>
                <option value="1">발주완료</option>
                <option value="2">입고완료</option>
              </select>
              <input type="date" id="orderStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="orderEndDate" class="form-control" style="width: 150px" />
              <button id="orderBtnFilter" class="btn btn-secondary" onclick="filterOrders()">조회</button>
            </div>
            <div class="toolbar-right">
              <button id="orderBtnNew" class="btn btn-success" onclick="openNewOrderModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 발주서 작성
              </button>
              <button id="orderBtnExport" class="btn btn-secondary" onclick="exportOrdersToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 발주 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 발주 수: <span id="orderCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- DataTable -->
          <table id="orderTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="orderSelectAll" /></th>
                <th>순번</th>
                <th>발주번호</th>
                <th>매입처명</th>
                <th>발주일자</th>
                <th>제목</th>
                <th>발주금액</th>
                <th>담당자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="orderTableBody"></tbody>
          </table>
        </div>

        <!-- 세금계산서관리 페이지 -->
        <div class="page-content hidden" id="taxInvoicePage">
          <h2 style="display: none">세금계산서관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="taxInvoiceStatusFilter" class="form-control" style="width: 150px"
                onchange="filterTaxInvoices()">
                <option value="">전체 상태</option>
                <option value="0">작성중</option>
                <option value="1">발행완료</option>
              </select>
              <input type="date" id="taxInvoiceStartDate" class="form-control" style="width: 150px"
                onchange="filterTaxInvoices()" />
              <span>~</span>
              <input type="date" id="taxInvoiceEndDate" class="form-control" style="width: 150px"
                onchange="filterTaxInvoices()" />
              <button class="btn btn-secondary" onclick="filterTaxInvoices()">조회</button>
            </div>

            <div class="toolbar-right" style="display: flex; gap: 12px; align-items: center">
              <!-- 임의 발행 버튼 -->
              <button class="btn btn-success" onclick="openNewTaxInvoiceModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#218838'" onmouseout="this.style.background='#28a745'">
                <span style="font-size: 18px; margin-right: 4px">📝</span> 임의 발행
              </button>

              <!-- 거래 발행 버튼 -->
              <button class="btn btn-primary" onclick="openTransactionTaxInvoiceModal()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#0056b3'" onmouseout="this.style.background='#007bff'">
                <span style="font-size: 18px; margin-right: 4px">📋</span> 거래 발행
              </button>

              <!-- Google Sheets 내보내기 버튼 -->
              <button class="btn btn-secondary" onclick="exportTaxInvoicesToCSV()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#5a6268'" onmouseout="this.style.background='#6c757d'">
                📊 Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 세금계산서 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 세금계산서 수: <span id="taxInvoiceCount" style="font-weight: bold">0</span> 건 |
            총 공급가액: <span id="taxInvoiceTotalSupply" style="font-weight: bold">0</span> 원 |
            총 세액: <span id="taxInvoiceTotalTax" style="font-weight: bold">0</span> 원
          </div>

          <!-- ✅ 세금계산서 목록 DataTable -->
          <table id="taxInvoiceTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="selectAllTaxInvoices" /></th>
                <th>순번</th>
                <th>작성년도</th>
                <th>책번호</th>
                <th>일련번호</th>
                <th>작성일자</th>
                <th>매출처명</th>
                <th>품목및규격</th>
                <th>수량</th>
                <th>공급가액</th>
                <th>세액</th>
                <th>합계</th>
                <th>발행여부</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="taxInvoiceTableBody"></tbody>
          </table>
        </div>

        <!-- ✅ 세금계산서 상세보기 모달 -->
        <div id="taxInvoiceDetailModal" class="modal hidden">
          <div class="modal-content large" style="max-width: 900px; max-height: 90vh; overflow-y: auto">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="taxInvoiceDetailModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                세금계산서 상세 보기
              </h2>
              <button onclick="closeTaxInvoiceDetailModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 세금계산서 기본 정보 (카드 스타일) -->
            <div style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                기본 정보
              </h3>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">작성년도-책번호</span>
                  <span id="detailTaxInvoiceNo" style="color: #1f2937; font-weight: 600">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">작성일자</span>
                  <span id="detailTaxInvoiceDate" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">매출처명</span>
                  <span id="detailTaxCustomerName" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">사업자번호</span>
                  <span id="detailTaxBusinessNo" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">대표자명</span>
                  <span id="detailTaxCeoName" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">업태/업종</span>
                  <span id="detailTaxBusinessType" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center; grid-column: span 2">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">주소</span>
                  <span id="detailTaxAddress" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">품목및규격</span>
                  <span id="detailTaxItemSpec" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">수량</span>
                  <span id="detailTaxQuantity" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">공급가액</span>
                  <span id="detailTaxSupplyAmount" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">세액</span>
                  <span id="detailTaxAmount" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">합계</span>
                  <span id="detailTaxTotal" style="color: #2563eb; font-weight: 600">-</span>
                </div>
                <div style="display: flex; align-items: center">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">발행여부</span>
                  <span id="detailTaxIssued" style="color: #1f2937">-</span>
                </div>
                <div style="display: flex; align-items: center; grid-column: span 2">
                  <span style="min-width: 120px; font-weight: 500; color: #6b7280">적요</span>
                  <span id="detailTaxRemark" style="color: #1f2937">-</span>
                </div>
              </div>
            </div>

            <!-- ✅ 자재입출내역 (세부 품목) -->
            <div style="
                  background: #ffffff;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                품목 내역
              </h3>
              <div style="overflow-x: auto">
                <table id="taxInvoiceDetailItemsTable" class="display" style="width: 100%; font-size: 14px">
                  <thead>
                    <tr>
                      <th>순번</th>
                      <th>자재명</th>
                      <th>규격</th>
                      <th>단위</th>
                      <th>수량</th>
                      <th>단가</th>
                      <th>공급가액</th>
                      <th>부가세</th>
                      <th>합계금액</th>
                      <th>적요</th>
                    </tr>
                  </thead>
                  <tbody id="taxInvoiceDetailItemsTableBody"></tbody>
                </table>
              </div>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div style="display: flex; gap: 12px; justify-content: flex-end">
              <button onclick="closeTaxInvoiceDetailModal()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    cursor: pointer;
                  ">
                닫기
              </button>
              <button id="taxInvoiceDetailPrintBtn" onclick="printTaxInvoiceFromDetail()" style="
                    padding: 10px 24px;
                    background: #9333ea;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                    box-shadow: 0 2px 4px rgba(147, 51, 234, 0.2);
                  "
                onmouseover="this.style.background='#7c3aed'; this.style.boxShadow='0 4px 8px rgba(147, 51, 234, 0.3)';"
                onmouseout="this.style.background='#9333ea'; this.style.boxShadow='0 2px 4px rgba(147, 51, 234, 0.2)';">
                📄 출력
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 세금계산서 수정 모달 -->
        <div id="taxInvoiceEditModal" class="modal" style="display: none">
          <div id="taxInvoiceEditModalContent" class="modal-content large"
            style="max-width: 900px; max-height: 90vh; overflow-y: auto; padding: 32px">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="taxInvoiceEditModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                세금계산서 수정
              </h2>
              <button id="closeTaxInvoiceEditModalBtn" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 세금계산서 기본 정보 폼 -->
            <form id="taxInvoiceEditForm">
              <div style="
                    background: #f9fafb;
                    padding: 20px;
                    border-radius: 12px;
                    margin-bottom: 24px;
                    border: 1px solid #e5e7eb;
                  ">
                <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                  기본 정보
                </h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      작성년도-책번호
                    </label>
                    <input type="text" id="editTaxInvoiceNo" class="form-control" readonly
                      style="background: #e5e7eb" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      작성일자
                    </label>
                    <input type="date" id="editTaxInvoiceDate" class="form-control" required />
                  </div>
                  <div style="grid-column: span 2">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      품목및규격
                    </label>
                    <input type="text" id="editTaxItemSpec" class="form-control" placeholder="예: LED전구 1건외 3건"
                      required />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      수량
                    </label>
                    <input type="number" id="editTaxQuantity" class="form-control" step="0.01" required />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      공급가액
                    </label>
                    <input type="number" id="editTaxSupplyAmount" class="form-control" step="1" required
                      onchange="calculateTaxInvoiceTotal()" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      세액 (10%)
                    </label>
                    <input type="number" id="editTaxAmount" class="form-control" step="1" required readonly
                      style="background: #e5e7eb" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      합계
                    </label>
                    <input type="number" id="editTaxTotal" class="form-control" readonly
                      style="background: #e5e7eb; font-weight: bold; color: #2563eb" />
                  </div>
                  <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      발행여부
                    </label>
                    <select id="editTaxIssued" class="form-control" required>
                      <option value="0">미발행</option>
                      <option value="1">발행완료</option>
                    </select>
                  </div>
                  <div style="grid-column: span 2">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      적요
                    </label>
                    <input type="text" id="editTaxRemark" class="form-control" placeholder="적요를 입력하세요" />
                  </div>
                </div>
              </div>

              <!-- ✅ 버튼 영역 -->
              <div style="display: flex; gap: 12px; justify-content: flex-end">
                <button type="button" id="cancelTaxInvoiceEditBtn" style="
                      padding: 10px 20px;
                      background: #6c757d;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      cursor: pointer;
                    ">
                  취소
                </button>
                <button type="submit" style="
                      padding: 10px 20px;
                      background: #007bff;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      cursor: pointer;
                    ">
                  저장
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- ✅ 세금계산서 신규 발행 모달 -->
        <div id="newTaxInvoiceModal" class="modal" style="display: none">
          <div id="newTaxInvoiceModalContent" class="modal-content large"
            style="max-width: 1200px; max-height: 90vh; overflow-y: auto; padding: 32px">
            <!-- ✅ 헤더 영역 -->
            <div id="newTaxInvoiceModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                세금계산서 신규 발행
              </h2>
              <button onclick="closeNewTaxInvoiceModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 기본 정보 폼 -->
            <form id="newTaxInvoiceForm" onsubmit="saveTaxInvoice(event)">
              <div style="
                    display: grid;
                    grid-template-columns: repeat(2, 1fr);
                    gap: 20px;
                    margin-bottom: 32px;
                    padding: 24px;
                    background: #f9fafb;
                    border-radius: 12px;
                    border: 1px solid #e5e7eb;
                  ">
                <h3 style="
                      grid-column: span 2;
                      margin: 0 0 16px 0;
                      font-size: 16px;
                      font-weight: 600;
                      color: #374151;
                    ">
                  기본 정보
                </h3>

                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                    작성일자 <span style="color: #ef4444">*</span>
                  </label>
                  <input type="date" id="newTaxDate" class="form-control" required />
                </div>

                <div style="grid-column: span 2">
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                    매출처 <span style="color: #ef4444">*</span>
                  </label>
                  <div style="display: flex; gap: 8px">
                    <input type="text" id="newTaxCustomerSearch" class="form-control" placeholder="매출처코드 또는 매출처명으로 검색"
                      style="flex: 1" />
                    <button type="button" onclick="searchCustomerForTax()" style="
                          padding: 0 20px;
                          background: #3b82f6;
                          color: white;
                          border: none;
                          border-radius: 6px;
                          cursor: pointer;
                          white-space: nowrap;
                          font-weight: 500;
                        ">
                      🔍 검색
                    </button>
                  </div>
                  <!-- 선택된 매출처 표시 -->
                  <div id="selectedCustomerDisplay" style="margin-top: 12px; display: none">
                    <div style="
                          padding: 12px 16px;
                          background: #eff6ff;
                          border: 1px solid #3b82f6;
                          border-radius: 8px;
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                        ">
                      <div>
                        <span style="font-weight: 600; color: #1e40af; margin-right: 12px"
                          id="selectedCustomerCode"></span>
                        <span style="color: #374151" id="selectedCustomerName"></span>
                      </div>
                      <button type="button" onclick="clearSelectedCustomer()" style="
                            padding: 4px 12px;
                            background: #ef4444;
                            color: white;
                            border: none;
                            border-radius: 4px;
                            cursor: pointer;
                            font-size: 12px;
                          ">
                        삭제
                      </button>
                    </div>
                  </div>
                  <!-- 검색 결과 목록 -->
                  <div id="customerSearchResults" style="
                        margin-top: 8px;
                        max-height: 200px;
                        overflow-y: auto;
                        border: 1px solid #e5e7eb;
                        border-radius: 6px;
                        background: white;
                        display: none;
                      "></div>
                </div>

                <div style="grid-column: span 2">
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                    적요
                  </label>
                  <input type="text" id="newTaxRemark" class="form-control" placeholder="적요를 입력하세요" />
                </div>
              </div>

              <!-- ✅ 품목 추가 영역 -->
              <div style="
                    margin-bottom: 24px;
                    padding: 24px;
                    background: #f9fafb;
                    border-radius: 12px;
                    border: 1px solid #e5e7eb;
                  ">
                <div style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 16px;
                    ">
                  <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
                    품목 추가
                  </h3>
                  <button type="button" onclick="addTaxInvoiceItem()" style="
                        padding: 8px 16px;
                        background: #10b981;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-weight: 500;
                        display: flex;
                        align-items: center;
                        gap: 6px;
                      ">
                    <span style="font-size: 18px">+</span> 품목 추가
                  </button>
                </div>

                <!-- 품목 입력 폼 -->
                <div style="
                      display: grid;
                      grid-template-columns: 2fr 1fr 1fr 1fr auto;
                      gap: 12px;
                      margin-bottom: 16px;
                      align-items: end;
                    ">
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #374151;
                        ">
                      품목명
                    </label>
                    <input type="text" id="itemName" class="form-control" placeholder="품목명 입력" />
                  </div>
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #374151;
                        ">
                      수량
                    </label>
                    <input type="number" id="itemQuantity" class="form-control" step="0.01" value="1"
                      oninput="calculateItemSupplyAmount()" />
                  </div>
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #374151;
                        ">
                      단가
                    </label>
                    <input type="number" id="itemUnitPrice" class="form-control" step="1" placeholder="0"
                      oninput="calculateItemSupplyAmount()" />
                  </div>
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #374151;
                        ">
                      공급가액
                    </label>
                    <input type="number" id="itemSupplyAmount" class="form-control" step="1" placeholder="0" readonly
                      style="background: #e5e7eb" />
                  </div>
                </div>

                <!-- 품목 목록 테이블 -->
                <div style="overflow-x: auto">
                  <table id="taxInvoiceItemsTable" style="width: 100%; border-collapse: collapse">
                    <thead>
                      <tr style="background: #f3f4f6">
                        <th style="
                              padding: 12px;
                              text-align: left;
                              border: 1px solid #e5e7eb;
                              font-weight: 600;
                              color: #374151;
                            ">
                          품목명
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              font-weight: 600;
                              color: #374151;
                              width: 100px;
                            ">
                          수량
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              font-weight: 600;
                              color: #374151;
                              width: 120px;
                            ">
                          단가
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              font-weight: 600;
                              color: #374151;
                              width: 140px;
                            ">
                          공급가액
                        </th>
                        <th style="
                              padding: 12px;
                              text-align: center;
                              border: 1px solid #e5e7eb;
                              font-weight: 600;
                              color: #374151;
                              width: 80px;
                            ">
                          삭제
                        </th>
                      </tr>
                    </thead>
                    <tbody id="taxInvoiceItemsList">
                      <!-- 품목 목록이 여기에 동적으로 추가됩니다 -->
                    </tbody>
                    <tfoot>
                      <tr style="background: #f9fafb; font-weight: 600">
                        <td colspan="3" style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              color: #374151;
                            ">
                          합계
                        </td>
                        <td style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              color: #2563eb;
                            " id="totalSupplyAmount">
                          0
                        </td>
                        <td style="border: 1px solid #e5e7eb"></td>
                      </tr>
                      <tr style="background: #f9fafb">
                        <td colspan="3" style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              color: #374151;
                            ">
                          부가세 (10%)
                        </td>
                        <td style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              color: #374151;
                            " id="totalTaxAmount">
                          0
                        </td>
                        <td style="border: 1px solid #e5e7eb"></td>
                      </tr>
                      <tr style="background: #eff6ff; font-weight: 700">
                        <td colspan="3" style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              color: #1e40af;
                            ">
                          총 합계
                        </td>
                        <td style="
                              padding: 12px;
                              text-align: right;
                              border: 1px solid #e5e7eb;
                              color: #1e40af;
                              font-size: 16px;
                            " id="grandTotal">
                          0
                        </td>
                        <td style="border: 1px solid #e5e7eb"></td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

              <!-- ✅ 버튼 영역 -->
              <div style="display: flex; gap: 12px; justify-content: flex-end">
                <button type="button" onclick="closeNewTaxInvoiceModal()" style="
                      padding: 12px 24px;
                      background: #6c757d;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      cursor: pointer;
                      font-weight: 500;
                    ">
                  취소
                </button>
                <button type="submit" style="
                      padding: 12px 24px;
                      background: #28a745;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      cursor: pointer;
                      font-weight: 500;
                    ">
                  발행
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- ✅ 세금계산서 거래 발행 모달 (거래명세서 기준) -->
        <div id="transactionTaxInvoiceModal" class="modal" style="display: none">
          <div id="transactionTaxInvoiceModalContent" class="modal-content large"
            style="max-width: 1200px; max-height: 90vh; overflow-y: auto; padding: 32px">
            <form id="transactionTaxInvoiceForm" onsubmit="saveTransactionTaxInvoice(event)">
              <!-- 헤더 -->
              <div class="draggable-header" style="
                    cursor: move;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 24px;
                    padding-bottom: 16px;
                    border-bottom: 2px solid #e5e7eb;
                  ">
                <h2 style="margin: 0; font-size: 24px; font-weight: 600; color: #1f2937">
                  세금계산서 거래 발행
                </h2>
                <button type="button" onclick="closeTransactionTaxInvoiceModal()" style="
                      width: 32px;
                      height: 32px;
                      border: none;
                      background: #f3f4f6;
                      border-radius: 8px;
                      cursor: pointer;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round" />
                  </svg>
                </button>
              </div>

              <!-- 거래 조회 섹션 -->
              <div style="
                    margin-bottom: 24px;
                    padding: 20px;
                    background: #f9fafb;
                    border-radius: 8px;
                  ">
                <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                  거래명세서 조회
                </h3>
                <div style="
                      display: grid;
                      grid-template-columns: 1fr 1fr 1fr auto;
                      gap: 12px;
                      align-items: end;
                    ">
                  <!-- 거래일자 -->
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #374151;
                        ">
                      거래일자 <span style="color: #ef4444">*</span>
                    </label>
                    <input type="date" id="txTaxTransactionDate" required style="
                          width: 100%;
                          padding: 10px 12px;
                          border: 1px solid #d1d5db;
                          border-radius: 6px;
                          font-size: 14px;
                        " />
                  </div>

                  <!-- 거래번호 -->
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #374151;
                        ">
                      거래번호 <span style="color: #ef4444">*</span>
                    </label>
                    <input type="number" id="txTaxTransactionNo" required min="1" placeholder="거래번호" style="
                          width: 100%;
                          padding: 10px 12px;
                          border: 1px solid #d1d5db;
                          border-radius: 6px;
                          font-size: 14px;
                        " />
                  </div>

                  <!-- 매출처코드 (readonly, 자동입력) -->
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #374151;
                        ">
                      매출처코드
                    </label>
                    <input type="text" id="txTaxCustomerCode" readonly style="
                          width: 100%;
                          padding: 10px 12px;
                          border: 1px solid #d1d5db;
                          border-radius: 6px;
                          font-size: 14px;
                          background: #f9fafb;
                        " />
                  </div>

                  <!-- 조회 버튼 -->
                  <div>
                    <button type="button" onclick="loadTransactionForTax()" style="
                          padding: 10px 24px;
                          background: #3b82f6;
                          color: white;
                          border: none;
                          border-radius: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          cursor: pointer;
                          transition: all 0.2s;
                        " onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">
                      조회
                    </button>
                  </div>
                </div>

                <!-- 매출처명 (readonly, 자동입력) -->
                <div style="margin-top: 12px">
                  <label style="
                        display: block;
                        margin-bottom: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        color: #374151;
                      ">
                    매출처명
                  </label>
                  <input type="text" id="txTaxCustomerName" readonly style="
                        width: 100%;
                        padding: 10px 12px;
                        border: 1px solid #d1d5db;
                        border-radius: 6px;
                        font-size: 14px;
                        background: #f9fafb;
                      " />
                </div>
              </div>

              <!-- 거래 품목 리스트 (DataTable) -->
              <div style="margin-bottom: 24px">
                <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #374151">
                  거래 품목 내역
                </h3>
                <div style="overflow-x: auto; border: 1px solid #e5e7eb; border-radius: 8px">
                  <table id="transactionTaxItemsTable" class="display" style="width: 100%">
                    <thead>
                      <tr>
                        <th>No</th>
                        <th>자재코드</th>
                        <th>자재명</th>
                        <th>규격</th>
                        <th>단위</th>
                        <th>출고수량</th>
                        <th>출고단가</th>
                        <th>공급가액</th>
                        <th>부가세</th>
                        <th>합계</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>

              <!-- 합계 정보 -->
              <div style="
                    margin-bottom: 24px;
                    padding: 20px;
                    background: #f0f9ff;
                    border-radius: 8px;
                    border: 1px solid #bfdbfe;
                  ">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px">
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #1e40af;
                        ">
                      공급가액 합계
                    </label>
                    <input type="text" id="txTaxTotalSupply" readonly style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #bfdbfe;
                          border-radius: 6px;
                          font-size: 16px;
                          font-weight: 600;
                          text-align: right;
                          background: white;
                          color: #1e40af;
                        " />
                  </div>
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #1e40af;
                        ">
                      세액 합계
                    </label>
                    <input type="text" id="txTaxTotalTax" readonly style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #bfdbfe;
                          border-radius: 6px;
                          font-size: 16px;
                          font-weight: 600;
                          text-align: right;
                          background: white;
                          color: #1e40af;
                        " />
                  </div>
                  <div>
                    <label style="
                          display: block;
                          margin-bottom: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          color: #1e40af;
                        ">
                      합계 금액
                    </label>
                    <input type="text" id="txTaxTotalAmount" readonly style="
                          width: 100%;
                          padding: 12px;
                          border: 1px solid #bfdbfe;
                          border-radius: 6px;
                          font-size: 16px;
                          font-weight: 600;
                          text-align: right;
                          background: white;
                          color: #1e40af;
                        " />
                  </div>
                </div>
              </div>

              <!-- 적요 -->
              <div style="margin-bottom: 24px">
                <label style="
                      display: block;
                      margin-bottom: 6px;
                      font-size: 14px;
                      font-weight: 500;
                      color: #374151;
                    ">
                  적요
                </label>
                <textarea id="txTaxRemarks" rows="2" placeholder="적요 입력 (선택사항)" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 1px solid #d1d5db;
                      border-radius: 6px;
                      font-size: 14px;
                      resize: vertical;
                    "></textarea>
              </div>

              <!-- 버튼 -->
              <div style="
                    display: flex;
                    justify-content: flex-end;
                    gap: 12px;
                    padding-top: 16px;
                    border-top: 1px solid #e5e7eb;
                  ">
                <button type="button" onclick="closeTransactionTaxInvoiceModal()" style="
                      padding: 10px 24px;
                      background: white;
                      color: #374151;
                      border: 1px solid #d1d5db;
                      border-radius: 6px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                  취소
                </button>
                <button type="submit" style="
                      padding: 10px 24px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      border: none;
                      border-radius: 6px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      transition: all 0.2s;
                      box-shadow: 0 4px 6px rgba(102, 126, 234, 0.25);
                    "
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 12px rgba(102, 126, 234, 0.35)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px rgba(102, 126, 234, 0.25)'">
                  발행
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- ✅ 세금계산서 삭제 확인 모달 -->
        <div id="taxInvoiceDeleteModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 400px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 아이콘 -->
            <div style="text-align: center; margin-bottom: 20px">
              <div style="
                    width: 64px;
                    height: 64px;
                    background: #fee2e2;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 16px;
                  ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path
                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" />
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937">
                세금계산서 삭제
              </h2>
              <p id="deleteTaxInvoiceInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px">
                세금계산서 번호: -
              </p>
              <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500">
                정말로 이 세금계산서를 삭제하시겠습니까?
              </p>
              <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px">
                삭제된 세금계산서는 복구할 수 없습니다.
              </p>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px">
              <button onclick="closeTaxInvoiceDeleteModal()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmTaxInvoiceDelete()" style="
                    flex: 1;
                    padding: 12px 24px;
                    background: #dc2626;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#b91c1c';" onmouseout="this.style.background='#dc2626';">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- 매입전표관리 페이지 -->
        <div class="page-content hidden" id="purchaseStatementPage">
          <h2 style="display: none">매입전표관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="purchaseStatementStatusFilter" class="form-control" style="width: 150px"
                onchange="filterPurchaseStatements()">
                <option value="">전체 상태</option>
                <option value="1">작성중</option>
                <option value="2">확정</option>
                <option value="3">발행완료</option>
              </select>
              <input type="date" id="purchaseStatementStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="purchaseStatementEndDate" class="form-control" style="width: 150px" />
              <button id="purchaseBtnFilter" class="btn btn-secondary" onclick="filterPurchaseStatements()">조회</button>
            </div>

            <div class="toolbar-right">
              <button id="purchaseBtnNew" class="btn btn-success" onclick="openNewPurchaseStatementModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 매입전표 작성
              </button>
              <button id="purchaseBtnExport" class="btn btn-secondary" onclick="exportPurchaseStatementsToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 매입전표 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 매입전표 수:
            <span id="purchaseStatementCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- ✅ 매입전표 목록 DataTable -->
          <table id="purchaseStatementTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="purchaseSelectAll" />
                </th>
                <th>순번</th>
                <th>전표번호</th>
                <th>거래일자</th>
                <th>매입처명</th>
                <th>공급가액</th>
                <th>부가세</th>
                <th>합계금액</th>
                <th>작성자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="purchaseStatementTableBody"></tbody>
          </table>
        </div>

        <!-- 매입처관리 페이지 -->
        <div id="supplierPage" class="page-content hidden">
          <h2 style="display: none">매입처관리</h2>
          <div class="toolbar" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
              ">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center">
              <input type="text" id="supplierSearchInput" placeholder="매입처코드 또는 매입처명 검색..." style="
                    padding: 10px 16px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    width: 280px;
                    outline: none;
                  " />
              <button id="supplierBtnSearch" class="btn btn-primary" onclick="searchSuppliers()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                🔍 검색
              </button>
              <button id="supplierBtnReset" class="btn btn-light" onclick="resetSupplierSearch()" style="
                    padding: 10px 16px;
                    background: #f8f9fa;
                    color: #333;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px">
              <button id="supplierBtnNew" class="btn btn-success" onclick="openSupplierModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 신규 등록
              </button>
              <button id="supplierBtnExport" class="btn btn-secondary" onclick="exportSuppliersToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">📊</span> Google Sheets로 보내기
              </button>
            </div>
          </div>

          <!-- ✅ DataTables 적용용 테이블 -->
          <table id="supplierTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="supplierSelectAll" title="전체 선택" aria-label="전체 선택" />
                </th>
                <th>순번</th>
                <th>매입처코드</th>
                <th>매입처명</th>
                <th>대표자</th>
                <th>사업자번호</th>
                <th>연락처</th>
                <th>거래상태</th>
                <th>등록일</th>
                <th style="width: 180px">관리</th>
              </tr>
            </thead>
          </table>
        </div>

        <!-- 매입처 상세보기 모달 -->
        <div id="supplierDetailModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div class="modal-content" style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 고정된 제목 영역 -->
            <div id="supplierDetailModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  position: sticky;
                  top: -32px;
                  background: white;
                  padding: 0 0 16px 0;
                  border-bottom: 2px solid var(--border);
                  z-index: 10;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
                매입처 상세정보
              </h2>
              <button onclick="closeSupplierDetailModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <div id="supplierDetailContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <!-- 상세 정보가 여기에 동적으로 로드됩니다 -->
            </div>

            <div style="margin-top: 24px; display: flex; justify-content: flex-end">
              <button onclick="closeSupplierDetailModal()" class="btn btn-secondary">닫기</button>
            </div>
          </div>
        </div>

        <!-- 매입처 등록/수정 모달 -->
        <div id="supplierModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div class="modal-content" style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 600px;
                max-height: 90vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 고정된 제목 영역 -->
            <div id="supplierModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  position: sticky;
                  top: -32px;
                  background: white;
                  padding: 0 0 16px 0;
                  border-bottom: 2px solid var(--border);
                  z-index: 10;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
                매입처 신규등록
              </h2>
              <button onclick="closeSupplierModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <form id="supplierForm" onsubmit="submitSupplier(event)">
              <!-- 1. 매입처코드 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매입처코드</label>
                <input type="text" id="supplierCode" name="supplierCode" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="자동생성" />
              </div>

              <!-- 2. 매입처명 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">매입처명 *</label>
                <input type="text" id="supplierName" name="supplierName" required style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="매입처명" />
              </div>

              <!-- 3. 대표자명 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">대표자명</label>
                <input type="text" id="supplierCeoName" name="supplierCeoName" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="대표자명" />
              </div>

              <!-- 4. 사업자번호 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">사업자번호</label>
                <input type="text" id="supplierBusinessNo" name="supplierBusinessNo" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="000-00-00000" />
              </div>

              <!-- 5. 업태 & 업종 (1:1 비율) -->
              <div style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 16px;
                    margin-bottom: 16px;
                  ">
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업태</label>
                  <input type="text" id="supplierBusinessType" name="supplierBusinessType" style="
                        width: 100%;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="업태" />
                </div>
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">업종</label>
                  <input type="text" id="supplierBusinessCategory" name="supplierBusinessCategory" style="
                        width: 100%;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="업종" />
                </div>
              </div>

              <!-- 6. 연락처 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">연락처</label>
                <input type="tel" id="supplierPhone" name="supplierPhone" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="010-0000-0000" />
              </div>

              <!-- 7. 팩스번호 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">팩스번호</label>
                <input type="tel" id="supplierFax" name="supplierFax" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="02-0000-0000" />
              </div>

              <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">우편번호</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="supplierZipCode" name="supplierZipCode" readonly style="
                        flex: 1;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                        background: #f8f9fa;
                      " placeholder="우편번호" />
                  <button type="button" onclick="openPostCodeForSupplier()" style="
                        padding: 12px 20px;
                        background: #007bff;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        white-space: nowrap;
                      ">
                    우편번호 찾기
                  </button>
                </div>
              </div>

              <!-- 9. 주소 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">주소</label>
                <input type="text" id="supplierAddress" name="supplierAddress" readonly style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f8f9fa;
                    " placeholder="주소" />
              </div>

              <!-- 10. 상세주소 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">상세주소</label>
                <input type="text" id="supplierAddressDetail" name="supplierAddressDetail" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="상세주소" />
              </div>

              <!-- 11. 은행 & 계좌번호 (1:1 비율) -->
              <div style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 16px;
                    margin-bottom: 16px;
                  ">
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">은행</label>
                  <input type="text" id="supplierBankCode" name="supplierBankCode" style="
                        width: 100%;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="은행명" />
                </div>
                <div>
                  <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">계좌번호</label>
                  <input type="text" id="supplierAccountNo" name="supplierAccountNo" style="
                        width: 100%;
                        padding: 12px 16px;
                        border: 2px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="계좌번호" />
                </div>
              </div>

              <!-- 12. 담당자명 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">담당자명</label>
                <input type="text" id="supplierManagerName" name="supplierManagerName" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="담당자명" />
              </div>

              <!-- 13. 거래상태 (전체 너비) -->
              <div style="margin-bottom: 16px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">거래상태</label>
                <select id="supplierStatus" name="supplierStatus" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    ">
                  <option value="0">정상거래</option>
                  <option value="1">거래보류</option>
                </select>
              </div>

              <!-- 14. 비고 (전체 너비) -->
              <div style="margin-bottom: 24px">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">비고</label>
                <textarea id="supplierRemark" name="supplierRemark" rows="3" style="
                      width: 100%;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                      resize: vertical;
                    " placeholder="비고사항을 입력하세요"></textarea>
              </div>

              <!-- 버튼 영역 -->
              <div style="display: flex; gap: 12px; justify-content: flex-end">
                <button type="button" onclick="closeSupplierModal()" class="btn btn-secondary" style="
                      padding: 12px 24px;
                      background: #6c757d;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                    ">
                  취소
                </button>
                <button type="submit" class="btn btn-primary" style="
                      padding: 12px 24px;
                      background: #007bff;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                    ">
                  저장
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- 매입처 삭제 확인 모달 -->
        <div id="supplierDeleteModal" class="modal" style="display: none">
          <div class="modal-content" style="width: 90%; max-width: 600px">
            <!-- 헤더 -->
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 20px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid var(--border);
                ">
              <h3 style="margin: 0; color: #dc3545; font-size: 20px; font-weight: 700">
                ⚠️ 매입처 삭제 확인
              </h3>
              <button onclick="closeSupplierDeleteModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  ">
                ×
              </button>
            </div>

            <!-- 삭제할 매입처 정보 표시 영역 -->
            <div id="supplierDeleteContent"></div>

            <!-- 경고 메시지 -->
            <div style="
                  background: #fff3cd;
                  padding: 16px;
                  border-radius: 8px;
                  border-left: 4px solid #ffc107;
                  margin-bottom: 20px;
                ">
              <p style="margin: 0; color: #856404; font-weight: 500">
                정말로 이 매입처를 삭제하시겠습니까?
              </p>
              <p style="margin: 8px 0 0 0; color: #856404; font-size: 13px">
                삭제된 데이터는 복구할 수 없습니다.
              </p>
            </div>

            <!-- 버튼 영역 -->
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px">
              <button onclick="closeSupplierDeleteModal()" class="btn btn-secondary">취소</button>
              <button onclick="confirmDeleteSupplier()" class="btn btn-danger" style="background: #dc3545">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- ========================= -->
        <!-- 발주 관련 모달들 -->
        <!-- ========================= -->

        <!-- ✅ 발주 작성 모달 (레거시 방식: orderCreateModal) -->
        <div id="orderCreateModal" class="modal" style="display: none">
          <div class="modal-content" style="
                max-width: 1200px;
                max-height: 90vh;
                overflow-y: auto;
                padding: 32px;
                position: relative;
              ">
            <!-- ✅ 헤더 영역 (Prefix 규칙: orderCreateModalHeader) -->
            <div id="orderCreateModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid var(--border);
                  cursor: move;
                  user-select: none;
                ">
              <h2 id="orderCreateModalTitle" style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
                발주서 작성
              </h2>
              <button id="orderCreateModalCloseBtn" onclick="closeOrderModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    color: #666;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s ease;
                  " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
                onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
                ×
              </button>
            </div>

            <form id="orderForm" onsubmit="submitNewOrder(event)">
              <!-- ✅ 발주 마스터 정보 (카드 스타일) -->
              <div id="orderMasterInfoCard" style="
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 8px;
                    margin-bottom: 24px;
                  ">
                <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                  발주 기본 정보
                </h3>
                <div id="orderFormGridContainer" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                  <!-- 발주일자 -->
                  <div id="orderDateFieldContainer">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      발주일자 <span style="color: #ef4444">*</span>
                    </label>
                    <input type="date" id="orderDate" class="form-control" required style="width: 100%" />
                  </div>

                  <!-- 입고희망일자 -->
                  <div id="orderDeliveryDateFieldContainer">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      입고희망일자
                    </label>
                    <input type="date" id="orderDeliveryDate" class="form-control" style="width: 100%" />
                  </div>

                  <!-- 매입처 선택 -->
                  <div id="orderSupplierFieldContainer" style="grid-column: 1 / -1">
                    <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                        ">매입처 *</label>
                    <div id="orderSupplierInputWrapper" style="display: flex; gap: 8px">
                      <!-- ✅ 숨겨진 매입처 코드 필드 (Prefix 규칙: orderSelectedSupplierCode) -->
                      <input type="hidden" id="orderSelectedSupplierCode" />

                      <!-- ✅ 통합 검색 입력란 (Prefix 규칙: orderSelectedSupplierName) -->
                      <input type="text" id="orderSelectedSupplierName" required style="
                            flex: 1;
                            padding: 12px 16px;
                            border: 2px solid var(--border);
                            border-radius: 8px;
                            font-size: 14px;
                          " placeholder="매입처 코드 또는 이름 입력 후 엔터"
                        onkeypress="if(event.key === 'Enter') { event.preventDefault(); openSupplierSearchModal(); }" />
                      <button type="button" onclick="openSupplierSearchModal()" style="
                            padding: 10px 20px;
                            background: var(--primary);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 500;
                            cursor: pointer;
                            white-space: nowrap;
                          ">
                        검색
                      </button>
                    </div>
                    <!-- ✅ 선택된 매입처 정보 표시 (Prefix 규칙: orderSelectedSupplierInfo) -->
                    <div id="orderSelectedSupplierInfo" style="
                          display: none;
                          margin-top: 8px;
                          padding: 8px 12px;
                          background: #f0f9ff;
                          border-radius: 6px;
                          border: 1px solid #bfdbfe;
                        ">
                      <span style="font-size: 12px; color: #3b82f6; font-weight: 600">선택된 매입처:</span>
                      <span id="orderSelectedSupplierDisplay"
                        style="margin-left: 8px; font-weight: 600; color: #1e40af"></span>
                    </div>
                  </div>

                  <!-- 결제방법 -->
                  <div id="orderPaymentMethodFieldContainer">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      결제방법
                    </label>
                    <select id="orderPaymentMethod" class="form-control" style="width: 100%">
                      <option value="">선택</option>
                      <option value="현금">현금</option>
                      <option value="카드">카드</option>
                      <option value="계좌이체">계좌이체</option>
                      <option value="어음">어음</option>
                    </select>
                  </div>

                  <!-- 상태 -->
                  <div id="orderStatusFieldContainer">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      상태
                    </label>
                    <select id="orderStatus" class="form-control" style="width: 100%">
                      <option value="0">발주대기</option>
                      <option value="1">발주완료</option>
                      <option value="2">입고완료</option>
                    </select>
                  </div>

                  <!-- 제목 (전체 너비) -->
                  <div id="orderTitleFieldContainer" style="grid-column: 1 / -1">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      제목 <span style="color: #ef4444">*</span>
                    </label>
                    <input type="text" id="orderTitle" class="form-control" required placeholder="발주 제목을 입력하세요"
                      style="width: 100%" />
                  </div>

                  <!-- 적요 (전체 너비) -->
                  <div id="orderRemarksFieldContainer" style="grid-column: 1 / -1">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                      적요
                    </label>
                    <textarea id="orderRemarks" class="form-control" rows="3" placeholder="발주 내용을 입력하세요"
                      style="width: 100%; resize: vertical"></textarea>
                  </div>
                </div>
              </div>

              <!-- ✅ 발주 품목 내역 -->
              <div id="orderDetailSection" style="margin-bottom: 24px">
                <div id="orderDetailHeaderWrapper" style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 16px;
                    ">
                  <h3 style="margin: 0; font-size: 18px; font-weight: 600">발주 상세내역</h3>
                  <button type="button" onclick="openOrderMaterialSearchModal()" style="
                        padding: 8px 16px;
                        background: #007bff;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                      ">
                    + 자재 추가
                  </button>
                </div>

                <div id="newOrderDetailTableContainer" style="overflow-x: auto">
                  <table id="newOrderDetailTable" class="display" style="
                        width: 100%;
                        border-collapse: collapse;
                        background: white;
                        border: 1px solid #e5e7eb;
                      ">
                    <thead style="background: #f3f4f6">
                      <tr>
                        <th style="
                              padding: 12px;
                              border: 1px solid #e5e7eb;
                              text-align: center;
                              width: 50px;
                            ">
                          No
                        </th>
                        <th style="padding: 12px; border: 1px solid #e5e7eb; text-align: left">
                          품목코드
                        </th>
                        <th style="
                              padding: 12px;
                              border: 1px solid #e5e7eb;
                              text-align: center;
                              width: 120px;
                            ">
                          규격
                        </th>
                        <th style="
                              padding: 12px;
                              border: 1px solid #e5e7eb;
                              text-align: right;
                              width: 100px;
                            ">
                          발주량
                        </th>
                        <th style="
                              padding: 12px;
                              border: 1px solid #e5e7eb;
                              text-align: right;
                              width: 120px;
                            ">
                          입고단가
                        </th>
                        <th style="
                              padding: 12px;
                              border: 1px solid #e5e7eb;
                              text-align: right;
                              width: 120px;
                            ">
                          출고단가
                        </th>
                        <th style="
                              padding: 12px;
                              border: 1px solid #e5e7eb;
                              text-align: right;
                              width: 130px;
                            ">
                          공급가액
                        </th>
                        <th style="
                              padding: 12px;
                              border: 1px solid #e5e7eb;
                              text-align: center;
                              width: 80px;
                            ">
                          삭제
                        </th>
                      </tr>
                    </thead>
                    <tbody id="newOrderDetailTableBody">
                      <tr>
                        <td colspan="8" style="
                              padding: 40px;
                              text-align: center;
                              color: #999;
                              border: 1px solid #e5e7eb;
                            ">
                          자재를 추가해주세요
                        </td>
                      </tr>
                    </tbody>
                    <tfoot style="background: #f9fafb; font-weight: 600">
                      <tr>
                        <td colspan="6" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid #e5e7eb;
                              color: #1f2937;
                            ">
                          합계
                        </td>
                        <td id="orderTotalSupplyPrice" style="
                              padding: 12px;
                              text-align: right;
                              border-top: 2px solid #e5e7eb;
                              color: #1f2937;
                            ">
                          0
                        </td>
                        <td style="padding: 12px; border-top: 2px solid #e5e7eb"></td>
                      </tr>
                      <tr>
                        <td colspan="6" style="padding: 12px; text-align: right; color: #1f2937">
                          부가세
                        </td>
                        <td id="orderTotalVat" style="padding: 12px; text-align: right; color: #1f2937">
                          0
                        </td>
                        <td style="padding: 12px"></td>
                      </tr>
                      <tr>
                        <td colspan="6" style="padding: 12px; text-align: right; color: #1f2937">
                          총액
                        </td>
                        <td id="orderGrandTotal" style="
                              padding: 12px;
                              text-align: right;
                              color: #2563eb;
                              font-size: 16px;
                              font-weight: 700;
                            ">
                          0
                        </td>
                        <td style="padding: 12px"></td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>

              <!-- ✅ 저장 버튼 -->
              <div id="orderFormButtonContainer" style="
                    display: flex;
                    gap: 12px;
                    justify-content: flex-end;
                    padding-top: 16px;
                    border-top: 2px solid #e5e7eb;
                  ">
                <button type="button" onclick="closeOrderModal()" style="
                      padding: 12px 24px;
                      background: #f3f4f6;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: #374151;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                  취소
                </button>
                <button type="submit" style="
                      padding: 12px 24px;
                      background: #3b82f6;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: white;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                  저장하기
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- ✅ 매입처 검색 모달 -->
        <div id="supplierSearchModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 800px">
            <div id="supplierSearchModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 20px;
                ">
              <h3 style="margin: 0">매입처 검색</h3>
              <button onclick="closeSupplierSearchModal()" style="
                    background: #f0f0f0;
                    border: none;
                    font-size: 24px;
                    cursor: pointer;
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                  ">
                ×
              </button>
            </div>

            <div id="supplierSearchInputWrapper" style="display: flex; gap: 10px; margin-bottom: 16px">
              <input type="text" id="orderSupplierSearchInput" placeholder="매입처명 또는 코드 검색"
                onkeypress="if(event.key === 'Enter') searchOrderSuppliers()"
                style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px" />
              <button onclick="searchOrderSuppliers()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    cursor: pointer;
                  ">
                검색
              </button>
            </div>

            <div id="supplierSearchTableContainer" style="
                  max-height: 400px;
                  overflow-y: auto;
                  border: 1px solid #e5e7eb;
                  border-radius: 6px;
                ">
              <table id="orderSupplierSearchTable" style="width: 100%; border-collapse: collapse">
                <thead style="background: #f8f9fa; position: sticky; top: 0">
                  <tr>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      코드
                    </th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      매입처명
                    </th>
                    <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
                      전화번호
                    </th>
                    <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb">
                      선택
                    </th>
                  </tr>
                </thead>
                <tbody id="supplierSearchTableBody">
                  <tr>
                    <td colspan="4" style="padding: 40px; text-align: center; color: #999">
                      검색 버튼을 클릭하여 매입처를 검색하세요
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- 신규 발주서용 품목 추가 모달 -->
        <div id="newOrderMaterialModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 900px">
            <div id="newOrderMaterialModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 추가
              </h2>
              <button onclick="closeNewOrderMaterialModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div id="newOrderMaterialFormWrapper" style="display: flex; flex-direction: column; gap: 16px">
              <!-- 자재 검색 영역 -->
              <div id="newOrderMaterialSearchSection">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
                <div id="newOrderMaterialSearchInputWrapper" style="display: flex; gap: 8px">
                  <input type="text" id="newOrderMaterialSearchInput" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="자재명 또는 품목코드로 검색"
                    onkeypress="if(event.key === 'Enter') searchNewOrderMaterials()" />
                  <button onclick="searchNewOrderMaterials()" style="
                        padding: 10px 20px;
                        background: #3b82f6;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- 검색 결과 테이블 -->
              <div id="newOrderMaterialSearchResults" style="display: none">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과</label>
                <div style="
                      max-height: 200px;
                      overflow-y: auto;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                    ">
                  <table style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f9fafb; position: sticky; top: 0">
                      <tr>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품목코드
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품명
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          규격
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: right;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          입고단가
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: center;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          선택
                        </th>
                      </tr>
                    </thead>
                    <tbody id="newOrderMaterialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- 선택된 자재 정보 -->
              <div id="newOrderSelectedMaterialInfo" style="
                    display: none;
                    background: #f0f9ff;
                    padding: 12px;
                    border-radius: 8px;
                    border: 2px solid #bfdbfe;
                  ">
                <div style="display: flex; justify-content: space-between; align-items: center">
                  <div>
                    <div style="
                          font-size: 12px;
                          color: #3b82f6;
                          font-weight: 600;
                          margin-bottom: 4px;
                        ">
                      선택된 자재
                    </div>
                    <div style="font-weight: 600; color: #1e40af" id="newOrderSelectedMaterialName">
                      -
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="newOrderSelectedMaterialCode">
                      -
                    </div>
                  </div>
                  <button onclick="clearNewOrderSelectedMaterial()" style="
                        padding: 6px 12px;
                        background: #ef4444;
                        border: none;
                        border-radius: 6px;
                        font-size: 12px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                      ">
                    취소
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
                <input type="number" id="newOrderDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="수량 입력" value="1" min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">입고단가</label>
                <div style="display: flex; gap: 8px">
                  <input type="number" id="newOrderDetailPrice" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="단가 입력" value="0" min="0" step="0.01" />
                  <button onclick="showNewOrderPriceHistory()" style="
                        padding: 10px 16px;
                        background: #8b5cf6;
                        border: none;
                        border-radius: 8px;
                        font-size: 13px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#7c3aed';" onmouseout="this.style.background='#8b5cf6';">
                    이전 단가
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">금액 (자동계산)</label>
                <input type="text" id="newOrderDetailAmount" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                    " readonly value="0" />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeNewOrderMaterialModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmNewOrderMaterialAdd()" style="
                    padding: 12px 24px;
                    background: #10b981;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- 발주 상세보기 모달 -->
        <div id="orderDetailModal" class="modal hidden">
          <div id="orderDetailModalContent" class="modal-content large"
            style="max-width: 1000px; max-height: 90vh; overflow-y: auto; position: relative">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="orderDetailModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                발주 상세 보기
              </h2>
              <button id="closeOrderDetailModal" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 발주 기본 정보 (카드 스타일) -->
            <div id="orderDetailInfoCard" style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                기본 정보
              </h3>
              <div id="orderDetailInfoGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                <div id="orderDetailNoField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">발주번호</span>
                  <span id="orderDetailNo" style="color: #1f2937; font-weight: 600">-</span>
                </div>
                <div id="orderDetailDateField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">발주일자</span>
                  <span id="orderDetailDate" style="color: #1f2937">-</span>
                </div>
                <div id="orderDetailSupplierField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">매입처명</span>
                  <span id="orderDetailSupplier" style="color: #1f2937">-</span>
                </div>
                <div id="orderDetailRemarkField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">비고</span>
                  <span id="orderDetailRemark" style="color: #1f2937">-</span>
                </div>
              </div>
            </div>

            <!-- ✅ 발주 상세 목록 -->
            <div id="orderDetailListSection" style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                발주 품목 내역
              </h3>
              <table id="orderDetailTable" class="display" style="width: 100%">
                <thead>
                  <tr>
                    <th>품목코드</th>
                    <th>품명</th>
                    <th>규격</th>
                    <th>단위</th>
                    <th>수량</th>
                    <th>단가</th>
                    <th>금액</th>
                  </tr>
                </thead>
                <tbody></tbody>
                <tfoot>
                  <tr style="background: #f9fafb; font-weight: bold">
                    <td colspan="6" style="text-align: right; padding-right: 20px; color: #1f2937">
                      합계
                    </td>
                    <td id="orderDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px">
                      0
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <!-- ✅ 출력 버튼 영역 -->
            <div id="orderDetailButtonContainer" style="
                  margin-top: 24px;
                  display: flex;
                  justify-content: flex-end;
                  gap: 12px;
                  padding-top: 16px;
                  border-top: 1px solid #e5e7eb;
                ">
              <button id="orderDetailCloseBtn" onclick="closeOrderDetailModal()" style="
                    padding: 10px 24px;
                    background: #dc2626;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                    box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
                  "
                onmouseover="this.style.background='#b91c1c'; this.style.boxShadow='0 4px 8px rgba(220, 38, 38, 0.3)';"
                onmouseout="this.style.background='#dc2626'; this.style.boxShadow='0 2px 4px rgba(220, 38, 38, 0.2)';">
                ✕ 닫기
              </button>
              <button id="orderDetailPrintBtn" onclick="printOrderFromDetail()" style="
                    padding: 10px 24px;
                    background: #9333ea;
                    color: white;
                    border: none;
                    border-radius: 6px;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                    box-shadow: 0 2px 4px rgba(147, 51, 234, 0.2);
                  "
                onmouseover="this.style.background='#7c3aed'; this.style.boxShadow='0 4px 8px rgba(147, 51, 234, 0.3)';"
                onmouseout="this.style.background='#9333ea'; this.style.boxShadow='0 2px 4px rgba(147, 51, 234, 0.2)';">
                📄 출력
              </button>
            </div>
          </div>
        </div>

        <!-- 발주 수정 모달 -->
        <div id="orderEditModal" class="modal" style="display: none">
          <div class="modal-content large" style="max-width: 1200px; max-height: 90vh; overflow-y: auto">
            <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
            <div id="orderEditModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                  cursor: move;
                  user-select: none;
                ">
              <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
                발주 수정
              </h2>
              <button id="closeOrderEditModalBtn" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- ✅ 발주 기본 정보 (카드 스타일) -->
            <div id="orderEditInfoCard" style="
                  background: #f9fafb;
                  padding: 20px;
                  border-radius: 12px;
                  margin-bottom: 24px;
                  border: 1px solid #e5e7eb;
                ">
              <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
                기본 정보
              </h3>
              <div id="orderEditInfoGrid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
                <div id="editOrderNoField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">발주번호</span>
                  <span id="editOrderNo" style="color: #1f2937; font-weight: 600">-</span>
                </div>
                <div id="editOrderDateField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">발주일자</span>
                  <span id="editOrderDate" style="color: #1f2937">-</span>
                </div>
                <div id="editSupplierNameField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">매입처명</span>
                  <span id="editSupplierName" style="color: #1f2937">-</span>
                </div>
                <div id="editOrderDeliveryDateField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">입고희망일자</span>
                  <input type="date" id="editOrderDeliveryDate" style="
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                      " />
                </div>
                <div id="editOrderPaymentMethodField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">결제방법</span>
                  <select id="editOrderPaymentMethod" style="
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                      ">
                    <option value="">선택</option>
                    <option value="현금">현금</option>
                    <option value="카드">카드</option>
                    <option value="계좌이체">계좌이체</option>
                    <option value="어음">어음</option>
                  </select>
                </div>
                <div id="editOrderStatusField" style="display: flex; align-items: center">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">상태</span>
                  <select id="editOrderStatus" style="
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                      ">
                    <option value="0">발주대기</option>
                    <option value="1">발주완료</option>
                    <option value="2">입고완료</option>
                  </select>
                </div>
                <div id="editOrderTitleField" style="display: flex; align-items: center; grid-column: 1 / -1">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280">제목</span>
                  <input type="text" id="editOrderTitle" style="
                        flex: 1;
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                      " placeholder="발주 제목" />
                </div>
                <div id="editOrderRemarkField" style="display: flex; align-items: flex-start; grid-column: 1 / -1">
                  <span style="min-width: 100px; font-weight: 500; color: #6b7280; padding-top: 8px">적요</span>
                  <textarea id="editOrderRemark" rows="2" style="
                        flex: 1;
                        padding: 8px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 6px;
                        font-size: 14px;
                        resize: vertical;
                      " placeholder="발주 적요"></textarea>
                </div>
              </div>
            </div>

            <!-- ✅ 발주 상세 목록 -->
            <div id="orderEditDetailSection">
              <div id="orderEditDetailHeaderWrapper" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
                  발주 품목 내역
                </h3>
                <div id="orderEditDetailButtonGroup" style="display: flex; gap: 8px">
                  <button type="button" onclick="addOrderDetailRowInEdit()" style="
                        padding: 8px 16px;
                        background: #10b981;
                        border: none;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                      " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                    + 품목 추가
                  </button>
                  <!-- <button type="button" onclick="deleteSelectedOrderDetails()" style="
              padding: 8px 16px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#dc2626';"
               onmouseout="this.style.background='#ef4444';">
              선택 삭제
            </button> -->
                </div>
              </div>

              <table id="orderEditDetailTable" class="display" style="width: 100%">
                <thead>
                  <tr>
                    <th style="width: 40px">
                      <input type="checkbox" id="selectAllEditOrderDetails" />
                    </th>
                    <th style="width: 50px">순번</th>
                    <th>자재코드</th>
                    <th>자재명</th>
                    <th>규격</th>
                    <th>발주량</th>
                    <th>입고단가</th>
                    <th>출고단가</th>
                    <th style="width: 120px">관리</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <!-- ✅ 버튼 영역 -->
            <div id="orderEditButtonContainer" style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button type="button" onclick="closeOrderEditModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button type="button" onclick="submitOrderEdit()" style="
                    padding: 12px 24px;
                    background: #2563eb;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                수정 완료
              </button>
            </div>
          </div>
        </div>

        <!-- 발주 삭제 확인 모달 -->
        <div id="orderDeleteModal" style="
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.5);
              z-index: 1000;
              align-items: center;
              justify-content: center;
            ">
          <div style="
                background: white;
                border-radius: 12px;
                padding: 32px;
                width: 90%;
                max-width: 400px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
              ">
            <!-- 아이콘 -->
            <div style="text-align: center; margin-bottom: 20px">
              <div style="
                    width: 64px;
                    height: 64px;
                    background: #fee2e2;
                    border-radius: 50%;
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    margin-bottom: 16px;
                  ">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
                  <path
                    d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" />
                </svg>
              </div>
              <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937">
                발주 삭제
              </h2>
              <div id="orderDeleteContent" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px">
                발주번호: -
              </div>
              <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500">
                정말로 이 발주를 삭제하시겠습니까?
              </p>
              <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px">
                삭제된 발주는 복구할 수 없습니다.
              </p>
            </div>

            <!-- 버튼 -->
            <div style="display: flex; gap: 12px">
              <button onclick="closeOrderDeleteModal()" style="
                    flex: 1;
                    padding: 12px;
                    border: 2px solid #e5e7eb;
                    background: white;
                    color: #374151;
                    border-radius: 8px;
                    font-size: 15px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#f9fafb'; this.style.borderColor='#d1d5db';"
                onmouseout="this.style.background='white'; this.style.borderColor='#e5e7eb';">
                취소
              </button>
              <button onclick="confirmDeleteOrder()" style="
                    flex: 1;
                    padding: 12px;
                    border: none;
                    background: #dc2626;
                    color: white;
                    border-radius: 8px;
                    font-size: 15px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#b91c1c';" onmouseout="this.style.background='#dc2626';">
                삭제
              </button>
            </div>
          </div>
        </div>

        <!-- 발주 품목 추가 모달 -->
        <div id="orderDetailAddModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 600px">
            <div id="orderDetailAddModalHeader" style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 추가
              </h2>
              <button id="closeOrderDetailAddModal" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <!-- ✅ 자재 검색 영역 -->
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
                <div style="display: flex; gap: 8px">
                  <input type="text" id="orderMaterialSearchInput" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="자재명 또는 품목코드로 검색" onkeypress="if(event.key === 'Enter') searchOrderMaterials()" />
                  <button onclick="searchOrderMaterials()" style="
                        padding: 10px 20px;
                        background: #3b82f6;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                    검색
                  </button>
                </div>
              </div>

              <!-- ✅ 검색 결과 테이블 -->
              <div id="orderMaterialSearchResults" style="display: none">
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과 (클릭하여
                  선택)</label>
                <div style="
                      max-height: 200px;
                      overflow-y: auto;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                    ">
                  <table id="orderMaterialSearchTable" style="width: 100%; border-collapse: collapse">
                    <thead style="background: #f9fafb; position: sticky; top: 0">
                      <tr>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품목코드
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          품명
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: left;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          규격
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: right;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          입고단가
                        </th>
                        <th style="
                              padding: 8px;
                              text-align: center;
                              border-bottom: 1px solid #e5e7eb;
                              font-size: 13px;
                            ">
                          선택
                        </th>
                      </tr>
                    </thead>
                    <tbody id="orderMaterialSearchTableBody"></tbody>
                  </table>
                </div>
              </div>

              <!-- ✅ 선택된 자재 정보 -->
              <div id="selectedOrderMaterialInfo" style="
                    display: none;
                    background: #f0f9ff;
                    padding: 12px;
                    border-radius: 8px;
                    border: 2px solid #bfdbfe;
                  ">
                <div style="display: flex; justify-content: space-between; align-items: center">
                  <div>
                    <div style="
                          font-size: 12px;
                          color: #3b82f6;
                          font-weight: 600;
                          margin-bottom: 4px;
                        ">
                      선택된 자재
                    </div>
                    <div style="font-weight: 600; color: #1e40af" id="selectedOrderMaterialName">
                      -
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="selectedOrderMaterialCode">
                      -
                    </div>
                  </div>
                  <button onclick="clearSelectedOrderMaterial()" style="
                        padding: 6px 12px;
                        background: #ef4444;
                        border: none;
                        border-radius: 6px;
                        font-size: 12px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                      ">
                    취소
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">발주 수량</label>
                <input type="number" id="addOrderDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="발주 수량 입력" value="1" min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">입고단가</label>
                <div style="display: flex; gap: 8px">
                  <input type="number" id="addOrderDetailInPrice" style="
                        flex: 1;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="입고단가 입력" value="0" min="0" step="0.01" />
                  <button onclick="showEditOrderPriceHistory()" style="
                        padding: 10px 16px;
                        background: #f59e0b;
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                        transition: all 0.2s;
                        white-space: nowrap;
                      " onmouseover="this.style.background='#d97706';" onmouseout="this.style.background='#f59e0b';">
                    이전단가
                  </button>
                </div>
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가</label>
                <input type="number" id="addOrderDetailOutPrice" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="출고단가 입력" value="0" min="0" step="0.01" />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeOrderDetailAddModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmAddOrderDetail()" style="
                    padding: 12px 24px;
                    background: #10b981;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                추가하기
              </button>
            </div>
          </div>
        </div>

        <!-- 발주 품목 수정 모달 -->
        <div id="orderDetailEditModal" class="modal" style="display: none">
          <div class="modal-content" style="max-width: 500px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                품목 수정
              </h2>
              <button id="closeOrderDetailEditModal" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 16px">
              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재명</label>
                <input type="text" id="editOrderDetailMaterialName" readonly style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f9fafb;
                    " />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">발주량</label>
                <input type="number" id="editOrderDetailQuantity" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">입고단가</label>
                <input type="number" id="editOrderDetailInPrice" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " min="0" step="0.01" />
              </div>

              <div>
                <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가</label>
                <input type="number" id="editOrderDetailOutPrice" style="
                      width: 100%;
                      padding: 10px 12px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                    " min="0" step="0.01" />
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  margin-top: 24px;
                  padding-top: 24px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeOrderDetailEditModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                취소
              </button>
              <button onclick="confirmEditOrderDetail()" style="
                    padding: 12px 24px;
                    background: #3b82f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                수정하기
              </button>
            </div>
          </div>
        </div>

        <!-- ✅ 발주 입고단가 이력 모달 -->
        <div id="orderPriceHistoryModal" class="modal" style="display: none; z-index: 10000">
          <div class="modal-content" style="max-width: 700px">
            <div style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 24px;
                  padding-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
                입고단가 이력
              </h2>
              <button id="closeOrderPriceHistoryModal" onclick="closeOrderPriceHistoryModal()" style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: #f3f4f6;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 20px;
                    color: #6b7280;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
                onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
                &times;
              </button>
            </div>

            <!-- 자재 정보 -->
            <div style="
                  background: #fef3c7;
                  padding: 12px;
                  border-radius: 8px;
                  margin-bottom: 16px;
                  border: 2px solid #fbbf24;
                ">
              <div style="display: flex; justify-content: space-between; align-items: center">
                <div>
                  <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px">
                    선택된 자재
                  </div>
                  <div style="font-weight: 600; color: #78350f" id="orderPriceHistoryMaterialName">
                    -
                  </div>
                  <div style="font-size: 12px; color: #92400e; margin-top: 2px" id="orderPriceHistoryMaterialCode">
                    -
                  </div>
                </div>
              </div>
            </div>

            <!-- ✅ 탭 메뉴 -->
            <div style="
                  display: flex;
                  gap: 8px;
                  margin-bottom: 16px;
                  border-bottom: 2px solid #e5e7eb;
                ">
              <button id="tabActualPurchasePrice" onclick="switchOrderPriceHistoryTab('actual')" style="
                    padding: 12px 20px;
                    background: #3b82f6;
                    border: none;
                    border-bottom: 3px solid #3b82f6;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    color: white;
                    transition: all 0.2s;
                    flex: 1;
                  ">
                실제 입고가
              </button>
              <button id="tabOrderPrice" onclick="switchOrderPriceHistoryTab('order')" style="
                    padding: 12px 20px;
                    background: transparent;
                    border: none;
                    border-bottom: 3px solid transparent;
                    font-size: 14px;
                    font-weight: 600;
                    cursor: pointer;
                    color: #6b7280;
                    transition: all 0.2s;
                    flex: 1;
                  " onmouseover="if(this.style.background === 'transparent') this.style.color='#1f2937';"
                onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';">
                발주 제안가
              </button>
            </div>

            <!-- 이력 테이블 -->
            <div style="margin-bottom: 16px">
              <label id="orderPriceHistoryLabel"
                style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
                이 거래처에 실제 입고한 이력 (클릭하여 단가 선택)
              </label>
              <div style="
                    max-height: 300px;
                    overflow-y: auto;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                  ">
                <table id="orderPriceHistoryTable" style="width: 100%; border-collapse: collapse">
                  <thead id="orderPriceHistoryTableHead" style="background: #f9fafb; position: sticky; top: 0">
                    <tr>
                      <th style="
                            padding: 10px;
                            text-align: left;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        입고일자
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        입고단가
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: right;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        입고수량
                      </th>
                      <th style="
                            padding: 10px;
                            text-align: center;
                            border-bottom: 2px solid #e5e7eb;
                            font-size: 13px;
                          ">
                        적요
                      </th>
                    </tr>
                  </thead>
                  <tbody id="orderPriceHistoryTableBody">
                    <tr>
                      <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af">
                        이력이 없습니다
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div style="
                  display: flex;
                  gap: 12px;
                  justify-content: flex-end;
                  padding-top: 16px;
                  border-top: 2px solid #e5e7eb;
                ">
              <button onclick="closeOrderPriceHistoryModal()" style="
                    padding: 12px 24px;
                    background: #f3f4f6;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                    color: #374151;
                    transition: all 0.2s;
                  " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
                닫기
              </button>
            </div>
          </div>
        </div>

        <!-- 자재분류관리 페이지 -->
        <div class="page-content hidden" id="materialCategoryPage">
          <h2 style="display: none">자재분류관리</h2>

          <!-- 툴바 영역 -->
          <div class="toolbar" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
              ">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center">
              <input type="text" id="categoryListSearchInput" placeholder="분류코드 또는 분류명 검색..." style="
                    padding: 10px 16px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    width: 280px;
                    outline: none;
                  " />
              <button class="btn btn-primary" onclick="searchMaterialCategories()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                🔍 검색
              </button>
              <button class="btn btn-light" onclick="resetCategorySearch()" style="
                    padding: 10px 16px;
                    background: #f8f9fa;
                    color: #333;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px">
              <button class="btn btn-success" onclick="openNewCategoryModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 신규 등록
              </button>
              <button class="btn btn-secondary" onclick="exportCategoriesToGoogleSheets()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">📊</span> Google Sheets로 보내기
              </button>
            </div>
          </div>

          <!-- 자재분류 목록 DataTable -->
          <table id="materialCategoryTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="selectAllCategories" title="전체 선택" aria-label="전체 선택" />
                </th>
                <th>순번</th>
                <th>분류코드</th>
                <th>분류명</th>
                <th>적요</th>
                <th>사용구분</th>
                <th>수정일자</th>
                <th style="width: 180px">관리</th>
              </tr>
            </thead>
          </table>
        </div>

        <!-- 자재재고관리 페이지 -->
        <div class="page-content hidden" id="materialInventoryPage">
          <h2 style="display: none">자재재고관리</h2>

          <!-- 검색 영역 -->
          <div class="toolbar" style="margin-bottom: 20px">
            <div style="display: flex; gap: 12px; align-items: flex-end; flex-wrap: wrap">
              <!-- 사업장 선택 -->
              <div>
                <label style="display: block; margin-bottom: 4px; font-weight: 600">사업장</label>
                <select id="inventoryWorkplaceFilter" class="form-control" style="width: 200px"
                  onchange="loadMaterialInventory()">
                  <option value="">사업장 선택</option>
                </select>
              </div>

              <!-- 버튼 -->
              <div style="display: flex; gap: 8px">
                <button class="btn btn-primary" onclick="loadMaterialInventory()" style="height: 40px">
                  조회
                </button>
                <button class="btn btn-secondary" onclick="resetInventorySearch()" style="height: 40px">
                  초기화
                </button>
              </div>
            </div>
          </div>

          <!-- 요약 정보 -->
          <div class="summary-bar" style="margin: 16px 0; padding: 12px; background: #f8f9fa; border-radius: 8px">
            <div style="display: flex; gap: 24px; font-size: 14px">
              <span>
                총 자재 수:
                <strong id="totalMaterialCount" style="color: #007bff; font-size: 16px">0</strong>
                개
              </span>
              <span>
                재고 부족:
                <strong id="lowStockCount" style="color: #dc3545; font-size: 16px">0</strong> 개
              </span>
              <span>
                재고 주의:
                <strong id="warningStockCount" style="color: #ffc107; font-size: 16px">0</strong>
                개
              </span>
            </div>
          </div>

          <!-- 재고 현황 DataTable -->
          <table id="materialInventoryTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th>순번</th>
                <th>자재코드</th>
                <th>자재명</th>
                <th>규격</th>
                <th>단위</th>
                <th>현재고</th>
                <th>총입고</th>
                <th>총출고</th>
                <th>적정재고</th>
                <th>최저재고</th>
                <th>상태</th>
                <th>최종입고일</th>
                <th>최종출고일</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- 자재내역관리 페이지 -->
        <div class="page-content hidden" id="materialHistoryPage">
          <h2 style="display: none">자재내역관리</h2>

          <!-- 툴바 영역 -->
          <div class="toolbar" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
              ">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center">
              <input type="text" id="historyListSearchInput" placeholder="세부코드 또는 자재명 검색..." style="
                    padding: 10px 16px;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    width: 280px;
                    outline: none;
                  " />
              <button class="btn btn-primary" onclick="searchMaterialHistory()" style="
                    padding: 10px 20px;
                    background: #007bff;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                🔍 검색
              </button>
              <button class="btn btn-light" onclick="resetHistorySearch()" style="
                    padding: 10px 16px;
                    background: #f8f9fa;
                    color: #333;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px">
              <button class="btn btn-success" onclick="openNewHistoryModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 신규 등록
              </button>
              <button class="btn btn-secondary" onclick="exportHistoryToGoogleSheets()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">📊</span> Google Sheets로 보내기
              </button>
            </div>
          </div>

          <!-- 자재 목록 DataTable -->
          <div id="materialHistoryList" style="overflow-x: auto">
            <table id="materialHistoryTable" class="display" style="width: 100%">
              <thead>
                <tr>
                  <th style="width: 40px">
                    <input type="checkbox" id="selectAllMaterials" title="전체 선택" aria-label="전체 선택" />
                  </th>
                  <th>순번</th>
                  <th>분류코드</th>
                  <th>자재코드</th>
                  <th>자재명</th>
                  <th>규격</th>
                  <th>단위</th>
                  <th>과세</th>
                  <th>입고단가1</th>
                  <th>출고단가1</th>
                  <th style="width: 200px">관리</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>

        <!-- 용지설정관리 페이지 -->
        <div class="page-content hidden" id="paperSettingPage">
          <h2 style="display: none">용지설정관리</h2>

          <div style="max-width: 800px; margin: 0 auto; padding: 24px">
            <!-- 페이지 헤더 -->
            <div style="margin-bottom: 32px">
              <h3 style="font-size: 24px; font-weight: 700; color: #1f2937; margin-bottom: 8px">
                프린트 용지 마진 설정
              </h3>
              <p style="color: #6b7280; font-size: 14px">
                A4 용지 출력 시 적용될 여백(마진)을 설정합니다.
              </p>
            </div>

            <!-- 마진 설정 카드 -->
            <div style="
                  background: white;
                  border: 1px solid #e5e7eb;
                  border-radius: 12px;
                  padding: 32px;
                  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                ">
              <!-- 마진 설정 그리드 -->
              <div style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 24px;
                    margin-bottom: 32px;
                  ">
                <!-- 상단 마진 -->
                <div>
                  <label style="
                        display: block;
                        font-size: 14px;
                        font-weight: 600;
                        color: #374151;
                        margin-bottom: 8px;
                      ">
                    상단 마진 (TOP)
                  </label>
                  <div style="display: flex; align-items: center; gap: 12px">
                    <input type="number" id="marginTop" min="0" max="50" value="10" style="
                          flex: 1;
                          padding: 10px 16px;
                          border: 1px solid #d1d5db;
                          border-radius: 8px;
                          font-size: 14px;
                          outline: none;
                        " />
                    <span style="font-size: 14px; color: #6b7280; min-width: 30px">mm</span>
                  </div>
                </div>

                <!-- 하단 마진 -->
                <div>
                  <label style="
                        display: block;
                        font-size: 14px;
                        font-weight: 600;
                        color: #374151;
                        margin-bottom: 8px;
                      ">
                    하단 마진 (BOTTOM)
                  </label>
                  <div style="display: flex; align-items: center; gap: 12px">
                    <input type="number" id="marginBottom" min="0" max="50" value="10" style="
                          flex: 1;
                          padding: 10px 16px;
                          border: 1px solid #d1d5db;
                          border-radius: 8px;
                          font-size: 14px;
                          outline: none;
                        " />
                    <span style="font-size: 14px; color: #6b7280; min-width: 30px">mm</span>
                  </div>
                </div>

                <!-- 좌측 마진 -->
                <div>
                  <label style="
                        display: block;
                        font-size: 14px;
                        font-weight: 600;
                        color: #374151;
                        margin-bottom: 8px;
                      ">
                    좌측 마진 (LEFT)
                  </label>
                  <div style="display: flex; align-items: center; gap: 12px">
                    <input type="number" id="marginLeft" min="0" max="50" value="10" style="
                          flex: 1;
                          padding: 10px 16px;
                          border: 1px solid #d1d5db;
                          border-radius: 8px;
                          font-size: 14px;
                          outline: none;
                        " />
                    <span style="font-size: 14px; color: #6b7280; min-width: 30px">mm</span>
                  </div>
                </div>

                <!-- 우측 마진 -->
                <div>
                  <label style="
                        display: block;
                        font-size: 14px;
                        font-weight: 600;
                        color: #374151;
                        margin-bottom: 8px;
                      ">
                    우측 마진 (RIGHT)
                  </label>
                  <div style="display: flex; align-items: center; gap: 12px">
                    <input type="number" id="marginRight" min="0" max="50" value="10" style="
                          flex: 1;
                          padding: 10px 16px;
                          border: 1px solid #d1d5db;
                          border-radius: 8px;
                          font-size: 14px;
                          outline: none;
                        " />
                    <span style="font-size: 14px; color: #6b7280; min-width: 30px">mm</span>
                  </div>
                </div>
              </div>

              <!-- 버튼 영역 -->
              <div style="
                    display: flex;
                    gap: 12px;
                    justify-content: flex-end;
                    border-top: 1px solid #e5e7eb;
                    padding-top: 24px;
                  ">
                <button onclick="resetPaperMargins()" style="
                      padding: 10px 24px;
                      background: #f3f4f6;
                      color: #374151;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                    ">
                  기본값 복원
                </button>
                <button onclick="savePaperMargins()" style="
                      padding: 10px 24px;
                      background: #3b82f6;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                    ">
                  저장
                </button>
              </div>
            </div>

            <!-- 안내 메시지 -->
            <div style="
                  margin-top: 24px;
                  padding: 16px;
                  background: #eff6ff;
                  border-left: 4px solid #3b82f6;
                  border-radius: 8px;
                ">
              <p style="margin: 0; font-size: 14px; color: #1e40af; line-height: 1.6">
                <strong>💡 사용 안내:</strong><br />
                • 마진 값은 0mm ~ 50mm 범위 내에서 설정할 수 있습니다.<br />
                • 설정한 마진은 견적서, 발주서, 거래명세서 등 모든 프린트 출력에 적용됩니다.<br />
                • 기본값은 상하좌우 모두 10mm입니다.
              </p>
            </div>
          </div>
        </div>

        <!-- 일계표 출력 페이지 -->
        <div class="page-content hidden" id="dailyReportPrintPage">
          <!-- 페이지에 대한 제목 표시 코드 주석 처리 
             <div class="page-header">
              <h1>일계표</h1>
              <p class="page-description">일별 매입/매출/입출금 현황을 조회합니다</p>
            </div> -->

          <!-- 검색 조건 -->
          <div class="filter-section" style="
                margin-bottom: 24px;
                padding: 20px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
              ">
            <div style="display: flex; gap: 16px; align-items: center">
              <div style="flex: 0 0 200px">
                <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151">시작일자</label>
                <input type="date" id="dailyReportStartDate" class="form-control" />
              </div>
              <div style="flex: 0 0 auto; margin-top: 28px">
                <span style="font-weight: 600; color: #374151">~</span>
              </div>
              <div style="flex: 0 0 200px">
                <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151">종료일자</label>
                <input type="date" id="dailyReportEndDate" class="form-control" />
              </div>
              <div style="flex: 0 0 auto; margin-top: 28px">
                <button class="btn btn-primary" onclick="loadDailyReport()" style="
                      padding: 10px 20px;
                      background: #007bff;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                    ">
                  조회
                </button>
              </div>
              <div style="flex: 0 0 auto; margin-top: 28px">
                <button class="btn btn-secondary" onclick="printDailyReport()" style="
                      padding: 10px 20px;
                      border: 1px solid #ddd;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                    ">
                  출력
                </button>
              </div>
            </div>
          </div>

          <!-- 일계표 테이블 -->
          <div class="table-container" style="
                background: white;
                border-radius: 8px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                padding: 20px;
              ">
            <table id="dailyReportTable" class="display" style="width: 100%">
              <thead>
                <tr>
                  <th>구분</th>
                  <th>거래처명/계정명</th>
                  <th>수입(공급가)</th>
                  <th>수입(부가세포함)</th>
                  <th>지출(공급가)</th>
                  <th>지출(부가세포함)</th>
                  <th>잔액</th>
                </tr>
              </thead>
              <tbody id="dailyReportTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 40px; color: #9ca3af">
                    조회 버튼을 클릭하여 일계표를 조회하세요
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <!-- 일계표 페이지 끝 -->

        <!-- 미지급금관리 페이지 -->
        <div class="page-content hidden" id="payablePage">
          <h2 style="display: none">미지급금관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <input type="date" id="payableStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="payableEndDate" class="form-control" style="width: 150px" />
              <button class="btn btn-secondary" onclick="loadAccountsPayable()">조회</button>
            </div>

            <div class="toolbar-right" style="display: flex; gap: 12px">
              <!-- 체크박스 선택 시 표시되는 버튼들 -->
              <button id="payableEditSelectedBtn" class="btn btn-warning" onclick="editSelectedAccountsPayable()"
                style="display: none">
                선택 항목 수정
              </button>
              <button id="payableDeleteSelectedBtn" class="btn btn-danger" onclick="deleteSelectedAccountsPayable()"
                style="display: none">
                선택 항목 삭제
              </button>

              <!-- Google Sheets 내보내기 -->
              <button class="btn btn-secondary" onclick="exportAccountsPayableToCSV()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 미지급금 내역 수: <span id="payableCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- 📋 미지급금 목록 테이블 -->
          <table id="accountsPayableTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="payableSelectAll" />
                </th>
                <th>순번</th>
                <th>매입처코드</th>
                <th>매입처명</th>
                <th>지급일자</th>
                <th>지급금액</th>
                <th>결제방법</th>
                <th>만기일자</th>
                <th>어음번호</th>
                <th>적요</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="payableTableBody"></tbody>
          </table>
        </div>
        <!-- 미지급금관리 페이지 끝 -->

        <!-- 미수금관리 페이지 -->
        <div class="page-content hidden" id="receivablePage">
          <h2 style="display: none">미수금관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <input type="date" id="receivableStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="receivableEndDate" class="form-control" style="width: 150px" />
              <button class="btn btn-secondary" onclick="loadAccountsReceivable()">조회</button>
            </div>

            <div class="toolbar-right" style="display: flex; gap: 12px">
              <!-- 체크박스 선택 시 표시되는 버튼들 -->
              <button id="receivableEditSelectedBtn" class="btn btn-warning" onclick="editSelectedAccountsReceivable()"
                style="display: none">
                선택 항목 수정
              </button>
              <button id="receivableDeleteSelectedBtn" class="btn btn-danger"
                onclick="deleteSelectedAccountsReceivable()" style="display: none">
                선택 항목 삭제
              </button>

              <!-- Google Sheets 내보내기 -->
              <button class="btn btn-secondary" onclick="exportAccountsReceivableToCSV()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 미수금 내역 수: <span id="receivableCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- 📋 미수금 목록 테이블 -->
          <table id="accountsReceivableTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="receivableSelectAll" onchange="toggleSelectAllReceivable()" />
                </th>
                <th>순번</th>
                <th>매출처코드</th>
                <th>매출처명</th>
                <th>입금일자</th>
                <th>입금금액</th>
                <th>결제방법</th>
                <th>만기일자</th>
                <th>어음번호</th>
                <th>적요</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <!-- 미수금관리 페이지 끝 -->
      </div>
      <!-- content-area End -->
    </main>
    <!-- main End -->
  </div>
  <!-- dashboard End -->

  <!-- 자재분류 상세보기 모달 -->
  <div id="categoryDetailModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700">자재분류 상세정보</h2>
        <button onclick="closeCategoryDetailModal()"
          style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999">
          ×
        </button>
      </div>

      <div id="categoryDetailContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
        <!-- 상세 정보가 여기에 동적으로 로드됩니다 -->
      </div>

      <div style="margin-top: 24px; display: flex; justify-content: flex-end">
        <button onclick="closeCategoryDetailModal()" class="btn btn-secondary">닫기</button>
      </div>
    </div>
  </div>

  <!-- 자재분류 삭제 확인 모달 -->
  <div id="categoryDeleteModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 500px">
      <!-- 헤더 -->
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #dc3545">
          ⚠ 자재분류 삭제 확인
        </h2>
        <button onclick="closeCategoryDeleteModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          ×
        </button>
      </div>

      <!-- 경고 메시지 -->
      <div style="margin-bottom: 24px">
        <div style="
              background: #fef2f2;
              border-left: 4px solid #dc3545;
              padding: 16px;
              border-radius: 8px;
              margin-bottom: 16px;
            ">
          <p style="margin: 0; font-size: 14px; color: #991b1b; line-height: 1.5">
            다음 자재분류를 삭제하시겠습니까?
          </p>
        </div>

        <div id="categoryDeleteInfo" style="padding: 12px; background: #f8f9fa; border-radius: 8px">
          <!-- 삭제할 분류 정보가 여기에 동적으로 표시됩니다 -->
        </div>
      </div>

      <!-- 액션 버튼 -->
      <div style="display: flex; gap: 8px; justify-content: flex-end">
        <button type="button" onclick="closeCategoryDeleteModal()" style="
              padding: 10px 20px;
              background: #f3f4f6;
              color: #374151;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button id="confirmCategoryDeleteBtn" type="button" onclick="confirmDeleteCategory()" style="
              padding: 10px 20px;
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
            " onmouseover="this.style.background='#c82333';" onmouseout="this.style.background='#dc3545';">
          삭제
        </button>
      </div>
    </div>
  </div>

  <!-- 자재분류 등록/수정 모달 -->
  <div id="categoryModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 500px">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 id="categoryModalTitle" style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
          자재분류 등록
        </h2>
        <button onclick="closeCategoryModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          &times;
        </button>
      </div>

      <form id="categoryForm" onsubmit="event.preventDefault(); saveMaterialCategory();">
        <input type="hidden" id="categoryModalMode" value="create" />

        <div style="margin-bottom: 16px">
          <label style="
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                font-size: 14px;
                color: #374151;
              ">
            분류코드 <span style="color: #dc3545">*</span>
          </label>
          <input type="text" id="category분류코드" class="form-control" placeholder="2자리 코드 입력 (예: 01)" maxlength="2"
            required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
          <small style="color: #6b7280; font-size: 12px">2자리 숫자 또는 문자</small>
        </div>

        <div style="margin-bottom: 16px">
          <label style="
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                font-size: 14px;
                color: #374151;
              ">
            분류명 <span style="color: #dc3545">*</span>
          </label>
          <input type="text" id="category분류명" class="form-control" placeholder="분류명 입력" required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <div style="margin-bottom: 24px">
          <label style="
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                font-size: 14px;
                color: #374151;
              ">
            적요
          </label>
          <textarea id="category적요" class="form-control" placeholder="비고 입력 (선택사항)" rows="3" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
              "></textarea>
        </div>

        <div style="display: flex; gap: 8px; justify-content: flex-end">
          <button type="button" onclick="closeCategoryModal()" style="
                padding: 10px 20px;
                background: #f3f4f6;
                color: #374151;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
            취소
          </button>
          <button type="submit" style="
                padding: 10px 20px;
                background: #2563eb;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
            저장
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- 자재내역 상세보기 모달 -->
  <div id="historyDetailModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700">자재 상세정보</h2>
        <button onclick="closeHistoryDetailModal()"
          style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999">
          ×
        </button>
      </div>

      <div id="historyDetailContent" style="padding: 0">
        <!-- 자재 상세 정보가 여기에 동적으로 로드됩니다 (기본정보, 자재시세, 자재원장, 입출고이력) -->
      </div>

      <div style="margin-top: 24px; display: flex; justify-content: flex-end">
        <button onclick="closeHistoryDetailModal()" class="btn btn-secondary">닫기</button>
      </div>
    </div>
  </div>

  <!-- 자재내역 삭제 확인 모달 -->
  <div id="historyDeleteModal" class="modal" style="display: none">
    <div class="modal-content" style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 500px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        ">
      <!-- 헤더 -->
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #dc3545">
          ⚠ 자재 삭제 확인
        </h2>
        <button onclick="closeHistoryDeleteModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          ×
        </button>
      </div>

      <!-- 경고 메시지 -->
      <div style="margin-bottom: 24px">
        <div style="
              background: #fef2f2;
              border-left: 4px solid #dc3545;
              padding: 16px;
              border-radius: 8px;
              margin-bottom: 16px;
            ">
          <p style="margin: 0; font-size: 14px; color: #991b1b; line-height: 1.5">
            다음 자재를 삭제하시겠습니까?<br />
            (사용구분이 9로 변경됩니다)
          </p>
        </div>

        <div id="historyDeleteInfo" style="padding: 12px; background: #f8f9fa; border-radius: 8px">
          <!-- 삭제할 내역 정보가 여기에 동적으로 표시됩니다 -->
        </div>
      </div>

      <!-- 액션 버튼 -->
      <div style="display: flex; gap: 8px; justify-content: flex-end">
        <button type="button" onclick="closeHistoryDeleteModal()" style="
              padding: 10px 20px;
              background: #f3f4f6;
              color: #374151;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button id="confirmHistoryDeleteBtn" type="button" onclick="confirmDeleteHistory()" style="
              padding: 10px 20px;
              background: #dc3545;
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
            " onmouseover="this.style.background='#c82333';" onmouseout="this.style.background='#dc3545';">
          삭제
        </button>
      </div>
    </div>
  </div>

  <!-- 자재 등록/수정 모달 -->
  <div id="historyModal" class="modal" style="display: none">
    <div class="modal-content" style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        ">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 id="historyModalTitle" style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
          자재 등록
        </h2>
        <button onclick="closeHistoryModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          &times;
        </button>
      </div>

      <form id="historyForm" onsubmit="event.preventDefault();">
        <!-- 분류코드 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            분류코드 <span style="color: #dc3545">*</span>
          </label>
          <input type="text" id="history분류코드" class="form-control" placeholder="분류코드 (2자리)" maxlength="2" required
            style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- 세부코드 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            세부코드 <span style="color: #dc3545">*</span>
          </label>
          <input type="text" id="history세부코드" class="form-control" placeholder="세부코드 (16자리)" maxlength="16" required
            style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- 자재명 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            자재명 <span style="color: #dc3545">*</span>
          </label>
          <input type="text" id="history자재명" class="form-control" placeholder="자재명 입력" maxlength="30" required style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- 규격 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            규격
          </label>
          <input type="text" id="history규격" class="form-control" placeholder="규격 입력" maxlength="30" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- 단위 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            단위
          </label>
          <input type="text" id="history단위" class="form-control" placeholder="단위 입력 (예: EA, 대, 개)" maxlength="20" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- 바코드 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            바코드
          </label>
          <input type="text" id="history바코드" class="form-control" placeholder="바코드 입력 (선택)" maxlength="13" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- 과세구분 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            과세구분
          </label>
          <select id="history과세구분" class="form-control" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              ">
            <option value="1">과세</option>
            <option value="0">면세</option>
          </select>
        </div>

        <!-- 폐기율 -->
        <div style="margin-bottom: 16px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            폐기율 (%)
          </label>
          <input type="number" id="history폐기율" class="form-control" placeholder="폐기율 입력 (선택)" step="0.01" min="0"
            max="100" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- 적요 -->
        <div style="margin-bottom: 24px">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px">
            적요
          </label>
          <textarea id="history적요" class="form-control" placeholder="비고 입력 (선택사항)" rows="3" maxlength="60" style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
              "></textarea>
        </div>

        <div style="display: flex; gap: 8px; justify-content: flex-end">
          <button type="button" onclick="closeHistoryModal()" style="
                padding: 10px 20px;
                background: #f3f4f6;
                color: #374151;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
            취소
          </button>
          <button type="submit" id="saveHistoryBtn" style="
                padding: 10px 20px;
                background: #2563eb;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
            저장
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ✅ 매입전표 상세보기 모달 -->
  <div id="purchaseStatementDetailModal" class="modal hidden">
    <div class="modal-content large" style="max-width: 1000px; max-height: 90vh; overflow-y: auto">
      <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
          매입전표 상세 보기
        </h2>
        <button onclick="closePurchaseStatementDetailModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- ✅ 매입전표 기본 정보 (카드 스타일) -->
      <div style="
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #e5e7eb;
          ">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
          기본 정보
        </h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
          <div style="display: flex; align-items: center">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280">전표번호</span>
            <span id="detailPurchaseStatementNo" style="color: #1f2937; font-weight: 600">-</span>
          </div>
          <div style="display: flex; align-items: center">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280">거래일자</span>
            <span id="detailPurchaseStatementDate" style="color: #1f2937">-</span>
          </div>
          <div style="display: flex; align-items: center">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280">매입처명</span>
            <span id="detailSupplierName" style="color: #1f2937">-</span>
          </div>
          <div style="display: flex; align-items: center">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280">작성자</span>
            <span id="detailPurchaseUserName" style="color: #1f2937">-</span>
          </div>
        </div>
      </div>

      <!-- ✅ 매입전표 상세 목록 -->
      <div>
        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
          매입 품목 내역
        </h3>
        <table id="purchaseStatementDetailTable" class="display" style="width: 100%">
          <thead>
            <tr>
              <th>순번</th>
              <th>품목코드</th>
              <th>품명</th>
              <th>규격</th>
              <th>수량</th>
              <th>단가</th>
              <th>공급가액</th>
              <th>세액</th>
              <th>합계</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr style="background: #f9fafb; font-weight: bold">
              <td colspan="8" style="text-align: right; padding-right: 20px; color: #1f2937">
                합계
              </td>
              <td id="purchaseStatementDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px">
                0
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!-- ✅ 매입전표 작성 모달 -->
  <div id="purchaseStatementCreateModal" class="modal" style="display: none">
    <div class="modal-content" style="
          max-width: 1200px;
          max-height: 90vh;
          overflow-y: auto;
          padding: 32px;
          position: relative;
        ">
      <!-- ✅ 헤더 영역 (드래그 가능) -->
      <div id="purchaseStatementCreateModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
            cursor: move;
            user-select: none;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
          매입전표 작성
        </h2>
        <button onclick="closePurchaseStatementCreateModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
          onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <form id="purchaseStatementCreateForm" onsubmit="submitPurchaseStatementCreate(event)">
        <!-- 기본 정보 섹션 -->
        <div style="
              background: #f9fafb;
              padding: 20px;
              border-radius: 12px;
              margin-bottom: 24px;
              border: 1px solid #e5e7eb;
            ">
          <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
            기본 정보
          </h3>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
            <!-- 거래일자 -->
            <div>
              <label style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 500;
                    font-size: 14px;
                    color: #374151;
                  ">거래일자 *</label>
              <input type="date" id="purchaseStatementCreateDate" required style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                  " />
            </div>

            <!-- 입출고구분 (매입전표는 항상 1=입고) -->
            <input type="hidden" id="purchaseStatementCreateType" value="1" />

            <!-- 매입처 선택 -->
            <div style="grid-column: 1 / -1">
              <label style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 500;
                    font-size: 14px;
                    color: #374151;
                  ">매입처 *</label>
              <div style="display: flex; gap: 8px">
                <input type="text" id="purchaseStatementCreateSupplierCode" readonly style="
                      width: 120px;
                      padding: 12px 16px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f5f5f5;
                    " placeholder="코드" />
                <input type="text" id="purchaseStatementCreateSupplierName" readonly required style="
                      flex: 1;
                      padding: 12px 16px;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                      font-size: 14px;
                      background: #f5f5f5;
                    " placeholder="매입처를 선택하세요" />
                <button type="button" onclick="openPurchaseStatementSupplierSearchModal()" style="
                      padding: 10px 20px;
                      background: #2563eb;
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      white-space: nowrap;
                    " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
                  매입처 검색
                </button>
              </div>
            </div>

            <!-- 적요 -->
            <div style="grid-column: 1 / -1">
              <label style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 500;
                    font-size: 14px;
                    color: #374151;
                  ">적요</label>
              <textarea id="purchaseStatementCreateRemark" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                    resize: vertical;
                    min-height: 80px;
                  " placeholder="비고사항을 입력하세요"></textarea>
            </div>
          </div>
        </div>

        <!-- 상세내역 섹션 -->
        <div style="margin-bottom: 24px">
          <div style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
              ">
            <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
              매입 품목 내역
            </h3>
            <button type="button" onclick="openNewPurchaseStatementDetailAddModal()" style="
                  padding: 8px 16px;
                  background: #10b981;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
              + 자재 추가
            </button>
          </div>

          <!-- 상세내역 테이블 -->
          <div style="overflow-x: auto; border: 1px solid #e5e7eb; border-radius: 8px">
            <table style="width: 100%; border-collapse: collapse">
              <thead style="background: #f9fafb">
                <tr>
                  <th style="
                        padding: 12px;
                        text-align: left;
                        border-bottom: 2px solid #e5e7eb;
                        width: 40px;
                      ">
                    순번
                  </th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                    자재코드
                  </th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                    자재명
                  </th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                    규격
                  </th>
                  <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid #e5e7eb;
                        width: 100px;
                      ">
                    수량
                  </th>
                  <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid #e5e7eb;
                        width: 120px;
                      ">
                    단가
                  </th>
                  <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid #e5e7eb;
                        width: 120px;
                      ">
                    공급가액
                  </th>
                  <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid #e5e7eb;
                        width: 100px;
                      ">
                    부가세
                  </th>
                  <th style="
                        padding: 12px;
                        text-align: center;
                        border-bottom: 2px solid #e5e7eb;
                        width: 120px;
                      ">
                    관리
                  </th>
                </tr>
              </thead>
              <tbody id="purchaseStatementCreateDetailTableBody">
                <tr>
                  <td colspan="10" style="padding: 40px; text-align: center; color: #6b7280">
                    자재 추가 버튼을 클릭하여 매입 상세내역을 입력하세요
                  </td>
                </tr>
              </tbody>
              <tfoot style="background: #f9fafb; font-weight: 600">
                <tr>
                  <td colspan="6" style="
                        padding: 12px;
                        text-align: right;
                        border-top: 2px solid #e5e7eb;
                        color: #1f2937;
                      ">
                    합계
                  </td>
                  <td id="purchaseStatementCreateTotalSupply" style="
                        padding: 12px;
                        text-align: right;
                        border-top: 2px solid #e5e7eb;
                        color: #1f2937;
                      ">
                    0
                  </td>
                  <td id="purchaseStatementCreateTotalVat" style="
                        padding: 12px;
                        text-align: right;
                        border-top: 2px solid #e5e7eb;
                        color: #1f2937;
                      ">
                    0
                  </td>
                  <td colspan="2" style="padding: 12px; border-top: 2px solid #e5e7eb"></td>
                </tr>
                <tr>
                  <td colspan="6" style="padding: 12px; text-align: right; color: #1f2937">
                    총액
                  </td>
                  <td colspan="2" id="purchaseStatementCreateGrandTotal"
                    style="padding: 12px; text-align: right; color: #2563eb; font-size: 16px">
                    0
                  </td>
                  <td colspan="2"></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- 버튼 영역 -->
        <div style="
              display: flex;
              gap: 12px;
              justify-content: flex-end;
              padding-top: 24px;
              border-top: 2px solid #e5e7eb;
            ">
          <button type="button" onclick="closePurchaseStatementCreateModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
            취소
          </button>
          <button type="submit" style="
                padding: 12px 24px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
            매입전표 등록
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ✅ 매입전표 매입처 검색 모달 -->
  <div id="purchaseStatementSupplierSearchModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 800px">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: #1f2937">매입처 검색</h3>
        <button onclick="closePurchaseStatementSupplierSearchModal()" style="
              width: 32px;
              height: 32px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              font-size: 20px;
              color: #6b7280;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          ×
        </button>
      </div>

      <div style="display: flex; gap: 10px; margin-bottom: 16px">
        <input type="text" id="purchaseStatementSupplierSearchInput" placeholder="매입처명 또는 코드 검색"
          onkeypress="if(event.key === 'Enter') searchPurchaseStatementSuppliers()" style="
              flex: 1;
              padding: 12px 16px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            " />
        <button onclick="searchPurchaseStatementSuppliers()" style="
              padding: 10px 20px;
              background: #2563eb;
              color: white;
              border: none;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 500;
            " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
          검색
        </button>
      </div>

      <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px">
        <table style="width: 100%; border-collapse: collapse">
          <thead style="background: #f9fafb; position: sticky; top: 0">
            <tr>
              <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                코드
              </th>
              <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                매입처명
              </th>
              <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb">
                전화번호
              </th>
              <th style="padding: 12px; text-align: center; border-bottom: 2px solid #e5e7eb">
                선택
              </th>
            </tr>
          </thead>
          <tbody id="purchaseStatementSupplierSearchTableBody">
            <tr>
              <td colspan="4" style="padding: 40px; text-align: center; color: #6b7280">
                검색 버튼을 클릭하여 매입처를 검색하세요
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ✅ 매입전표 작성 - 자재 추가 모달 -->
  <div id="purchaseStatementMaterialSearchModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 600px">
      <!-- ✅ 헤더 영역 (드래그 가능) -->
      <div id="purchaseStatementMaterialSearchModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
            cursor: move;
            user-select: none;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 추가</h2>
        <button onclick="closePurchaseStatementMaterialSearchModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px">
        <!-- ✅ 자재 검색 영역 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
          <div style="display: flex; gap: 8px">
            <input type="text" id="purchaseStatementMaterialSearchInput" style="
                  flex: 1;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="자재명 또는 품목코드로 검색"
              onkeypress="if(event.key === 'Enter') searchPurchaseStatementMaterials()" />
            <button onclick="searchPurchaseStatementMaterials()" style="
                  padding: 10px 20px;
                  background: #3b82f6;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: white;
                  transition: all 0.2s;
                  white-space: nowrap;
                " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
              검색
            </button>
          </div>
        </div>

        <!-- ✅ 검색 결과 테이블 (3컬럼, 클릭 가능) -->
        <div id="purchaseStatementMaterialSearchResults" style="display: none">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과</label>
          <div style="
                max-height: 300px;
                overflow-y: auto;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
              ">
            <table id="purchaseStatementMaterialSearchTable" style="width: 100%; border-collapse: collapse">
              <thead style="background: #f9fafb; position: sticky; top: 0">
                <tr>
                  <th style="
                        padding: 10px 12px;
                        text-align: left;
                        border-bottom: 2px solid #e5e7eb;
                        font-weight: 600;
                        font-size: 13px;
                        color: #374151;
                      ">
                    품목코드
                  </th>
                  <th style="
                        padding: 10px 12px;
                        text-align: left;
                        border-bottom: 2px solid #e5e7eb;
                        font-weight: 600;
                        font-size: 13px;
                        color: #374151;
                      ">
                    품명
                  </th>
                  <th style="
                        padding: 10px 12px;
                        text-align: left;
                        border-bottom: 2px solid #e5e7eb;
                        font-weight: 600;
                        font-size: 13px;
                        color: #374151;
                      ">
                    규격
                  </th>
                  <th style="
                        padding: 10px 12px;
                        text-align: center;
                        border-bottom: 2px solid #e5e7eb;
                        font-weight: 600;
                        font-size: 13px;
                        color: #374151;
                        width: 80px;
                      ">
                    선택
                  </th>
                </tr>
              </thead>
              <tbody id="purchaseStatementMaterialSearchTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- ✅ 선택된 자재 표시 (파란색 카드) -->
        <div id="purchaseStatementSelectedMaterialInfo" style="
              display: none;
              background: #f0f9ff;
              padding: 12px;
              border-radius: 8px;
              border: 2px solid #bfdbfe;
            ">
          <div style="
                display: flex;
                justify-content: space-between;
                align-items: start;
                margin-bottom: 4px;
              ">
            <div>
              <div style="font-weight: 600; color: #1e40af; font-size: 15px" id="purchaseStatementSelectedMaterialName">
                -
              </div>
              <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="purchaseStatementSelectedMaterialCode">
                -
              </div>
            </div>
            <button onclick="clearSelectedPurchaseStatementMaterial()" style="
                  padding: 4px 12px;
                  background: white;
                  border: 1px solid #bfdbfe;
                  border-radius: 4px;
                  font-size: 12px;
                  cursor: pointer;
                  color: #2563eb;
                  font-weight: 500;
                " onmouseover="this.style.background='#eff6ff';" onmouseout="this.style.background='white';">
              취소
            </button>
          </div>
        </div>

        <!-- ✅ 수량 입력 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량 *</label>
          <input type="number" id="purchaseStatementAddDetailQuantity" value="1" min="0" step="0.01"
            oninput="calculatePurchaseStatementDetailAmount()" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- ✅ 단가 입력 + 이전단가 버튼 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">입고단가 (원) *</label>
          <div style="display: flex; gap: 8px; align-items: center">
            <input type="number" id="purchaseStatementAddDetailPrice" value="0" min="0" step="1"
              oninput="calculatePurchaseStatementDetailAmount()" style="
                  flex: 1;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " />
            <button onclick="showPurchaseStatementPriceHistory()" style="
                  padding: 10px 20px;
                  background: #9333ea;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: white;
                  transition: all 0.2s;
                  white-space: nowrap;
                " onmouseover="this.style.background='#7e22ce';" onmouseout="this.style.background='#9333ea';">
              이전 단가
            </button>
          </div>
        </div>

        <!-- ✅ 공급가액 표시 (읽기 전용) -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">공급가액 (원)</label>
          <input type="text" id="purchaseStatementAddDetailAmount" readonly value="0" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                background: #f9fafb;
                color: #1f2937;
                font-weight: 600;
              " />
        </div>
      </div>

      <!-- ✅ 버튼 영역 -->
      <div style="
            display: flex;
            gap: 10px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
          ">
        <button type="button" onclick="closePurchaseStatementMaterialSearchModal()" style="
              flex: 1;
              padding: 12px 20px;
              background: #f3f4f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: #374151;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button type="button" onclick="confirmPurchaseStatementDetailAdd()" style="
              flex: 1;
              padding: 12px 20px;
              background: #2563eb;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
          추가하기
        </button>
      </div>
    </div>
  </div>

  <!-- ✅ 매입전표 작성 - 품목 수정 모달 -->
  <div id="newPurchaseStatementDetailEditModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 500px">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 수정</h2>
        <button onclick="closeNewPurchaseStatementDetailEditModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px">
        <!-- ✅ 자재 정보 표시 (읽기 전용, 파란색 카드) -->
        <div style="
              background: #f0f9ff;
              padding: 12px;
              border-radius: 8px;
              border: 2px solid #bfdbfe;
            ">
          <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px">
            선택된 자재
          </div>
          <div style="font-weight: 600; color: #1e40af; font-size: 15px" id="newPurchaseStatementEditMaterialName">
            -
          </div>
          <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="newPurchaseStatementEditMaterialCode">
            -
          </div>
        </div>

        <!-- ✅ 수량 수정 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량 *</label>
          <input type="number" id="newPurchaseStatementEditDetailQuantity" value="1" min="0" step="0.01"
            oninput="calculateNewPurchaseStatementEditDetailAmount()" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- ✅ 단가 수정 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">단가 (원) *</label>
          <input type="number" id="newPurchaseStatementEditDetailPrice" value="0" min="0" step="1"
            oninput="calculateNewPurchaseStatementEditDetailAmount()" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <!-- ✅ 공급가액 표시 (읽기 전용) -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">공급가액 (원)</label>
          <input type="text" id="newPurchaseStatementEditDetailAmount" readonly value="0" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                background: #f9fafb;
                color: #1f2937;
                font-weight: 600;
              " />
        </div>
      </div>

      <!-- ✅ 버튼 영역 -->
      <div style="
            display: flex;
            gap: 10px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
          ">
        <button type="button" onclick="closeNewPurchaseStatementDetailEditModal()" style="
              flex: 1;
              padding: 12px 20px;
              background: #f3f4f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: #374151;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button type="button" onclick="confirmNewPurchaseStatementDetailEdit()" style="
              flex: 1;
              padding: 12px 20px;
              background: #2563eb;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
          수정 완료
        </button>
      </div>
    </div>
  </div>

  <!-- ✅ 매입전표 수정 모달 -->
  <div id="purchaseStatementEditModal" class="modal" style="display: none">
    <div id="purchaseStatementEditModalContent" class="modal-content large"
      style="max-width: 1200px; max-height: 90vh; overflow-y: auto; padding: 32px">
      <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
      <div id="purchaseStatementEditModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
            cursor: move;
            user-select: none;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">
          매입전표 수정
        </h2>
        <button onclick="closePurchaseStatementEditModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- ✅ 매입전표 기본 정보 (카드 스타일) -->
      <div style="
            background: #f9fafb;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #e5e7eb;
          ">
        <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
          기본 정보
        </h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
          <div style="display: flex; align-items: center">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280">전표번호</span>
            <span id="editPurchaseStatementNo" style="color: #1f2937; font-weight: 600">-</span>
          </div>
          <div style="display: flex; align-items: center">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280">거래일자</span>
            <span id="editPurchaseStatementDate" style="color: #1f2937">-</span>
          </div>
          <div style="display: flex; align-items: center">
            <span style="min-width: 100px; font-weight: 500; color: #6b7280">매입처명</span>
            <span id="editPurchaseStatementSupplier" style="color: #1f2937">-</span>
          </div>
          <!-- 입출고구분 (매입전표는 항상 1=입고, hidden) -->
          <input type="hidden" id="editPurchaseStatementStatus" value="1" />
        </div>
      </div>

      <!-- ✅ 매입전표 상세 목록 -->
      <div>
        <div style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 16px;
            ">
          <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
            매입 품목 내역
          </h3>
          <div style="display: flex; gap: 8px">
            <button type="button" onclick="addPurchaseStatementDetailRow()" style="
                  padding: 8px 16px;
                  background: #10b981;
                  border: none;
                  border-radius: 6px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: white;
                  transition: all 0.2s;
                " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
              + 자재 추가
            </button>
          </div>
        </div>

        <table id="purchaseStatementEditDetailTable" class="display" style="width: 100%">
          <thead>
            <tr>
              <th style="width: 50px">순번</th>
              <th>품목코드</th>
              <th>품명</th>
              <th>규격</th>
              <th>수량</th>
              <th>단가</th>
              <th>공급가액</th>
              <th>세액</th>
              <th>합계</th>
              <th style="width: 120px">관리</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr style="background: #f9fafb; font-weight: bold">
              <td colspan="9" style="text-align: right; padding-right: 20px; color: #1f2937">
                합계
              </td>
              <td id="purchaseStatementEditDetailTotal" style="text-align: right; color: #2563eb; font-size: 16px">
                0
              </td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- ✅ 버튼 영역 -->
      <div style="
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #e5e7eb;
          ">
        <button type="button" onclick="closePurchaseStatementEditModal()" style="
              padding: 12px 24px;
              background: #f3f4f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: #374151;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button type="button" onclick="submitPurchaseStatementEdit()" style="
              padding: 12px 24px;
              background: #2563eb;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
          수정 완료
        </button>
      </div>
    </div>
  </div>

  <!-- ✅ 매입전표 수정 - 자재 추가 모달 -->
  <div id="purchaseStatementDetailAddModal" class="modal" style="display: none">
    <div id="purchaseStatementDetailAddModalContent" class="modal-content" style="max-width: 600px">
      <div id="purchaseStatementDetailAddModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 추가</h2>
        <button onclick="closePurchaseStatementDetailAddModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px">
        <!-- ✅ 자재 검색 영역 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
          <div style="display: flex; gap: 8px">
            <input type="text" id="purchaseStatementEditMaterialSearchInput" style="
                  flex: 1;
                  padding: 10px 12px;
                  border: 2px solid #e5e7eb;
                  border-radius: 8px;
                  font-size: 14px;
                " placeholder="자재명 또는 품목코드로 검색"
              onkeypress="if(event.key === 'Enter') searchPurchaseStatementEditMaterials()" />
            <button onclick="searchPurchaseStatementEditMaterials()" style="
                  padding: 10px 20px;
                  background: #3b82f6;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: white;
                  transition: all 0.2s;
                  white-space: nowrap;
                " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
              검색
            </button>
          </div>
        </div>

        <!-- ✅ 검색 결과 테이블 -->
        <div id="purchaseStatementEditMaterialSearchResults" style="display: none">
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과</label>
          <div style="
                max-height: 300px;
                overflow-y: auto;
                border: 1px solid #e5e7eb;
                border-radius: 8px;
              ">
            <table id="purchaseStatementEditMaterialSearchTable" style="width: 100%; border-collapse: collapse">
              <thead style="background: #f9fafb; position: sticky; top: 0">
                <tr>
                  <th style="
                        padding: 8px;
                        text-align: left;
                        border-bottom: 1px solid #e5e7eb;
                        font-size: 13px;
                      ">
                    품목코드
                  </th>
                  <th style="
                        padding: 8px;
                        text-align: left;
                        border-bottom: 1px solid #e5e7eb;
                        font-size: 13px;
                      ">
                    품명
                  </th>
                  <th style="
                        padding: 8px;
                        text-align: left;
                        border-bottom: 1px solid #e5e7eb;
                        font-size: 13px;
                      ">
                    규격
                  </th>
                </tr>
              </thead>
              <tbody id="purchaseStatementEditMaterialSearchTableBody"></tbody>
            </table>
          </div>
        </div>

        <!-- ✅ 선택된 자재 정보 -->
        <div id="purchaseStatementEditSelectedMaterialInfo" style="
              display: none;
              background: #f0f9ff;
              padding: 12px;
              border-radius: 8px;
              border: 2px solid #bfdbfe;
            ">
          <div style="display: flex; justify-content: space-between; align-items: center">
            <div>
              <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px">
                선택된 자재
              </div>
              <div style="font-weight: 600; color: #1e40af" id="purchaseStatementEditSelectedMaterialName">
                -
              </div>
              <div style="font-size: 12px; color: #6b7280; margin-top: 2px"
                id="purchaseStatementEditSelectedMaterialCode">
                -
              </div>
            </div>
            <button onclick="clearSelectedPurchaseStatementEditMaterial()" style="
                  padding: 6px 12px;
                  background: #ef4444;
                  border: none;
                  border-radius: 6px;
                  font-size: 12px;
                  font-weight: 500;
                  cursor: pointer;
                  color: white;
                ">
              취소
            </button>
          </div>
        </div>

        <!-- ✅ 수량/단가 입력 -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
          <input type="number" id="purchaseStatementEditDetailQuantity" min="1" value="1"
            oninput="calculatePurchaseStatementEditDetailAmount()" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">단가</label>
          <input type="number" id="purchaseStatementEditDetailPrice" min="0" value="0"
            oninput="calculatePurchaseStatementEditDetailAmount()" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">공급가액</label>
          <input type="text" id="purchaseStatementEditDetailAmount" readonly value="0" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                background: #f9fafb;
              " />
        </div>

        <!-- ✅ 버튼 영역 -->
        <div style="display: flex; gap: 8px; margin-top: 8px">
          <button type="button" onclick="closePurchaseStatementDetailAddModal()" style="
                flex: 1;
                padding: 12px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
              ">
            취소
          </button>
          <button type="button" onclick="confirmPurchaseStatementEditDetailAdd()" style="
                flex: 1;
                padding: 12px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
              ">
            추가
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ 매입전표 수정 - 품목 수정 모달 -->
  <div id="purchaseStatementDetailEditModal" class="modal" style="display: none">
    <div id="purchaseStatementDetailEditModalContent" class="modal-content" style="max-width: 500px">
      <div id="purchaseStatementDetailEditModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
            cursor: move;
            user-select: none;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 수정</h2>
        <button onclick="closePurchaseStatementDetailEditModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="display: flex; flex-direction: column; gap: 16px">
        <!-- 자재 정보 (읽기 전용) -->
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">품목명</label>
          <input type="text" id="purchaseStatementEditItemName" readonly style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                background: #f9fafb;
              " />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
          <input type="number" id="purchaseStatementEditItemQuantity" min="1"
            oninput="calculatePurchaseStatementEditItemAmount()" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">단가</label>
          <input type="number" id="purchaseStatementEditItemPrice" min="0"
            oninput="calculatePurchaseStatementEditItemAmount()" style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
              " />
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">공급가액</label>
          <input type="text" id="purchaseStatementEditItemAmount" readonly style="
                width: 100%;
                padding: 10px 12px;
                border: 2px solid #e5e7eb;
                border-radius: 8px;
                font-size: 14px;
                background: #f9fafb;
              " />
        </div>

        <!-- 버튼 영역 -->
        <div style="display: flex; gap: 8px; margin-top: 8px">
          <button type="button" onclick="closePurchaseStatementDetailEditModal()" style="
                flex: 1;
                padding: 12px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
              ">
            취소
          </button>
          <button type="button" onclick="confirmPurchaseStatementDetailEdit()" style="
                flex: 1;
                padding: 12px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
              ">
            수정
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ✅ 매입전표 삭제 확인 모달 -->
  <div id="purchaseStatementDeleteModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      ">
    <div style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 400px;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        ">
      <!-- 아이콘 -->
      <div style="text-align: center; margin-bottom: 20px">
        <div style="
              width: 64px;
              height: 64px;
              background: #fee2e2;
              border-radius: 50%;
              display: inline-flex;
              align-items: center;
              justify-content: center;
              margin-bottom: 16px;
            ">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#dc2626" stroke-width="2">
            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6" />
          </svg>
        </div>
        <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 700; color: #1f2937">
          매입전표 삭제
        </h2>
        <p id="purchaseStatementDeleteInfo" style="margin: 0 0 8px 0; color: #6b7280; font-size: 14px">
          전표번호: -
        </p>
        <p style="margin: 0; color: #dc2626; font-size: 14px; font-weight: 500">
          정말로 이 매입전표를 삭제하시겠습니까?
        </p>
        <p style="margin: 8px 0 0 0; color: #6b7280; font-size: 12px">
          삭제된 전표는 복구할 수 없습니다.
        </p>
      </div>

      <!-- 버튼 -->
      <div style="display: flex; gap: 12px">
        <button onclick="closePurchaseStatementDeleteModal()" style="
              flex: 1;
              padding: 12px;
              border: 2px solid #e5e7eb;
              background: white;
              color: #374151;
              border-radius: 8px;
              font-size: 15px;
              font-weight: 600;
              cursor: pointer;
              transition: all 0.2s;
            " onmouseover="this.style.background='#f9fafb'; this.style.borderColor='#d1d5db';"
          onmouseout="this.style.background='white'; this.style.borderColor='#e5e7eb';">
          취소
        </button>
        <button onclick="confirmPurchaseStatementDelete()" style="
              flex: 1;
              padding: 12px;
              border: none;
              background: #dc2626;
              color: white;
              border-radius: 8px;
              font-size: 15px;
              font-weight: 600;
              cursor: pointer;
              transition: all 0.2s;
            " onmouseover="this.style.background='#b91c1c';" onmouseout="this.style.background='#dc2626';">
          삭제
        </button>
      </div>
    </div>
  </div>

  <!-- 작업일자 변경 모달 -->
  <div id="dateChangeModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 400px">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
          작업일자 변경
        </h2>
        <button onclick="closeDateChangeModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="margin-bottom: 24px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">작업일자 선택</label>
        <input type="date" id="newWorkingDate" style="
              width: 100%;
              padding: 12px 16px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " />
        <p style="font-size: 12px; color: #6b7280; margin-top: 8px">
          선택한 날짜가 모든 문서 작성 시 기본 날짜로 사용됩니다.
        </p>
      </div>

      <div style="display: flex; gap: 10px; justify-content: flex-end">
        <button type="button" onclick="closeDateChangeModal()" style="
              padding: 12px 24px;
              background: #f3f4f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: #374151;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button type="button" onclick="confirmDateChange()" style="
              padding: 12px 24px;
              background: #2563eb;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
          변경
        </button>
      </div>
    </div>
  </div>

  <script>
    // 모달을 body 직속으로 이동 (dashboard CSS 영향 회피)
    document.addEventListener('DOMContentLoaded', function () {
      // 로그인 날짜 자동 설정 (함수 호출)
      if (typeof setLoginDateToToday === 'function') {
        setLoginDateToToday();
      }

      const customerSearchModal = document.getElementById('customerSearchModal');
      const supplierModal = document.getElementById('supplierModal');

      if (customerSearchModal && customerSearchModal.parentElement !== document.body) {
        document.body.appendChild(customerSearchModal);
        console.log('✅ 매출처 검색 모달을 body로 이동 완료');
      }

      if (supplierModal && supplierModal.parentElement !== document.body) {
        document.body.appendChild(supplierModal);
        console.log('✅ 매입처 모달을 body로 이동 완료');
      }
    });

    // API 기본 URL
    // 포트 3000에서 접속한 경우: 같은 origin 사용
    // 다른 포트(8000 등)에서 접속한 경우: localhost:3000 사용
    const API_BASE_URL =
      window.location.port === '3000'
        ? `${window.location.origin}/api`
        : 'http://localhost:3000/api';

    // 현재 로그인 사용자 정보 (이미 위에 선언됨)
    // let currentUser = null;

    let currentCustomerPage = 1;
    let customerPageSizeSelected = 10;
    let customerPageSizeEffective = 10;

    let currentSupplierPage = 1;
    let supplierPageSizeSelected = 10;
    let supplierPageSizeEffective = 10;

    function getCustomerEffectivePageSize() {
      // 셀렉터 선택값을 그대로 사용 (화면 높이로 제한하지 않음)
      const select = document.getElementById('customerPageSizeSelect');
      const selected = Number(select?.value || customerPageSizeSelected || 10);
      customerPageSizeSelected = selected;
      customerPageSizeEffective = selected;
      return selected;
    }

    function getSupplierEffectivePageSize() {
      const select = document.getElementById('supplierPageSizeSelect');
      const selected = Number(select?.value || supplierPageSizeSelected || 10);
      supplierPageSizeSelected = selected;
      supplierPageSizeEffective = selected;
      return selected;
    }

    function debounce(fn, wait = 200) {
      let t;
      return (...args) => {
        clearTimeout(t);
        t = setTimeout(() => fn(...args), wait);
      };
    }

    document.addEventListener('DOMContentLoaded', () => {
      // 주입식 페이지 사이즈 선택 박스 생성
      const toolbarLeft = document.querySelector('#customerPage .toolbar .toolbar-left');
      if (toolbarLeft && !document.getElementById('customerPageSizeSelect')) {
        const sel = document.createElement('select');
        sel.id = 'customerPageSizeSelect';
        sel.className = 'form-control';
        sel.style.width = '120px';
        sel.style.marginLeft = '8px';
        [10, 15, 20, 25, 50].forEach((n) => {
          const opt = document.createElement('option');
          opt.value = String(n);
          opt.textContent = n + '개';
          if (n === 10) opt.selected = true;
          sel.appendChild(opt);
        });
        toolbarLeft.appendChild(sel);
        // ❌ 주석: customer.js의 DataTable이 자동으로 페이지 사이즈 관리
        // sel.addEventListener('change', () => loadCustomers(1));
      }

      const supplierToolbarLeft = document.querySelector('#supplierPage .toolbar .toolbar-left');
      if (supplierToolbarLeft && !document.getElementById('supplierPageSizeSelect')) {
        const sel = document.createElement('select');
        sel.id = 'supplierPageSizeSelect';
        sel.className = 'form-control';
        sel.style.width = '120px';
        sel.style.marginLeft = '8px';
        [10, 15, 20, 25, 50].forEach((n) => {
          const opt = document.createElement('option');
          opt.value = String(n);
          opt.textContent = n + '개';
          if (n === 10) opt.selected = true;
          sel.appendChild(opt);
        });
        supplierToolbarLeft.appendChild(sel);
        sel.addEventListener('change', () => loadSuppliers(1));
      }

      window.addEventListener(
        'resize',
        debounce(() => {
          const customerActive = document
            .getElementById('customerPage')
            ?.classList.contains('active');
          // ❌ 주석: customer.js의 DataTable이 자동으로 리사이즈 처리
          // if (customerActive) loadCustomers(currentCustomerPage);

          const supplierActive = document
            .getElementById('supplierPage')
            ?.classList.contains('active');
          if (supplierActive) loadSuppliers(currentSupplierPage);
        }, 200),
      );
    });

    // API 호출 헬퍼 함수
    async function apiCall(endpoint, method = 'GET', data = null) {
      try {
        let url = `${API_BASE_URL}${endpoint}`;
        const options = {
          method,
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include', // 세션 쿠키 포함
        };

        // ✅ GET 요청일 때: data를 쿼리스트링으로 변환
        if (method.toUpperCase() === 'GET' && data && typeof data === 'object') {
          const queryString = new URLSearchParams(data).toString();
          if (queryString) url += (url.includes('?') ? '&' : '?') + queryString;
        }
        // ✅ POST/PUT/DELETE 요청일 때: body에 JSON으로 추가
        else if (data) {
          options.body = JSON.stringify(data);
        }

        const response = await fetch(url, options);
        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.message || '서버 오류');
        }

        return result;
      } catch (error) {
        console.error('API 호출 에러:', error);
        throw error;
      }
    }

    function openLoginDatePicker() {
      const input = document.getElementById('loginDatePicker');
      if (!input) return;

      if (typeof input.showPicker === 'function') {
        input.showPicker();
      } else {
        input.focus();
      }
    }

    const loginDateTextInput = document.getElementById('loginDateText');
    const loginDatePickerInput = document.getElementById('loginDatePicker');

    if (loginDatePickerInput && loginDateTextInput) {
      loginDatePickerInput.addEventListener('change', () => {
        loginDateTextInput.value = loginDatePickerInput.value;
      });
    }

    // 페이지 로드 시 사업장 목록 로드 (로그인 페이지)
    async function loadWorkplaceInfo() {
      try {
        const result = await apiCall('/workplaces', 'GET');
        const workplaceSelect = document.getElementById('workplaceCode');
        const workplaceNameDisplay = document.getElementById('workplaceNameLogin');

        if (result.success && result.data && result.data.length > 0) {
          // 사업장 목록을 select box에 추가
          result.data.forEach((workplace) => {
            const option = document.createElement('option');
            option.value = workplace.사업장코드;
            option.textContent = `${workplace.사업장코드} - ${workplace.사업장명}`;
            workplaceSelect.appendChild(option);
          });

          // 첫 번째 사업장을 기본으로 선택하고 표시
          if (result.data[0]) {
            workplaceSelect.value = result.data[0].사업장코드;
            workplaceNameDisplay.textContent = result.data[0].사업장명;
          }

          // 사업장 선택 시 상단 표시 업데이트
          workplaceSelect.addEventListener('change', function () {
            const selectedWorkplace = result.data.find((w) => w.사업장코드 === this.value);
            if (selectedWorkplace) {
              workplaceNameDisplay.textContent = selectedWorkplace.사업장명;
            }
          });
        } else {
          workplaceNameDisplay.textContent = '사업장 정보 없음';
        }
      } catch (error) {
        console.error('사업장 정보 로드 실패:', error);
        document.getElementById('workplaceNameLogin').textContent = '사업장 로드 실패';
      }
    }

    // 페이지 로드 시 사업장 목록 로드
    loadWorkplaceInfo();

    // Top-bar 스크롤 효과
    const mainContent = document.querySelector('.main-content');
    const topBar = document.querySelector('.top-bar');

    if (mainContent && topBar) {
      mainContent.addEventListener('scroll', function () {
        if (mainContent.scrollTop > 50) {
          topBar.classList.add('scrolled');
        } else {
          topBar.classList.remove('scrolled');
        }
      });
    }

    // 로그인 처리
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const workplaceCode = document.getElementById('workplaceCode').value;
      const userId = document.getElementById('userId').value;
      const password = document.getElementById('password').value;
      const loginDateTextValue = loginDateTextInput.value.trim();
      const loginDatePickerValue = loginDatePickerInput.value;
      const loginDate = loginDatePickerValue || loginDateTextValue;
      const messageEl = document.getElementById('loginMessage');

      if (!workplaceCode) {
        messageEl.textContent = '사업장을 선택해 주세요.';
        messageEl.classList.add('error');
        messageEl.classList.add('show');
        document.getElementById('workplaceCode').focus();
        return;
      }

      if (!loginDate) {
        messageEl.textContent = '접속일자를 입력하거나 선택해 주세요.';
        messageEl.classList.add('error');
        messageEl.classList.add('show');
        loginDateTextInput.focus();
        return;
      }

      if (loginDatePickerValue && loginDateTextValue !== loginDatePickerValue) {
        loginDateTextInput.value = loginDatePickerValue;
      }

      try {
        messageEl.textContent = '로그인 중...';
        messageEl.classList.remove('error');
        messageEl.classList.add('show');

        // 서버는 사용자 테이블의 사업장코드를 사용
        const result = await apiCall('/auth/login', 'POST', {
          userId: userId,
          password: password,
          loginDate: loginDate,
        });

        if (result.success) {
          // 서버에서 반환된 사용자의 사업장코드와 선택한 사업장코드 비교
          if (result.data.사업장코드 !== workplaceCode) {
            messageEl.textContent = `선택한 사업장이 일치하지 않습니다. 이 사용자는 "${result.data.사업장명}" 사업장에 속해 있습니다.`;
            messageEl.classList.add('error');
            messageEl.classList.add('show');

            // 올바른 사업장을 자동으로 선택
            document.getElementById('workplaceCode').value = result.data.사업장코드;

            return;
          }

          currentUser = result.data;

          // 작업일자 localStorage에 저장
          localStorage.setItem('workingDate', loginDate);

          messageEl.textContent = result.message;

          setTimeout(() => {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';

            document.getElementById('userName').textContent = currentUser.사용자명;
            document.getElementById('userAvatar').textContent = currentUser.사용자명.charAt(0);

            // 사이드바에 사업장명 표시
            if (currentUser.사업장명) {
              document.getElementById('workplaceNameSidebar').textContent = currentUser.사업장명;
            }

            // 작업일자 표시
            updateWorkingDateDisplay(loginDate);

            // 대시보드 통계 로드
            loadDashboardStats();
          }, 800);
        }
      } catch (error) {
        messageEl.textContent = '로그인 실패: ' + error.message;
        messageEl.classList.add('error');
        messageEl.classList.add('show');
      }
    });

    // 대시보드 통계 로드
    async function loadDashboardStats() {
      try {
        const result = await apiCall(`/dashboard/stats?사업장코드=${currentUser.사업장코드}`);

        if (result.success) {
          const stats = result.data;
          const statCards = document.querySelectorAll('.stat-card');

          statCards[0].querySelector('.stat-value').textContent =
            '₩' + Number(stats.todaySales).toLocaleString();
          statCards[0].querySelector('.stat-change').textContent = '전일 대비';

          statCards[1].querySelector('.stat-value').textContent =
            '₩' + Number(stats.monthlySales).toLocaleString();
          statCards[1].querySelector('.stat-change').textContent = '전월 대비';

          statCards[2].querySelector('.stat-value').textContent =
            '₩' + Number(stats.unpaidAmount).toLocaleString();
          statCards[2].querySelector('.stat-change').textContent = '미수금 현황';

          // 재고 현황 주석처리
          // statCards[3].querySelector('.stat-value').textContent =
          //   Number(stats.inventoryCount).toLocaleString() + '건';
          // statCards[3].querySelector('.stat-change').textContent = '재고 품목';
        }

        // 오늘의 문서 리스트 로드
        await loadTodayDocuments();
      } catch (error) {
        console.error('통계 로드 실패:', error);
      }
    }

    // 오늘의 문서 리스트 로드
    async function loadTodayDocuments() {
      const today = new Date().toISOString().slice(0, 10).replace(/-/g, ''); // YYYYMMDD

      try {
        // 1. 오늘의 견적서
        await loadTodayQuotations(today);

        // 2. 오늘의 발주서
        await loadTodayOrders(today);

        // 3. 오늘의 거래명세서
        await loadTodayTransactions(today);
      } catch (error) {
        console.error('오늘의 문서 로드 실패:', error);
      }
    }

    // 오늘의 견적서 로드
    async function loadTodayQuotations(today) {
      try {
        const result = await apiCall(`/quotations?startDate=${today}&endDate=${today}`);
        const countEl = document.getElementById('todayQuotationCount');

        // 기존 DataTable 파괴
        if (window.todayQuotationTableInstance) {
          window.todayQuotationTableInstance.destroy();
        }

        const tableData = result.success && result.data ? result.data : [];
        countEl.textContent = `${tableData.length}건`;

        // DataTable 초기화
        window.todayQuotationTableInstance = $('#todayQuotationTable').DataTable({
          data: tableData,
          columns: [
            {
              data: '견적번호',
              defaultContent: '-',
              render: (data) => data || '-',
            },
            {
              data: '매출처명',
              defaultContent: '-',
              render: (data) => {
                if (!data) return '-';
                if (data.length > 9) {
                  return `<span title="${data}">${data.substring(0, 9)}...</span>`;
                }
                return data;
              },
            },
            {
              data: '합계금액',
              defaultContent: '0',
              render: (data) => formatCurrency(data || 0),
              className: 'dt-right',
            },
          ],
          language: {
            emptyTable: '오늘 등록된 견적서가 없습니다.',
            search: '검색:',
            lengthMenu: '페이지당 _MENU_ 개',
            info: '_START_-_END_ / 총 _TOTAL_건',
            paginate: { previous: '이전', next: '다음' },
          },
          order: [[0, 'desc']], // 견적번호 내림차순
          paging: true,
          pageLength: 10,
          searching: false,
          lengthChange: false,
          info: false,
          responsive: true,
          autoWidth: false,
          scrollY: '320px',
          scrollCollapse: true,
        });

        // 행 클릭 이벤트
        $('#todayQuotationTable tbody').on('click', 'tr', function () {
          showPage('quotation');
        });
      } catch (error) {
        console.error('견적서 로드 실패:', error);
        document.getElementById('todayQuotationCount').textContent = '0건';
      }
    }

    // 오늘의 발주서 로드
    async function loadTodayOrders(today) {
      try {
        const result = await apiCall(`/orders?orderStartDate=${today}&orderEndDate=${today}`);
        const countEl = document.getElementById('todayOrderCount');

        // 기존 DataTable 파괴
        if (window.todayOrderTableInstance) {
          window.todayOrderTableInstance.destroy();
        }

        const tableData = result.success && result.data ? result.data : [];
        countEl.textContent = `${tableData.length}건`;

        // DataTable 초기화
        window.todayOrderTableInstance = $('#todayOrderTable').DataTable({
          data: tableData,
          columns: [
            {
              data: '발주번호',
              defaultContent: '-',
              render: (data) => data || '-',
            },
            {
              data: '매입처명',
              defaultContent: '-',
              render: (data) => {
                if (!data) return '-';
                if (data.length > 9) {
                  return `<span title="${data}">${data.substring(0, 9)}...</span>`;
                }
                return data;
              },
            },
            {
              data: '합계금액',
              defaultContent: '0',
              render: (data) => formatCurrency(data || 0),
              className: 'dt-right',
            },
          ],
          language: {
            emptyTable: '오늘 등록된 발주서가 없습니다.',
            search: '검색:',
            lengthMenu: '페이지당 _MENU_ 개',
            info: '_START_-_END_ / 총 _TOTAL_건',
            paginate: { previous: '이전', next: '다음' },
          },
          order: [[0, 'desc']], // 발주번호 내림차순
          paging: true,
          pageLength: 10,
          searching: false,
          lengthChange: false,
          info: false,
          responsive: true,
          autoWidth: false,
          scrollY: '320px',
          scrollCollapse: true,
        });

        // 행 클릭 이벤트
        $('#todayOrderTable tbody').on('click', 'tr', function () {
          showPage('order');
        });
      } catch (error) {
        console.error('발주서 로드 실패:', error);
        document.getElementById('todayOrderCount').textContent = '0건';
      }
    }

    // 오늘의 거래명세서 로드
    async function loadTodayTransactions(today) {
      try {
        const result = await apiCall(`/transactions?startDate=${today}&endDate=${today}`);
        const countEl = document.getElementById('todayTransactionCount');

        // 기존 DataTable 파괴
        if (window.todayTransactionTableInstance) {
          window.todayTransactionTableInstance.destroy();
        }

        const tableData = result.success && result.data ? result.data : [];
        countEl.textContent = `${tableData.length}건`;

        // DataTable 초기화
        window.todayTransactionTableInstance = $('#todayTransactionTable').DataTable({
          data: tableData,
          columns: [
            {
              data: '거래번호',
              defaultContent: '-',
              render: (data) => data || '-',
            },
            {
              data: '매출처명',
              defaultContent: '-',
              render: (data) => {
                if (!data) return '-';
                if (data.length > 9) {
                  return `<span title="${data}">${data.substring(0, 9)}...</span>`;
                }
                return data;
              },
            },
            {
              data: '합계금액',
              defaultContent: '0',
              render: (data) => formatCurrency(data || 0),
              className: 'dt-right',
            },
          ],
          language: {
            emptyTable: '오늘 등록된 거래명세서가 없습니다.',
            search: '검색:',
            lengthMenu: '페이지당 _MENU_ 개',
            info: '_START_-_END_ / 총 _TOTAL_건',
            paginate: { previous: '이전', next: '다음' },
          },
          order: [[0, 'desc']], // 거래번호 내림차순
          paging: true,
          pageLength: 10,
          searching: false,
          lengthChange: false,
          info: false,
          responsive: true,
          autoWidth: false,
          scrollY: '320px',
          scrollCollapse: true,
        });

        // 행 클릭 이벤트
        $('#todayTransactionTable tbody').on('click', 'tr', function () {
          showPage('transaction');
        });
      } catch (error) {
        console.error('거래명세서 로드 실패:', error);
        document.getElementById('todayTransactionCount').textContent = '0건';
      }
    }

    // 날짜 포맷 헬퍼 함수
    function formatDate(dateStr) {
      if (!dateStr || dateStr.length !== 8) return '-';
      return `${dateStr.substring(0, 4)}-${dateStr.substring(4, 6)}-${dateStr.substring(6, 8)}`;
    }

    // 금액 포맷 헬퍼 함수
    function formatCurrency(amount) {
      return '₩' + Number(amount).toLocaleString();
    }

    /**
     * 체크박스 선택 시 수정/삭제 버튼 표시/숨김
     * @param {HTMLElement} checkbox - 체크박스 엘리먼트
     */
    function toggleCustomerActionButtons(checkbox) {
      const customerCode = checkbox.value;
      const actionsDiv = document.getElementById(`actions-${customerCode}`);

      if (!actionsDiv) return;

      const viewBtn = actionsDiv.querySelector('.btn-view');
      const editBtn = actionsDiv.querySelector('.btn-edit');
      const deleteBtn = actionsDiv.querySelector('.btn-delete');

      if (checkbox.checked) {
        // 체크 시: 상세 버튼 숨기고 수정/삭제 버튼 표시
        viewBtn.style.display = 'none';
        editBtn.style.display = 'inline-block';
        deleteBtn.style.display = 'inline-block';
      } else {
        // 체크 해제 시: 수정/삭제 버튼 숨기고 상세 버튼 표시
        viewBtn.style.display = 'inline-block';
        editBtn.style.display = 'none';
        deleteBtn.style.display = 'none';
      }
    }

    /**
     * 전체 선택/해제 (수정된 버전)
     * @param {HTMLElement} checkbox - 전체 선택 체크박스
     */
    function toggleSelectAllCustomers(checkbox) {
      const checkboxes = document.querySelectorAll('.customerCheckbox');
      checkboxes.forEach((cb) => {
        cb.checked = checkbox.checked;
        // 각 체크박스의 버튼 상태도 업데이트
        toggleCustomerActionButtons(cb);
      });
    }

    function toggleSelectAllSuppliers(checkbox) {
      const supplierCheckboxes = document.querySelectorAll('.supplierCheckbox');
      supplierCheckboxes.forEach((cb) => (cb.checked = checkbox.checked));
    }

    /**
     * 매출처 수정 함수
     * @param {string} customerCode - 매출처코드
     */
    async function editCustomer(customerCode) {
      try {
        console.log('===== 매출처 수정 시작 =====');
        console.log('매출처코드:', customerCode);

        // 1. 매출처 상세 정보 조회
        const result = await apiCall(`/customers/${customerCode}`);

        if (!result.success) {
          throw new Error(result.message || '매출처 정보를 불러올 수 없습니다.');
        }

        const customer = result.data;
        console.log('조회된 매출처 정보:', customer);

        // 2. 모달 열기
        const modal = document.getElementById('customerModal');
        if (!modal) {
          throw new Error('모달을 찾을 수 없습니다.');
        }

        // 3. 모달 제목 변경
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 수정';
        }

        // 4. 폼 필드에 데이터 채우기
        document.getElementById('customerCode').value = customer.매출처코드 || '';
        document.getElementById('customerName').value = customer.매출처명 || '';
        document.getElementById('ceoName').value = customer.대표자명 || '';
        document.getElementById('businessNo').value = customer.사업자번호 || '';
        document.getElementById('businessType').value = customer.업태 || '';
        document.getElementById('businessCategory').value = customer.업종 || '';
        document.getElementById('phone').value = customer.전화번호 || '';
        document.getElementById('fax').value = customer.팩스번호 || '';
        document.getElementById('zipCode').value = customer.우편번호 || '';
        document.getElementById('address').value = customer.주소 || '';
        document.getElementById('addressDetail').value = customer.번지 || '';
        document.getElementById('bankCode').value = customer.은행코드 || '';
        document.getElementById('accountNo').value = customer.계좌번호 || '';
        document.getElementById('managerName').value = customer.담당자 || '';
        document.getElementById('status').value = customer.사용구분 || '0';
        document.getElementById('remark').value = customer.비고 || '';

        // 5. 폼에 수정 모드 표시를 위한 데이터 속성 추가
        const form = document.getElementById('customerForm');
        form.setAttribute('data-mode', 'edit');
        form.setAttribute('data-customer-code', customerCode);

        // 6. 모달 표시
        modal.style.display = 'flex';

        console.log('✅ 매출처 수정 모달 열기 완료');
      } catch (error) {
        console.error('❌ 매출처 수정 오류:', error);
        alert('매출처 수정 중 오류가 발생했습니다: ' + error.message);
      }
    }

    /**
     * 매출처 삭제 함수
     * @param {string} customerCode - 매출처코드
     */
    async function deleteCustomer(customerCode) {
      try {
        console.log('===== 매출처 삭제 시작 =====');
        console.log('매출처코드:', customerCode);

        // 1. 삭제 확인
        if (
          !confirm('정말로 이 매출처를 삭제하시겠습니까?\n\n삭제된 데이터는 복구할 수 없습니다.')
        ) {
          console.log('❌ 사용자가 삭제를 취소했습니다.');
          return;
        }

        // 2. API 호출로 매출처 삭제
        const result = await apiCall(`/customers/${customerCode}`, 'DELETE');

        if (!result.success) {
          throw new Error(result.message || '매출처 삭제에 실패했습니다.');
        }

        console.log('✅ 매출처 삭제 성공:', result);

        // 3. 성공 메시지 표시
        alert('매출처가 성공적으로 삭제되었습니다.');

        // 4. 목록 새로고침 (DataTable 자동 새로고침)
        try {
          $('#customerTable').DataTable().ajax.reload(null, false);
          console.log('✅ 매출처 목록 새로고침 완료');
        } catch (e) {
          console.warn('⚠️ DataTable 새로고침 실패 (수동 새로고침 필요):', e);
        }
      } catch (error) {
        console.error('❌ 매출처 삭제 오류:', error);
        alert('매출처 삭제 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // ✅ 매입처 목록 로드는 supplier.js의 DataTable이 자동으로 처리합니다.

    // ✅ 견적 목록 로드는 quotation.js의 DataTable이 자동으로 처리합니다.

    // 발주 목록 로드
    async function loadOrders() {
      try {
        const searchValue = document.getElementById('orderSearch')?.value || '';
        const tbody = document.getElementById('orderTableBody');
        tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터를 불러오는 중...</td></tr>';

        const result = await apiCall(
          `/orders?사업장코드=${currentUser.사업장코드}&search=${searchValue}`,
        );

        if (result.success) {
          tbody.innerHTML = '';

          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터가 없습니다.</td></tr>';
            return;
          }

          result.data.forEach((order) => {
            const statusMap = {
              1: { class: 'status-pending', text: '발주대기' },
              2: { class: 'status-pending', text: '발주완료' },
              3: { class: 'status-completed', text: '입고완료' },
            };
            const status = statusMap[order.상태코드] || statusMap[1];

            const tr = document.createElement('tr');
            tr.innerHTML = `
                            <td>PO${order.발주일자}-${order.발주번호}</td>
                            <td>${order.매입처명 || '-'}</td>
                            <td>${order.발주일자}</td>
                            <td>${order.입고희망일자 || '-'}</td>
                            <td>₩0</td>
                            <td>${order.사용자명 || '-'}</td>
                            <td><span class="status-badge ${status.class}">${status.text
              }</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon" onclick="viewOrder('${order.발주일자
              }', ${order.발주번호})">상세</button>
                                </div>
                            </td>
                        `;
            tbody.appendChild(tr);
          });
        }
      } catch (error) {
        console.error('발주 목록 로드 실패:', error);
        const tbody = document.getElementById('orderTableBody');
        tbody.innerHTML = `<tr><td colspan="8" class="loading" style="color: red;">오류: ${error.message}</td></tr>`;
      }
    }

    // 서브메뉴 토글
    function toggleSubmenu(element) {
      element.classList.toggle('open');
      const submenu = element.nextElementSibling;
      submenu.classList.toggle('open');
    }

    // ⚠️ 중복된 showPage() 함수 제거됨 - 첫 번째 정의만 사용

    // ==================== 작업일자 관리 함수 ====================

    // 작업일자 표시 업데이트
    function updateWorkingDateDisplay(dateStr) {
      const dateEl = document.getElementById('currentWorkingDate');
      const dayEl = document.getElementById('currentWorkingDay');

      if (!dateEl || !dayEl) return;

      dateEl.textContent = dateStr;

      // 요일 계산
      const date = new Date(dateStr);
      const days = ['일', '월', '화', '수', '목', '금', '토'];
      const dayOfWeek = days[date.getDay()];
      dayEl.textContent = `(${dayOfWeek})`;
    }

    // 작업일자 가져오기
    function getWorkingDate() {
      return localStorage.getItem('workingDate') || new Date().toISOString().slice(0, 10);
    }

    // ==================== 용지설정관리 함수 ====================

    // 페이지 로드 시 저장된 마진 설정 불러오기
    function loadPaperMargins() {
      const savedMargins = localStorage.getItem('printMargins');

      if (savedMargins) {
        const margins = JSON.parse(savedMargins);
        document.getElementById('marginTop').value = margins.top || 10;
        document.getElementById('marginBottom').value = margins.bottom || 10;
        document.getElementById('marginLeft').value = margins.left || 10;
        document.getElementById('marginRight').value = margins.right || 10;
      } else {
        // 기본값 설정
        document.getElementById('marginTop').value = 10;
        document.getElementById('marginBottom').value = 10;
        document.getElementById('marginLeft').value = 10;
        document.getElementById('marginRight').value = 10;
      }
    }

    // 마진 설정 저장
    function savePaperMargins() {
      const margins = {
        top: parseInt(document.getElementById('marginTop').value) || 10,
        bottom: parseInt(document.getElementById('marginBottom').value) || 10,
        left: parseInt(document.getElementById('marginLeft').value) || 10,
        right: parseInt(document.getElementById('marginRight').value) || 10,
      };

      // 유효성 검사
      if (
        margins.top < 0 ||
        margins.top > 50 ||
        margins.bottom < 0 ||
        margins.bottom > 50 ||
        margins.left < 0 ||
        margins.left > 50 ||
        margins.right < 0 ||
        margins.right > 50
      ) {
        alert('마진 값은 0mm ~ 50mm 사이여야 합니다.');
        return;
      }

      // localStorage에 저장
      localStorage.setItem('printMargins', JSON.stringify(margins));

      // CSS 변수 업데이트
      updatePrintMargins(margins);

      alert('마진 설정이 저장되었습니다.');
      console.log('✅ 용지 마진 저장:', margins);
    }

    // 마진 기본값 복원
    function resetPaperMargins() {
      if (confirm('마진 설정을 기본값(10mm)으로 복원하시겠습니까?')) {
        document.getElementById('marginTop').value = 10;
        document.getElementById('marginBottom').value = 10;
        document.getElementById('marginLeft').value = 10;
        document.getElementById('marginRight').value = 10;

        const defaultMargins = { top: 10, bottom: 10, left: 10, right: 10 };
        localStorage.setItem('printMargins', JSON.stringify(defaultMargins));
        updatePrintMargins(defaultMargins);

        alert('기본값으로 복원되었습니다.');
      }
    }

    // CSS @page 마진 업데이트
    function updatePrintMargins(margins) {
      // 기존 스타일 제거
      const existingStyle = document.getElementById('dynamicPrintMargins');
      if (existingStyle) {
        existingStyle.remove();
      }

      // 새 스타일 추가
      const style = document.createElement('style');
      style.id = 'dynamicPrintMargins';
      style.textContent = `
          @media print {
            @page {
              size: A4;
              margin: ${margins.top}mm ${margins.right}mm ${margins.bottom}mm ${margins.left}mm;
            }
          }
        `;
      document.head.appendChild(style);

      console.log('✅ 프린트 마진 CSS 업데이트:', margins);
    }

    // 페이지 로드 시 마진 적용
    function initPrintMargins() {
      const savedMargins = localStorage.getItem('printMargins');

      if (savedMargins) {
        const margins = JSON.parse(savedMargins);
        updatePrintMargins(margins);
      } else {
        // 기본값 적용
        const defaultMargins = { top: 10, bottom: 10, left: 10, right: 10 };
        updatePrintMargins(defaultMargins);
      }
    }

    // 작업일자 변경 모달 열기
    function openDateChangeModal() {
      const modal = document.getElementById('dateChangeModal');
      const dateInput = document.getElementById('newWorkingDate');

      // 현재 작업일자로 초기화
      dateInput.value = getWorkingDate();

      modal.style.display = 'flex';
    }

    // 작업일자 변경 모달 닫기
    function closeDateChangeModal() {
      document.getElementById('dateChangeModal').style.display = 'none';
    }

    // 작업일자 변경 확인
    function confirmDateChange() {
      const newDate = document.getElementById('newWorkingDate').value;

      if (!newDate) {
        alert('날짜를 선택해주세요.');
        return;
      }

      // localStorage 업데이트
      localStorage.setItem('workingDate', newDate);

      // 화면 표시 업데이트
      updateWorkingDateDisplay(newDate);

      // 모달 닫기
      closeDateChangeModal();

      // 성공 메시지
      alert(`작업일자가 ${newDate}로 변경되었습니다.`);
    }

    // ⚠️ 중복된 logout() 함수 제거됨 - 첫 번째 정의만 사용

    // 상세 조회 함수들
    // ==================== 매출처 상세보기/수정/삭제 기능 ====================

    // 매출처 상세보기
    async function viewCustomerDetail(customerCode) {
      try {
        const result = await apiCall(`/customers/${customerCode}`);

        if (!result.success) {
          alert('매출처 정보를 불러올 수 없습니다.');
          return;
        }

        const data = result.data;

        // 상세 정보 HTML 생성
        const detailHtml = `
          <div style="grid-column: 1 / -1; padding: 12px; background: #f8f9fa; border-radius: 8px;">
            <strong>매출처코드:</strong> ${data.매출처코드}
          </div>
          <div style="padding: 12px;">
            <strong>매출처명</strong><br/>
            ${data.매출처명 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>대표자명</strong><br/>
            ${data.대표자명 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>사업자번호</strong><br/>
            ${data.사업자번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>법인번호</strong><br/>
            ${data.법인번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>전화번호</strong><br/>
            ${data.전화번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>팩스번호</strong><br/>
            ${data.팩스번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>업태</strong><br/>
            ${data.업태 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>업종</strong><br/>
            ${data.업종 || '-'}
          </div>
          <div style="grid-column: 1 / -1; padding: 12px;">
            <strong>주소</strong><br/>
            ${data.주소 || ''} ${data.번지 || ''}
          </div>
          <div style="padding: 12px;">
            <strong>은행</strong><br/>
            ${data.은행코드 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>계좌번호</strong><br/>
            ${data.계좌번호 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>담당자명</strong><br/>
            ${data.담당자명 || '-'}
          </div>
          <div style="padding: 12px;">
            <strong>거래상태</strong><br/>
            <span class="status-badge ${data.사용구분 === 0 ? 'status-active' : 'status-pending'}">
              ${data.사용구분 === 0 ? '정상거래' : '거래보류'}
            </span>
          </div>
          <div style="grid-column: 1 / -1; padding: 12px;">
            <strong>비고</strong><br/>
            ${data.비고란 || '-'}
          </div>
        `;

        document.getElementById('customerDetailContent').innerHTML = detailHtml;
        document.getElementById('customerDetailModal').style.display = 'flex';

        // 모달 드래그 기능 적용
        makeModalDraggable('customerDetailModal', 'customerDetailModalHeader');
      } catch (error) {
        console.error('매출처 상세 조회 오류:', error);
        alert('매출처 정보를 불러오는 중 오류가 발생했습니다.');
      }
    }

    // 매출처 상세보기 모달 닫기
    function closeCustomerDetailModal() {
      document.getElementById('customerDetailModal').style.display = 'none';
    }

    // 매출처 수정
    async function editCustomer(customerCode) {
      try {
        // 1. 매출처 상세 정보 조회
        const result = await apiCall(`/customers/${customerCode}`);

        if (!result.success) {
          alert('매출처 정보를 불러올 수 없습니다.');
          return;
        }

        const data = result.data;

        // 2. 모달 열기
        const modal = document.getElementById('customerModal');
        if (!modal) {
          console.error('매출처 모달을 찾을 수 없습니다.');
          return;
        }

        // 3. 모달 제목 변경
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 수정';
        }

        // 4. 폼 필드에 데이터 채우기
        document.getElementById('customerCode').value = data.매출처코드;
        document.getElementById('customerName').value = data.매출처명 || '';
        document.getElementById('ceoName').value = data.대표자명 || '';
        document.getElementById('businessNo').value = data.사업자번호 || '';
        document.getElementById('businessType').value = data.업태 || '';
        document.getElementById('businessCategory').value = data.업종 || '';
        document.getElementById('phone').value = data.전화번호 || '';
        document.getElementById('fax').value = data.팩스번호 || '';
        document.getElementById('zipCode').value = data.우편번호 || '';
        document.getElementById('address').value = data.주소 || '';
        document.getElementById('addressDetail').value = data.번지 || '';
        document.getElementById('bankCode').value = data.은행코드 || '';
        document.getElementById('accountNo').value = data.계좌번호 || '';
        document.getElementById('managerName').value = data.담당자명 || '';
        document.getElementById('status').value = data.사용구분 || 0;
        document.getElementById('remark').value = data.비고란 || '';

        // 5. 폼에 수정 모드 표시를 위한 데이터 속성 추가
        const form = document.getElementById('customerForm');
        form.dataset.mode = 'edit';
        form.dataset.code = customerCode;

        // 6. 모달 표시
        modal.style.display = 'flex';

        // 7. 모달 드래그 기능 적용
        makeModalDraggable('customerModal', 'customerModalHeader');
      } catch (error) {
        console.error('매출처 수정 준비 오류:', error);
        alert('매출처 정보를 불러오는 중 오류가 발생했습니다.');
      }
    }

    // 매출처 등록/수정 폼 제출
    async function submitCustomer(event) {
      event.preventDefault();

      try {
        const form = document.getElementById('customerForm');
        const isEditMode = form.dataset.mode === 'edit';
        const customerCode = form.dataset.code;

        // 폼 데이터 수집
        const formData = {
          매출처명: document.getElementById('customerName').value,
          사업자번호: document.getElementById('businessNo').value,
          대표자명: document.getElementById('ceoName').value,
          업태: document.getElementById('businessType').value,
          업종: document.getElementById('businessCategory').value,
          전화번호: document.getElementById('phone').value,
          팩스번호: document.getElementById('fax').value,
          우편번호: document.getElementById('zipCode').value,
          주소: document.getElementById('address').value,
          번지: document.getElementById('addressDetail').value,
          은행코드: document.getElementById('bankCode').value,
          계좌번호: document.getElementById('accountNo').value,
          담당자명: document.getElementById('managerName').value,
          사용구분: parseInt(document.getElementById('status').value),
          비고란: document.getElementById('remark').value,
        };

        let result;

        if (isEditMode) {
          // 수정 모드
          result = await apiCall(`/customers/${customerCode}`, 'PUT', formData);
        } else {
          // 신규 등록 모드
          formData.매출처코드 = document.getElementById('customerCode').value;
          result = await apiCall('/customers', 'POST', formData);
        }

        if (result.success) {
          alert(isEditMode ? '매출처가 수정되었습니다.' : '매출처가 등록되었습니다.');
          closeCustomerModal();

          // DataTable 새로고침
          try {
            $('#customerTable').DataTable().ajax.reload(null, false);
          } catch (e) {
            console.warn('DataTable 새로고침 실패:', e);
          }
        } else {
          alert('오류: ' + (result.message || '알 수 없는 오류'));
        }
      } catch (error) {
        console.error('매출처 저장 오류:', error);
        alert('매출처 저장 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 매출처 모달 닫기 (신규/수정 공용)
    function closeCustomerModal() {
      const modal = document.getElementById('customerModal');
      if (modal) {
        modal.style.display = 'none';

        // 폼 초기화
        const form = document.getElementById('customerForm');
        form.reset();
        delete form.dataset.mode;
        delete form.dataset.code;

        // 모달 제목 복원
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 신규등록';
        }
      }
    }

    // 매출처 삭제 (모달 열기)
    async function deleteCustomer(customerCode) {
      try {
        console.log('===== 매출처 삭제 모달 열기 =====');
        console.log('매출처코드:', customerCode);

        // 1. API 호출로 매출처 정보 가져오기
        const result = await apiCall(`/customers/${customerCode}`, 'GET');

        if (!result.success || !result.data) {
          throw new Error(result.message || '매출처 정보를 불러올 수 없습니다.');
        }

        const customer = result.data;
        console.log('✅ 매출처 정보 로드 성공:', customer);

        // 2. 삭제할 매출처 정보를 모달에 표시
        const deleteContent = document.getElementById('customerDeleteContent');
        deleteContent.innerHTML = `
          <div style="
                background: #f8f9fa;
                border: 1px solid var(--border);
                border-radius: 8px;
                padding: 20px;
              ">
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">매출처코드</span>
              <p style="margin: 4px 0 0 0; font-size: 16px; font-weight: 600; color: var(--text-dark);">${customer.매출처코드
          }</p>
            </div>
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">매출처명</span>
              <p style="margin: 4px 0 0 0; font-size: 16px; font-weight: 600; color: var(--text-dark);">${customer.매출처명
          }</p>
            </div>
            <div style="margin-bottom: 12px;">
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">대표자</span>
              <p style="margin: 4px 0 0 0; font-size: 14px; color: var(--text-dark);">${customer.대표자명 || '-'
          }</p>
            </div>
            <div>
              <span style="font-weight: 500; color: var(--text-gray); font-size: 14px;">사업자번호</span>
              <p style="margin: 4px 0 0 0; font-size: 14px; color: var(--text-dark);">${customer.사업자번호 || '-'
          }</p>
            </div>
          </div>
        `;

        // 3. 모달에 매출처코드 저장 (삭제 시 사용)
        document
          .getElementById('customerDeleteModal')
          .setAttribute('data-customer-code', customerCode);

        // 4. 모달 표시
        document.getElementById('customerDeleteModal').style.display = 'flex';
        console.log('✅ 삭제 모달 표시 완료');
      } catch (error) {
        console.error('❌ 매출처 삭제 모달 열기 오류:', error);
        alert('매출처 정보를 불러오는 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 매출처 삭제 모달 닫기
    function closeCustomerDeleteModal() {
      document.getElementById('customerDeleteModal').style.display = 'none';
      document.getElementById('customerDeleteContent').innerHTML = '';
      document.getElementById('customerDeleteModal').removeAttribute('data-customer-code');
      console.log('✅ 삭제 모달 닫기 완료');
    }

    // 매출처 삭제 확인 (실제 삭제)
    async function confirmDeleteCustomer() {
      try {
        const customerCode = document
          .getElementById('customerDeleteModal')
          .getAttribute('data-customer-code');

        if (!customerCode) {
          throw new Error('삭제할 매출처 코드가 없습니다.');
        }

        console.log('===== 매출처 삭제 실행 =====');
        console.log('매출처코드:', customerCode);

        // 1. API 호출로 매출처 삭제
        const result = await apiCall(`/customers/${customerCode}`, 'DELETE');

        if (!result.success) {
          throw new Error(result.message || '매출처 삭제에 실패했습니다.');
        }

        console.log('✅ 매출처 삭제 성공:', result);

        // 2. 성공 메시지 표시
        alert('매출처가 성공적으로 삭제되었습니다.');

        // 3. 모달 닫기
        closeCustomerDeleteModal();

        // 4. 목록 새로고침 (DataTable)
        try {
          $('#customerTable').DataTable().ajax.reload(null, false);
          console.log('✅ 매출처 목록 새로고침 완료');
        } catch (e) {
          console.warn('⚠️ DataTable 새로고침 실패 (수동 새로고침 필요):', e);
        }
      } catch (error) {
        console.error('❌ 매출처 삭제 오류:', error);
        alert('매출처 삭제 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 신규 매출처 등록 모달 열기
    async function openNewCustomerModal() {
      try {
        console.log('===== 신규 매출처 등록 모달 열기 =====');

        // 1. 서버에서 새로운 매출처코드 생성 요청
        const result = await apiCall('/customer_new', 'GET');

        if (!result.success || !result.data) {
          throw new Error(result.message || '매출처코드를 생성할 수 없습니다.');
        }

        const newCustomerCode = result.data.매출처코드;
        console.log('✅ 생성된 매출처코드:', newCustomerCode);

        // 2. 모달 열기
        const modal = document.getElementById('customerModal');
        if (!modal) {
          throw new Error('모달을 찾을 수 없습니다.');
        }

        // 3. 폼 초기화
        const form = document.getElementById('customerForm');
        form.reset();
        form.removeAttribute('data-mode');
        form.removeAttribute('data-customer-code');

        // 4. 모달 제목 설정
        const modalTitle = modal.querySelector('h2');
        if (modalTitle) {
          modalTitle.textContent = '매출처 신규등록';
        }

        // 5. 자동 생성된 매출처코드 설정 (사용자 수정 가능)
        document.getElementById('customerCode').value = newCustomerCode;
        document.getElementById('customerCode').readOnly = false;

        // 6. 모달 표시
        modal.style.display = 'flex';

        // 7. 모달 드래그 기능 적용
        makeModalDraggable('customerModal', 'customerModalHeader');

        console.log('✅ 신규 등록 모달 열기 완료');
      } catch (error) {
        console.error('❌ 신규 등록 모달 열기 오류:', error);
        alert('신규 등록 모달을 열 수 없습니다: ' + error.message);
      }
    }

    // Google Sheets로 내보내기 (CSV 다운로드)
    function exportCustomersToGoogleSheets() {
      try {
        console.log('===== Google Sheets로 내보내기 시작 =====');

        // 1. DataTable에서 선택된 행 가져오기
        const table = $('#customerTable').DataTable();
        const selectedRows = [];

        // 체크박스가 선택된 행만 가져오기
        $('.customerCheckbox:checked').each(function () {
          const customerCode = $(this).data('code');
          const rowData = table
            .rows()
            .data()
            .toArray()
            .find((row) => row.매출처코드 === customerCode);
          if (rowData) {
            selectedRows.push(rowData);
          }
        });

        // 선택된 행이 없으면 전체 데이터 내보내기
        let dataToExport = selectedRows.length > 0 ? selectedRows : table.rows().data().toArray();

        if (dataToExport.length === 0) {
          alert('내보낼 데이터가 없습니다.');
          return;
        }

        console.log(`✅ 내보낼 데이터 수: ${dataToExport.length}건`);

        // 2. CSV 형식으로 변환
        const headers = [
          '매출처코드',
          '매출처명',
          '대표자',
          '사업자번호',
          '연락처',
          '거래상태',
          '등록일',
        ];
        let csvContent = '\uFEFF'; // UTF-8 BOM 추가 (엑셀에서 한글 깨짐 방지)
        csvContent += headers.join(',') + '\n';

        dataToExport.forEach((row) => {
          const rowArray = [
            row.매출처코드 || '',
            row.매출처명 || '',
            row.대표자명 || '',
            row.사업자번호 || '',
            row.전화번호 || '',
            row.사용구분 === 0 ? '정상거래' : '거래보류',
            row.등록일자 || '',
          ];

          // CSV 특수문자 처리 (쉼표, 따옴표, 줄바꿈 있으면 큰따옴표로 감싸기)
          const csvRow = rowArray.map((field) => {
            const fieldStr = String(field);
            if (fieldStr.includes(',') || fieldStr.includes('"') || fieldStr.includes('\n')) {
              return '"' + fieldStr.replace(/"/g, '""') + '"';
            }
            return fieldStr;
          });

          csvContent += csvRow.join(',') + '\n';
        });

        // 3. Blob 생성 및 다운로드
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        if (link.download !== undefined) {
          const url = URL.createObjectURL(blob);
          const today = new Date().toISOString().slice(0, 10).replace(/-/g, '');
          const filename = `매출처관리_${today}.csv`;

          link.setAttribute('href', url);
          link.setAttribute('download', filename);
          link.style.visibility = 'hidden';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);

          console.log('✅ CSV 파일 다운로드 완료:', filename);
          alert(
            `CSV 파일이 다운로드되었습니다.\n\nGoogle Sheets에서:\n1. 파일 > 가져오기\n2. 업로드 탭 선택\n3. 다운로드된 CSV 파일 선택\n4. 가져오기를 클릭하세요.`,
          );
        }
      } catch (error) {
        console.error('❌ CSV 내보내기 오류:', error);
        alert('CSV 파일 생성 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 기존 viewCustomer 함수 (호환성 유지)
    async function viewCustomer(id) {
      // 새로운 상세보기 함수로 리다이렉트
      viewCustomerDetail(id);
    }

    async function viewSupplier(id) {
      try {
        const result = await apiCall(`/suppliers/${id}`);
        if (result.success) {
          alert(
            '매입처 정보:\n\n' +
            `매입처명: ${result.data.매입처명}\n` +
            `대표자: ${result.data.대표자명}\n` +
            `사업자번호: ${result.data.사업자번호}\n` +
            `전화번호: ${result.data.전화번호}\n` +
            `주소: ${result.data.주소} ${result.data.번지}`,
          );
        }
      } catch (error) {
        alert('매입처 조회 실패: ' + error.message);
      }
    }

    async function viewQuotation(date, no) {
      try {
        const result = await apiCall(`/quotations/${date}/${no}`);
        if (result.success) {
          console.log('견적 상세:', result.data);
          alert('견적 정보가 콘솔에 출력되었습니다.');
        }
      } catch (error) {
        alert('견적 조회 실패: ' + error.message);
      }
    }

    async function viewOrder(date, no) {
      try {
        const result = await apiCall(`/orders/${date}/${no}`);
        if (result.success) {
          console.log('발주 상세:', result.data);
          alert('발주 정보가 콘솔에 출력되었습니다.');
        }
      } catch (error) {
        alert('발주 조회 실패: ' + error.message);
      }
    }

    // ==================== Google Sheets 내보내기 기능 ====================

    // 매출처 Google Sheets 내보내기
    function exportCustomersToExcel() {
      try {
        console.log('===== 매출처 Google Sheets 내보내기 시작 =====');

        // 선택된 행 가져오기
        const checkboxes = document.querySelectorAll('.customerCheckbox:checked');

        if (checkboxes.length === 0) {
          alert('선택된 매출처가 없습니다.');
          return;
        }

        // 선택된 레코드의 데이터 수집
        const selectedData = [];
        checkboxes.forEach((checkbox) => {
          const row = checkbox.closest('tr');
          const cells = row.querySelectorAll('td');

          selectedData.push({
            번호: cells[1].textContent.trim(),
            매출처코드: cells[2].textContent.trim(),
            매출처명: cells[3].textContent.trim(),
            대표자: cells[4].textContent.trim(),
            사업자번호: cells[5].textContent.trim(),
            연락처: cells[6].textContent.trim(),
            거래상태: cells[7].textContent.trim(),
            등록일: cells[8].textContent.trim(),
          });
        });

        console.log('선택된 데이터:', selectedData);

        // CSV 형식으로 변환
        const headers = [
          '번호',
          '매출처코드',
          '매출처명',
          '대표자',
          '사업자번호',
          '연락처',
          '거래상태',
          '등록일',
        ];
        let csvContent = '\uFEFF' + headers.join(',') + '\n'; // UTF-8 BOM 추가

        selectedData.forEach((data) => {
          const row = [
            data.번호,
            data.매출처코드,
            `"${data.매출처명}"`, // 쉼표가 포함될 수 있으므로 따옴표로 감싸기
            data.대표자,
            data.사업자번호,
            data.연락처,
            data.거래상태,
            data.등록일,
          ];
          csvContent += row.join(',') + '\n';
        });

        // Blob 생성 및 다운로드
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        // 파일명 생성
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const date = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const fileName = `매출처_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

        // 다운로드 실행
        if (navigator.msSaveBlob) {
          // IE 10+
          navigator.msSaveBlob(blob, fileName);
        } else {
          link.href = URL.createObjectURL(blob);
          link.download = fileName;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        console.log('✅ CSV 파일 다운로드 완료:', fileName);

        // Google Sheets 안내
        alert(
          `${selectedData.length}개의 매출처 정보가 CSV로 다운로드되었습니다.\n\n📊 Google Sheets로 가져오기:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드 탭\n3. 다운로드된 CSV 파일 선택`,
        );
      } catch (error) {
        console.error('❌ Google Sheets 내보내기 오류:', error);
        alert('내보내기 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 매입처 Google Sheets 내보내기
    function exportSuppliersToExcel() {
      try {
        console.log('===== 매입처 Google Sheets 내보내기 시작 =====');

        // 선택된 행 가져오기
        const checkboxes = document.querySelectorAll('.supplierCheckbox:checked');

        if (checkboxes.length === 0) {
          alert('선택된 매입처가 없습니다.');
          return;
        }

        // 선택된 레코드의 데이터 수집
        const selectedData = [];
        checkboxes.forEach((checkbox) => {
          const row = checkbox.closest('tr');
          const cells = row.querySelectorAll('td');

          selectedData.push({
            번호: cells[1].textContent.trim(),
            매입처코드: cells[2].textContent.trim(),
            매입처명: cells[3].textContent.trim(),
            대표자: cells[4].textContent.trim(),
            사업자번호: cells[5].textContent.trim(),
            연락처: cells[6].textContent.trim(),
            거래상태: cells[7].textContent.trim(),
            작성자: cells[8].textContent.trim(),
          });
        });

        console.log('선택된 데이터:', selectedData);

        // CSV 형식으로 변환
        const headers = [
          '번호',
          '매입처코드',
          '매입처명',
          '대표자',
          '사업자번호',
          '연락처',
          '거래상태',
          '작성자',
        ];
        let csvContent = '\uFEFF' + headers.join(',') + '\n'; // UTF-8 BOM 추가

        selectedData.forEach((data) => {
          const row = [
            data.번호,
            data.매입처코드,
            `"${data.매입처명}"`, // 쉼표가 포함될 수 있으므로 따옴표로 감싸기
            data.대표자,
            data.사업자번호,
            data.연락처,
            data.거래상태,
            data.작성자,
          ];
          csvContent += row.join(',') + '\n';
        });

        // Blob 생성 및 다운로드
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        // 파일명 생성
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const date = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const fileName = `매입처_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

        // 다운로드 실행
        if (navigator.msSaveBlob) {
          // IE 10+
          navigator.msSaveBlob(blob, fileName);
        } else {
          link.href = URL.createObjectURL(blob);
          link.download = fileName;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        console.log('✅ CSV 파일 다운로드 완료:', fileName);

        // Google Sheets 안내
        alert(
          `${selectedData.length}개의 매입처 정보가 CSV로 다운로드되었습니다.\n\n📊 Google Sheets로 가져오기:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드 탭\n3. 다운로드된 CSV 파일 선택`,
        );
      } catch (error) {
        console.error('❌ Google Sheets 내보내기 오류:', error);
        alert('내보내기 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 견적 Google Sheets 내보내기
    function exportQuotationsToExcel() {
      try {
        console.log('===== 견적 Google Sheets 내보내기 시작 =====');

        const checkboxes = document.querySelectorAll('.quotationCheckbox:checked');

        if (checkboxes.length === 0) {
          alert('내보낼 견적을 선택해 주세요.');
          return;
        }

        const selectedData = [];
        checkboxes.forEach((checkbox) => {
          const row = checkbox.closest('tr');
          if (!row) return;
          const cells = row.querySelectorAll('td');
          if (cells.length < 9) return;

          selectedData.push({
            번호: cells[1]?.textContent.trim() || '',
            견적번호: cells[2]?.textContent.trim() || '',
            매출처명: cells[3]?.textContent.trim() || '',
            견적일자: cells[4]?.textContent.trim() || '',
            출고희망일: cells[5]?.textContent.trim() || '',
            비고: cells[6]?.textContent.trim() || '',
            담당자: cells[7]?.textContent.trim() || '',
            상태: cells[8]?.textContent.trim() || '',
          });
        });

        if (selectedData.length === 0) {
          alert('선택한 견적 행 정보를 불러오지 못했습니다. 다시 시도해 주세요.');
          return;
        }

        const headers = [
          '번호',
          '견적번호',
          '매출처명',
          '견적일자',
          '출고희망일',
          '비고',
          '담당자',
          '상태',
        ];

        const escapeCsv = (value) => {
          const text = (value ?? '').replace(/"/g, '""');
          return `"${text}"`;
        };

        let csvContent = '\uFEFF' + headers.join(',') + '\n';
        selectedData.forEach((item) => {
          const row = [
            item.번호,
            item.견적번호,
            item.매출처명,
            item.견적일자,
            item.출고희망일,
            item.비고,
            item.담당자,
            item.상태,
          ].map(escapeCsv);
          csvContent += row.join(',') + '\n';
        });

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');

        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const date = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const fileName = `견적_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

        if (navigator.msSaveBlob) {
          navigator.msSaveBlob(blob, fileName);
        } else {
          link.href = URL.createObjectURL(blob);
          link.download = fileName;
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        }

        console.log('CSV 파일 다운로드 완료:', fileName);
        alert(
          `${selectedData.length}개의 견적 정보가 CSV로 내려받아졌습니다.\n\nGoogle Sheets에서 불러오려면:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드\n3. 방금 다운로드한 CSV 파일 선택`,
        );
      } catch (error) {
        console.error('견적 Google Sheets 내보내기 오류:', error);
        alert('내보내기 중 오류가 발생했습니다: ' + error.message);
      }
    }

    /**
     * 일계표 조회
     */
    async function loadDailyReport() {
      try {
        const startDate = document.getElementById('dailyReportStartDate').value;
        const endDate = document.getElementById('dailyReportEndDate').value;

        if (!startDate || !endDate) {
          alert('시작일자와 종료일자를 모두 선택해주세요.');
          return;
        }

        // 날짜 포맷 변환 (YYYY-MM-DD → YYYYMMDD)
        const startDateStr = startDate.replace(/-/g, '');
        const endDateStr = endDate.replace(/-/g, '');

        console.log('✅ 일계표 조회:', startDateStr, '~', endDateStr);

        // 테이블 렌더링
        const tbody = document.getElementById('dailyReportTableBody');
        tbody.innerHTML = '';

        // 날짜 범위 생성
        const start = new Date(startDate);
        const end = new Date(endDate);
        const dateList = [];

        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
          dateList.push(new Date(d));
        }

        let totalCount = 0;

        // 각 날짜별로 데이터 조회 및 렌더링
        for (const date of dateList) {
          const dateStr = date.toISOString().split('T')[0].replace(/-/g, '');
          const dateDisplay = date.toISOString().split('T')[0];

          const response = await fetch(`/api/daily-report?date=${dateStr}`);
          const result = await response.json();

          if (result.success && result.data.length > 0) {
            // 날짜 구분 헤더 행 추가
            const headerTr = document.createElement('tr');
            headerTr.style.backgroundColor = '#f8f9fa';
            headerTr.innerHTML = `
                <td colspan="7" style="text-align: left; font-weight: bold; padding: 10px; background-color: #e9ecef;">
                  ${dateDisplay} (${date.toLocaleDateString('ko-KR', { weekday: 'short' })})
                </td>
              `;
            tbody.appendChild(headerTr);

            // 항목별 합계 계산용 객체
            const subtotals = {};

            // 데이터 렌더링
            result.data.forEach((row) => {
              const 구분 = row.구분 || '-';

              // 합계 계산
              if (!subtotals[구분]) {
                subtotals[구분] = { 수입1: 0, 수입2: 0, 지출1: 0, 지출2: 0, 잔액: 0 };
              }
              subtotals[구분].수입1 += row.수입1 || 0;
              subtotals[구분].수입2 += row.수입2 || 0;
              subtotals[구분].지출1 += row.지출1 || 0;
              subtotals[구분].지출2 += row.지출2 || 0;
              subtotals[구분].잔액 += row.잔액 || 0;

              const tr = document.createElement('tr');
              tr.innerHTML = `
                  <td style="text-align: center;">${구분}</td>
                  <td style="text-align: left;">${row.계정명 || '-'}</td>
                  <td style="text-align: right;">${(row.수입1 || 0).toLocaleString()}</td>
                  <td style="text-align: right;">${(row.수입2 || 0).toLocaleString()}</td>
                  <td style="text-align: right;">${(row.지출1 || 0).toLocaleString()}</td>
                  <td style="text-align: right;">${(row.지출2 || 0).toLocaleString()}</td>
                  <td style="text-align: right;">${(row.잔액 || 0).toLocaleString()}</td>
                `;
              tbody.appendChild(tr);
              totalCount++;
            });

            // 항목별 소계 행 추가
            Object.keys(subtotals).forEach((구분) => {
              const subtotal = subtotals[구분];
              const subtotalTr = document.createElement('tr');
              subtotalTr.style.backgroundColor = '#fff3cd';
              subtotalTr.style.fontWeight = 'bold';
              subtotalTr.innerHTML = `
                  <td style="text-align: center;">${구분}</td>
                  <td style="text-align: left;">[ 소계 ]</td>
                  <td style="text-align: right;">${subtotal.수입1.toLocaleString()}</td>
                  <td style="text-align: right;">${subtotal.수입2.toLocaleString()}</td>
                  <td style="text-align: right;">${subtotal.지출1.toLocaleString()}</td>
                  <td style="text-align: right;">${subtotal.지출2.toLocaleString()}</td>
                  <td style="text-align: right;">${subtotal.잔액.toLocaleString()}</td>
                `;
              tbody.appendChild(subtotalTr);
            });
          }
        }

        if (totalCount === 0) {
          tbody.innerHTML = `
              <tr>
                <td colspan="7" style="text-align: center; padding: 40px; color: #9ca3af;">
                  조회 결과가 없습니다
                </td>
              </tr>
            `;
        }

        console.log('✅ 일계표 렌더링 완료:', totalCount, '건');
      } catch (error) {
        console.error('❌ 일계표 조회 오류:', error);
        alert('일계표 조회 중 오류가 발생했습니다: ' + error.message);
      }
    }

    /**
     * 일계표 출력 (일자별로 A4 페이지 구분)
     */
    async function printDailyReport() {
      try {
        const startDate = document.getElementById('dailyReportStartDate').value;
        const endDate = document.getElementById('dailyReportEndDate').value;

        if (!startDate || !endDate) {
          alert('시작일자와 종료일자를 모두 선택해주세요.');
          return;
        }

        // 날짜 범위 생성
        const start = new Date(startDate);
        const end = new Date(endDate);
        const dateList = [];

        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
          dateList.push(new Date(d));
        }

        // 각 날짜별로 데이터 수집
        const dailyReports = [];

        for (const date of dateList) {
          const dateStr = date.toISOString().split('T')[0].replace(/-/g, '');
          const response = await fetch(`/api/daily-report?date=${dateStr}`);
          const result = await response.json();

          if (result.success && result.data.length > 0) {
            dailyReports.push({
              date: date,
              dateStr: date.toISOString().split('T')[0],
              dateDisplay: date
                .toISOString()
                .split('T')[0]
                .replace(/(\d{4})-(\d{2})-(\d{2})/, '$1년 $2월 $3일'),
              weekday: date.toLocaleDateString('ko-KR', { weekday: 'long' }),
              data: result.data,
            });
          }
        }

        if (dailyReports.length === 0) {
          alert('출력할 데이터가 없습니다.');
          return;
        }

        // 출력 창 열기
        const printWindow = window.open('', '_blank', 'width=900,height=900');

        // 일자별 페이지 HTML 생성
        const pagesHtml = dailyReports
          .map((report) => {
            // 항목별 합계 계산
            const subtotals = {};
            report.data.forEach((row) => {
              const 구분 = row.구분 || '-';
              if (!subtotals[구분]) {
                subtotals[구분] = { 수입1: 0, 수입2: 0, 지출1: 0, 지출2: 0, 잔액: 0 };
              }
              subtotals[구분].수입1 += row.수입1 || 0;
              subtotals[구분].수입2 += row.수입2 || 0;
              subtotals[구분].지출1 += row.지출1 || 0;
              subtotals[구분].지출2 += row.지출2 || 0;
              subtotals[구분].잔액 += row.잔액 || 0;
            });

            // 데이터 행 생성
            const dataRows = report.data
              .map(
                (row) => `
                <tr>
                  <td class="text-center">${row.구분 || '-'}</td>
                  <td class="text-left">${row.계정명 || '-'}</td>
                  <td class="text-right">${(row.수입1 || 0).toLocaleString()}</td>
                  <td class="text-right">${(row.수입2 || 0).toLocaleString()}</td>
                  <td class="text-right">${(row.지출1 || 0).toLocaleString()}</td>
                  <td class="text-right">${(row.지출2 || 0).toLocaleString()}</td>
                  <td class="text-right">${(row.잔액 || 0).toLocaleString()}</td>
                </tr>
              `,
              )
              .join('');

            // 소계 행 생성
            const subtotalRows = Object.keys(subtotals)
              .map((구분) => {
                const subtotal = subtotals[구분];
                return `
                <tr style="background-color: #fff3cd; font-weight: bold;">
                  <td class="text-center">${구분}</td>
                  <td class="text-left">[ 소계 ]</td>
                  <td class="text-right">${subtotal.수입1.toLocaleString()}</td>
                  <td class="text-right">${subtotal.수입2.toLocaleString()}</td>
                  <td class="text-right">${subtotal.지출1.toLocaleString()}</td>
                  <td class="text-right">${subtotal.지출2.toLocaleString()}</td>
                  <td class="text-right">${subtotal.잔액.toLocaleString()}</td>
                </tr>
              `;
              })
              .join('');

            return `
            <div class="page-break">
              <div class="title">일 계 표</div>
              <div class="date">${report.dateDisplay} (${report.weekday})</div>

              <table>
                <thead>
                  <tr>
                    <th style="width: 10%;">구분</th>
                    <th style="width: 20%;">거래처명/계정명</th>
                    <th style="width: 14%;">수입(공급가)</th>
                    <th style="width: 14%;">수입(부가세포함)</th>
                    <th style="width: 14%;">지출(공급가)</th>
                    <th style="width: 14%;">지출(부가세포함)</th>
                    <th style="width: 14%;">잔액</th>
                  </tr>
                </thead>
                <tbody>
                  ${dataRows}
                  ${subtotalRows}
                </tbody>
              </table>
            </div>
          `;
          })
          .join('');

        // HTML 생성
        const html = `
            <!DOCTYPE html>
            <html>
            <head>
              <meta charset="UTF-8">
              <title>일계표 - ${startDate} ~ ${endDate}</title>
              <style>
                @page {
                  size: A4;
                  margin: 15mm;
                }

                * {
                  margin: 0;
                  padding: 0;
                  box-sizing: border-box;
                }

                body {
                  font-family: '맑은 고딕', 'Malgun Gothic', Arial, sans-serif;
                  font-size: 10pt;
                  line-height: 1.4;
                  background: white;
                }

                .page-break {
                  page-break-after: always;
                  padding: 10mm;
                }

                .page-break:last-child {
                  page-break-after: auto;
                }

                .title {
                  text-align: center;
                  font-size: 20pt;
                  font-weight: bold;
                  margin-bottom: 10mm;
                }

                .date {
                  text-align: center;
                  font-size: 12pt;
                  margin-bottom: 8mm;
                  color: #333;
                }

                table {
                  width: 100%;
                  border-collapse: collapse;
                  margin-bottom: 10mm;
                  font-size: 9pt;
                }

                thead {
                  display: table-header-group;
                }

                th {
                  background-color: #f0f0f0;
                  border: 1px solid #333;
                  padding: 6px 4px;
                  text-align: center;
                  font-weight: bold;
                  font-size: 9pt;
                }

                td {
                  border: 1px solid #333;
                  padding: 5px 4px;
                  font-size: 8.5pt;
                }

                .text-center {
                  text-align: center;
                }

                .text-left {
                  text-align: left;
                  padding-left: 6px;
                }

                .text-right {
                  text-align: right;
                  padding-right: 6px;
                }

                @media print {
                  body {
                    padding: 0;
                  }
                  @page {
                    margin: 10mm;
                  }
                  .page-break {
                    padding: 0;
                  }
                }
              </style>
            </head>
            <body>
              ${pagesHtml}

              <script>
                window.onload = function() {
                  setTimeout(function() {
                    window.print();
                  }, 500);
                };
              <\/script>
            </body>
            </html>
          `;

        printWindow.document.write(html);
        printWindow.document.close();

        console.log('✅ 일계표 출력 완료:', dailyReports.length, '일');
      } catch (error) {
        console.error('❌ 일계표 출력 오류:', error);
        alert('일계표 출력 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // =============================================
    // 📊 회계전표관리 함수
    // =============================================
    let accountingVoucherTable = null;

    // 회계전표 목록 조회
    async function loadAccountingVouchers() {
      try {
        // 날짜 필드가 비어있으면 오늘 날짜로 설정
        const today = new Date().toISOString().split('T')[0];
        const startDateInput = document.getElementById('voucherStartDate');
        const endDateInput = document.getElementById('voucherEndDate');

        if (!startDateInput.value) {
          startDateInput.value = today;
        }
        if (!endDateInput.value) {
          endDateInput.value = today;
        }

        const startDate = startDateInput.value || '';
        const endDate = endDateInput.value || '';
        const voucherType = document.getElementById('voucherTypeFilter')?.value || '';

        const params = new URLSearchParams();
        if (startDate) params.append('startDate', startDate);
        if (endDate) params.append('endDate', endDate);
        if (voucherType) params.append('voucherType', voucherType);

        const response = await fetch(`/api/accounting-vouchers?${params.toString()}`);
        const result = await response.json();

        if (!result.success) {
          throw new Error(result.message);
        }

        const vouchers = result.data || [];

        // DataTable 초기화
        if (accountingVoucherTable) {
          accountingVoucherTable.clear().destroy();
        }

        accountingVoucherTable = $('#accountingVoucherTable').DataTable({
          data: vouchers,
          order: [
            [1, 'desc'],
            [2, 'desc'],
            [3, 'asc'],
          ], // 작성일자, 전표번호, 순번 순
          columns: [
            {
              // 체크박스
              data: null,
              orderable: false,
              className: 'text-center',
              render: (data, type, row) => {
                return `<input type="checkbox" class="voucher-checkbox" data-voucher-no="${row.전표번호}" data-voucher-date="${row.전표일자}" data-voucher-seq="${row.전표순번}" />`;
              },
            },
            {
              data: '전표일자',
              render: (data) => {
                if (!data) return '';
                return `${data.substring(0, 4)}-${data.substring(4, 6)}-${data.substring(6, 8)}`;
              },
            },
            {
              data: '전표번호',
              render: (data) => {
                if (!data) return '';
                // 전표번호 형식: "20251122-4" → "0004" 추출
                const parts = data.split('-');
                const num = parts[parts.length - 1];
                return num.padStart(4, '0');
              },
            },
            { data: '전표순번' },
            { data: '계정코드' },
            { data: '계정명' },
            {
              data: '차대구분',
              render: (data) => {
                if (data === 'D') return '<span class="status-badge status-active">차변</span>';
                if (data === 'C') return '<span class="status-badge status-pending">대변</span>';
                return data;
              },
            },
            {
              data: '금액',
              render: (data) => (data || 0).toLocaleString() + ' 원',
              className: 'text-right',
            },
            { data: '적요' },
            { data: '참조전표' },
            { data: '사용자명' },
            {
              // 관리 버튼
              data: null,
              orderable: false,
              className: 'text-center',
              render: (data, type, row) => {
                return `<button class="btn-icon btn-view" onclick="openVoucherDetailModal('${row.전표번호}', '${row.전표일자}')" title="상세보기">상세</button>`;
              },
            },
          ],
          language: {
            emptyTable: '조회된 전표가 없습니다',
            info: '총 _TOTAL_건',
            infoEmpty: '',
            infoFiltered: '(전체 _MAX_건 중 검색)',
            lengthMenu: '_MENU_ 건씩 보기',
            search: '검색:',
            zeroRecords: '검색 결과가 없습니다',
            paginate: {
              first: '처음',
              last: '마지막',
              next: '다음',
              previous: '이전',
            },
          },
          pageLength: 25,
          lengthMenu: [
            [25, 50, 100, -1],
            [25, 50, 100, '전체'],
          ],
          ordering: true,
          searching: true,
        });

        // 전체 선택 체크박스 이벤트
        $('#selectAllVouchers')
          .off('change')
          .on('change', function () {
            const checked = $(this).prop('checked');
            $('.voucher-checkbox').prop('checked', checked);
            toggleVoucherActionButtons();
          });

        // 개별 체크박스 이벤트
        $(document)
          .off('change', '.voucher-checkbox')
          .on('change', '.voucher-checkbox', function () {
            const totalCheckboxes = $('.voucher-checkbox').length;
            const checkedCheckboxes = $('.voucher-checkbox:checked').length;
            $('#selectAllVouchers').prop('checked', totalCheckboxes === checkedCheckboxes);
            toggleVoucherActionButtons();
          });

        // 요약 정보 업데이트
        const voucherCount = vouchers.length;
        const debitTotal = vouchers
          .filter((v) => v.차대구분 === 'D')
          .reduce((sum, v) => sum + (v.금액 || 0), 0);
        const creditTotal = vouchers
          .filter((v) => v.차대구분 === 'C')
          .reduce((sum, v) => sum + (v.금액 || 0), 0);

        document.getElementById('voucherCount').textContent = voucherCount.toLocaleString();
        document.getElementById('debitTotal').textContent = debitTotal.toLocaleString();
        document.getElementById('creditTotal').textContent = creditTotal.toLocaleString();

        console.log('✅ 회계전표 조회 완료:', voucherCount, '건');
      } catch (error) {
        console.error('❌ 회계전표 조회 오류:', error);
        alert('회계전표 조회 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 필터 조회
    function filterVouchers() {
      loadAccountingVouchers();
    }

    // Google Sheets로 내보내기
    function exportVouchersToExcel() {
      if (!accountingVoucherTable) {
        alert('조회된 데이터가 없습니다.');
        return;
      }

      const data = accountingVoucherTable.rows().data().toArray();
      if (data.length === 0) {
        alert('내보낼 데이터가 없습니다.');
        return;
      }

      // CSV 생성
      let csv = '전표번호,전표일자,순번,계정코드,계정명,차대구분,금액,적요,참조전표,작성자\n';
      data.forEach((row) => {
        const 전표일자 = row.전표일자
          ? `${row.전표일자.substring(0, 4)}-${row.전표일자.substring(
            4,
            6,
          )}-${row.전표일자.substring(6, 8)}`
          : '';
        const 차대구분 = row.차대구분 === 'D' ? '차변' : '대변';
        csv += `${row.전표번호 || ''},${전표일자},${row.전표순번 || ''},${row.계정코드 || ''},${row.계정명 || ''
          },${차대구분},${row.금액 || 0},"${(row.적요 || '').replace(/"/g, '""')}",${row.참조전표 || ''
          },${row.사용자명 || ''}\n`;
      });

      const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `회계전표_${new Date().toISOString().slice(0, 10)}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      console.log('✅ 회계전표 CSV 내보내기 완료:', data.length, '건');
    }

    // 수정/삭제 버튼 토글
    function toggleVoucherActionButtons() {
      const checkedCount = $('.voucher-checkbox:checked').length;
      if (checkedCount > 0) {
        $('#voucherEditBtn').show();
        $('#voucherDeleteBtn').show();
      } else {
        $('#voucherEditBtn').hide();
        $('#voucherDeleteBtn').hide();
      }
    }

    // 상세보기 모달 열기
    async function openVoucherDetailModal(voucherNo, voucherDate) {
      try {
        // 해당 전표번호의 모든 항목 조회
        const params = new URLSearchParams({ startDate: voucherDate, endDate: voucherDate });
        const response = await fetch(`/api/accounting-vouchers?${params.toString()}`);
        const result = await response.json();

        if (!result.success) {
          throw new Error(result.message);
        }

        // 해당 전표번호와 일자의 데이터만 필터링
        const voucherDetails = (result.data || []).filter(
          (v) => v.전표번호 === voucherNo && v.전표일자 === voucherDate,
        );

        if (voucherDetails.length === 0) {
          alert('전표 정보를 찾을 수 없습니다.');
          return;
        }

        // 상세 정보 HTML 생성
        const firstRow = voucherDetails[0];
        const 전표일자_formatted = `${voucherDate.substring(0, 4)}-${voucherDate.substring(
          4,
          6,
        )}-${voucherDate.substring(6, 8)}`;
        const 참조전표 = firstRow.참조전표 || '';

        let detailHtml = `
            <div style="margin-bottom: 20px">
              <h4 style="margin-bottom: 15px; border-bottom: 2px solid #333; padding-bottom: 10px">전표 정보</h4>
              <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px">
                <div><strong>전표번호:</strong> ${voucherNo}</div>
                <div><strong>전표일자:</strong> ${전표일자_formatted}</div>
                <div><strong>참조전표:</strong> ${참조전표}</div>
                <div><strong>작성자:</strong> ${firstRow.사용자명 || ''}</div>
              </div>
            </div>

            <h4 style="margin-bottom: 10px">전표 내역</h4>
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px">
              <thead>
                <tr style="background-color: #f5f5f5">
                  <th style="border: 1px solid #ddd; padding: 10px; text-align: center">순번</th>
                  <th style="border: 1px solid #ddd; padding: 10px; text-align: left">계정코드</th>
                  <th style="border: 1px solid #ddd; padding: 10px; text-align: left">계정명</th>
                  <th style="border: 1px solid #ddd; padding: 10px; text-align: center">차대</th>
                  <th style="border: 1px solid #ddd; padding: 10px; text-align: right">금액</th>
                  <th style="border: 1px solid #ddd; padding: 10px; text-align: left">적요</th>
                </tr>
              </thead>
              <tbody>
          `;

        voucherDetails.forEach((row) => {
          const 차대구분 =
            row.차대구분 === 'D'
              ? '<span style="color: #007bff; font-weight: 600">차변</span>'
              : '<span style="color: #28a745; font-weight: 600">대변</span>';

          detailHtml += `
              <tr>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center">${row.전표순번
            }</td>
                <td style="border: 1px solid #ddd; padding: 8px">${row.계정코드}</td>
                <td style="border: 1px solid #ddd; padding: 8px">${row.계정명}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: center">${차대구분}</td>
                <td style="border: 1px solid #ddd; padding: 8px; text-align: right">${(
              row.금액 || 0
            ).toLocaleString()} 원</td>
                <td style="border: 1px solid #ddd; padding: 8px">${row.적요 || ''}</td>
              </tr>
            `;
        });

        // 합계 계산
        const 차변합계 = voucherDetails
          .filter((v) => v.차대구분 === 'D')
          .reduce((sum, v) => sum + (v.금액 || 0), 0);
        const 대변합계 = voucherDetails
          .filter((v) => v.차대구분 === 'C')
          .reduce((sum, v) => sum + (v.금액 || 0), 0);

        detailHtml += `
              </tbody>
              <tfoot>
                <tr style="background-color: #f9f9f9; font-weight: bold">
                  <td colspan="3" style="border: 1px solid #ddd; padding: 10px; text-align: right">합계</td>
                  <td style="border: 1px solid #ddd; padding: 10px; text-align: center">차변</td>
                  <td style="border: 1px solid #ddd; padding: 10px; text-align: right; color: #007bff">${차변합계.toLocaleString()} 원</td>
                  <td style="border: 1px solid #ddd; padding: 10px"></td>
                </tr>
                <tr style="background-color: #f9f9f9; font-weight: bold">
                  <td colspan="3" style="border: 1px solid #ddd; padding: 10px; text-align: right"></td>
                  <td style="border: 1px solid #ddd; padding: 10px; text-align: center">대변</td>
                  <td style="border: 1px solid #ddd; padding: 10px; text-align: right; color: #28a745">${대변합계.toLocaleString()} 원</td>
                  <td style="border: 1px solid #ddd; padding: 10px"></td>
                </tr>
              </tfoot>
            </table>
          `;

        // 참조전표 상세 내역 조회 및 표시
        if (참조전표) {
          try {
            // 참조전표에서 거래일자와 거래번호 추출 (형식: "20251122-999")
            const parts = 참조전표.split('-');
            if (parts.length === 2) {
              const 거래일자 = parts[0];
              const 거래번호 = parts[1];

              // 자재입출내역 조회 API 호출
              const inventoryResponse = await fetch(
                `/api/inventory-transactions/${거래일자}/${거래번호}`,
              );
              const inventoryResult = await inventoryResponse.json();

              if (
                inventoryResult.success &&
                inventoryResult.data &&
                inventoryResult.data.length > 0
              ) {
                const items = inventoryResult.data;
                const firstItem = items[0];
                const 입출고구분 = firstItem.입출고구분;
                const 거래처명 = 입출고구분 === 1 ? firstItem.매입처명 : firstItem.매출처명;
                const 거래구분명 = 입출고구분 === 1 ? '매입전표' : '거래명세서';

                detailHtml += `
                    <div style="margin-top: 30px">
                      <h4 style="margin-bottom: 15px; border-bottom: 2px solid #333; padding-bottom: 10px">참조전표 상세 (${거래구분명})</h4>
                      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px">
                        <div><strong>거래일자:</strong> ${거래일자.substring(
                  0,
                  4,
                )}-${거래일자.substring(4, 6)}-${거래일자.substring(6, 8)}</div>
                        <div><strong>거래번호:</strong> ${거래번호}</div>
                        <div><strong>거래처:</strong> ${거래처명 || ''}</div>
                        <div><strong>구분:</strong> ${거래구분명}</div>
                      </div>

                      <table style="width: 100%; border-collapse: collapse">
                        <thead>
                          <tr style="background-color: #f5f5f5">
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: center">No</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: left">자재명</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: left">규격</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: center">단위</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: right">수량</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: right">단가</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: right">공급가액</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: right">부가세</th>
                            <th style="border: 1px solid #ddd; padding: 10px; text-align: right">합계</th>
                          </tr>
                        </thead>
                        <tbody>
                  `;

                let 총공급가액 = 0;
                let 총부가세 = 0;

                items.forEach((item, index) => {
                  const 수량 = 입출고구분 === 1 ? item.입고수량 : item.출고수량;
                  const 단가 = 입출고구분 === 1 ? item.입고단가 : item.출고단가;
                  const 부가세 = 입출고구분 === 1 ? item.입고부가 : item.출고부가;
                  const 공급가액 = 수량 * 단가;
                  const 합계 = 공급가액 + 부가세;

                  총공급가액 += 공급가액;
                  총부가세 += 부가세;

                  detailHtml += `
                      <tr>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center">${index + 1
                    }</td>
                        <td style="border: 1px solid #ddd; padding: 8px">${item.자재명 || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px">${item.규격 || ''}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center">${item.단위 || ''
                    }</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right">${수량.toLocaleString()}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right">${단가.toLocaleString()}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right">${공급가액.toLocaleString()}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right">${부가세.toLocaleString()}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right">${합계.toLocaleString()}</td>
                      </tr>
                    `;
                });

                const 총합계 = 총공급가액 + 총부가세;

                detailHtml += `
                        </tbody>
                        <tfoot>
                          <tr style="background-color: #f9f9f9; font-weight: bold">
                            <td colspan="6" style="border: 1px solid #ddd; padding: 10px; text-align: right">합계</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right">${총공급가액.toLocaleString()} 원</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right">${총부가세.toLocaleString()} 원</td>
                            <td style="border: 1px solid #ddd; padding: 10px; text-align: right">${총합계.toLocaleString()} 원</td>
                          </tr>
                        </tfoot>
                      </table>
                    </div>
                  `;
              }
            }
          } catch (error) {
            console.error('❌ 참조전표 상세 조회 오류:', error);
            // 참조전표 조회 실패 시 에러를 무시하고 전표 내역만 표시
          }
        }

        document.getElementById('voucherDetailContent').innerHTML = detailHtml;
        document.getElementById('voucherDetailModal').style.display = 'flex';

        // 모달에 데이터 저장 (출력용)
        window.currentVoucherDetail = { voucherNo, voucherDate, details: voucherDetails };
      } catch (error) {
        console.error('❌ 전표 상세 조회 오류:', error);
        alert('전표 상세 정보를 불러오는 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 상세보기 모달 닫기
    function closeVoucherDetailModal() {
      document.getElementById('voucherDetailModal').style.display = 'none';
      window.currentVoucherDetail = null;
    }

    // 전표 상세 출력 (일자별 페이지 구분)
    function printVoucherDetail() {
      if (!window.currentVoucherDetail) {
        alert('출력할 전표 정보가 없습니다.');
        return;
      }

      const { voucherNo, voucherDate, details } = window.currentVoucherDetail;
      const 전표일자_formatted = `${voucherDate.substring(0, 4)}-${voucherDate.substring(
        4,
        6,
      )}-${voucherDate.substring(6, 8)}`;
      const firstRow = details[0];

      // 차변/대변 합계 계산
      const 차변합계 = details
        .filter((v) => v.차대구분 === 'D')
        .reduce((sum, v) => sum + (v.금액 || 0), 0);
      const 대변합계 = details
        .filter((v) => v.차대구분 === 'C')
        .reduce((sum, v) => sum + (v.금액 || 0), 0);

      const printWindow = window.open('', '_blank');
      const html = `
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8">
            <title>회계전표 - ${voucherNo}</title>
            <style>
              @page {
                size: A4;
                margin: 15mm;
              }
              body {
                font-family: 'Malgun Gothic', sans-serif;
                font-size: 10pt;
                line-height: 1.4;
                margin: 0;
                padding: 20px;
              }
              h2 {
                text-align: center;
                margin-bottom: 20px;
                font-size: 18pt;
                border-bottom: 2px solid #333;
                padding-bottom: 10px;
              }
              .info-section {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                margin-bottom: 20px;
                border: 1px solid #ddd;
                padding: 15px;
                background-color: #f9f9f9;
              }
              .info-item {
                padding: 5px 0;
              }
              .info-item strong {
                display: inline-block;
                width: 100px;
              }
              table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 20px;
              }
              th, td {
                border: 1px solid #333;
                padding: 8px;
                text-align: left;
              }
              th {
                background-color: #f0f0f0;
                font-weight: bold;
                text-align: center;
              }
              td.text-center { text-align: center; }
              td.text-right { text-align: right; }
              tfoot tr {
                background-color: #f9f9f9;
                font-weight: bold;
              }
              .debit { color: #007bff; }
              .credit { color: #28a745; }
              @media print {
                body { padding: 0; }
                @page { margin: 15mm; }
              }
            </style>
          </head>
          <body>
            <h2>회계전표</h2>
            <div class="info-section">
              <div class="info-item"><strong>전표번호:</strong> ${voucherNo}</div>
              <div class="info-item"><strong>전표일자:</strong> ${전표일자_formatted}</div>
              <div class="info-item"><strong>참조전표:</strong> ${firstRow.참조전표 || ''}</div>
              <div class="info-item"><strong>작성자:</strong> ${firstRow.사용자명 || ''}</div>
            </div>

            <table>
              <thead>
                <tr>
                  <th>순번</th>
                  <th>계정코드</th>
                  <th>계정명</th>
                  <th>차대</th>
                  <th>금액</th>
                  <th>적요</th>
                </tr>
              </thead>
              <tbody>
                ${details
          .map(
            (row) => `
                  <tr>
                    <td class="text-center">${row.전표순번}</td>
                    <td>${row.계정코드}</td>
                    <td>${row.계정명}</td>
                    <td class="text-center ${row.차대구분 === 'D' ? 'debit' : 'credit'}">
                      ${row.차대구분 === 'D' ? '차변' : '대변'}
                    </td>
                    <td class="text-right">${(row.금액 || 0).toLocaleString()} 원</td>
                    <td>${row.적요 || ''}</td>
                  </tr>
                `,
          )
          .join('')}
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="3" class="text-right">합계</td>
                  <td class="text-center debit">차변</td>
                  <td class="text-right debit">${차변합계.toLocaleString()} 원</td>
                  <td></td>
                </tr>
                <tr>
                  <td colspan="3" class="text-right"></td>
                  <td class="text-center credit">대변</td>
                  <td class="text-right credit">${대변합계.toLocaleString()} 원</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>

            <script>
              window.onload = function() {
                setTimeout(function() {
                  window.print();
                }, 500);
              };
            <\/script>
          </body>
          </html>
        `;

      printWindow.document.write(html);
      printWindow.document.close();
    }

    // 수정 모달 열기
    function editSelectedVouchers() {
      const checkedBoxes = $('.voucher-checkbox:checked');
      if (checkedBoxes.length === 0) {
        alert('수정할 전표를 선택해주세요.');
        return;
      }

      // 선택된 전표들의 데이터 수집
      const selectedVouchers = [];
      checkedBoxes.each(function () {
        const voucherNo = $(this).data('voucher-no');
        const voucherDate = $(this).data('voucher-date');
        const voucherSeq = $(this).data('voucher-seq');

        // DataTable에서 해당 행 데이터 찾기
        const rowData = accountingVoucherTable
          .rows()
          .data()
          .toArray()
          .find(
            (row) =>
              row.전표번호 === voucherNo &&
              row.전표일자 === voucherDate &&
              row.전표순번 === voucherSeq,
          );
        if (rowData) {
          selectedVouchers.push(rowData);
        }
      });

      if (selectedVouchers.length === 0) {
        alert('선택한 전표 정보를 찾을 수 없습니다.');
        return;
      }

      // 수정 모달에 DataTable 표시
      if (window.voucherEditTable) {
        window.voucherEditTable.clear().destroy();
      }

      window.voucherEditTable = $('#voucherEditTable').DataTable({
        data: selectedVouchers,
        order: [],
        paging: false,
        searching: false,
        info: false,
        columns: [
          { data: '전표번호' },
          {
            data: '전표일자',
            render: (data) => {
              if (!data) return '';
              return `${data.substring(0, 4)}-${data.substring(4, 6)}-${data.substring(6, 8)}`;
            },
          },
          { data: '전표순번' },
          { data: '계정코드' },
          { data: '계정명' },
          {
            data: '차대구분',
            render: (data) => (data === 'D' ? '차변' : '대변'),
          },
          {
            data: '금액',
            render: (data, type, row) => {
              return `<input type="number" class="form-control" value="${data || 0}"
                  data-voucher-no="${row.전표번호}"
                  data-voucher-date="${row.전표일자}"
                  data-voucher-seq="${row.전표순번}"
                  style="width: 150px; text-align: right" />`;
            },
          },
          {
            data: '적요',
            render: (data, type, row) => {
              return `<input type="text" class="form-control" value="${data || ''}"
                  data-voucher-no="${row.전표번호}"
                  data-voucher-date="${row.전표일자}"
                  data-voucher-seq="${row.전표순번}"
                  style="width: 200px" />`;
            },
          },
        ],
      });

      document.getElementById('voucherEditModal').style.display = 'flex';
    }

    // 수정 모달 닫기
    function closeVoucherEditModal() {
      document.getElementById('voucherEditModal').style.display = 'none';
      if (window.voucherEditTable) {
        window.voucherEditTable.clear().destroy();
        window.voucherEditTable = null;
      }
    }

    // 전표 수정 저장
    async function saveVoucherEdit() {
      try {
        // 수정된 데이터 수집
        const updates = [];
        $('#voucherEditTable tbody tr').each(function () {
          const 금액Input = $(this).find('input[type="number"]');
          const 적요Input = $(this).find('input[type="text"]');

          updates.push({
            전표번호: 금액Input.data('voucher-no'),
            전표일자: 금액Input.data('voucher-date'),
            전표순번: 금액Input.data('voucher-seq'),
            금액: parseFloat(금액Input.val()) || 0,
            적요: 적요Input.val(),
          });
        });

        if (updates.length === 0) {
          alert('수정할 데이터가 없습니다.');
          return;
        }

        // API 호출
        const response = await fetch('/api/accounting-vouchers/batch-update', {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ updates }),
        });

        const result = await response.json();

        if (!result.success) {
          throw new Error(result.message);
        }

        alert('회계전표가 수정되었습니다.');
        closeVoucherEditModal();
        loadAccountingVouchers();
      } catch (error) {
        console.error('❌ 전표 수정 오류:', error);
        alert('전표 수정 중 오류가 발생했습니다: ' + error.message);
      }
    }

    // 삭제 모달 열기
    function deleteSelectedVouchers() {
      const checkedBoxes = $('.voucher-checkbox:checked');
      if (checkedBoxes.length === 0) {
        alert('삭제할 전표를 선택해주세요.');
        return;
      }

      document.getElementById('deleteVoucherCount').textContent = checkedBoxes.length;
      document.getElementById('voucherDeleteModal').style.display = 'flex';
    }

    // 삭제 모달 닫기
    function closeVoucherDeleteModal() {
      document.getElementById('voucherDeleteModal').style.display = 'none';
    }

    // 전표 삭제 확인
    async function confirmVoucherDelete() {
      try {
        const checkedBoxes = $('.voucher-checkbox:checked');
        const deleteList = [];

        checkedBoxes.each(function () {
          deleteList.push({
            전표번호: $(this).data('voucher-no'),
            전표일자: $(this).data('voucher-date'),
            전표순번: $(this).data('voucher-seq'),
          });
        });

        if (deleteList.length === 0) {
          alert('삭제할 전표가 없습니다.');
          return;
        }

        // API 호출
        const response = await fetch('/api/accounting-vouchers/batch-delete', {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ deleteList }),
        });

        const result = await response.json();

        if (!result.success) {
          throw new Error(result.message);
        }

        alert(`${deleteList.length}건의 회계전표가 삭제되었습니다.`);
        closeVoucherDeleteModal();
        loadAccountingVouchers();
      } catch (error) {
        console.error('❌ 전표 삭제 오류:', error);
        alert('전표 삭제 중 오류가 발생했습니다: ' + error.message);
      }
    }
  </script>

  <!-- HTML의 </body> 직전에 모달 HTML 추가 -->

  <!-- 현금출납 등록/수정 모달 -->
  <div id="cashEntryModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto">
      <div class="modal-header" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px 12px 0 0;
          ">
        <h3 id="cashEntryModalTitle" style="margin: 0; font-size: 18px; font-weight: 700; color: white">
          현금출납 등록
        </h3>
        <button onclick="closeCashEntryModal()" style="
              background: rgba(255, 255, 255, 0.2);
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: white;
              width: 32px;
              height: 32px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='rgba(255, 255, 255, 0.3)';"
          onmouseout="this.style.background='rgba(255, 255, 255, 0.2)';">
          &times;
        </button>
      </div>

      <div class="modal-body">
        <form id="cashEntryForm" onsubmit="saveCashEntry(event)">
          <!-- 숨겨진 필드: 수정 모드용 -->
          <input type="hidden" id="cashEntryMode" value="new" />
          <input type="hidden" id="cashEntryOriginalDate" />
          <input type="hidden" id="cashEntryOriginalTime" />

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px">
            <!-- 작성일자 -->
            <div class="form-group">
              <label for="cashEntryDate">작성일자 <span style="color: red">*</span></label>
              <input type="date" id="cashEntryDate" class="form-control" required />
            </div>

            <!-- 계정과목 -->
            <div class="form-group">
              <label for="cashEntryAccount">계정과목 <span style="color: red">*</span></label>
              <select id="cashEntryAccount" class="form-control" required>
                <option value="">선택하세요</option>
              </select>
            </div>
          </div>

          <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px">
            <!-- 입출구분 -->
            <div class="form-group">
              <label for="cashEntryType">입출구분 <span style="color: red">*</span></label>
              <select id="cashEntryType" class="form-control" required onchange="toggleCashEntryAmounts()">
                <option value="">선택하세요</option>
                <option value="1">입금</option>
                <option value="2">출금</option>
              </select>
            </div>

            <!-- 금액 -->
            <div class="form-group">
              <label for="cashEntryAmount">금액 <span style="color: red">*</span></label>
              <input type="number" id="cashEntryAmount" class="form-control" placeholder="금액을 입력하세요" min="0" step="1"
                required />
            </div>
          </div>

          <!-- 적요 -->
          <div class="form-group">
            <label for="cashEntryRemark">적요</label>
            <input type="text" id="cashEntryRemark" class="form-control" placeholder="적요를 입력하세요" maxlength="60" />
          </div>

          <!-- 버튼 영역 -->
          <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px">
            <button type="button" class="btn btn-secondary" onclick="closeCashEntryModal()">
              취소
            </button>
            <button type="submit" class="btn btn-primary">저장</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 현금출납 상세보기 모달 -->
  <div id="cashDetailModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      ">
    <div id="cashDetailModalContent" style="
          background: white;
          border-radius: 12px;
          padding: 0;
          width: 90%;
          max-width: 600px;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
          position: relative;
        ">
      <!-- 헤더 (드래그 가능) -->
      <div id="cashDetailModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 2px solid #e5e7eb;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px 12px 0 0;
            cursor: move;
            user-select: none;
          ">
        <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: white">
          💰 현금출납 상세정보
        </h3>
        <button onclick="closeCashDetailModal()" style="
              background: rgba(255, 255, 255, 0.2);
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: white;
              width: 32px;
              height: 32px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='rgba(255, 255, 255, 0.3)';"
          onmouseout="this.style.background='rgba(255, 255, 255, 0.2)';">
          ×
        </button>
      </div>

      <!-- 본문 -->
      <div style="padding: 20px 24px">
        <table style="
              width: 100%;
              border-collapse: separate;
              border-spacing: 0;
              border: 1px solid #e5e7eb;
              border-radius: 8px;
              overflow: hidden;
            ">
          <tbody>
            <tr style="background: #f9fafb">
              <th style="
                    width: 35%;
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                작성일자
              </th>
              <td id="cashDetailDate" style="
                    padding: 10px 16px;
                    color: #1f2937;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                -
              </td>
            </tr>
            <tr>
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    background: #f9fafb;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                작성시간
              </th>
              <td id="cashDetailTime" style="
                    padding: 10px 16px;
                    color: #1f2937;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                -
              </td>
            </tr>
            <tr style="background: #f9fafb">
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                계정과목
              </th>
              <td id="cashDetailAccount" style="
                    padding: 10px 16px;
                    color: #1f2937;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                    font-weight: 600;
                  ">
                -
              </td>
            </tr>
            <tr>
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    background: #f9fafb;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                입출구분
              </th>
              <td id="cashDetailType" style="
                    padding: 10px 16px;
                    color: #1f2937;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                -
              </td>
            </tr>
            <tr style="background: #f0fdf4">
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                💵 입금금액
              </th>
              <td id="cashDetailInAmount" style="
                    padding: 10px 16px;
                    text-align: right;
                    font-weight: 700;
                    color: #16a34a;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 16px;
                  ">
                -
              </td>
            </tr>
            <tr style="background: #fef2f2">
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                💸 출금금액
              </th>
              <td id="cashDetailOutAmount" style="
                    padding: 10px 16px;
                    text-align: right;
                    font-weight: 700;
                    color: #dc2626;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 16px;
                  ">
                -
              </td>
            </tr>
            <tr style="background: #f9fafb">
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                적요
              </th>
              <td id="cashDetailRemark" style="
                    padding: 10px 16px;
                    color: #1f2937;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                -
              </td>
            </tr>
            <tr>
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    background: #f9fafb;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                작성자
              </th>
              <td id="cashDetailCreator" style="
                    padding: 10px 16px;
                    color: #1f2937;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  ">
                -
              </td>
            </tr>
            <tr style="background: #f9fafb">
              <th style="
                    padding: 10px 16px;
                    text-align: left;
                    font-weight: 600;
                    color: #374151;
                    font-size: 13px;
                  ">
                수정일자
              </th>
              <td id="cashDetailModified" style="padding: 10px 16px; color: #6b7280; font-size: 13px">
                -
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- 푸터 -->
      <div style="
            display: flex;
            justify-content: flex-end;
            padding: 12px 24px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            border-radius: 0 0 12px 12px;
          ">
        <button onclick="closeCashDetailModal()" style="
              padding: 8px 20px;
              background: #6b7280;
              color: white;
              border: none;
              border-radius: 6px;
              font-size: 13px;
              font-weight: 600;
              cursor: pointer;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#4b5563';" onmouseout="this.style.background='#6b7280';">
          닫기
        </button>
      </div>
    </div>
  </div>

  <!-- 현금출납 삭제 확인 모달 -->
  <div id="cashDeleteModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      ">
    <div style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 450px;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        ">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #fee2e2;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #dc2626">
          현금출납 삭제
        </h2>
        <button onclick="closeCashDeleteModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
          onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <div style="margin-bottom: 24px">
        <p style="font-size: 16px; color: #1f2937; margin: 0 0 16px 0">
          다음 현금출납내역을 삭제하시겠습니까?
        </p>
        <div id="deleteCashInfo" style="
              padding: 16px;
              background: #fef2f2;
              border: 1px solid #fecaca;
              border-radius: 8px;
              font-weight: 500;
              color: #991b1b;
            ">
          작성일자: -
        </div>
        <p style="font-size: 14px; color: #6b7280; margin: 16px 0 0 0">
          ※ 삭제된 현금출납내역은 복구할 수 없습니다.
        </p>
      </div>

      <div style="display: flex; justify-content: flex-end; gap: 8px">
        <button onclick="closeCashDeleteModal()" style="
              padding: 10px 20px;
              background: #6c757d;
              color: white;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              cursor: pointer;
            ">
          취소
        </button>
        <button onclick="confirmCashDelete()" style="
              padding: 10px 20px;
              background: #dc2626;
              color: white;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              cursor: pointer;
            ">
          삭제
        </button>
      </div>
    </div>
  </div>

  <!-- 월마감 처리 모달 -->
  <div id="monthCloseModal" style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      ">
    <div style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 500px;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        ">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #fef3c7;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #f59e0b">
          📅 월마감 처리
        </h2>
        <button onclick="closeMonthCloseModal()" style="
              background: #f0f0f0;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: #666;
              width: 36px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              transition: all 0.2s ease;
            " onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
          onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';">
          ×
        </button>
      </div>

      <div style="margin-bottom: 24px">
        <p style="font-size: 16px; color: #1f2937; margin: 0 0 16px 0">
          회계전표내역을 월별로 마감 처리합니다.
        </p>

        <div style="margin-bottom: 16px">
          <label for="closeMonth" style="display: block; margin-bottom: 6px; font-weight: 600; color: #374151">
            마감년월 <span style="color: #dc2626">*</span>
          </label>
          <input type="month" id="closeMonth" class="form-control"
            style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px" />
        </div>

        <div style="
              padding: 16px;
              background: #fef3c7;
              border: 1px solid #fde68a;
              border-radius: 8px;
              font-size: 14px;
              color: #92400e;
            ">
          <p style="margin: 0 0 8px 0; font-weight: 600">⚠️ 주의사항</p>
          <ul style="margin: 0; padding-left: 20px">
            <li>모든 계정과목의 해당 월 데이터가 마감됩니다.</li>
            <li>마감 후에는 해당 월 데이터가 집계되어 조회 속도가 향상됩니다.</li>
            <li>이미 마감된 월은 재마감됩니다.</li>
          </ul>
        </div>
      </div>

      <div style="display: flex; justify-content: flex-end; gap: 8px">
        <button onclick="closeMonthCloseModal()" style="
              padding: 10px 20px;
              background: #6c757d;
              color: white;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              cursor: pointer;
            ">
          취소
        </button>
        <button onclick="confirmMonthClose()" style="
              padding: 10px 20px;
              background: #f59e0b;
              color: white;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              cursor: pointer;
              font-weight: 500;
            ">
          월마감 실행
        </button>
      </div>
    </div>
  </div>
</body>

</html>