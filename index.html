<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>판매관리 시스템</title>
  <!-- 하워드 휴즈 & 멜빈 다마 -->
  <!-- jQuery & DataTables -->
  <script src="js/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="DataTable/datatables.css" />
  <script src="DataTable/datatables.min.js"></script>

  <!-- 다음 우편번호 API -->
  <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

  <!-- 공통 유틸리티 함수 (다른 모듈보다 먼저 로드) -->
  <script src="js/common.js" defer></script>

  <script src="js/dataTableInit.js" defer></script>
  <script src="js/modal-draggable.js?v=251216_drag_fix" defer></script>

  <script src="js/customer.js?v=251212_improvement" defer></script>
  <script src="js/material.js?v=251217_row_click" defer></script>
  <script src="js/account.js" defer></script>
  <script src="js/supplier.js?v=251212_improvement" defer></script>
  <script src="js/quotation.js?v=251223_edit_mode_fix" defer></script>
  <script src="js/order.js?v=251212_improvement" defer></script>
  <script src="js/postoffice.js?v=1031M" defer></script>
  <!-- print.js를 transaction.js, quotation.js보다 먼저 로드하여 각 모듈의 인쇄 함수를 덮어쓸 수 있도록 함 -->
  <script src="js/print.js?v=1114.js" defer></script>
  <script src="js/transaction.js?v=251224_sorting_unit" defer></script>
  <script src="js/cash-history.js" defer></script>
  <script src="js/trial-balance.js" defer></script>
  <script src="js/balance-sheet.js" defer></script>
  <script src="js/transaction-price-history.js?v=251221_5columns" defer></script>
  <script src="js/purchase.js?v=251212_improvement" defer></script>
  <script src="js/material-history.js?v=251211_fix3" defer></script>
  <script src="js/material-inventory.js?v=1101" defer></script>
  <script src="js/material-category.js?v=1101" defer></script>
  <script src="js/taxinvoice.js?v=1113_v4" defer></script>
  <script src="js/accounts-payable.js" defer></script>
  <script src="js/accounts-receivable.js" defer></script>

  <link rel="stylesheet" href="css/onstyles.css?v=251212_btnstyles" />
  <!-- <link rel="stylesheet" href="css/shadcn-ui.css" /> -->
  <!-- <link rel="stylesheet" href="css/default.css" /> -->
</head>

<body>
  <!-- 로그인 페이지 -->
  <div class="login-container" id="loginPage" style="display: flex">
    <div class="login-box">
      <div class="login-header">
        <h1>판매관리 시스템</h1>
        <p id="workplaceNameLogin" style="font-size: 16px; font-weight: 600; color: var(--primary); margin-top: 8px">
          사업장 정보 로딩 중...
        </p>
        <p>로그인하여 시스템을 사용하세요</p>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="workplaceCode">사업장 선택</label>
          <select id="workplaceCode" class="form-input" required style="cursor: pointer">
            <option value="">사업장을 선택하세요</option>
          </select>
        </div>
        <div class="form-group">
          <label for="loginDateText">접속일자</label>
          <div style="display: flex; gap: 12px; align-items: center">
            <input type="text" id="loginDateText" class="form-input" placeholder="YYYY-MM-DD 직접 입력"
              autocomplete="off" />
            <div style="position: relative; flex: 1">
              <input type="date" id="loginDatePicker" class="form-input" style="padding-right: 44px" />
              <button type="button" onclick="openLoginDatePicker()" aria-label="달력으로 일자 선택" style="
                    position: absolute;
                    top: 50%;
                    right: 12px;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    cursor: pointer;
                    padding: 0;
                    display: flex;
                  ">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                  <line x1="16" y1="2" x2="16" y2="6"></line>
                  <line x1="8" y1="2" x2="8" y2="6"></line>
                  <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="userId">사용자 아이디</label>
          <input type="text" id="userId" class="form-input" placeholder="아이디를 입력하세요" required />
        </div>
        <div class="form-group">
          <label for="password">비밀번호</label>
          <input type="password" id="password" class="form-input" placeholder="비밀번호를 입력하세요"
            autocomplete="current-password" required />
        </div>
        <button type="submit" class="btn-login">로그인</button>
      </form>
      <div class="login-message" id="loginMessage">시스템에 오신 것을 환영합니다.</div>
    </div>
  </div>

  <!-- 대시보드 -->
  <div class="dashboard" id="dashboard" style="display: none">
    <!-- 사이드바 -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>판매관리 시스템</h2>
        <p id="workplaceNameSidebar" style="font-size: 14px; color: #93c5fd; margin-top: 4px; font-weight: 500"></p>
      </div>
      <nav class="sidebar-menu">
        <div class="menu-item">
          <a class="menu-link active" onclick="showPage('dashboard')">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
              </path>
            </svg>
            대시보드
          </a>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="jangbuMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253">
              </path>
            </svg>
            장부관리
            <span class="arrow">▼</span>
          </a>
          <!--
            매입처장부관리 -> Purchaser's ledger management (TODO: Not implemented)
            매출처장부관리 -> Sales ledger management (TODO: Not implemented)
            미수금관리 -> Accounts receivable management (TODO: Not implemented)
            미지급금관리 -> Accounts Payable Management (TODO: Not implemented)
            세금계산서관리 -> Tax invoice management (TODO: Not implemented)

            NOTE: 현금출납관리는 회계관리 메뉴의 "현금출납내역관리"로 이동됨
            -->
          <div class="submenu" id="jangbuSubmenu">
            <a class="submenu-link" onclick="alert('매입처장부관리 기능은 준비 중입니다.')">매입처장부관리</a>
            <a class="submenu-link" onclick="alert('매출처장부관리 기능은 준비 중입니다.')">매출처장부관리</a>
            <a class="submenu-link" onclick="showPage('receivable')">미수금관리</a>
            <a class="submenu-link" onclick="showPage('payable')">미지급금관리</a>
            <a class="submenu-link" onclick="showPage('taxInvoice')">세금계산서관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="purchaseMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
            </svg>
            매입관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="purchaseSubmenu">
            <a class="submenu-link" onclick="showPage('order')">발주관리</a>
            <a class="submenu-link" onclick="showPage('purchase')">매입전표관리</a>
            <a class="submenu-link" onclick="showPage('supplier')">매입처관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="salesMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z">
              </path>
            </svg>
            매출관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="salesSubmenu">
            <a class="submenu-link" onclick="showPage('quotation')">견적서관리</a>
            <a class="submenu-link" onclick="showPage('transaction')">거래명세서관리</a>
            <a class="submenu-link" onclick="showPage('customer')">매출처관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="itemMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
            </svg>
            자재관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="itemsSubmenu">
            <a class="submenu-link" onclick="showPage('materialCategory')">자재분류관리</a>
            <a class="submenu-link" onclick="showPage('materialHistory')">자재내역관리</a>
            <a class="submenu-link" onclick="showPage('materialInventory')">자재재고관리</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="accountMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z">
              </path>
            </svg>
            회계관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="accountSubmenu">
            <a class="submenu-link" onclick="showPage('account-catagory')">계정과목관리</a>
            <a class="submenu-link" onclick="showPage('account-history')">현금출납관리</a>
            <a class="submenu-link" onclick="showPage('accounting-voucher')">회계전표관리</a>
            <a class="submenu-link" onclick="showPage('total-balnace')">합계잔액시산표</a>
            <a class="submenu-link" onclick="showPage('account-balnace')">대차대조표</a>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="printMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z">
              </path>
            </svg>
            출력물관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="printSubmenu">
            <!-- 일계표 -->
            <a class="submenu-link" onclick="showPage('daily-report-print')">일계표</a>

            <!-- 미지급금 -->
            <div class="submenu-group">
              <span class="submenu-group-title">미지급금</span>
              <a class="submenu-link submenu-indent" onclick="showPage('payable-summary-print')">업체별 미지급금 현황(집계표)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('payable-daily-print')">업체별 지급 현황(일자별)</a>
            </div>

            <!-- 매입현황 -->
            <div class="submenu-group">
              <span class="submenu-group-title">매입현황</span>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-item-print')">품목별 매입 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-item-print')">업체별 매입
                현황(품목별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-daily-print')">업체별 매입
                현황(일자별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-print')">업체별 매입 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-tax-ledger-print')">매입세금계산서 장부 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('purchase-by-supplier-3months-print')">업체별 매입
                현황(3개월)</a>
            </div>

            <!-- 미수금 -->
            <div class="submenu-group">
              <span class="submenu-group-title">미수금</span>
              <a class="submenu-link submenu-indent" onclick="showPage('receivable-summary-print')">업체별 미수금 현황(집계표)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('receivable-daily-print')">업체별 수금 현황(일자별)</a>
            </div>

            <!-- 매출현황 -->
            <div class="submenu-group">
              <span class="submenu-group-title">매출현황</span>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-item-print')">품목별 매출 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-item-print')">업체별 매출
                현황(품목별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-daily-print')">업체별 매출
                현황(일자별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-print')">업체별 매출 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-tax-ledger-print')">매출세금계산서 장부 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-tax-status-print')">매출세금계산서 현황</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-3months-print')">업체별 매출
                현황(3개월간)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-daily-cost-print')">업체별 매출
                현황(일자별, 매입단가출력)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('sales-by-customer-cost-print')">업체별 매출
                현황(매입단가출력)</a>
            </div>

            <!-- 회계관리 -->
            <div class="submenu-group">
              <span class="submenu-group-title">회계관리</span>
              <a class="submenu-link submenu-indent" onclick="showPage('cashbook-daily-print')">출납관리(일자별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('cashbook-account-print')">출납관리(계정과목별)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('cashbook-summary-print')">출납관리(계정별집계)</a>
              <a class="submenu-link submenu-indent" onclick="showPage('trial-balance-print')">합계시산표</a>
            </div>
          </div>
        </div>

        <div class="menu-item">
          <a class="menu-link" onclick="toggleSubmenu(this)" id="settingMenu">
            <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
              </path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            설정관리
            <span class="arrow">▼</span>
          </a>
          <div class="submenu" id="settingSubmenu">
            <a class="submenu-link" onclick="showPage('paper-setting')">용지설정관리</a>
            <!-- <a class="submenu-link" onclick="showPage('salespaper-setting')">거래명세서설정관리</a> -->
            <a class="submenu-link" onclick="showPage('taxpaper-setting')">세금계산서설정관리</a>
            <a class="submenu-link" onclick="showPage('warehouse-setting')">창고설정관리</a>
            <a class="submenu-link" onclick="showPage('taxrate-setting')">부과세율설정관리</a>
          </div>
        </div>
      </nav>
    </aside>

    <!-- 메인 컨텐츠 -->
    <main class="main-content">
      <div class="top-bar">
        <div style="display: flex; align-items: center; gap: 16px">
          <h1 id="pageTitle">대시보드</h1>
          <div style="
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 8px 16px;
                background: #f0f9ff;
                border-radius: 8px;
                border: 1px solid #bfdbfe;
              ">
            <span style="font-size: 16px">📅</span>
            <span id="currentWorkingDate" style="font-size: 14px; font-weight: 600; color: #1e40af">2025-11-01</span>
            <span style="font-size: 12px; color: #6b7280" id="currentWorkingDay">(금)</span>
            <button onclick="openDateChangeModal()" style="
                  padding: 4px 12px;
                  background: white;
                  border: 1px solid #bfdbfe;
                  border-radius: 6px;
                  font-size: 12px;
                  cursor: pointer;
                  color: #2563eb;
                  font-weight: 500;
                  margin-left: 8px;
                " onmouseover="this.style.background='#eff6ff';" onmouseout="this.style.background='white';">
              변경
            </button>
          </div>
        </div>
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <span id="userName">사용자</span>
          <button class="btn-logout" onclick="logout()">로그아웃</button>
        </div>
      </div>
      <!-- content-area start -->
      <div class="content-area">
        <!-- 대시보드 페이지 -->
        <div class="page-content active" id="dashboardPage">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-label">오늘 매출</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">이번달 매출</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">미수금</div>
              <div class="stat-value">₩0</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            <!-- 재고 현황 주석처리
            <div class="stat-card">
              <div class="stat-label">재고 현황</div>
              <div class="stat-value">0건</div>
              <div class="stat-change">데이터 로딩중...</div>
            </div>
            -->
          </div>

          <div class="content-card">
            <h3 class="card-title">판매관리 시스템에 오신 것을 환영합니다</h3>
            <p style="color: var(--text-gray); margin-top: 16px; line-height: 1.6">
              좌측 메뉴에서 원하시는 기능을 선택하세요.<br />
              • 매출관리: 견적, 거래명세서, 매출처 관리<br />
              • 매입관리: 발주, 매입전표, 매입처 관리<br />
              • 재고관리: 자재 및 재고 현황 조회
            </p>
          </div>

          <!-- 오늘의 문서 현황 -->
          <div id="todayDocumentStatus" style="
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
                margin-top: 24px;
              ">
            <!-- 견적서 리스트 -->
            <div id="todayQuotationSection" class="content-card" style="padding: 20px">
              <h3 class="card-title" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <span>📋 오늘의 견적서</span>
                <span id="todayQuotationCount" style="font-size: 14px; color: #007bff; font-weight: normal">0건</span>
              </h3>
              <div style="height: 200px; overflow: hidden">
                <div style="height: 100%; overflow-y: auto">
                  <table id="todayQuotationTable" class="display" style="width: 100%; font-size: 13px">
                    <thead>
                      <tr>
                        <th style="width: 60px">번호</th>
                        <th>매출처</th>
                        <th style="width: 100px">금액</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- 발주서 리스트 -->
            <div id="todayOrderSection" class="content-card" style="padding: 20px">
              <h3 class="card-title" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <span>📦 오늘의 발주서</span>
                <span id="todayOrderCount" style="font-size: 14px; color: #28a745; font-weight: normal">0건</span>
              </h3>
              <div style="height: 200px; overflow: hidden">
                <div style="height: 100%; overflow-y: auto">
                  <table id="todayOrderTable" class="display" style="width: 100%; font-size: 13px">
                    <thead>
                      <tr>
                        <th style="width: 60px">번호</th>
                        <th>매입처</th>
                        <th style="width: 100px">금액</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- 거래명세서 리스트 -->
            <div id="todayTransactionSection" class="content-card" style="padding: 20px">
              <h3 class="card-title" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 16px;
                  ">
                <span>📄 오늘의 거래명세서</span>
                <span id="todayTransactionCount" style="font-size: 14px; color: #ffc107; font-weight: normal">0건</span>
              </h3>
              <div style="height: 200px; overflow: hidden">
                <div style="height: 100%; overflow-y: auto">
                  <table id="todayTransactionTable" class="display" style="width: 100%; font-size: 13px">
                    <thead>
                      <tr>
                        <th style="width: 60px">번호</th>
                        <th>매출처</th>
                        <th style="width: 100px">금액</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Please write the page display code corresponding to the menu click from here. N:490 -->

        <!-- 거래명세서관리 메뉴 페이지 -->
        <div class="page-content hidden" id="transactionManagePage">
          <h2 style="display: none">거래명세서관리</h2>

          <!-- 🔹 상단 툴바 -->
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="transactionStatusFilter" class="form-control" style="width: 150px"
                onchange="filterTransactions()">
                <option value="">전체 상태</option>
                <option value="1">작성중</option>
                <option value="2">확정</option>
                <option value="3">발행완료</option>
              </select>
              <input type="date" id="transactionStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="transactionEndDate" class="form-control" style="width: 150px" />
              <button id="transactionBtnFilter" class="btn btn-secondary" onclick="filterTransactions()">조회</button>
            </div>

            <div class="toolbar-right">
              <button id="transactionBtnNew" class="btn btn-success" onclick="openTransactionCreateModal()" style="
                    padding: 10px 20px;
                    background: #28a745;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 거래명세서 작성
              </button>
              <button id="transactionBtnExport" class="btn btn-secondary" onclick="exportTransactionsToExcel()" style="
                    padding: 10px 20px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 거래명세서 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 거래명세서 수: <span id="transactionCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- ✅ 거래명세서 목록 DataTable -->
          <table id="transactionTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="transactionSelectAll" /></th>
                <th>순번</th>
                <th>명세서번호</th>
                <th>거래일자</th>
                <th>매출처명</th>
                <th>공급가액</th>
                <th>부가세</th>
                <th>합계금액</th>
                <th>작성자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="transactionTableBody"></tbody>
          </table>
        </div>

        <!-- 견적서관리 메뉴 페이지 -->
        <div class="page-content hidden" id="quotationManagePage">
          <h2 style="display: none">견적서관리</h2>
          <div class="toolbar" style="justify-content: space-between">
            <div class="toolbar-left" style="display: flex; gap: 12px; align-items: center">
              <select id="quotationManageStatusFilter" class="form-control" style="width: 150px"
                onchange="filterQuotations()">
                <option value="">전체 상태</option>
                <option value="1">작성중</option>
                <option value="2">승인</option>
                <option value="3">반려</option>
              </select>
              <input type="date" id="quotationManageStartDate" class="form-control" style="width: 150px" />
              <span>~</span>
              <input type="date" id="quotationManageEndDate" class="form-control" style="width: 150px" />
              <button id="quotationManageFilterBtn" class="btn btn-secondary" onclick="filterQuotations()">조회</button>
            </div>
            <div class="toolbar-right">
              <button id="quotationManageCreateBtn" class="btn btn-success" onclick="openQuotationManageCreateModal()"
                style="
                                    padding: 10px 20px;
                                    background: #28a745;
                                    color: white;
                                    border: none;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    font-weight: 500;
                                    cursor: pointer;
                                  ">
                <span style="font-size: 18px; margin-right: 4px">+</span> 견적서 작성
              </button>
              <button id="quotationManageExportBtn" class="btn btn-secondary" onclick="exportQuotationsToExcel()" style="
                                    padding: 10px 20px;
                                    background: #6c757d;
                                    color: white;
                                    border: none;
                                    border-radius: 8px;
                                    font-size: 14px;
                                    font-weight: 500;
                                    cursor: pointer;
                                  ">
                <span>&#128196;</span> Google Sheets로 내보내기
              </button>
            </div>
          </div>

          <!-- ✅ 견적 요약 정보 -->
          <div class="summary-bar" style="margin: 10px 0; font-size: 14px">
            총 견적 수: <span id="quotationManageCount" style="font-weight: bold">0</span> 건
          </div>

          <!-- DataTable -->
          <table id="quotationManageTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px"><input type="checkbox" id="quotationManageSelectAll" /></th>
                <th>순번</th>
                <th>견적번호</th>
                <th>매출처명</th>
                <th>견적일자</th>
                <th>제목</th>
                <th>견적금액</th>
                <th>담당자</th>
                <th>상태</th>
                <th>관리</th>
              </tr>
            </thead>
            <tbody id="quotationManageTableBody"></tbody>
          </table>
        </div>

        <!-- 매출처관리 페이지 -->
        <div id="salesCustomerManagePage" class="page-content hidden">
          <h2 style="display: none">매출처관리</h2>
          <div class="toolbar"
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px">
            <!-- 왼쪽: 검색 영역 -->
            <div style="display: flex; gap: 8px; align-items: center">
              <input type="text" id="salesCustomerManageSearchInput" placeholder="매출처코드 또는 매출처명 검색..."
                style="padding: 10px 16px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; width: 280px; outline: none" />
              <button id="salesCustomerManageSearchBtn" class="btn btn-primary" onclick="searchSalesCustomerManage()"
                style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer">
                🔍 검색
              </button>
              <button id="salesCustomerManageResetBtn" class="btn btn-light" onclick="resetSalesCustomerManageSearch()"
                style="padding: 10px 16px; background: #f8f9fa; color: #333; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer">
                초기화
              </button>
            </div>

            <!-- 오른쪽: 액션 버튼 영역 -->
            <div style="display: flex; gap: 8px">
              <button id="salesCustomerManageCreateBtn" class="btn btn-success"
                onclick="openSalesCustomerManageCreateModal()"
                style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer">
                <span style="font-size: 18px; margin-right: 4px">+</span> 신규 등록
              </button>
              <button id="salesCustomerManageExportBtn" class="btn btn-secondary"
                onclick="exportSalesCustomerManageToGoogleSheets()"
                style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer">
                <span style="font-size: 18px; margin-right: 4px">📊</span> Google Sheets로 보내기
              </button>
            </div>
          </div>

          <!-- DataTables 적용용 테이블 -->
          <table id="salesCustomerManageTable" class="display" style="width: 100%">
            <thead>
              <tr>
                <th style="width: 40px">
                  <input type="checkbox" id="salesCustomerManageSelectAll" title="전체 선택" aria-label="전체 선택" />
                </th>
                <th>순번</th>
                <th>매출처코드</th>
                <th>매출처명</th>
                <th>대표자</th>
                <th>사업자번호</th>
                <th>연락처</th>
                <th>거래상태</th>
                <th>등록일</th>
                <th style="width: 180px">관리</th>
              </tr>
            </thead>
          </table>
        </div>

        <script>
          // 전역 변수 선언
          let currentUser = null;
          let heartbeatInterval = null; // Heartbeat 타이머

          // 페이지 라우팅
          const pageMap = {
            dashboard: {
              element: 'dashboardPage',
              title: '대시보드',
              menu: null,
              loadFunc: null,
            },
            quotation: {
              element: 'quotationManagePage',
              title: '견적서관리',
              menu: 'sales',
              loadFunc: () => {
                if (typeof window.loadQuotations === 'function') {
                  window.loadQuotations();
                }
              },
            },
            transaction: {
              element: 'transactionManagePage',
              title: '거래명세서관리',
              menu: 'sales',
              loadFunc: () => {
                if (typeof window.initTransactionPage === 'function') {
                  window.initTransactionPage();
                }
              },
            },
            taxInvoice: {
              element: 'taxInvoicePage',
              title: '세금계산서관리',
              menu: 'jangbu',
              loadFunc: () => {
                if (typeof window.loadTaxInvoices === 'function') {
                  window.loadTaxInvoices();
                }
              },
            },
            receivable: {
              element: 'receivablePage',
              title: '미수금관리',
              menu: 'ledger',
              loadFunc: null,
            },
            customer: {
              element: 'salesCustomerManagePage',
              title: '매출처관리',
              menu: 'sales',
              loadFunc: () => {
                if (typeof window.loadSalesCustomers === 'function') {
                  window.loadSalesCustomers();
                }
              },
            },
            order: {
              element: 'orderPage',
              title: '발주관리',
              menu: 'purchase',
              loadFunc: () => {
                if (typeof window.loadOrderList === 'function') {
                  window.loadOrderList();
                }
              },
            },
            purchase: {
              element: 'purchaseStatementPage',
              title: '매입전표관리',
              menu: 'purchase',
              loadFunc: () => {
                if (typeof window.loadPurchaseStatements === 'function') {
                  window.loadPurchaseStatements();
                }
              },
            },
            payable: {
              element: 'payablePage',
              title: '미지급금관리',
              menu: 'purchase',
              loadFunc: null, // accounts-payable.js에서 DOMContentLoaded 시 설정
            },
            supplier: {
              element: 'supplierPage',
              title: '매입처관리',
              menu: 'purchase',
              loadFunc: () => {
                if (typeof window.loadSuppliers === 'function') {
                  window.loadSuppliers();
                }
              },
            },
            materialCategory: {
              element: 'materialCategoryPage',
              title: '자재분류관리',
              menu: 'material',
              loadFunc: () => {
                if (typeof initMaterialCategoryTable === 'function') {
                  initMaterialCategoryTable();
                }
                if (typeof loadMaterialCategories === 'function') {
                  loadMaterialCategories();
                }
              },
            },
            materialHistory: {
              element: 'materialHistoryPage',
              title: '자재내역관리',
              menu: 'material',
              loadFunc: () => {
                // 페이지 표시만 하고 데이터는 검색 시에만 로드
                if (typeof initMaterialHistoryTable === 'function') {
                  initMaterialHistoryTable();
                }
              },
            },
            materialInventory: {
              element: 'materialInventoryPage',
              title: '자재재고관리',
              menu: 'material',
              loadFunc: () => {
                if (typeof window.loadMaterialInventoryPage === 'function') {
                  window.loadMaterialInventoryPage();
                }
              },
            },
            financialClosing: {
              element: 'financialClosingPage',
              title: '회계마감관리',
              menu: 'accounting',
              loadFunc: null,
            },
            'account-catagory': {
              element: 'accountCatagoryPage',
              title: '계정과목관리',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadAccounts === 'function') {
                  loadAccounts();
                }
              },
            },
            'account-history': {
              element: 'accountHistoryPage',
              title: '현금출납내역관리',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadCashHistory === 'function') {
                  loadCashHistory();
                }
              },
            },
            'accounting-voucher': {
              element: 'accountingVoucherPage',
              title: '회계전표관리',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadAccountingVouchers === 'function') {
                  loadAccountingVouchers();
                }
              },
            },
            'total-balnace': {
              element: 'totalBalancePage',
              title: '합계잔액시산표',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadTrialBalance === 'function') {
                  loadTrialBalance();
                }
              },
            },
            'account-balnace': {
              element: 'accountBalancePage',
              title: '대차대조표',
              menu: 'accounting',
              loadFunc: () => {
                if (typeof loadBalanceSheet === 'function') {
                  loadBalanceSheet();
                }
              },
            },
            settings: {
              element: 'settingsPage',
              title: '시스템설정',
              menu: 'settings',
              loadFunc: null,
            },
            'paper-setting': {
              element: 'paperSettingPage',
              title: '용지설정관리',
              menu: 'settings',
              loadFunc: () => {
                if (typeof loadPaperMargins === 'function') {
                  loadPaperMargins();
                }
              },
            },
            'daily-report-print': {
              element: 'dailyReportPrintPage',
              title: '일계표',
              menu: 'print',
              loadFunc: () => {
                // 오늘 날짜 자동 설정
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('dailyReportStartDate').value = today;
                document.getElementById('dailyReportEndDate').value = today;
              },
            },
          };

          // pageMap을 전역 스코프로 노출
          window.pageMap = pageMap;

          let currentPage = 'dashboard';

          function showPage(pageName) {
            // 모든 페이지 숨김 (.active 클래스 제거, .hidden 클래스 추가)
            document.querySelectorAll('.page-content').forEach((page) => {
              page.classList.remove('active');
              page.classList.add('hidden');
            });

            // 모든 사이드바 메뉴 비활성화
            document.querySelectorAll('.sidebar-menu li').forEach((item) => {
              item.classList.remove('active');
            });

            // 선택한 페이지 표시
            const selectedPage = pageMap[pageName];
            if (selectedPage && selectedPage.element) {
              const pageElement = document.getElementById(selectedPage.element);
              if (pageElement) {
                pageElement.classList.remove('hidden');
                pageElement.classList.add('active');

                // 페이지 제목 업데이트
                const pageTitleEl = document.getElementById('pageTitle');
                if (pageTitleEl && selectedPage.title) {
                  pageTitleEl.textContent = selectedPage.title;
                }

                // 선택한 메뉴 활성화
                const menuItem = document
                  .querySelector(`[onclick="showPage('${pageName}')"]`)
                  ?.closest('li');
                if (menuItem) {
                  menuItem.classList.add('active');
                }

                // loadFunc 실행 (로그인 여부와 상관없이 실행)
                if (selectedPage.loadFunc) {
                  selectedPage.loadFunc();
                }

                currentPage = pageName;
              }
            }
          }

          // showPage와 toggleMenu를 전역 스코프로 노출
          window.showPage = showPage;
          window.toggleMenu = toggleMenu;

          // 사이드바 메뉴 토글
          function toggleMenu(menuId) {
            const menuElement = document.getElementById(menuId);
            if (!menuElement) return;

            const isCurrentlyActive = menuElement.classList.contains('active');

            // 모든 서브메뉴 닫기
            document.querySelectorAll('.submenu').forEach((submenu) => {
              submenu.classList.remove('active');
            });

            // 클릭한 메뉴가 닫혀있었다면 열기
            if (!isCurrentlyActive) {
              menuElement.classList.add('active');
            }
          }

          // 로그인 체크
          async function checkAuth() {
            try {
              const response = await fetch('/api/auth/me', { credentials: 'include' });

              // ✅ HTTP 상태 코드 먼저 확인
              if (!response.ok) {
                // 401 Unauthorized 또는 기타 에러 - 로그인 페이지 표시
                console.log('🔴 로그인 필요 - 로그인 페이지 표시');
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
                console.log(
                  'loginPage display:',
                  document.getElementById('loginPage').style.display,
                );
                console.log(
                  'dashboard display:',
                  document.getElementById('dashboard').style.display,
                );
                return false;
              }

              const result = await response.json();

              if (!result.success) {
                // 로그인 페이지 표시
                console.log('🔴 인증 실패 - 로그인 페이지 표시');
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
                return false;
              }

              const user = result.data;

              // currentUser에 사용자 정보 저장
              currentUser = user;

              document.getElementById('userName').textContent = user.사용자명 || '사용자';

              // 로그인된 상태 - 대시보드 표시
              console.log('✅ 로그인 성공 - 대시보드 표시');
              document.getElementById('loginPage').style.display = 'none';
              document.getElementById('dashboard').style.display = 'flex';

              // Heartbeat 시작
              startHeartbeat();

              return true;
            } catch (err) {
              console.error('인증 확인 오류:', err);
              // 로그인 페이지 표시
              console.log('🔴 에러 발생 - 로그인 페이지 표시');
              document.getElementById('loginPage').style.display = 'flex';
              document.getElementById('dashboard').style.display = 'none';
              return false;
            }
          }

          // 로그인 날짜 자동 설정 함수
          function setLoginDateToToday() {
            const today = new Date();

            // 한국 시간 기준으로 날짜 계산 (UTC+9)
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const day = String(today.getDate()).padStart(2, '0');
            const formatted = `${year}-${month}-${day}`; // YYYY-MM-DD 형식

            const loginDateText = document.getElementById('loginDateText');
            const loginDatePicker = document.getElementById('loginDatePicker');

            // 두 입력창 모두 오늘 날짜 자동 설정
            if (loginDateText) loginDateText.value = formatted;
            if (loginDatePicker) loginDatePicker.value = formatted;

            console.log(`✅ 로그인 날짜 자동 설정 완료 (로컬 시간 기준): ${formatted}`);
          }

          // ==================== Heartbeat 관리 ====================

          /**
           * Heartbeat 시작 - 5분마다 서버에 활동 신호 전송
           */
          function startHeartbeat() {
            // 기존 타이머가 있으면 중지
            stopHeartbeat();

            console.log('✅ Heartbeat 시작 (5분 간격)');

            // 5분마다 heartbeat 전송
            heartbeatInterval = setInterval(async () => {
              try {
                const response = await fetch('/api/auth/heartbeat', {
                  method: 'POST',
                  credentials: 'include',
                });

                if (!response.ok) {
                  console.warn('⚠️  Heartbeat 실패 - 세션이 만료되었을 수 있습니다.');
                  // 세션 만료 시 로그인 페이지로 리다이렉트
                  if (response.status === 401) {
                    stopHeartbeat();
                    alert('세션이 만료되었습니다. 다시 로그인해주세요.');
                    location.reload();
                  }
                } else {
                  console.log('💓 Heartbeat 전송 성공');
                }
              } catch (error) {
                console.error('❌ Heartbeat 전송 중 오류:', error);
              }
            }, 5 * 60 * 1000); // 5분 (300,000ms)
          }

          /**
           * Heartbeat 중지
           */
          function stopHeartbeat() {
            if (heartbeatInterval) {
              clearInterval(heartbeatInterval);
              heartbeatInterval = null;
              console.log('🛑 Heartbeat 중지');
            }
          }

          // 로그아웃
          async function logout() {
            if (!confirm('로그아웃 하시겠습니까?')) {
              return;
            }

            try {
              // Heartbeat 중지
              stopHeartbeat();

              // 서버에 로그아웃 요청
              await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });

              // currentUser 초기화
              if (typeof currentUser !== 'undefined') {
                currentUser = null;
              }

              // localStorage 정리
              localStorage.removeItem('workingDate');

              // 로그인 페이지 표시
              document.getElementById('loginPage').style.display = 'flex';
              document.getElementById('dashboard').style.display = 'none';

              // 폼 초기화
              document.getElementById('loginForm').reset();

              // 로그인 메시지 초기화
              const loginMessage = document.getElementById('loginMessage');
              if (loginMessage) {
                loginMessage.textContent = '시스템에 오신 것을 환영합니다.';
                loginMessage.className = 'login-message';
              }

              // 날짜 자동 설정
              setLoginDateToToday();

              console.log('✅ 로그아웃 완료');
            } catch (err) {
              console.error('로그아웃 오류:', err);
              alert('로그아웃 중 오류가 발생했습니다.');
            }
          }

          // 사업장 정보 로드 (로그인 페이지 제목에 표시)
          async function loadWorkplaceInfo() {
            try {
              const response = await fetch('/api/workplaces');
              const result = await response.json();

              if (result.success && result.data && result.data.length > 0) {
                // 첫 번째 사업장 정보 표시 (추후 사업장 선택 기능 추가 가능)
                const workplace = result.data[0];
                const workplaceNameEl = document.getElementById('workplaceNameLogin');
                if (workplaceNameEl) {
                  workplaceNameEl.textContent = workplace.사업장명 || '사업장';
                }
              }
            } catch (err) {
              console.error('사업장 정보 로드 실패:', err);
              const workplaceNameEl = document.getElementById('workplaceNameLogin');
              if (workplaceNameEl) {
                workplaceNameEl.textContent = '판매관리 시스템';
              }
            }
          }

          // ==================== 모달 드래그 기능 ====================

          /**
           * 모달을 드래그 가능하게 만드는 함수
           * @param {string} modalId - 모달 컨테이너 ID
           * @param {string} headerId - 드래그 핸들(헤더) ID 또는 클래스
           */
          window.makeModalDraggable = function (modalId, headerId) {
            const modalContent = document.getElementById(modalId);
            if (!modalContent) {
              console.warn('Modal content not found:', modalId);
              return;
            }

            // 이미 드래그 설정되어 있으면 제거
            if (modalContent._dragHandler) {
              const oldHandle = modalContent._dragHandler.handle;
              const oldHandlers = modalContent._dragHandler.handlers;
              oldHandle.removeEventListener('mousedown', oldHandlers.dragStart);
              document.removeEventListener('mousemove', oldHandlers.drag);
              document.removeEventListener('mouseup', oldHandlers.dragEnd);
            }

            let isDragging = false;
            let currentX;
            let currentY;
            let initialX;
            let initialY;
            let xOffset = 0;
            let yOffset = 0;

            // 헤더 영역을 드래그 핸들로 설정
            let dragHandle;
            if (headerId.startsWith('.')) {
              dragHandle = modalContent.querySelector(headerId);
            } else {
              dragHandle = document.getElementById(headerId);
            }

            if (!dragHandle) {
              console.warn('Drag handle not found:', headerId);
              dragHandle = modalContent;
            }

            console.log('✅ Setting up draggable modal:', modalId, headerId);

            // 드래그를 위한 위치 설정
            // Flex 레이아웃에서는 transform이 제대로 작동하지 않으므로 absolute로 변경
            const parentModal = modalContent.closest('.modal');
            if (parentModal) {
              // 모달이 이미 flex로 설정되어 있는 경우
              const modalDisplay = window.getComputedStyle(parentModal).display;
              if (modalDisplay === 'flex' || parentModal.style.display === 'flex') {
                // 모달 컨텐츠를 absolute positioning으로 변경
                modalContent.style.position = 'absolute';
                modalContent.style.top = '50%';
                modalContent.style.left = '50%';
                modalContent.style.transform = 'translate(-50%, -50%)';
                modalContent.style.margin = '0';

                console.log('🔄 Modal positioning changed to absolute for dragging');
              }
            }

            dragHandle.style.cursor = 'move';

            function dragStart(e) {
              // 버튼이나 입력 필드 클릭 시 드래그 방지
              if (
                e.target.tagName === 'BUTTON' ||
                e.target.tagName === 'INPUT' ||
                e.target.tagName === 'TEXTAREA' ||
                e.target.tagName === 'SELECT'
              ) {
                return;
              }

              initialX = e.clientX - xOffset;
              initialY = e.clientY - yOffset;

              if (e.target === dragHandle || dragHandle.contains(e.target)) {
                isDragging = true;
                console.log('🎯 Drag started');
              }
            }

            function drag(e) {
              if (isDragging) {
                e.preventDefault();

                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;

                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, modalContent);
              }
            }

            function dragEnd(e) {
              if (isDragging) {
                console.log('🛑 Drag ended');
              }
              initialX = currentX;
              initialY = currentY;
              isDragging = false;
            }

            function setTranslate(xPos, yPos, el) {
              el.style.transform = `translate(${xPos}px, ${yPos}px)`;
            }

            // 이벤트 리스너 등록
            dragHandle.addEventListener('mousedown', dragStart);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', dragEnd);

            // 핸들러 저장 (나중에 제거용)
            modalContent._dragHandler = {
              handle: dragHandle,
              handlers: { dragStart, drag, dragEnd },
            };

            // 모달이 닫힐 때 위치 초기화
            const modal = modalContent.closest('.modal');
            if (modal) {
              if (!modal._observer) {
                const observer = new MutationObserver((mutations) => {
                  mutations.forEach((mutation) => {
                    if (mutation.attributeName === 'style') {
                      if (modal.style.display === 'none') {
                        xOffset = 0;
                        yOffset = 0;
                        modalContent.style.transform = 'translate(0px, 0px)';
                        console.log('↩️  Modal position reset');
                      }
                    }
                  });
                });

                observer.observe(modal, { attributes: true, attributeFilter: ['style'] });
                modal._observer = observer;
              }
            }
          };

          // ==================== 브라우저 종료 시 자동 로그아웃 ====================

          /**
           * 브라우저 닫기/새로고침 시 강제 로그아웃
           */
          window.addEventListener('beforeunload', function (e) {
            if (currentUser && currentUser.사용자코드) {
              // sendBeacon을 사용하여 비동기로 로그아웃 요청 전송
              // 브라우저 종료 시에도 확실하게 전송됨
              const data = new URLSearchParams();
              data.append('사용자코드', currentUser.사용자코드);

              navigator.sendBeacon('/api/auth/force-logout', data);
              console.log('🚪 브라우저 종료 - 강제 로그아웃 요청 전송');
            }
          });

          // 초기 로드
          document.addEventListener('DOMContentLoaded', async () => {
            // 사업장 정보 로드
            await loadWorkplaceInfo();

            // 로그인 날짜 초기 설정
            setLoginDateToToday();

            // 프린트 마진 초기화
            initPrintMargins();

            const isLoggedIn = await checkAuth();
            if (isLoggedIn) {
              showPage('dashboard');
            }
          });
        </script>


      </div>
      <!-- content-area End -->
    </main>
    <!-- main End -->
  </div>
  <!-- dashboard End -->


  <!-- Write code for page modal here N:1260  -->

  <!-- ========================================
       견적서관리 모달 섹션
       ======================================== -->


  <!-- 견적서작성 버튼에 대한 모달 -->
  <div id="quotationManageCreateModal" class="modal" style="display: none">
    <div id="quotationManageCreateModalContent" class="modal-content" style="
                  max-width: 1200px;
                  max-height: 90vh;
                  padding: 0;
                  position: relative;
                  display: flex;
                  flex-direction: column;
                ">
      <!-- 헤더 (완전 고정) -->
      <div id="quotationManageCreateModalHeader" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 32px 32px 16px 32px;
                    border-bottom: 2px solid var(--border);
                    cursor: move;
                    user-select: none;
                    flex-shrink: 0;
                    background: white;
                  ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)"
          id="quotationManageCreateModalTitle">
          견적서 작성
        </h2>
        <button onclick="closeQuotationManageCreateModal()" style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: #f3f4f6;
                      border: none;
                      cursor: pointer;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-size: 24px;
                      color: #6b7280;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 스크롤 가능한 컨텐츠 영역 -->
      <div id="quotationManageCreateModalBody" style="
                    flex: 1;
                    overflow-y: auto;
                    padding: 32px;
                    min-height: 0;
                  ">
        <form id="quotationManageCreateForm" onsubmit="submitQuotationManageCreate(event)">
          <!-- 마스터 정보 섹션 -->
          <div id="quotationManageCreateMasterSection" style="
                      background: #f9fafb;
                      padding: 20px;
                      border-radius: 12px;
                      margin-bottom: 24px;
                      border: 1px solid #e5e7eb;
                    ">
            <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">기본 정보</h3>

            <div id="quotationManageCreateMasterGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <!-- 견적일자 -->
              <div id="quotationManageCreateDateSection">
                <label style="
                            display: block;
                            margin-bottom: 8px;
                            font-weight: 500;
                            font-size: 14px;
                            color: #374151;
                          ">견적일자 *</label>
                <input type="date" id="quotationManageCreateDate" required style="
                            width: 100%;
                            padding: 12px 16px;
                            border: 2px solid var(--border);
                            border-radius: 8px;
                            font-size: 14px;
                          " />
              </div>

              <!-- 출고희망일자 -->
              <div id="quotationManageCreateDeliveryDateSection">
                <label style="
                            display: block;
                            margin-bottom: 8px;
                            font-weight: 500;
                            font-size: 14px;
                            color: #374151;
                          ">출고희망일자</label>
                <input type="date" id="quotationManageCreateDeliveryDate" style="
                            width: 100%;
                            padding: 12px 16px;
                            border: 2px solid var(--border);
                            border-radius: 8px;
                            font-size: 14px;
                          " />
              </div>

              <!-- 매출처 선택 -->
              <div id="quotationManageCreateCustomerSection" style="grid-column: 1 / -1">
                <label style="
                            display: block;
                            margin-bottom: 8px;
                            font-weight: 500;
                            font-size: 14px;
                            color: #374151;
                          ">매출처 *</label>
                <div id="quotationManageCreateCustomerSearchArea" style="display: flex; gap: 8px">
                  <!-- 숨겨진 매출처 코드 필드 (실제 값 저장용) -->
                  <input type="hidden" id="quotationManageCreateCustomerCode" />

                  <!-- 통합 검색 입력란 -->
                  <input type="text" id="quotationManageCreateCustomerName" required style="
                              flex: 1;
                              padding: 12px 16px;
                              border: 2px solid var(--border);
                              border-radius: 8px;
                              font-size: 14px;
                            " placeholder="매출처 코드 또는 이름 입력 후 엔터"
                    onkeypress="if(event.key === 'Enter') { event.preventDefault(); openQuotationManageCreateCustomerSearchModal(); }" />
                  <button type="button" onclick="openQuotationManageCreateCustomerSearchModal()" style="
                              padding: 10px 20px;
                              background: var(--primary);
                              color: white;
                              border: none;
                              border-radius: 8px;
                              font-size: 14px;
                              font-weight: 500;
                              cursor: pointer;
                              white-space: nowrap;
                            ">
                    검색
                  </button>
                </div>
                <!-- 선택된 매출처 정보 표시 -->
                <div id="quotationManageCreateCustomerInfo" style="
                            display: none;
                            margin-top: 8px;
                            padding: 8px 12px;
                            background: #f0f9ff;
                            border-left: 4px solid #3b82f6;
                            border-radius: 6px;
                            border: 1px solid #bfdbfe;
                          ">
                  <span style="font-size: 12px; color: #3b82f6; font-weight: 600">선택된 매출처:</span>
                  <span id="quotationManageCreateCustomerDisplay"
                    style="margin-left: 8px; font-weight: 600; color: #1e40af"></span>
                </div>
              </div>

              <!-- 제목 -->
              <div id="quotationManageCreateTitleSection" style="grid-column: 1 / -1">
                <label style="
                            display: block;
                            margin-bottom: 8px;
                            font-weight: 500;
                            font-size: 14px;
                            color: #374151;
                          ">제목</label>
                <input type="text" id="quotationManageCreateTitle" style="
                            width: 100%;
                            padding: 12px 16px;
                            border: 2px solid var(--border);
                            border-radius: 8px;
                            font-size: 14px;
                          " placeholder="견적서 제목을 입력하세요" />
              </div>

              <!-- 적요 -->
              <div id="quotationManageCreateRemarkSection" style="grid-column: 1 / -1">
                <label style="
                            display: block;
                            margin-bottom: 8px;
                            font-weight: 500;
                            font-size: 14px;
                            color: #374151;
                          ">적요</label>
                <textarea id="quotationManageCreateRemark" style="
                            width: 100%;
                            padding: 12px 16px;
                            border: 2px solid var(--border);
                            border-radius: 8px;
                            font-size: 14px;
                            resize: vertical;
                            min-height: 80px;
                          " placeholder="비고사항을 입력하세요"></textarea>
              </div>
            </div>
          </div>

          <!-- 상세내역 섹션 -->
          <div id="quotationManageCreateDetailSection" style="
                      background: #f9fafb;
                      padding: 20px;
                      border-radius: 12px;
                      margin-bottom: 24px;
                      border: 1px solid #e5e7eb;
                    ">
            <div id="quotationManageCreateDetailHeader" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 16px;
                      ">
              <h3 style="margin: 0; font-size: 18px; font-weight: 600">견적 상세내역</h3>
              <button type="button" onclick="openQuotationManageDetailAddModal()" style="
                          padding: 8px 16px;
                          background: #007bff;
                          color: white;
                          border: none;
                          border-radius: 6px;
                          font-size: 14px;
                          font-weight: 500;
                          cursor: pointer;
                        ">
                + 자재 추가
              </button>
            </div>

            <!-- 상세내역 테이블 -->
            <div id="quotationManageCreateDetailTableWrapper"
              style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px">
              <table id="quotationManageCreateDetailTable" style="width: 100%; border-collapse: collapse">
                <thead style="background: #f8f9fa">
                  <tr>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); width: 60px; white-space: nowrap;">
                      순번
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                      자재코드
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                      자재명
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                      규격
                    </th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); width: 60px">
                      단위
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 80px">
                      수량
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 100px">
                      단가
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 120px">
                      공급가
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 100px">
                      부가세
                    </th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); width: 130px">
                      관리
                    </th>
                  </tr>
                </thead>
                <tbody id="quotationManageCreateDetailTableBody">
                  <tr>
                    <td colspan="10" style="padding: 40px; text-align: center; color: #999">
                      자재 추가 버튼을 클릭하여 견적 상세내역을 입력하세요
                    </td>
                  </tr>
                </tbody>
                <tfoot style="background: #f8f9fa; font-weight: 600">
                  <tr>
                    <td colspan="7" style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                      합계
                    </td>
                    <td id="totalSupplyPrice"
                      style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                      0
                    </td>
                    <td id="totalVat" style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                      0
                    </td>
                    <td style="padding: 12px; border-top: 2px solid var(--border)"></td>
                  </tr>
                  <tr>
                    <td colspan="7" style="padding: 12px; text-align: right">총액</td>
                    <td colspan="2" id="grandTotal"
                      style="padding: 12px; text-align: right; color: #007bff; font-size: 16px">
                      0
                    </td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- 버튼 영역 -->
          <div id="quotationManageCreateButtonArea" style="display: flex; gap: 12px; justify-content: flex-end">
            <button type="button" onclick="closeQuotationManageCreateModal()" style="
                        padding: 10px 24px;
                        background: var(--bg-light);
                        border: 1px solid var(--border);
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: var(--text-dark);
                      ">
              취소
            </button>
            <button type="submit" style="
                        padding: 10px 24px;
                        background: var(--primary);
                        border: none;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                        color: white;
                      ">
              견적서 등록
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 견적서작성 버튼 상세내역 입력 모달 (자재 추가) -->
  <div id="quotationManageDetailAddModal" class="modal" style="display: none">
    <div id="quotationManageDetailAddModalContent" class="modal-content"
      style="max-width: 600px; max-height: 90vh; display: flex; flex-direction: column; overflow: hidden;">
      <!-- ✅ 헤더 영역 (고정) - 드래그 가능 -->
      <div id="quotationManageDetailAddModalHeader" class="modal-header-draggable" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 24px 24px 16px 24px;
                    border-bottom: 2px solid #e5e7eb;
                    flex-shrink: 0;
                    cursor: move;
                  ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
          견적 상세내역 입력
        </h2>
        <button onclick="closeQuotationManageDetailAddModal()" style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: #f3f4f6;
                      border: none;
                      cursor: pointer;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-size: 20px;
                      color: #6b7280;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- ✅ 스크롤 가능한 본문 영역 -->
      <div id="quotationManageDetailAddModalBody" style="flex: 1; overflow-y: auto; padding: 24px;">
        <div id="quotationManageDetailAddFormContainer" style="display: flex; flex-direction: column; gap: 16px">
          <div id="quotationManageDetailAddMaterialSearchSection">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">자재 검색</label>
            <div id="quotationManageDetailAddSearchInputArea" style="display: flex; gap: 8px">
              <input type="text" id="addDetailMaterialSearchCategory" style="
                          width: 70px;
                          padding: 10px 6px;
                          border: 2px solid #e5e7eb;
                          border-radius: 8px;
                          font-size: 14px;
                        " placeholder="분류" onkeypress="if(event.key === 'Enter') searchAddDetailMaterials()" />
              <input type="text" id="addDetailMaterialSearchCode" style="
                          width: 120px;
                          padding: 10px 6px;
                          border: 2px solid #e5e7eb;
                          border-radius: 8px;
                          font-size: 14px;
                        " placeholder="자재코드" onkeypress="if(event.key === 'Enter') searchAddDetailMaterials()" />
              <input type="text" id="addDetailMaterialSearchName" style="
                          flex: 1;
                          padding: 10px 12px;
                          border: 2px solid #e5e7eb;
                          border-radius: 8px;
                          font-size: 14px;
                        " placeholder="자재명" onkeypress="if(event.key === 'Enter') searchAddDetailMaterials()" />
              <button onclick="searchAddDetailMaterials()" style="
                          padding: 10px 16px;
                          background: #3b82f6;
                          border: none;
                          border-radius: 8px;
                          font-size: 13px;
                          font-weight: 500;
                          cursor: pointer;
                          color: white;
                          transition: all 0.2s;
                          white-space: nowrap;
                        " onmouseover="this.style.background='#2563eb';" onmouseout="this.style.background='#3b82f6';">
                검색
              </button>
            </div>
          </div>

          <div id="addDetailMaterialSearchResults" style="display: none">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">검색 결과 (클릭하여
              선택)</label>
            <div id="addDetailMaterialSearchResultsWrapper" style="
                        max-height: 200px;
                        overflow-y: auto;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                      ">
              <table id="addDetailMaterialSearchResultsTable" style="width: 100%; border-collapse: collapse">
                <thead style="background: #f9fafb; position: sticky; top: 0">
                  <tr>
                    <th style="
                                padding: 8px;
                                text-align: left;
                                border-bottom: 1px solid #e5e7eb;
                                font-size: 13px;
                              ">
                      품목코드
                    </th>
                    <th style="
                                padding: 8px;
                                text-align: left;
                                border-bottom: 1px solid #e5e7eb;
                                font-size: 13px;
                              ">
                      품명
                    </th>
                    <th style="
                                padding: 8px;
                                text-align: left;
                                border-bottom: 1px solid #e5e7eb;
                                font-size: 13px;
                              ">
                      규격
                    </th>
                  </tr>
                </thead>
                <tbody id="addDetailMaterialSearchTableBody"></tbody>
              </table>
            </div>
          </div>

          <div id="addDetailSelectedMaterialInfo" style="
                      display: none;
                      background: #f0f9ff;
                      padding: 12px;
                      border-radius: 8px;
                      border: 2px solid #bfdbfe;
                    ">
            <div id="addDetailSelectedMaterialInfoContainer"
              style="display: flex; justify-content: space-between; align-items: center">
              <div>
                <div style="
                            font-size: 12px;
                            color: #3b82f6;
                            font-weight: 600;
                            margin-bottom: 4px;
                          ">
                  선택된 자재
                </div>
                <div style="font-weight: 600; color: #1e40af" id="addDetailSelectedMaterialName">
                  -
                </div>
                <div style="font-size: 12px; color: #6b7280; margin-top: 2px" id="addDetailSelectedMaterialCode">
                  -
                </div>
              </div>
              <button onclick="clearAddDetailSelectedMaterial()" style="
                          padding: 6px 12px;
                          background: #ef4444;
                          border: none;
                          border-radius: 6px;
                          font-size: 12px;
                          font-weight: 500;
                          cursor: pointer;
                          color: white;
                        ">
                취소
              </button>
            </div>
          </div>

          <div id="addDetailQuantitySection">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">수량</label>
            <input type="number" id="addDetailQuantity" style="
                        width: 100%;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                      " placeholder="수량 입력" value="1" min="0" step="0.01" oninput="calculateAddDetailAmount()" />
          </div>

          <div id="addDetailPriceSection">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">출고단가</label>
            <div id="addDetailPriceInputArea" style="display: flex; gap: 8px">
              <input type="number" id="addDetailPrice" style="
                          flex: 1;
                          padding: 10px 12px;
                          border: 2px solid #e5e7eb;
                          border-radius: 8px;
                          font-size: 14px;
                        " placeholder="단가 입력" value="0" min="0" step="0.01" oninput="calculateAddDetailAmount()" />
              <button onclick="showQuotationManageDetailPriceHistory()" style="
                          padding: 10px 16px;
                          background: #8b5cf6;
                          border: none;
                          border-radius: 8px;
                          font-size: 13px;
                          font-weight: 500;
                          cursor: pointer;
                          color: white;
                          transition: all 0.2s;
                          white-space: nowrap;
                        " onmouseover="this.style.background='#7c3aed';" onmouseout="this.style.background='#8b5cf6';">
                이전 단가
              </button>
            </div>
          </div>

          <div id="addDetailAmountSection">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">금액 (자동계산)</label>
            <input type="text" id="addDetailAmount" style="
                        width: 100%;
                        padding: 10px 12px;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 14px;
                        background: #f9fafb;
                      " readonly value="0" />
          </div>
        </div>

        <div id="addDetailButtonArea" style="
                    display: flex;
                    gap: 12px;
                    justify-content: flex-end;
                    margin-top: 24px;
                    padding-top: 24px;
                    border-top: 2px solid #e5e7eb;
                  ">
          <button onclick="closeQuotationManageDetailAddModal()" style="
                      padding: 12px 24px;
                      background: #f3f4f6;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: #374151;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
            취소
          </button>
          <button onclick="confirmQuotationManageDetailAdd()" style="
                      padding: 12px 24px;
                      background: #10b981;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: white;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
            추가하기
          </button>
        </div>
      </div> <!-- 스크롤 가능한 본문 영역 끝 -->
    </div>
  </div>

  <!-- 견적 이전단가 이력 조회 모달 -->
  <div id="quotationManagePriceHistoryModal" class="modal" style="display: none">
    <div id="quotationManagePriceHistoryModalContent" class="modal-content" style="max-width: 700px">
      <div id="quotationManagePriceHistoryModalHeader" style="
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 24px;
                    padding-bottom: 16px;
                    border-bottom: 2px solid #e5e7eb;
                  ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
          출고단가 이력
        </h2>
        <button id="quotationManagePriceHistoryCloseBtn" onclick="closeQuotationManagePriceHistoryModal()" style="
                      width: 36px;
                      height: 36px;
                      border-radius: 50%;
                      background: #f3f4f6;
                      border: none;
                      cursor: pointer;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-size: 20px;
                      color: #6b7280;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 자재 정보 -->
      <div id="quotationManagePriceHistoryMaterialSection" style="
                    background: #fef3c7;
                    padding: 12px;
                    border-radius: 8px;
                    margin-bottom: 16px;
                    border: 2px solid #fbbf24;
                  ">
        <div id="quotationManagePriceHistoryMaterialInfo"
          style="display: flex; justify-content: space-between; align-items: center">
          <div>
            <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px">
              선택된 자재
            </div>
            <div style="font-weight: 600; color: #78350f" id="quotationManagePriceHistoryMaterialName">
              -
            </div>
            <div style="font-size: 12px; color: #92400e; margin-top: 2px" id="quotationManagePriceHistoryMaterialCode">
              -
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ 탭 메뉴 -->
      <div id="quotationManagePriceHistoryTabSection" style="
                    display: flex;
                    gap: 8px;
                    margin-bottom: 16px;
                    border-bottom: 2px solid #e5e7eb;
                  ">
        <button id="quotationManagePriceHistoryActualTab" onclick="switchQuotationManagePriceHistoryTab('actual')"
          style="
                      padding: 12px 20px;
                      background: #3b82f6;
                      border: none;
                      border-bottom: 3px solid #3b82f6;
                      font-size: 14px;
                      font-weight: 600;
                      cursor: pointer;
                      color: white;
                      transition: all 0.2s;
                      flex: 1;
                    ">
          실제 출고가
        </button>
        <button id="quotationManagePriceHistoryQuotationTab" onclick="switchQuotationManagePriceHistoryTab('quotation')"
          style="
                      padding: 12px 20px;
                      background: transparent;
                      border: none;
                      border-bottom: 3px solid transparent;
                      font-size: 14px;
                      font-weight: 600;
                      cursor: pointer;
                      color: #6b7280;
                      transition: all 0.2s;
                      flex: 1;
                    "
          onmouseover="if(this.id !== 'quotationManagePriceHistoryActualTab' || this.style.background === 'transparent') this.style.color='#1f2937';"
          onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';">
          견적 제안가
        </button>
      </div>

      <!-- 이력 테이블 -->
      <div id="quotationManagePriceHistoryTableSection" style="margin-bottom: 16px">
        <label id="quotationManagePriceHistoryLabel"
          style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">
          이 거래처에 실제 출고한 이력 (클릭하여 단가 선택)
        </label>
        <div id="quotationManagePriceHistoryTableWrapper" style="
                      max-height: 300px;
                      overflow-y: auto;
                      border: 2px solid #e5e7eb;
                      border-radius: 8px;
                    ">
          <table id="quotationManagePriceHistoryTable" style="width: 100%; border-collapse: collapse">
            <thead id="quotationManagePriceHistoryTableHead" style="background: #f9fafb; position: sticky; top: 0">
              <tr>
                <th style="
                              padding: 10px;
                              text-align: left;
                              border-bottom: 2px solid #e5e7eb;
                              font-size: 13px;
                            ">
                  출고일자
                </th>
                <th style="
                              padding: 10px;
                              text-align: right;
                              border-bottom: 2px solid #e5e7eb;
                              font-size: 13px;
                            ">
                  출고단가
                </th>
                <th style="
                              padding: 10px;
                              text-align: right;
                              border-bottom: 2px solid #e5e7eb;
                              font-size: 13px;
                            ">
                  출고수량
                </th>
                <th style="
                              padding: 10px;
                              text-align: center;
                              border-bottom: 2px solid #e5e7eb;
                              font-size: 13px;
                            ">
                  적요
                </th>
              </tr>
            </thead>
            <tbody id="quotationManagePriceHistoryTableBody">
              <tr>
                <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af">
                  이력이 없습니다
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="quotationManagePriceHistoryButtonArea" style="
                    display: flex;
                    gap: 12px;
                    justify-content: flex-end;
                    padding-top: 16px;
                    border-top: 2px solid #e5e7eb;
                  ">
        <button onclick="closeQuotationManagePriceHistoryModal()" style="
                      padding: 12px 24px;
                      background: #f3f4f6;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      color: #374151;
                      transition: all 0.2s;
                    " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          닫기
        </button>
      </div>
    </div>
  </div>

  <!-- 견적서 메뉴 페이지에 있는 데이타테이블에서 상세 버튼에 대한 모달 -->
  <div id="quotationManageViewModal" class="modal" style="display: none">
    <div id="quotationManageViewModalContent" class="modal-content"
      style="max-width: 1000px; max-height: 90vh; display: flex; flex-direction: column; position: relative; padding: 0;">
      <!-- 헤더 영역 (제목 + 닫기 버튼) - 고정 -->
      <div id="quotationManageViewModalHeader" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 32px 32px 16px 32px;
                border-bottom: 2px solid var(--border);
                cursor: move;
                user-select: none;
                flex-shrink: 0;
                background: white;
              ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
          견적 상세 보기
        </h2>
        <button onclick="closeQuotationManageViewModal()" style="
                  width: 36px;
                  height: 36px;
                  border-radius: 50%;
                  background: #f3f4f6;
                  border: none;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 24px;
                  color: #6b7280;
                  transition: all 0.2s;
                " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 스크롤 가능한 본문 영역 -->
      <div style="flex: 1; overflow-y: auto; padding: 32px;">
        <!-- 견적 기본 정보 -->
        <div id="quotationManageViewHeaderSection" style="
                background: #f9fafb;
                padding: 20px;
                border-radius: 12px;
                margin-bottom: 24px;
                border: 1px solid #e5e7eb;
              ">
          <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
            기본 정보
          </h3>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
            <div style="display: flex; align-items: center">
              <span style="min-width: 100px; font-weight: 500; color: #374151">견적번호</span>
              <span id="quotationManageViewNo" style="color: #1f2937; font-weight: 600">-</span>
            </div>
            <div style="display: flex; align-items: center">
              <span style="min-width: 100px; font-weight: 500; color: #374151">견적일자</span>
              <span id="quotationManageViewDate" style="color: #1f2937">-</span>
            </div>
            <div style="display: flex; align-items: center">
              <span style="min-width: 100px; font-weight: 500; color: #374151">매출처명</span>
              <span id="quotationManageViewCustomer" style="color: #1f2937">-</span>
            </div>
            <div style="display: flex; align-items: center">
              <span style="min-width: 100px; font-weight: 500; color: #374151">비고</span>
              <span id="quotationManageViewRemark" style="color: #1f2937">-</span>
            </div>
          </div>
        </div>

        <!-- 견적 상세 목록 -->
        <div id="quotationManageViewMaterialSection" style="
                background: #f9fafb;
                padding: 20px;
                border-radius: 12px;
                border: 1px solid #e5e7eb;
              ">
          <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
            견적 품목 내역
          </h3>

          <!-- 상세내역 테이블 -->
          <div id="quotationManageViewDetailTableWrapper"
            style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px">
            <table id="quotationManageViewDetailTable" style="width: 100%; border-collapse: collapse">
              <thead style="background: #f8f9fa">
                <tr>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); width: 60px; white-space: nowrap;">
                    순번
                  </th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                    자재코드
                  </th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                    자재명
                  </th>
                  <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                    규격
                  </th>
                  <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); width: 60px">
                    단위
                  </th>
                  <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 80px">
                    수량
                  </th>
                  <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 100px">
                    단가
                  </th>
                  <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 120px">
                    금액
                  </th>
                </tr>
              </thead>
              <tbody id="quotationManageViewDetailTableBody"></tbody>
              <tfoot style="background: #f8f9fa; font-weight: 600">
                <tr>
                  <td colspan="6" style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                    합계
                  </td>
                  <td id="quotationManageViewSupplyPrice"
                    style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                    0
                  </td>
                  <td id="quotationManageViewTotal"
                    style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                    0
                  </td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>

        <!-- 버튼 영역 -->
        <div style="
                margin-top: 24px;
                display: flex;
                justify-content: flex-end;
                gap: 12px;
                padding-top: 16px;
                border-top: 1px solid #e5e7eb;
              ">
          <button onclick="closeQuotationManageViewModal()" style="
                  padding: 10px 24px;
                  background: var(--bg-light);
                  border: 1px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: var(--text-dark);
                ">
            닫기
          </button>
          <button onclick="printQuotationFromDetail()" style="
                  padding: 10px 24px;
                  background: #9333ea;
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                ">
            📄 출력
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 견적서메뉴 페이지에 있는 데이타테이블의 수정버튼에 해당하는 모달 -->
  <div id="quotationManageEditModal" class="modal" style="display: none">
    <div id="quotationManageEditModalContent" class="modal-content" style="
              max-width: 1200px;
              max-height: 90vh;
              padding: 0;
              position: relative;
              display: flex;
              flex-direction: column;
            ">
      <!-- 헤더 (완전 고정) -->
      <div id="quotationManageEditModalHeader" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 32px 32px 16px 32px;
                border-bottom: 2px solid var(--border);
                cursor: move;
                user-select: none;
                flex-shrink: 0;
                background: white;
              ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)"
          id="quotationManageEditModalTitle">
          견적 수정
        </h2>
        <button onclick="closeQuotationManageEditModal()" style="
                  width: 36px;
                  height: 36px;
                  border-radius: 50%;
                  background: #f3f4f6;
                  border: none;
                  cursor: pointer;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  font-size: 24px;
                  color: #6b7280;
                  transition: all 0.2s;
                " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 스크롤 가능한 컨텐츠 영역 -->
      <div id="quotationManageEditModalBody" style="
                flex: 1;
                overflow-y: auto;
                padding: 32px;
                min-height: 0;
              ">
        <form id="quotationManageEditForm" onsubmit="submitQuotationManageEdit(event)">
          <!-- 마스터 정보 섹션 -->
          <div id="quotationManageEditMasterSection" style="
                    background: #f9fafb;
                    padding: 20px;
                    border-radius: 12px;
                    margin-bottom: 24px;
                    border: 1px solid #e5e7eb;
                  ">
            <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">기본 정보</h3>

            <div id="quotationManageEditMasterGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <!-- 견적번호 (읽기전용) -->
              <div id="quotationManageEditNoSection">
                <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">견적번호</label>
                <input type="text" id="quotationManageEditNo" readonly style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                          background: #e5e7eb;
                          color: #1f2937;
                          font-weight: 600;
                        " value="-" />
              </div>

              <!-- 견적일자 (읽기전용) -->
              <div id="quotationManageEditDateSection">
                <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">견적일자</label>
                <input type="text" id="quotationManageEditDate" readonly style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                          background: #e5e7eb;
                          color: #1f2937;
                        " value="-" />
              </div>

              <!-- 출고희망일자 -->
              <div id="quotationManageEditDeliveryDateSection">
                <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">출고희망일자</label>
                <input type="date" id="quotationManageEditDeliveryDate" style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                        " />
              </div>

              <!-- 매출처 선택 (읽기전용) -->
              <div id="quotationManageEditCustomerSection" style="grid-column: 1 / -1">
                <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">매출처</label>
                <div id="quotationManageEditCustomerSearchArea" style="display: flex; gap: 8px">
                  <!-- 숨겨진 매출처 코드 필드 (실제 값 저장용) -->
                  <input type="hidden" id="quotationManageEditCustomerCode" />

                  <!-- 통합 검색 입력란 (읽기전용) -->
                  <input type="text" id="quotationManageEditCustomerName" readonly style="
                            flex: 1;
                            padding: 12px 16px;
                            border: 2px solid var(--border);
                            border-radius: 8px;
                            font-size: 14px;
                            background: #e5e7eb;
                            color: #1f2937;
                          " value="-" />
                  <button type="button" disabled style="
                            padding: 10px 20px;
                            background: #d1d5db;
                            color: #6b7280;
                            border: none;
                            border-radius: 8px;
                            font-size: 14px;
                            font-weight: 500;
                            cursor: not-allowed;
                            white-space: nowrap;
                          ">
                    검색
                  </button>
                </div>
                <!-- 선택된 매출처 정보 표시 -->
                <div id="quotationManageEditCustomerInfo" style="
                          display: none;
                          margin-top: 8px;
                          padding: 8px 12px;
                          background: #f0f9ff;
                          border-left: 4px solid #3b82f6;
                          border-radius: 6px;
                          border: 1px solid #bfdbfe;
                        ">
                  <span style="font-size: 12px; color: #3b82f6; font-weight: 600">선택된 매출처:</span>
                  <span id="quotationManageEditCustomerDisplay"
                    style="margin-left: 8px; font-weight: 600; color: #1e40af"></span>
                </div>
              </div>

              <!-- 제목 -->
              <div id="quotationManageEditTitleSection" style="grid-column: 1 / -1">
                <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">제목</label>
                <input type="text" id="quotationManageEditTitle" style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                        " placeholder="견적서 제목을 입력하세요" />
              </div>

              <!-- 적요 -->
              <div id="quotationManageEditRemarkSection" style="grid-column: 1 / -1">
                <label style="
                          display: block;
                          margin-bottom: 8px;
                          font-weight: 500;
                          font-size: 14px;
                          color: #374151;
                        ">적요</label>
                <textarea id="quotationManageEditRemark" style="
                          width: 100%;
                          padding: 12px 16px;
                          border: 2px solid var(--border);
                          border-radius: 8px;
                          font-size: 14px;
                          resize: vertical;
                          min-height: 80px;
                        " placeholder="비고사항을 입력하세요"></textarea>
              </div>
            </div>
          </div>

          <!-- 상세내역 섹션 -->
          <div id="quotationManageEditDetailSection" style="
                      background: #f9fafb;
                      padding: 20px;
                      border-radius: 12px;
                      margin-bottom: 24px;
                      border: 1px solid #e5e7eb;
                    ">
            <div id="quotationManageEditDetailHeader" style="
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      margin-bottom: 16px;
                    ">
              <h3 style="margin: 0; font-size: 18px; font-weight: 600">견적 상세내역</h3>
              <button type="button" onclick="openQuotationManageDetailAddModal('edit')" style="
                        padding: 8px 16px;
                        background: #007bff;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        font-size: 14px;
                        font-weight: 500;
                        cursor: pointer;
                      ">
                + 자재 추가
              </button>
            </div>

            <!-- 상세내역 테이블 -->
            <div id="quotationManageEditDetailTableWrapper"
              style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px">
              <table id="quotationManageEditDetailTable" style="width: 100%; border-collapse: collapse">
                <thead style="background: #f8f9fa">
                  <tr>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border); width: 60px; white-space: nowrap;">
                      순번
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                      자재코드
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                      자재명
                    </th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                      규격
                    </th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); width: 60px">
                      단위
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 80px">
                      수량
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 100px">
                      단가
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 120px">
                      공급가
                    </th>
                    <th style="padding: 12px; text-align: right; border-bottom: 2px solid var(--border); width: 100px">
                      부가세
                    </th>
                    <th style="padding: 12px; text-align: center; border-bottom: 2px solid var(--border); width: 130px">
                      관리
                    </th>
                  </tr>
                </thead>
                <tbody id="quotationManageEditDetailTableBody">
                  <tr>
                    <td colspan="10" style="padding: 40px; text-align: center; color: #999">
                      자재 추가 버튼을 클릭하여 견적 상세내역을 입력하세요
                    </td>
                  </tr>
                </tbody>
                <tfoot style="background: #f8f9fa; font-weight: 600">
                  <tr>
                    <td colspan="7" style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                      합계
                    </td>
                    <td id="totalSupplyPriceEdit"
                      style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                      0
                    </td>
                    <td id="totalVatEdit" style="padding: 12px; text-align: right; border-top: 2px solid var(--border)">
                      0
                    </td>
                    <td style="padding: 12px; border-top: 2px solid var(--border)"></td>
                  </tr>
                  <tr>
                    <td colspan="7" style="padding: 12px; text-align: right">총액</td>
                    <td colspan="2" id="quotationManageEditDetailTotal"
                      style="padding: 12px; text-align: right; color: #007bff; font-size: 16px">
                      0
                    </td>
                    <td></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- 버튼 영역 -->
          <div id="quotationManageEditButtonArea" style="display: flex; gap: 12px; justify-content: flex-end">
            <button type="button" onclick="closeQuotationManageEditModal()" style="
                  padding: 10px 24px;
                  background: var(--bg-light);
                  border: 1px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: var(--text-dark);
                ">
              취소
            </button>
            <button type="submit" style="
                  padding: 10px 24px;
                  background: var(--primary);
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  color: white;
                ">
              수정 완료
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 견적서 승인 확인 모달 -->
  <div id="quotationManageApproveConfirmModal" class="modal" style="display: none; z-index: 1050">
    <div id="quotationManageApproveConfirmModalContent" class="modal-content"
      style="max-width: 500px; max-height: 90vh; position: relative; margin: 50px auto; display: flex; flex-direction: column">
      <!-- 고정 헤더 -->
      <div id="quotationManageApproveConfirmModalHeader"
        style="display: flex; justify-content: space-between; align-items: center; padding: 32px 32px 16px 32px; border-bottom: 2px solid var(--border); cursor: move; user-select: none; flex-shrink: 0; background: white">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">견적 승인</h2>
        <button onclick="closeQuotationManageApproveConfirmModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 24px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 스크롤 가능한 내용 영역 -->
      <div id="quotationManageApproveConfirmModalBody" style="overflow-y: auto; flex: 1; padding: 32px">
        <div id="quotationManageApproveConfirmContentArea" style="margin-bottom: 20px">
          <div id="quotationManageApproveConfirmInfoBox" style="
                background: #f0f9ff;
                border: 1px solid #3b82f6;
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 20px;
              ">
            <p id="quotationManageApproveInfo" style="margin: 0; color: #1e40af; font-weight: 600; font-size: 14px">
              견적번호: -
            </p>
          </div>
        </div>

        <div id="quotationManageApproveConfirmNoticeBox" style="
              background: #ecfdf5;
              border: 1px solid #10b981;
              border-radius: 8px;
              padding: 16px;
              margin-bottom: 20px;
            ">
          <p style="margin: 0; color: #065f46">
            <strong>✅ 안내:</strong> 승인 후에는 수정이 불가능합니다.
          </p>
        </div>

        <div id="quotationManageApproveConfirmButtonArea" style="display: flex; justify-content: flex-end; gap: 10px">
          <button type="button" class="btn btn-secondary" onclick="closeQuotationManageApproveConfirmModal()" style="
                padding: 10px 20px;
                background: #6c757d;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              ">취소</button>
          <button type="button" class="btn btn-success" onclick="confirmQuotationManageApprove()" style="
                padding: 10px 20px;
                background: #28a745;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              ">승인</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 견적서 삭제 확인 모달 -->
  <div id="quotationManageDeleteConfirmModal" class="modal" style="display: none; z-index: 1050">
    <div id="quotationManageDeleteConfirmModalContent" class="modal-content"
      style="max-width: 500px; max-height: 90vh; position: relative; margin: 50px auto; display: flex; flex-direction: column">
      <!-- 고정 헤더 -->
      <div id="quotationManageDeleteConfirmModalHeader"
        style="display: flex; justify-content: space-between; align-items: center; padding: 32px 32px 16px 32px; border-bottom: 2px solid var(--border); cursor: move; user-select: none; flex-shrink: 0; background: white">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #dc3545">견적 삭제</h2>
        <button onclick="closeQuotationManageDeleteConfirmModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 24px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- 스크롤 가능한 내용 영역 -->
      <div id="quotationManageDeleteConfirmModalBody" style="overflow-y: auto; flex: 1; padding: 32px">
        <div id="quotationManageDeleteConfirmContentArea" style="margin-bottom: 20px">
          <div id="quotationManageDeleteConfirmInfoBox" style="
                background: #fee2e2;
                border: 1px solid #dc3545;
                border-radius: 8px;
                padding: 16px;
                margin-bottom: 20px;
              ">
            <p style="margin: 0 0 8px 0; color: #7f1d1d; font-weight: 600; font-size: 14px">
              삭제할 견적: <span id="quotationManageDeleteCount" style="color: #dc3545">0</span>건
            </p>
            <div id="quotationManageDeleteList" style="color: #991b1b; font-size: 13px">
              <!-- 삭제할 견적 목록이 표시됩니다 -->
            </div>
          </div>
        </div>

        <div id="quotationManageDeleteConfirmWarningBox" style="
              background: #fff3cd;
              border: 1px solid #ffc107;
              border-radius: 8px;
              padding: 16px;
              margin-bottom: 20px;
            ">
          <p style="margin: 0; color: #856404">
            <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.
          </p>
        </div>

        <div id="quotationManageDeleteConfirmButtonArea" style="display: flex; justify-content: flex-end; gap: 10px">
          <button type="button" class="btn btn-secondary" onclick="closeQuotationManageDeleteConfirmModal()" style="
                padding: 10px 20px;
                background: #6c757d;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              ">취소</button>
          <button type="button" class="btn btn-danger" onclick="confirmQuotationManageDelete()" style="
                padding: 10px 20px;
                background: #dc3545;
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
              ">삭제</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================================
       거래명세서관리 모달 섹션
       ======================================== -->

  <!-- 거래명세서 작성 모달 -->
  <div id="openTransactionCreateModal" class="modal" style="display: none">
    <div id="openTransactionCreateModalContent" class="modal-content"
      style="max-width: 1200px; max-height: 90vh; padding: 0; position: relative; display: flex; flex-direction: column;">
      <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) - 고정 -->
      <div id="openTransactionCreateModalHeader" style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 32px 32px 16px 32px;
            border-bottom: 2px solid var(--border);
            cursor: move;
            user-select: none;
            flex-shrink: 0;
            background: white;
          ">
        <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)"
          id="transactionCreateModalTitle">
          거래명세서 작성
        </h2>
        <button onclick="closeTransactionCreateModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 24px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <!-- ✅ 스크롤 가능한 본문 영역 -->
      <div id="openTransactionCreateModalBasicInfo" style="flex: 1; overflow-y: auto; padding: 32px; min-height: 0;">
        <form id="transactionCreateForm" onsubmit="submitTransactionCreate(event)">
          <!-- 기본 정보 섹션 -->
          <div style="
              background: #f9fafb;
              padding: 20px;
              border-radius: 12px;
              margin-bottom: 24px;
              border: 1px solid #e5e7eb;
            ">
            <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
              기본 정보
            </h3>

            <div id="transactionCreateMasterGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <!-- 거래일자 -->
              <div id="transactionCreateDateSection">
                <label style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 500;
                    font-size: 14px;
                    color: #374151;
                  ">거래일자 *</label>
                <input type="date" id="transactionCreateDate" required style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid var(--border);
                    border-radius: 8px;
                    font-size: 14px;
                  " />
              </div>

              <!-- 입출고구분 (거래명세서는 항상 2=출고) -->
              <input type="hidden" id="transactionCreateType" value="2" />

              <!-- 매출처 선택 -->
              <div id="transactionCreateCustomerSection" style="grid-column: 1 / -1">
                <label style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 500;
                    font-size: 14px;
                    color: #374151;
                  ">매출처 *</label>
                <div id="transactionCreateCustomerSearchArea" style="display: flex; gap: 8px">
                  <!-- 숨겨진 매출처 코드 필드 (실제 값 저장용) -->
                  <input type="hidden" id="transactionCreateCustomerCode" />

                  <!-- 통합 검색 입력란 -->
                  <input type="text" id="transactionCreateCustomerSearch" required style="
                      flex: 1;
                      padding: 12px 16px;
                      border: 2px solid var(--border);
                      border-radius: 8px;
                      font-size: 14px;
                    " placeholder="매출처 코드 또는 이름 입력 후 엔터"
                    onkeypress="if(event.key === 'Enter') { event.preventDefault(); openTransactionCustomerSearchModal(); }" />
                  <button type="button" onclick="openTransactionCustomerSearchModal()" style="
                      padding: 10px 20px;
                      background: var(--primary);
                      color: white;
                      border: none;
                      border-radius: 8px;
                      font-size: 14px;
                      font-weight: 500;
                      cursor: pointer;
                      white-space: nowrap;
                    ">
                    검색
                  </button>
                </div>
                <!-- 선택된 매출처 정보 표시 -->
                <!-- 견적서관리에서도 해당 매출처 검색 모달을 사용해야 합니다. -->
                <div id="transactionSelectedCustomerDisplay" style="
                    display: none;
                    margin-top: 8px;
                    padding: 8px 12px;
                    background: #f0f9ff;
                    border-left: 4px solid #3b82f6;
                    border-radius: 6px;
                    border: 1px solid #bfdbfe;
                  ">
                  <div style="display: flex; justify-content: space-between; align-items: center">
                    <div>
                      <span style="font-size: 12px; color: #3b82f6; font-weight: 600">선택된 매출처:</span>
                      <span id="transactionSelectedCustomerInfo"
                        style="margin-left: 8px; font-weight: 600; color: #1e40af"></span>
                    </div>
                    <button type="button" onclick="clearTransactionSelectedCustomer()" style="
                        padding: 4px 12px;
                        background: #ef4444;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        font-size: 12px;
                        cursor: pointer;
                        font-weight: 500;
                      " onmouseover="this.style.background='#dc2626';" onmouseout="this.style.background='#ef4444';">
                      선택 취소
                    </button>
                  </div>
                </div>
                <!-- 숨겨진 필드 (폼 검증용) -->
                <input type="hidden" id="transactionCreateCustomerName" required />
              </div>

              <!-- 적요 -->
              <div style="grid-column: 1 / -1">
                <label style="
                    display: block;
                    margin-bottom: 8px;
                    font-weight: 500;
                    font-size: 14px;
                    color: #374151;
                  ">적요</label>
                <textarea id="transactionCreateRemark" style="
                    width: 100%;
                    padding: 12px 16px;
                    border: 2px solid #e5e7eb;
                    border-radius: 8px;
                    font-size: 14px;
                    resize: vertical;
                    min-height: 80px;
                  " placeholder="비고사항을 입력하세요"></textarea>
              </div>
            </div>
          </div>

          <!-- 거래명세서 상세내역 섹션 -->
          <div id="openTransactionCreateModalDetailInfo" style="margin-bottom: 24px">
            <div id="transactionCreateDetailHeader" style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
              ">
              <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">
                거래명세서 상세내역
              </h3>
              <button type="button" onclick="openNewTransactionDetailAddModal()" style="
                  padding: 8px 16px;
                  background: #10b981;
                  color: white;
                  border: none;
                  border-radius: 6px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                " onmouseover="this.style.background='#059669';" onmouseout="this.style.background='#10b981';">
                + 자재 추가
              </button>
            </div>

            <!-- 상세내역 테이블 -->
            <div id="transactionCreateDetailTableWrapper"
              style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px">
              <table id="transactionCreateDetailTable" style="width: 100%; border-collapse: collapse">
                <thead style="background: #f8f9fa">
                  <tr>
                    <th style="
                        padding: 12px;
                        text-align: left;
                        border-bottom: 2px solid var(--border);
                        width: 54px;
                      ">
                      순번
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: left;
                        border-bottom: 2px solid var(--border);
                      ">
                      자재코드
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: left;
                        border-bottom: 2px solid var(--border);
                      ">
                      자재명
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: left;
                        border-bottom: 2px solid var(--border);
                      ">
                      규격
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: center;
                        border-bottom: 2px solid var(--border);
                        width: 60px;
                      ">
                      단위
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid var(--border);
                        width: 54px;
                      ">
                      수량
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid var(--border);
                        width: 120px;
                      ">
                      단가
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid var(--border);
                        width: 120px;
                      ">
                      공급가
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid var(--border);
                        width: 100px;
                      ">
                      부가세
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: right;
                        border-bottom: 2px solid var(--border);
                        width: 100px;
                      ">
                      합계
                    </th>
                    <th style="
                        padding: 12px;
                        text-align: center;
                        border-bottom: 2px solid var(--border);
                        width: 120px;
                      ">
                      관리
                    </th>
                  </tr>
                </thead>
                <tbody id="transactionCreateDetailTableBody">
                  <tr>
                    <td colspan="11" style="padding: 40px; text-align: center; color: #999">
                      자재 추가 버튼을 클릭하여 거래 상세내역을 입력하세요
                    </td>
                  </tr>
                </tbody>
                <tfoot style="background: #f8f9fa; font-weight: 600">
                  <tr>
                    <td colspan="7" style="
                        padding: 12px;
                        text-align: right;
                        border-top: 2px solid var(--border);
                      ">
                      합계
                    </td>
                    <td id="transactionCreateTotalSupply" style="
                        padding: 12px;
                        text-align: right;
                        border-top: 2px solid var(--border);
                      ">
                      0
                    </td>
                    <td id="transactionCreateTotalVat" style="
                        padding: 12px;
                        text-align: right;
                        border-top: 2px solid var(--border);
                      ">
                      0
                    </td>
                    <td id="transactionCreateGrandTotal" style="
                        padding: 12px;
                        text-align: right;
                        border-top: 2px solid var(--border);
                        color: #007bff;
                        font-size: 16px;
                      ">
                      0
                    </td>
                    <td style="padding: 12px; border-top: 2px solid var(--border)"></td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>

          <!-- 버튼 영역 -->
          <div id="transactionCreateButtonArea" style="
              display: flex;
              gap: 12px;
              justify-content: flex-end;
              padding-top: 24px;
              border-top: 2px solid #e5e7eb;
            ">
            <button type="button" onclick="closeTransactionCreateModal()" style="
                padding: 12px 24px;
                background: #f3f4f6;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: #374151;
                transition: all 0.2s;
              " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
              취소
            </button>
            <button type="submit" style="
                padding: 12px 24px;
                background: #2563eb;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
                transition: all 0.2s;
              " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
              거래명세서 등록
            </button>
          </div>
        </form>
      </div> <!-- 스크롤 가능한 본문 영역 끝 -->
    </div>
  </div>

  <!-- 매출처관리 신규등록/수정 모달 -->
  <div id="salesCustomerManageEditModal" class="modal" style="display: none; z-index: 1050">
    <div id="salesCustomerManageEditModalContent" class="modal-content"
      style="max-width: 600px; max-height: 90vh; position: relative; margin: 50px auto; display: flex; flex-direction: column">
      <!-- 고정 헤더 -->
      <div id="salesCustomerManageEditModalHeader"
        style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb; cursor: move; flex-shrink: 0; background: white; position: sticky; top: 0; z-index: 10">
        <h3 style="margin: 0" id="salesCustomerManageEditModalTitle">매출처 신규등록</h3>
        <button onclick="closeSalesCustomerManageEditModal()"
          style="background: #f0f0f0; border: none; font-size: 24px; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; padding: 0; color: #333;">×</button>
      </div>

      <!-- 스크롤 가능한 내용 영역 -->
      <div style="overflow-y: auto; flex: 1; padding-top: 20px">
        <form id="salesCustomerManageEditForm" onsubmit="submitSalesCustomerManage(event)">
          <div id="salesCustomerManageEditFormBody" style="display: grid; gap: 16px">
            <!-- 매출처코드 -->
            <div id="salesCustomerManageEditFormFieldCustomerCode">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">매출처코드</label>
              <input type="text" id="customerCode" name="customerCode" class="form-control"
                placeholder="매출처코드를 입력하세요" />
            </div>

            <!-- 매출처명 -->
            <div id="salesCustomerManageEditFormFieldCustomerName">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">매출처명 *</label>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input type="text" id="customerName" name="customerName" class="form-control" required style="flex: 1;"
                  onkeydown="if(event.key === 'Enter') { event.preventDefault(); openCustomerSearchFromEditModal(); }" />
                <button type="button" onclick="openCustomerSearchFromEditModal()"
                  style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer;">검색</button>
              </div>
            </div>

            <!-- 대표자 / 사업자번호 -->
            <div id="salesCustomerManageEditFormFieldCeoBusinessRow"
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <div id="salesCustomerManageEditFormFieldCeoName">
                <label style="display: block; margin-bottom: 8px; font-weight: 500">대표자</label>
                <input type="text" id="ceoName" name="ceoName" class="form-control" />
              </div>
              <div id="salesCustomerManageEditFormFieldBusinessNo">
                <label style="display: block; margin-bottom: 8px; font-weight: 500">사업자번호</label>
                <input type="text" id="businessNo" name="businessNo" class="form-control" />
              </div>
            </div>

            <!-- 업태 / 업종 -->
            <div id="salesCustomerManageEditFormFieldBusinessTypeRow"
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <div id="salesCustomerManageEditFormFieldBusinessType">
                <label style="display: block; margin-bottom: 8px; font-weight: 500">업태</label>
                <input type="text" id="businessType" name="businessType" class="form-control" />
              </div>
              <div id="salesCustomerManageEditFormFieldBusinessCategory">
                <label style="display: block; margin-bottom: 8px; font-weight: 500">업종</label>
                <input type="text" id="businessCategory" name="businessCategory" class="form-control" />
              </div>
            </div>

            <!-- 연락처 / 팩스 -->
            <div id="salesCustomerManageEditFormFieldContactRow"
              style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
              <div id="salesCustomerManageEditFormFieldPhone">
                <label style="display: block; margin-bottom: 8px; font-weight: 500">연락처</label>
                <input type="tel" id="phone" name="phone" class="form-control" />
              </div>
              <div id="salesCustomerManageEditFormFieldFax">
                <label style="display: block; margin-bottom: 8px; font-weight: 500">팩스</label>
                <input type="tel" id="fax" name="fax" class="form-control" />
              </div>
            </div>

            <!-- 우편번호 -->
            <div id="salesCustomerManageEditFormFieldZipCode">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">우편번호</label>
              <div id="salesCustomerManageEditFormFieldZipCodeInputGroup" style="display: flex; gap: 8px">
                <input type="text" id="zipCode" name="zipCode" class="form-control" readonly
                  style="flex: 1; background-color: #f5f5f5" />
                <button type="button" onclick="execDaumPostcode()" class="btn btn-secondary">찾기</button>
              </div>
            </div>

            <!-- 주소 -->
            <div id="salesCustomerManageEditFormFieldAddress">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">주소</label>
              <input type="text" id="address" name="address" class="form-control" readonly
                style="background-color: #f5f5f5" />
            </div>

            <!-- 상세주소 -->
            <div id="salesCustomerManageEditFormFieldAddressDetail">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">상세주소</label>
              <input type="text" id="addressDetail" name="addressDetail" class="form-control" />
            </div>

            <!-- 은행 -->
            <div id="salesCustomerManageEditFormFieldBankCode">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">은행</label>
              <select id="bankCode" name="bankCode" class="form-control">
                <option value="">선택하세요</option>
                <option value="01">한국은행</option>
                <option value="02">산업은행</option>
                <option value="03">기업은행</option>
                <option value="04">국민은행</option>
                <option value="05">농협</option>
                <option value="06">하나은행</option>
                <option value="07">우리은행</option>
                <option value="08">SC은행</option>
                <option value="09">씨티은행</option>
              </select>
            </div>

            <!-- 계좌번호 -->
            <div id="salesCustomerManageEditFormFieldAccountNo">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">계좌번호</label>
              <input type="text" id="accountNo" name="accountNo" class="form-control" />
            </div>

            <!-- 담당자명 -->
            <div id="salesCustomerManageEditFormFieldManagerName">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">담당자명</label>
              <input type="text" id="managerName" name="managerName" class="form-control" />
            </div>

            <!-- 사용구분 -->
            <div id="salesCustomerManageEditFormFieldStatus">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">사용구분</label>
              <select id="status" name="status" class="form-control">
                <option value="0">사용</option>
                <option value="1">미사용</option>
              </select>
            </div>

            <!-- 비고 -->
            <div id="salesCustomerManageEditFormFieldRemark">
              <label style="display: block; margin-bottom: 8px; font-weight: 500">비고</label>
              <textarea id="remark" name="remark" class="form-control" rows="3"></textarea>
            </div>
          </div>

          <div id="salesCustomerManageEditFormFooter"
            style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 24px">
            <button type="button" class="btn btn-secondary" onclick="closeSalesCustomerManageEditModal()">취소</button>
            <button type="submit" class="btn btn-primary">저장</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- 매출처관리 상세보기 모달 -->
  <div id="salesCustomerManageViewModal" class="modal" style="display: none; z-index: 1050">
    <div id="salesCustomerManageViewModalContent" class="modal-content"
      style="max-width: 700px; max-height: 90vh; position: relative; margin: 50px auto; display: flex; flex-direction: column">
      <!-- 고정 헤더 -->
      <div id="salesCustomerManageViewModalHeader"
        style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb; cursor: move; flex-shrink: 0; background: white; position: sticky; top: 0; z-index: 10">
        <h3 style="margin: 0" id="salesCustomerManageViewModalTitle">매출처 상세정보</h3>
        <button onclick="closeSalesCustomerManageViewModal()"
          style="background: #f0f0f0; border: none; font-size: 24px; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; padding: 0; color: #333;">×</button>
      </div>

      <!-- 스크롤 가능한 내용 영역 -->
      <div style="overflow-y: auto; flex: 1; padding-top: 20px">
        <div id="salesCustomerManageViewContent" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
          <!-- 상세 정보가 동적으로 로드됩니다 -->
        </div>

        <div id="salesCustomerManageViewModalFooter" style="display: flex; justify-content: flex-end; margin-top: 24px">
          <button class="btn btn-secondary" onclick="closeSalesCustomerManageViewModal()">닫기</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 매출처관리 삭제 확인 모달 -->
  <div id="salesCustomerManageDeleteModal" class="modal" style="display: none; z-index: 1050">
    <div id="salesCustomerManageDeleteModalContent" class="modal-content"
      style="max-width: 500px; max-height: 90vh; position: relative; margin: 50px auto; display: flex; flex-direction: column">
      <!-- 고정 헤더 -->
      <div id="salesCustomerManageDeleteModalHeader"
        style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb; cursor: move; flex-shrink: 0; background: white; position: sticky; top: 0; z-index: 10">
        <h3 style="margin: 0; color: #dc3545">매출처 삭제</h3>
        <button onclick="closeSalesCustomerManageDeleteModal()"
          style="background: #f0f0f0; border: none; font-size: 24px; cursor: pointer; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; padding: 0; color: #333;">×</button>
      </div>

      <!-- 스크롤 가능한 내용 영역 -->
      <div style="overflow-y: auto; flex: 1; padding-top: 20px">
        <div id="salesCustomerManageDeleteContent" style="margin-bottom: 20px">
          <!-- 삭제할 매출처 정보가 표시됩니다 -->
        </div>

        <div
          style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 16px; margin-bottom: 20px">
          <p style="margin: 0; color: #856404">
            <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.
          </p>
        </div>

        <div style="display: flex; justify-content: flex-end; gap: 10px">
          <button type="button" class="btn btn-secondary" onclick="closeSalesCustomerManageDeleteModal()">취소</button>
          <button type="button" class="btn btn-danger" onclick="confirmSalesCustomerManageDelete()">삭제</button>
        </div>
      </div>
    </div>
  </div>


  <!-- ✅ 매출처 검색 모달 (공통 1개만 사용) -->
  <div id="customerSearchModal" class="modal" style="display: none; z-index: 1070">
    <div class="modal-content" id="customerSearchModalContent"
      style="max-width: 1200px; max-height: 60vh; position: relative; display: flex; flex-direction: column">
      <!-- 고정 헤더 -->
      <div id="customerSearchModalHeader"
        style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 2px solid #e5e7eb; cursor: move; user-select: none; flex-shrink: 0; background: white; position: sticky; top: 0; z-index: 10">
        <h3 style="margin: 0">매출처 검색</h3>
        <button onclick="closeCustomerSearchModal()"
          style="background: #f0f0f0; border: none; font-size: 24px; cursor: pointer; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; padding: 0; color: #333">
          ×
        </button>
      </div>

      <!-- 스크롤 가능한 내용 영역 -->
      <div style="overflow-y: auto; flex: 1; padding-top: 20px">
        <div style="display: flex; gap: 10px; margin-bottom: 16px">
          <input type="text" id="customerSearchModalInput" placeholder="매출처명 또는 코드 검색"
            onkeypress="if(event.key === 'Enter') searchCustomersForModal()"
            style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px" />
          <button onclick="searchCustomersForModal()" style="
                        padding: 10px 20px;
                        background: #007bff;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                      ">
            검색
          </button>
        </div>

        <div style="border: 1px solid #e5e7eb; border-radius: 6px; padding: 10px;">
          <table id="customerSearchTable" class="display" style="width: 100%; table-layout: fixed;">
            <thead>
              <tr>
                <th style="width: 120px;">코드</th>
                <th style="width: 250px;">매출처명</th>
                <th style="width: 150px;">대표자명</th>
                <th style="width: 150px;">사업자번호</th>
                <th style="width: 150px;">전화번호</th>
                <th style="width: 100px;">선택</th>
              </tr>
            </thead>
            <tbody id="customerSearchTableBody">
              <!-- DataTables가 자동으로 채움 -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <!-- 작업일자 변경 모달 -->
  <div id="dateChangeModal" class="modal" style="display: none">
    <div class="modal-content" style="max-width: 400px">
      <div style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
          ">
        <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">
          작업일자 변경
        </h2>
        <button onclick="closeDateChangeModal()" style="
              width: 36px;
              height: 36px;
              border-radius: 50%;
              background: #f3f4f6;
              border: none;
              cursor: pointer;
              display: flex;
              align-items: center;
              justify-content: center;
              font-size: 20px;
              color: #6b7280;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
          onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';">
          &times;
        </button>
      </div>

      <div style="margin-bottom: 24px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151">작업일자 선택</label>
        <input type="date" id="newWorkingDate" style="
              width: 100%;
              padding: 12px 16px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            " />
        <p style="font-size: 12px; color: #6b7280; margin-top: 8px">
          선택한 날짜가 모든 문서 작성 시 기본 날짜로 사용됩니다.
        </p>
      </div>

      <div style="display: flex; gap: 10px; justify-content: flex-end">
        <button type="button" onclick="closeDateChangeModal()" style="
              padding: 12px 24px;
              background: #f3f4f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: #374151;
              transition: all 0.2s;
            " onmouseover="this.style.background='#e5e7eb';" onmouseout="this.style.background='#f3f4f6';">
          취소
        </button>
        <button type="button" onclick="confirmDateChange()" style="
              padding: 12px 24px;
              background: #2563eb;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            " onmouseover="this.style.background='#1d4ed8';" onmouseout="this.style.background='#2563eb';">
          변경
        </button>
      </div>
    </div>
  </div>

  <script>
    // 모달을 body 직속으로 이동 (dashboard CSS 영향 회피)
    // ✅ 로그인 날짜 설정은 이미 다른 곳에서 처리됨 (라인 953, 1055, 1257)
    // ✅ setLoginDateToToday()는 중복 호출 제거됨

    // API 기본 URL
    // 포트 3000에서 접속한 경우: 같은 origin 사용
    // 다른 포트(8000 등)에서 접속한 경우: localhost:3000 사용
    const API_BASE_URL =
      window.location.port === '3000'
        ? `${window.location.origin}/api`
        : 'http://localhost:3000/api';

    // 현재 로그인 사용자 정보 (이미 위에 선언됨)
    // let currentUser = null;

    // ✅ 페이지네이션 관련 변수 및 함수 제거됨 (currentCustomerPage, currentSupplierPage 등)
    // ✅ customer.js와 supplier.js의 DataTable이 페이지네이션을 자동으로 처리함
    // ✅ debounce, 동적 select 생성, resize 이벤트 리스너 모두 불필요하여 제거됨

    // API 호출 헬퍼 함수
    async function apiCall(endpoint, method = 'GET', data = null) {
      try {
        let url = `${API_BASE_URL}${endpoint}`;
        const options = {
          method,
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include', // 세션 쿠키 포함
        };

        // ✅ GET 요청일 때: data를 쿼리스트링으로 변환
        if (method.toUpperCase() === 'GET' && data && typeof data === 'object') {
          const queryString = new URLSearchParams(data).toString();
          if (queryString) url += (url.includes('?') ? '&' : '?') + queryString;
        }
        // ✅ POST/PUT/DELETE 요청일 때: body에 JSON으로 추가
        else if (data) {
          options.body = JSON.stringify(data);
        }

        const response = await fetch(url, options);
        const result = await response.json();

        if (!response.ok) {
          throw new Error(result.message || '서버 오류');
        }

        return result;
      } catch (error) {
        console.error('API 호출 에러:', error);
        throw error;
      }
    }

    function openLoginDatePicker() {
      const input = document.getElementById('loginDatePicker');
      if (!input) return;

      if (typeof input.showPicker === 'function') {
        input.showPicker();
      } else {
        input.focus();
      }
    }

    const loginDateTextInput = document.getElementById('loginDateText');
    const loginDatePickerInput = document.getElementById('loginDatePicker');

    if (loginDatePickerInput && loginDateTextInput) {
      loginDatePickerInput.addEventListener('change', () => {
        loginDateTextInput.value = loginDatePickerInput.value;
      });
    }

    // 페이지 로드 시 사업장 목록 로드 (로그인 페이지)
    async function loadWorkplaceInfo() {
      try {
        const result = await apiCall('/workplaces', 'GET');
        const workplaceSelect = document.getElementById('workplaceCode');
        const workplaceNameDisplay = document.getElementById('workplaceNameLogin');

        if (result.success && result.data && result.data.length > 0) {
          // 사업장 목록을 select box에 추가
          result.data.forEach((workplace) => {
            const option = document.createElement('option');
            option.value = workplace.사업장코드;
            option.textContent = `${workplace.사업장코드} - ${workplace.사업장명}`;
            workplaceSelect.appendChild(option);
          });

          // 첫 번째 사업장을 기본으로 선택하고 표시
          if (result.data[0]) {
            workplaceSelect.value = result.data[0].사업장코드;
            workplaceNameDisplay.textContent = result.data[0].사업장명;
          }

          // 사업장 선택 시 상단 표시 업데이트
          workplaceSelect.addEventListener('change', function () {
            const selectedWorkplace = result.data.find((w) => w.사업장코드 === this.value);
            if (selectedWorkplace) {
              workplaceNameDisplay.textContent = selectedWorkplace.사업장명;
            }
          });
        } else {
          workplaceNameDisplay.textContent = '사업장 정보 없음';
        }
      } catch (error) {
        console.error('사업장 정보 로드 실패:', error);
        document.getElementById('workplaceNameLogin').textContent = '사업장 로드 실패';
      }
    }

    // 페이지 로드 시 사업장 목록 로드
    loadWorkplaceInfo();

    // Top-bar 스크롤 효과
    const mainContent = document.querySelector('.main-content');
    const topBar = document.querySelector('.top-bar');

    if (mainContent && topBar) {
      mainContent.addEventListener('scroll', function () {
        if (mainContent.scrollTop > 50) {
          topBar.classList.add('scrolled');
        } else {
          topBar.classList.remove('scrolled');
        }
      });
    }

    // 로그인 처리
    document.getElementById('loginForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const workplaceCode = document.getElementById('workplaceCode').value;
      const userId = document.getElementById('userId').value;
      const password = document.getElementById('password').value;
      const loginDateTextValue = loginDateTextInput.value.trim();
      const loginDatePickerValue = loginDatePickerInput.value;
      const loginDate = loginDatePickerValue || loginDateTextValue;
      const messageEl = document.getElementById('loginMessage');

      if (!workplaceCode) {
        messageEl.textContent = '사업장을 선택해 주세요.';
        messageEl.classList.add('error');
        messageEl.classList.add('show');
        document.getElementById('workplaceCode').focus();
        return;
      }

      if (!loginDate) {
        messageEl.textContent = '접속일자를 입력하거나 선택해 주세요.';
        messageEl.classList.add('error');
        messageEl.classList.add('show');
        loginDateTextInput.focus();
        return;
      }

      if (loginDatePickerValue && loginDateTextValue !== loginDatePickerValue) {
        loginDateTextInput.value = loginDatePickerValue;
      }

      try {
        messageEl.textContent = '로그인 중...';
        messageEl.classList.remove('error');
        messageEl.classList.add('show');

        // 서버는 사용자 테이블의 사업장코드를 사용
        const result = await apiCall('/auth/login', 'POST', {
          userId: userId,
          password: password,
          loginDate: loginDate,
        });

        if (result.success) {
          // 서버에서 반환된 사용자의 사업장코드와 선택한 사업장코드 비교
          if (result.data.사업장코드 !== workplaceCode) {
            messageEl.textContent = `선택한 사업장이 일치하지 않습니다. 이 사용자는 "${result.data.사업장명}" 사업장에 속해 있습니다.`;
            messageEl.classList.add('error');
            messageEl.classList.add('show');

            // 올바른 사업장을 자동으로 선택
            document.getElementById('workplaceCode').value = result.data.사업장코드;

            return;
          }

          currentUser = result.data;

          // 작업일자 localStorage에 저장
          localStorage.setItem('workingDate', loginDate);

          messageEl.textContent = result.message;

          setTimeout(() => {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';

            document.getElementById('userName').textContent = currentUser.사용자명;
            document.getElementById('userAvatar').textContent = currentUser.사용자명.charAt(0);

            // 사이드바에 사업장명 표시
            if (currentUser.사업장명) {
              document.getElementById('workplaceNameSidebar').textContent = currentUser.사업장명;
            }

            // 작업일자 표시
            updateWorkingDateDisplay(loginDate);

            // 대시보드 통계 로드
            loadDashboardStats();
          }, 800);
        }
      } catch (error) {
        messageEl.textContent = '로그인 실패: ' + error.message;
        messageEl.classList.add('error');
        messageEl.classList.add('show');
      }
    });

    // 대시보드 통계 로드
    async function loadDashboardStats() {
      try {
        const result = await apiCall(`/dashboard/stats?사업장코드=${currentUser.사업장코드}`);

        if (result.success) {
          const stats = result.data;
          const statCards = document.querySelectorAll('.stat-card');

          statCards[0].querySelector('.stat-value').textContent =
            '₩' + Number(stats.todaySales).toLocaleString();
          statCards[0].querySelector('.stat-change').textContent = '전일 대비';

          statCards[1].querySelector('.stat-value').textContent =
            '₩' + Number(stats.monthlySales).toLocaleString();
          statCards[1].querySelector('.stat-change').textContent = '전월 대비';

          statCards[2].querySelector('.stat-value').textContent =
            '₩' + Number(stats.unpaidAmount).toLocaleString();
          statCards[2].querySelector('.stat-change').textContent = '미수금 현황';

          // 재고 현황 주석처리
          // statCards[3].querySelector('.stat-value').textContent =
          //   Number(stats.inventoryCount).toLocaleString() + '건';
          // statCards[3].querySelector('.stat-change').textContent = '재고 품목';
        }

        // 오늘의 문서 리스트 로드
        await loadTodayDocuments();
      } catch (error) {
        console.error('통계 로드 실패:', error);
      }
    }

    // 오늘의 문서 리스트 로드
    async function loadTodayDocuments() {
      const today = new Date().toISOString().slice(0, 10).replace(/-/g, ''); // YYYYMMDD

      try {
        // 1. 오늘의 견적서
        await loadTodayQuotations(today);

        // 2. 오늘의 발주서
        await loadTodayOrders(today);

        // 3. 오늘의 거래명세서
        await loadTodayTransactions(today);
      } catch (error) {
        console.error('오늘의 문서 로드 실패:', error);
      }
    }

    // 오늘의 견적서 로드
    async function loadTodayQuotations(today) {
      try {
        const result = await apiCall(`/quotations?startDate=${today}&endDate=${today}`);
        const countEl = document.getElementById('todayQuotationCount');

        // 기존 DataTable 파괴
        if (window.todayQuotationTableInstance) {
          window.todayQuotationTableInstance.destroy();
        }

        const tableData = result.success && result.data ? result.data : [];
        countEl.textContent = `${tableData.length}건`;

        // DataTable 초기화
        window.todayQuotationTableInstance = $('#todayQuotationTable').DataTable({
          data: tableData,
          columns: [
            {
              data: '견적번호',
              defaultContent: '-',
              render: (data) => data || '-',
            },
            {
              data: '매출처명',
              defaultContent: '-',
              render: (data) => {
                if (!data) return '-';
                if (data.length > 9) {
                  return `<span title="${data}">${data.substring(0, 9)}...</span>`;
                }
                return data;
              },
            },
            {
              // ✅ API에서 '견적금액'으로 반환
              data: '견적금액',
              defaultContent: '0',
              render: (data) => formatCurrencyKRW(data || 0),
              className: 'dt-right',
            },
          ],
          language: {
            emptyTable: '오늘 등록된 견적서가 없습니다.',
            search: '검색:',
            lengthMenu: '페이지당 _MENU_ 개',
            info: '_START_-_END_ / 총 _TOTAL_건',
            paginate: { previous: '이전', next: '다음' },
          },
          order: [[0, 'desc']], // 견적번호 내림차순
          paging: true,
          pageLength: 10,
          searching: false,
          lengthChange: false,
          info: false,
          responsive: true,
          autoWidth: false,
          scrollY: '320px',
          scrollCollapse: true,
        });

        // 행 클릭 이벤트
        $('#todayQuotationTable tbody').on('click', 'tr', function () {
          showPage('quotation');
        });
      } catch (error) {
        console.error('견적서 로드 실패:', error);
        document.getElementById('todayQuotationCount').textContent = '0건';
      }
    }

    // 오늘의 발주서 로드
    async function loadTodayOrders(today) {
      try {
        const result = await apiCall(`/orders?orderStartDate=${today}&orderEndDate=${today}`);
        const countEl = document.getElementById('todayOrderCount');

        // 기존 DataTable 파괴
        if (window.todayOrderTableInstance) {
          window.todayOrderTableInstance.destroy();
        }

        const tableData = result.success && result.data ? result.data : [];
        countEl.textContent = `${tableData.length}건`;

        // DataTable 초기화
        window.todayOrderTableInstance = $('#todayOrderTable').DataTable({
          data: tableData,
          columns: [
            {
              data: '발주번호',
              defaultContent: '-',
              render: (data) => data || '-',
            },
            {
              data: '매입처명',
              defaultContent: '-',
              render: (data) => {
                if (!data) return '-';
                if (data.length > 9) {
                  return `<span title="${data}">${data.substring(0, 9)}...</span>`;
                }
                return data;
              },
            },
            {
              data: '합계금액',
              defaultContent: '0',
              render: (data) => formatCurrencyKRW(data || 0),
              className: 'dt-right',
            },
          ],
          language: {
            emptyTable: '오늘 등록된 발주서가 없습니다.',
            search: '검색:',
            lengthMenu: '페이지당 _MENU_ 개',
            info: '_START_-_END_ / 총 _TOTAL_건',
            paginate: { previous: '이전', next: '다음' },
          },
          order: [[0, 'desc']], // 발주번호 내림차순
          paging: true,
          pageLength: 10,
          searching: false,
          lengthChange: false,
          info: false,
          responsive: true,
          autoWidth: false,
          scrollY: '320px',
          scrollCollapse: true,
        });

        // 행 클릭 이벤트
        $('#todayOrderTable tbody').on('click', 'tr', function () {
          showPage('order');
        });
      } catch (error) {
        console.error('발주서 로드 실패:', error);
        document.getElementById('todayOrderCount').textContent = '0건';
      }
    }

    // 오늘의 거래명세서 로드
    async function loadTodayTransactions(today) {
      try {
        const result = await apiCall(`/transactions?startDate=${today}&endDate=${today}`);
        const countEl = document.getElementById('todayTransactionCount');

        // 기존 DataTable 파괴
        if (window.todayTransactionTableInstance) {
          window.todayTransactionTableInstance.destroy();
        }

        const tableData = result.success && result.data ? result.data : [];
        countEl.textContent = `${tableData.length}건`;

        // DataTable 초기화
        window.todayTransactionTableInstance = $('#todayTransactionTable').DataTable({
          data: tableData,
          columns: [
            {
              data: '거래번호',
              defaultContent: '-',
              render: (data) => data || '-',
            },
            {
              data: '매출처명',
              defaultContent: '-',
              render: (data) => {
                if (!data) return '-';
                if (data.length > 9) {
                  return `<span title="${data}">${data.substring(0, 9)}...</span>`;
                }
                return data;
              },
            },
            {
              data: '합계금액',
              defaultContent: '0',
              render: (data) => formatCurrencyKRW(data || 0),
              className: 'dt-right',
            },
          ],
          language: {
            emptyTable: '오늘 등록된 거래명세서가 없습니다.',
            search: '검색:',
            lengthMenu: '페이지당 _MENU_ 개',
            info: '_START_-_END_ / 총 _TOTAL_건',
            paginate: { previous: '이전', next: '다음' },
          },
          order: [[0, 'desc']], // 거래번호 내림차순
          paging: true,
          pageLength: 10,
          searching: false,
          lengthChange: false,
          info: false,
          responsive: true,
          autoWidth: false,
          scrollY: '320px',
          scrollCollapse: true,
        });

        // 행 클릭 이벤트
        $('#todayTransactionTable tbody').on('click', 'tr', function () {
          showPage('transaction');
        });
      } catch (error) {
        console.error('거래명세서 로드 실패:', error);
        document.getElementById('todayTransactionCount').textContent = '0건';
      }
    }

    // ✅ formatDate → common.js:23 (formatDate 함수)
    // ✅ formatCurrency → common.js:163 (formatCurrencyKRW 함수)
    // ✅ 모든 날짜/금액 포맷 함수는 common.js에서 관리됨

    // ✅ toggleCustomerActionButtons, toggleSelectAllCustomers, toggleSelectAllSuppliers 함수 제거됨
    // ✅ customer.js는 DataTable을 사용하므로 체크박스 토글 함수가 필요 없습니다

    // ✅ 매출처 수정/삭제 함수는 customer.js에서 관리됩니다 (deleteSalesCustomerManage, editCustomer 등)

    // ✅ 매입처 목록 로드는 supplier.js의 DataTable이 자동으로 처리합니다.

    // ✅ 견적 목록 로드는 quotation.js의 DataTable이 자동으로 처리합니다.

    // ✅ 발주 목록 로드는 order.js에서 관리됩니다 (window.loadOrders = loadOrderList)

    // 서브메뉴 토글
    function toggleSubmenu(element) {
      const submenu = element.nextElementSibling;
      const isCurrentlyOpen = submenu.classList.contains('open');

      // 모든 메뉴 링크와 서브메뉴의 open 클래스 제거
      document.querySelectorAll('.menu-link').forEach((link) => {
        link.classList.remove('open');
      });
      document.querySelectorAll('.submenu').forEach((sub) => {
        sub.classList.remove('open');
      });

      // 클릭한 메뉴가 닫혀있었다면 열기
      if (!isCurrentlyOpen) {
        element.classList.add('open');
        submenu.classList.add('open');
      }
    }

    // ⚠️ 중복된 showPage() 함수 제거됨 - 첫 번째 정의만 사용

    // ==================== 작업일자 관리 함수 ====================

    // 작업일자 표시 업데이트
    function updateWorkingDateDisplay(dateStr) {
      const dateEl = document.getElementById('currentWorkingDate');
      const dayEl = document.getElementById('currentWorkingDay');

      if (!dateEl || !dayEl) return;

      dateEl.textContent = dateStr;

      // 요일 계산
      const date = new Date(dateStr);
      const days = ['일', '월', '화', '수', '목', '금', '토'];
      const dayOfWeek = days[date.getDay()];
      dayEl.textContent = `(${dayOfWeek})`;
    }

    // 작업일자 가져오기
    function getWorkingDate() {
      return localStorage.getItem('workingDate') || new Date().toISOString().slice(0, 10);
    }

    // ==================== 용지설정관리 함수 ====================

    // 페이지 로드 시 저장된 마진 설정 불러오기
    function loadPaperMargins() {
      const savedMargins = localStorage.getItem('printMargins');

      if (savedMargins) {
        const margins = JSON.parse(savedMargins);
        document.getElementById('marginTop').value = margins.top || 10;
        document.getElementById('marginBottom').value = margins.bottom || 10;
        document.getElementById('marginLeft').value = margins.left || 10;
        document.getElementById('marginRight').value = margins.right || 10;
      } else {
        // 기본값 설정
        document.getElementById('marginTop').value = 10;
        document.getElementById('marginBottom').value = 10;
        document.getElementById('marginLeft').value = 10;
        document.getElementById('marginRight').value = 10;
      }
    }

    // 마진 설정 저장
    function savePaperMargins() {
      const margins = {
        top: parseInt(document.getElementById('marginTop').value) || 10,
        bottom: parseInt(document.getElementById('marginBottom').value) || 10,
        left: parseInt(document.getElementById('marginLeft').value) || 10,
        right: parseInt(document.getElementById('marginRight').value) || 10,
      };

      // 유효성 검사
      if (
        margins.top < 0 ||
        margins.top > 50 ||
        margins.bottom < 0 ||
        margins.bottom > 50 ||
        margins.left < 0 ||
        margins.left > 50 ||
        margins.right < 0 ||
        margins.right > 50
      ) {
        alert('마진 값은 0mm ~ 50mm 사이여야 합니다.');
        return;
      }

      // localStorage에 저장
      localStorage.setItem('printMargins', JSON.stringify(margins));

      // CSS 변수 업데이트
      updatePrintMargins(margins);

      alert('마진 설정이 저장되었습니다.');
      console.log('✅ 용지 마진 저장:', margins);
    }

    // 마진 기본값 복원
    function resetPaperMargins() {
      if (confirm('마진 설정을 기본값(10mm)으로 복원하시겠습니까?')) {
        document.getElementById('marginTop').value = 10;
        document.getElementById('marginBottom').value = 10;
        document.getElementById('marginLeft').value = 10;
        document.getElementById('marginRight').value = 10;

        const defaultMargins = { top: 10, bottom: 10, left: 10, right: 10 };
        localStorage.setItem('printMargins', JSON.stringify(defaultMargins));
        updatePrintMargins(defaultMargins);

        alert('기본값으로 복원되었습니다.');
      }
    }

    // CSS @page 마진 업데이트
    function updatePrintMargins(margins) {
      // 기존 스타일 제거
      const existingStyle = document.getElementById('dynamicPrintMargins');
      if (existingStyle) {
        existingStyle.remove();
      }

      // 새 스타일 추가
      const style = document.createElement('style');
      style.id = 'dynamicPrintMargins';
      style.textContent = `
          @media print {
            @page {
              size: A4;
              margin: ${margins.top}mm ${margins.right}mm ${margins.bottom}mm ${margins.left}mm;
            }
          }
        `;
      document.head.appendChild(style);

      console.log('✅ 프린트 마진 CSS 업데이트:', margins);
    }

    // 페이지 로드 시 마진 적용
    function initPrintMargins() {
      const savedMargins = localStorage.getItem('printMargins');

      if (savedMargins) {
        const margins = JSON.parse(savedMargins);
        updatePrintMargins(margins);
      } else {
        // 기본값 적용
        const defaultMargins = { top: 10, bottom: 10, left: 10, right: 10 };
        updatePrintMargins(defaultMargins);
      }
    }

    // 작업일자 변경 모달 열기
    function openDateChangeModal() {
      const modal = document.getElementById('dateChangeModal');
      const dateInput = document.getElementById('newWorkingDate');

      // 현재 작업일자로 초기화
      dateInput.value = getWorkingDate();

      modal.style.display = 'flex';
    }

    // 작업일자 변경 모달 닫기
    function closeDateChangeModal() {
      document.getElementById('dateChangeModal').style.display = 'none';
    }

    // 작업일자 변경 확인
    function confirmDateChange() {
      const newDate = document.getElementById('newWorkingDate').value;

      if (!newDate) {
        alert('날짜를 선택해주세요.');
        return;
      }

      // localStorage 업데이트
      localStorage.setItem('workingDate', newDate);

      // 화면 표시 업데이트
      updateWorkingDateDisplay(newDate);

      // 모달 닫기
      closeDateChangeModal();

      // 성공 메시지
      alert(`작업일자가 ${newDate}로 변경되었습니다.`);
    }

    // ⚠️ 중복된 logout() 함수 제거됨 - 첫 번째 정의만 사용

    // ✅ 매출처 상세조회/수정/삭제 함수는 customer.js에서 관리됩니다
    // (viewSalesCustomerManageDetail, editSalesCustomerManage, deleteSalesCustomerManage 등)
    // ✅ openNewCustomerModal → customer.js:884 (window.openNewCustomerModal = window.openSalesCustomerManageCreateModal)

    // ✅ exportCustomersToGoogleSheets → customer.js:342 (window.exportCustomersToGoogleSheets)
    // ✅ viewCustomer → customer.js:348 (window.viewCustomerDetail)
    // ✅ viewSupplier → supplier.js:365 (viewSupplierDetail)
    // ✅ viewQuotation → quotation.js:624 (window.viewQuotationManageDetail)
    // ✅ viewOrder → order.js:520 (viewOrderDetail)

    // ==================== Google Sheets 내보내기 기능 ====================

    // ✅ exportCustomersToExcel → customer.js:342 (window.exportCustomersToGoogleSheets)에서 관리됨 (중복 함수 제거됨)
    // ✅ exportSuppliersToExcel → 사용되지 않음 (중복 함수 제거됨)

    // ✅ exportQuotationsToExcel → quotation.js:3992 (window.exportQuotationsToExcel)
    // ✅ DataTable 기반으로 재작성되어 quotation.js로 이동됨 (체크박스 기반 함수는 작동하지 않았음)

    // ✅ 일계표 출력 함수 제거됨 (loadDailyReport, printDailyReport)
    // ✅ 회계전표관리 함수 제거됨 (loadAccountingVouchers, openVoucherDetailModal, saveVoucherEdit, confirmVoucherDelete 등)

  </script>

  <!-- HTML의 </body> 직전에 모달 HTML 추가 -->

  <!-- 현금출납 등록/수정 모달 -->

</body>

</html>