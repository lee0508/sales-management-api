<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>판매관리 시스템</title>
    <!-- 다음 우편번호 API -->
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script src="js/customer.js" defer></script>
    <script src="js/supplier.js" defer></script>
    <script src="js/postoffice.js" defer></script>
    <script src="js/transaction.js" defer></script>

    <link rel="stylesheet" href="css/onstyles.css" />
  </head>

  <body>
    <!-- 로그인 페이지 -->
    <div class="login-container" id="loginPage">
      <div class="login-box">
        <div class="login-header">
          <h1>판매관리 시스템</h1>
          <p>로그인하여 시스템을 사용하세요</p>
        </div>
        <form id="loginForm">
          <div class="form-group">
            <label for="loginDateText">접속일자</label>
            <div style="display: flex; gap: 12px; align-items: center;">
              <input
                type="text"
                id="loginDateText"
                class="form-input"
                placeholder="YYYY-MM-DD 직접 입력"
                autocomplete="off"
              />
              <div style="position: relative; flex: 1;">
                <input
                  type="date"
                  id="loginDatePicker"
                  class="form-input"
                  style="padding-right: 44px;"
                />
                <button
                  type="button"
                  onclick="openLoginDatePicker()"
                  aria-label="달력으로 일자 선택"
                  style="
                    position: absolute;
                    top: 50%;
                    right: 12px;
                    transform: translateY(-50%);
                    background: none;
                    border: none;
                    cursor: pointer;
                    padding: 0;
                    display: flex;
                  "
                >
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <rect x="3" y="4" width="18" height="18" rx="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="userId">사용자 아이디</label>
            <input
              type="text"
              id="userId"
              class="form-input"
              placeholder="아이디를 입력하세요"
              required
            />
          </div>
          <div class="form-group">
            <label for="password">비밀번호</label>
            <input
              type="password"
              id="password"
              class="form-input"
              placeholder="비밀번호를 입력하세요"
              required
            />
          </div>
          <button type="submit" class="btn-login">로그인</button>
        </form>
        <div class="login-message" id="loginMessage">시스템에 오신 것을 환영합니다.</div>
      </div>
    </div>

    <!-- 대시보드 -->
    <div class="dashboard" id="dashboard">
      <!-- 사이드바 -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <h2>판매관리 시스템</h2>
        </div>
        <nav class="sidebar-menu">
          <div class="menu-item">
            <a class="menu-link active" onclick="showPage('dashboard')">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
                ></path>
              </svg>
              대시보드
            </a>
          </div>

          <div class="menu-item">
            <a class="menu-link" onclick="toggleSubmenu(this)" id="jangbuMenu">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
                ></path>
              </svg>
              장부관리
              <span class="arrow">▼</span>
            </a>
            <!--  
            매입처장부관리 -> Purchaser's ledger management 
            매출처장부관리 -> Sales ledger management
            미수금관리 -> Accounts receivable management
            미지급금관리 -> Accounts Payable Management
            현금출납장관리 -> Cash receipt and disbursement management
            세금계산서관리 -> Tax invoice management
            -->
            <div class="submenu" id="salesSubmenu">
              <a class="submenu-link" onclick="showPage('item-catagory')">매입처장부관리</a>
              <a class="submenu-link" onclick="showPage('item-history')">매출처장부관리</a>
              <a class="submenu-link" onclick="showPage('item-stock')">미수금관리</a>
              <a class="submenu-link" onclick="showPage('item-stock')">미지급금관리</a>
              <a class="submenu-link" onclick="showPage('item-stock')">현금출납관리</a>
              <a class="submenu-link" onclick="showPage('item-stock')">세금계산서관리</a>
            </div>
          </div>

          <div class="menu-item">
            <a class="menu-link" onclick="toggleSubmenu(this)" id="purchaseMenu">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"
                ></path>
              </svg>
              매입관리
              <span class="arrow">▼</span>
            </a>
            <div class="submenu" id="purchaseSubmenu">
              <a class="submenu-link" onclick="showPage('order')">발주관리</a>
              <a class="submenu-link" onclick="showPage('purchase')">매입전표관리</a>
              <a class="submenu-link" onclick="showPage('supplier')">매입처관리</a>
            </div>
          </div>

          <div class="menu-item">
            <a class="menu-link" onclick="toggleSubmenu(this)" id="salesMenu">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
                ></path>
              </svg>
              매출관리
              <span class="arrow">▼</span>
            </a>
            <div class="submenu" id="salesSubmenu">
              <a class="submenu-link" onclick="showPage('quotation')">견적관리</a>
              <a class="submenu-link" onclick="showPage('transaction')">거래명세서관리</a>
              <a class="submenu-link" onclick="showPage('customer')">매출처관리</a>
            </div>
          </div>

          <div class="menu-item">
            <a class="menu-link" onclick="toggleSubmenu(this)" id="itemMenu">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
                ></path>
              </svg>
              자재관리
              <span class="arrow">▼</span>
            </a>
            <div class="submenu" id="salesSubmenu">
              <a class="submenu-link" onclick="showPage('item-catagory')">자재분류관리</a>
              <a class="submenu-link" onclick="showPage('item-history')">자재내역관리</a>
              <a class="submenu-link" onclick="showPage('item-stock')">자재재고관리</a>
            </div>
          </div>

          <div class="menu-item">
            <a class="menu-link" onclick="toggleSubmenu(this)" id="accountMenu">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                ></path>
              </svg>
              회계관리
              <span class="arrow">▼</span>
            </a>
            <div class="submenu" id="salesSubmenu">
              <a class="submenu-link" onclick="showPage('account-catagory')">회계개정관리</a>
              <a class="submenu-link" onclick="showPage('account-history')">현금출납내역관리</a>
              <a class="submenu-link" onclick="showPage('total-balnace')">합계잔액시산표</a>
              <a class="submenu-link" onclick="showPage('account-balnace')">대차대조표</a>
            </div>
          </div>

          <div class="menu-item">
            <a class="menu-link" onclick="toggleSubmenu(this)" id="printMenu">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"
                ></path>
              </svg>
              출력물관리
              <span class="arrow">▼</span>
            </a>
            <div class="submenu" id="salesSubmenu">
              <a class="submenu-link" onclick="showPage('itembook-printMenu')">자재대장출력관리</a>
              <a class="submenu-link" onclick="showPage('salesbook-printMenu')">매출처출력관리</a>
              <a class="submenu-link" onclick="showPage('quotation-printMenu')">매입처출력관리</a>
              <a class="submenu-link" onclick="showPage('account-balnace')">발주서출력관리</a>
              <a class="submenu-link" onclick="showPage('account-balnace')">견적서출력관리</a>
              <a class="submenu-link" onclick="showPage('account-balnace')">세금계산서출력관리</a>
            </div>
          </div>

          <div class="menu-item">
            <a class="menu-link" onclick="toggleSubmenu(this)" id="settingMenu">
              <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                ></path>
              </svg>
              설정관리
              <span class="arrow">▼</span>
            </a>
            <div class="submenu" id="salesSubmenu">
              <a class="submenu-link" onclick="showPage('paper-setting')">용지설정관리</a>
              <a class="submenu-link" onclick="showPage('salespaper-setting')"
                >거래명세서설정관리</a
              >
              <a class="submenu-link" onclick="showPage('taxpaper-setting')">세금계산서설정관리</a>
              <a class="submenu-link" onclick="showPage('warehouse-setting')">창고설정관리</a>
              <a class="submenu-link" onclick="showPage('taxrate-setting')">부과세율설정관리</a>
            </div>
          </div>
        </nav>
      </aside>

      <!-- 메인 컨텐츠 -->
      <main class="main-content">
        <div class="top-bar">
          <h1 id="pageTitle">대시보드</h1>
          <div class="user-info">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">사용자</span>
            <button class="btn-logout" onclick="logout()">로그아웃</button>
          </div>
        </div>

        <div class="content-area">
          <!-- 대시보드 페이지 -->
          <div class="page-content active" id="dashboardPage">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-label">오늘 매출</div>
                <div class="stat-value">₩0</div>
                <div class="stat-change">데이터 로딩중...</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">이번달 매출</div>
                <div class="stat-value">₩0</div>
                <div class="stat-change">데이터 로딩중...</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">미수금</div>
                <div class="stat-value">₩0</div>
                <div class="stat-change">데이터 로딩중...</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">재고 현황</div>
                <div class="stat-value">0건</div>
                <div class="stat-change">데이터 로딩중...</div>
              </div>
            </div>

            <div class="content-card">
              <h3 class="card-title">판매관리 시스템에 오신 것을 환영합니다</h3>
              <p style="color: var(--text-gray); margin-top: 16px; line-height: 1.6">
                좌측 메뉴에서 원하시는 기능을 선택하세요.<br />
                • 매출관리: 견적, 거래명세서, 매출처 관리<br />
                • 매입관리: 발주, 매입전표, 매입처 관리<br />
                • 재고관리: 자재 및 재고 현황 조회
              </p>
            </div>
          </div>

          <!-- 매출처관리 페이지 -->
          <div class="page-content" id="customerPage">
            <div class="toolbar">
              <div class="toolbar-left">
                <div class="search-box">
                  <input
                    type="text"
                    class="search-input"
                    id="customerSearch"
                    placeholder="매출처명 또는 사업자번호로 검색..."
                  />
                  <button class="btn btn-secondary" onclick="loadCustomers()">검색</button>
                </div>
              </div>
              <div class="toolbar-right">
                <button class="btn btn-success" onclick="openCustomerModal()">
                  <span>+</span> 신규 등록
                </button>
                <!-- <button class="btn btn-success"><span>+</span> 신규 등록</button> -->
                <!-- <button class="btn btn-secondary"><span>📄</span> 엑셀 내보내기</button> -->
                <button class="btn btn-secondary" onclick="exportCustomersToExcel()">
                  <span>📊</span> Google Sheets로 내보내기
                </button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <!-- <th>선택</th> -->
                    <th style="width: 40px">
                      <input
                        type="checkbox"
                        id="selectAllCustomers"
                        onclick="toggleSelectAllCustomers(this)"
                      />
                    </th>
                    <th>번호</th>
                    <th>매출처코드</th>
                    <th>매출처명</th>
                    <th>대표자</th>
                    <th>사업자번호</th>
                    <th>연락처</th>
                    <th>거래상태</th>
                    <th>등록일</th>
                    <th>관리</th>
                  </tr>
                </thead>
                <tbody id="customerTableBody">
                  <tr>
                    <td colspan="10" class="loading">데이터를 불러오는 중...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="pagination" id="customerPagination"></div>
          </div>

          <!-- 매입처관리 페이지 -->
          <div class="page-content" id="supplierPage">
            <div class="toolbar">
              <div class="toolbar-left">
                <div class="search-box">
                  <input
                    type="text"
                    class="search-input"
                    id="supplierSearch"
                    placeholder="매입처명 또는 사업자번호로 검색..."
                  />
                  <button class="btn btn-secondary" onclick="loadSuppliers()">검색</button>
                </div>
              </div>
              <div class="toolbar-right">
                <button
                  class="btn btn-success"
                  onclick="console.log('🔘 매입처 신규 등록 버튼 클릭됨'); openSupplierModal();"
                >
                  <span>+</span> 신규 등록
                </button>
                <!-- <button class="btn btn-success"><span>+</span> 신규 등록</button> -->
                <!-- <button class="btn btn-secondary"><span>📄</span> 엑셀 내보내기</button> -->
                <button class="btn btn-secondary" onclick="exportSuppliersToExcel()">
                  <span>📊</span> Google Sheets로 내보내기
                </button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th style="width: 40px">
                      <input
                        type="checkbox"
                        id="selectAllSuppliers"
                        onclick="toggleSelectAllSuppliers(this)"
                      />
                    </th>
                    <th>번호</th>
                    <th>매입처코드</th>
                    <th>매입처명</th>
                    <th>대표자</th>
                    <th>사업자번호</th>
                    <th>연락처</th>
                    <th>거래상태</th>
                    <th>등록일</th>
                    <th>관리</th>
                  </tr>
                </thead>
                <tbody id="supplierTableBody">
                  <tr>
                    <td colspan="10" class="loading">데이터를 불러오는 중...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="pagination" id="supplierPagination"></div>
          </div>

          <!-- 견적관리 페이지 -->
          <div class="page-content" id="quotationPage">
            <div class="toolbar">
              <div class="toolbar-left">
                <select class="form-control" style="width: 150px">
                  <option>전체</option>
                  <option>진행중</option>
                  <option>승인</option>
                  <option>반려</option>
                </select>
                <div class="search-box">
                  <input
                    type="text"
                    class="search-input"
                    id="quotationSearch"
                    placeholder="견적번호 또는 매출처명으로 검색..."
                  />
                  <button class="btn btn-secondary" onclick="loadQuotations()">검색</button>
                </div>
              </div>
              <div class="toolbar-right">
                <button class="btn btn-success"><span>+</span> 견적서 작성</button>
                <button class="btn btn-secondary"><span>📄</span> 출력</button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>견적번호</th>
                    <th>매출처명</th>
                    <th>견적일자</th>
                    <th>유효기간</th>
                    <th>견적금액</th>
                    <th>담당자</th>
                    <th>상태</th>
                    <th>관리</th>
                  </tr>
                </thead>
                <tbody id="quotationTableBody">
                  <tr>
                    <td colspan="8" class="loading">데이터를 불러오는 중...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="pagination" id="quotationPagination"></div>
          </div>

          <!-- 발주관리 페이지 -->
          <div class="page-content" id="orderPage">
            <div class="toolbar">
              <div class="toolbar-left">
                <select class="form-control" style="width: 150px">
                  <option>전체</option>
                  <option>발주대기</option>
                  <option>발주완료</option>
                  <option>입고완료</option>
                </select>
                <div class="search-box">
                  <input
                    type="text"
                    class="search-input"
                    id="orderSearch"
                    placeholder="발주번호 또는 매입처명으로 검색..."
                  />
                  <button class="btn btn-secondary" onclick="loadOrders()">검색</button>
                </div>
              </div>
              <div class="toolbar-right">
                <button class="btn btn-success"><span>+</span> 발주서 작성</button>
                <button class="btn btn-secondary"><span>📄</span> 출력</button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>발주번호</th>
                    <th>매입처명</th>
                    <th>발주일자</th>
                    <th>납기일자</th>
                    <th>발주금액</th>
                    <th>담당자</th>
                    <th>상태</th>
                    <th>관리</th>
                  </tr>
                </thead>
                <tbody id="orderTableBody">
                  <tr>
                    <td colspan="8" class="loading">데이터를 불러오는 중...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="pagination" id="orderPagination"></div>
          </div>

          <!-- 거래명세서관리 페이지 -->
          <div class="page-content" id="transactionPage">
            <div class="toolbar">
              <div class="toolbar-left">
                <input type="date" class="form-control" style="width: 180px" />
                <span style="padding: 0 8px">~</span>
                <input type="date" class="form-control" style="width: 180px" />
                <button class="btn btn-secondary">조회</button>
              </div>
              <div class="toolbar-right">
                <button class="btn btn-success"><span>+</span> 거래명세서 작성</button>
                <button class="btn btn-secondary"><span>📄</span> 출력</button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>명세서번호</th>
                    <th>매출처명</th>
                    <th>거래일자</th>
                    <th>공급가액</th>
                    <th>부가세</th>
                    <th>합계금액</th>
                    <th>담당자</th>
                    <th>상태</th>
                    <th>관리</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="9" class="loading">데이터를 불러오는 중...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- 매입전표관리 페이지 -->
          <div class="page-content" id="purchasePage">
            <div class="toolbar">
              <div class="toolbar-left">
                <input type="date" class="form-control" style="width: 180px" />
                <span style="padding: 0 8px">~</span>
                <input type="date" class="form-control" style="width: 180px" />
                <button class="btn btn-secondary">조회</button>
              </div>
              <div class="toolbar-right">
                <button class="btn btn-success"><span>+</span> 매입전표 작성</button>
                <button class="btn btn-secondary"><span>📄</span> 출력</button>
              </div>
            </div>

            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>전표번호</th>
                    <th>매입처명</th>
                    <th>매입일자</th>
                    <th>공급가액</th>
                    <th>부가세</th>
                    <th>합계금액</th>
                    <th>담당자</th>
                    <th>상태</th>
                    <th>관리</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="9" class="loading">데이터를 불러오는 중...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // 모달을 body 직속으로 이동 (dashboard CSS 영향 회피)
      document.addEventListener('DOMContentLoaded', function () {
        const customerModal = document.getElementById('customerModal');
        const supplierModal = document.getElementById('supplierModal');

        if (customerModal && customerModal.parentElement !== document.body) {
          document.body.appendChild(customerModal);
          console.log('✅ 매출처 모달을 body로 이동 완료');
        }

        if (supplierModal && supplierModal.parentElement !== document.body) {
          document.body.appendChild(supplierModal);
          console.log('✅ 매입처 모달을 body로 이동 완료');
        }
      });

      // API 기본 URL
      const API_BASE_URL = 'http://localhost:3000/api';

      // 현재 로그인 사용자 정보
      let currentUser = null;

      let currentCustomerPage = 1;
      let customerPageSizeSelected = 10;
      let customerPageSizeEffective = 10;

      let currentSupplierPage = 1;
      let supplierPageSizeSelected = 10;
      let supplierPageSizeEffective = 10;

      function getCustomerEffectivePageSize() {
        // 셀렉터 선택값을 그대로 사용 (화면 높이로 제한하지 않음)
        const select = document.getElementById('customerPageSizeSelect');
        const selected = Number(select?.value || customerPageSizeSelected || 10);
        customerPageSizeSelected = selected;
        customerPageSizeEffective = selected;
        return selected;
      }

      function getSupplierEffectivePageSize() {
        const select = document.getElementById('supplierPageSizeSelect');
        const selected = Number(select?.value || supplierPageSizeSelected || 10);
        supplierPageSizeSelected = selected;
        supplierPageSizeEffective = selected;
        return selected;
      }

      function debounce(fn, wait = 200) {
        let t;
        return (...args) => {
          clearTimeout(t);
          t = setTimeout(() => fn(...args), wait);
        };
      }

      document.addEventListener('DOMContentLoaded', () => {
        // 주입식 페이지 사이즈 선택 박스 생성
        const toolbarLeft = document.querySelector('#customerPage .toolbar .toolbar-left');
        if (toolbarLeft && !document.getElementById('customerPageSizeSelect')) {
          const sel = document.createElement('select');
          sel.id = 'customerPageSizeSelect';
          sel.className = 'form-control';
          sel.style.width = '120px';
          sel.style.marginLeft = '8px';
          [10, 15, 20, 25, 50].forEach((n) => {
            const opt = document.createElement('option');
            opt.value = String(n);
            opt.textContent = n + '개';
            if (n === 10) opt.selected = true;
            sel.appendChild(opt);
          });
          toolbarLeft.appendChild(sel);
          sel.addEventListener('change', () => loadCustomers(1));
        }

        const supplierToolbarLeft = document.querySelector('#supplierPage .toolbar .toolbar-left');
        if (supplierToolbarLeft && !document.getElementById('supplierPageSizeSelect')) {
          const sel = document.createElement('select');
          sel.id = 'supplierPageSizeSelect';
          sel.className = 'form-control';
          sel.style.width = '120px';
          sel.style.marginLeft = '8px';
          [10, 15, 20, 25, 50].forEach((n) => {
            const opt = document.createElement('option');
            opt.value = String(n);
            opt.textContent = n + '개';
            if (n === 10) opt.selected = true;
            sel.appendChild(opt);
          });
          supplierToolbarLeft.appendChild(sel);
          sel.addEventListener('change', () => loadSuppliers(1));
        }

        window.addEventListener(
          'resize',
          debounce(() => {
            const customerActive = document
              .getElementById('customerPage')
              ?.classList.contains('active');
            if (customerActive) loadCustomers(currentCustomerPage);

            const supplierActive = document
              .getElementById('supplierPage')
              ?.classList.contains('active');
            if (supplierActive) loadSuppliers(currentSupplierPage);
          }, 200),
        );
      });

      // API 호출 헬퍼 함수
      async function apiCall(endpoint, method = 'GET', data = null) {
        /**
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                try {
                    const response = await fetch(`${API_BASE_URL}${endpoint}`, options);
                    const result = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(result.message || '서버 오류');
                    }
                    
                    return result;
                } catch (error) {
                    console.error('API 호출 에러:', error);
                    throw error;
                }
                **/
        try {
          let url = `${API_BASE_URL}${endpoint}`;
          const options = {
            method,
            headers: { 'Content-Type': 'application/json' },
          };

          // ✅ GET 요청일 때: data를 쿼리스트링으로 변환
          if (method.toUpperCase() === 'GET' && data && typeof data === 'object') {
            const queryString = new URLSearchParams(data).toString();
            if (queryString) url += (url.includes('?') ? '&' : '?') + queryString;
          }
          // ✅ POST/PUT/DELETE 요청일 때: body에 JSON으로 추가
          else if (data) {
            options.body = JSON.stringify(data);
          }

          const response = await fetch(url, options);
          const result = await response.json();

          if (!response.ok) {
            throw new Error(result.message || '서버 오류');
          }

          return result;
        } catch (error) {
          console.error('API 호출 에러:', error);
          throw error;
        }
      }

      function openLoginDatePicker() {
        const input = document.getElementById('loginDatePicker');
        if (!input) return;

      if (typeof input.showPicker === 'function') {
        input.showPicker();
      } else {
        input.focus();
      }
    }

      const loginDateTextInput = document.getElementById('loginDateText');
      const loginDatePickerInput = document.getElementById('loginDatePicker');

      if (loginDatePickerInput && loginDateTextInput) {
        loginDatePickerInput.addEventListener('change', () => {
          loginDateTextInput.value = loginDatePickerInput.value;
        });
      }

      // 로그인 처리
      document.getElementById('loginForm').addEventListener('submit', async function (e) {
        e.preventDefault();

        const userId = document.getElementById('userId').value;
        const password = document.getElementById('password').value;
        const loginDateTextValue = loginDateTextInput.value.trim();
        const loginDatePickerValue = loginDatePickerInput.value;
        const loginDate = loginDatePickerValue || loginDateTextValue;
        const messageEl = document.getElementById('loginMessage');

        if (!loginDate) {
          messageEl.textContent = '접속일자를 입력하거나 선택해 주세요.';
          messageEl.classList.add('error');
          messageEl.classList.add('show');
          loginDateTextInput.focus();
          return;
        }

        if (loginDatePickerValue && loginDateTextValue !== loginDatePickerValue) {
          loginDateTextInput.value = loginDatePickerValue;
        }

        try {
          messageEl.textContent = '로그인 중...';
          messageEl.classList.remove('error');
          messageEl.classList.add('show');

          const result = await apiCall('/auth/login', 'POST', {
            userId: userId,
            password: password,
            loginDate: loginDate,
          });

          if (result.success) {
            currentUser = result.data;

            messageEl.textContent = result.message;

            setTimeout(() => {
              document.getElementById('loginPage').style.display = 'none';
              document.getElementById('dashboard').classList.add('active');

              document.getElementById('userName').textContent = currentUser.사용자명;
              document.getElementById('userAvatar').textContent = currentUser.사용자명.charAt(0);

              // 대시보드 통계 로드
              loadDashboardStats();
            }, 800);
          }
        } catch (error) {
          messageEl.textContent = '로그인 실패: ' + error.message;
          messageEl.classList.add('error');
          messageEl.classList.add('show');
        }
      });

      // 대시보드 통계 로드
      async function loadDashboardStats() {
        try {
          const result = await apiCall(`/dashboard/stats?사업장코드=${currentUser.사업장코드}`);

          if (result.success) {
            const stats = result.data;
            const statCards = document.querySelectorAll('.stat-card');

            statCards[0].querySelector('.stat-value').textContent =
              '₩' + Number(stats.todaySales).toLocaleString();
            statCards[0].querySelector('.stat-change').textContent = '전일 대비';

            statCards[1].querySelector('.stat-value').textContent =
              '₩' + Number(stats.monthlySales).toLocaleString();
            statCards[1].querySelector('.stat-change').textContent = '전월 대비';

            statCards[2].querySelector('.stat-value').textContent =
              '₩' + Number(stats.unpaidAmount).toLocaleString();
            statCards[2].querySelector('.stat-change').textContent = '미수금 현황';

            statCards[3].querySelector('.stat-value').textContent =
              Number(stats.inventoryCount).toLocaleString() + '건';
            statCards[3].querySelector('.stat-change').textContent = '재고 품목';
          }
        } catch (error) {
          console.error('통계 로드 실패:', error);
        }
      }

      /**
       * 체크박스 선택 시 수정/삭제 버튼 표시/숨김
       * @param {HTMLElement} checkbox - 체크박스 엘리먼트
       */
      function toggleCustomerActionButtons(checkbox) {
        const customerCode = checkbox.value;
        const actionsDiv = document.getElementById(`actions-${customerCode}`);

        if (!actionsDiv) return;

        const viewBtn = actionsDiv.querySelector('.btn-view');
        const editBtn = actionsDiv.querySelector('.btn-edit');
        const deleteBtn = actionsDiv.querySelector('.btn-delete');

        if (checkbox.checked) {
          // 체크 시: 상세 버튼 숨기고 수정/삭제 버튼 표시
          viewBtn.style.display = 'none';
          editBtn.style.display = 'inline-block';
          deleteBtn.style.display = 'inline-block';
        } else {
          // 체크 해제 시: 수정/삭제 버튼 숨기고 상세 버튼 표시
          viewBtn.style.display = 'inline-block';
          editBtn.style.display = 'none';
          deleteBtn.style.display = 'none';
        }
      }

      /**
       * 전체 선택/해제 (수정된 버전)
       * @param {HTMLElement} checkbox - 전체 선택 체크박스
       */
      function toggleSelectAllCustomers(checkbox) {
        const checkboxes = document.querySelectorAll('.customerCheckbox');
        checkboxes.forEach((cb) => {
          cb.checked = checkbox.checked;
          // 각 체크박스의 버튼 상태도 업데이트
          toggleCustomerActionButtons(cb);
        });
      }

      function toggleSelectAllSuppliers(checkbox) {
        const supplierCheckboxes = document.querySelectorAll('.supplierCheckbox');
        supplierCheckboxes.forEach((cb) => (cb.checked = checkbox.checked));
      }

      /**
       * 매출처 수정 함수
       * @param {string} customerCode - 매출처코드
       */
      async function editCustomer(customerCode) {
        try {
          console.log('===== 매출처 수정 시작 =====');
          console.log('매출처코드:', customerCode);

          // 1. 매출처 상세 정보 조회
          const result = await apiCall(`/customers/${customerCode}`);

          if (!result.success) {
            throw new Error(result.message || '매출처 정보를 불러올 수 없습니다.');
          }

          const customer = result.data;
          console.log('조회된 매출처 정보:', customer);

          // 2. 모달 열기
          const modal = document.getElementById('customerModal');
          if (!modal) {
            throw new Error('모달을 찾을 수 없습니다.');
          }

          // 3. 모달 제목 변경
          const modalTitle = modal.querySelector('h2');
          if (modalTitle) {
            modalTitle.textContent = '매출처 수정';
          }

          // 4. 폼 필드에 데이터 채우기
          document.getElementById('customerCode').value = customer.매출처코드 || '';
          document.getElementById('customerName').value = customer.매출처명 || '';
          document.getElementById('ceoName').value = customer.대표자명 || '';
          document.getElementById('businessNo').value = customer.사업자번호 || '';
          document.getElementById('businessType').value = customer.업태 || '';
          document.getElementById('businessCategory').value = customer.업종 || '';
          document.getElementById('phone').value = customer.전화번호 || '';
          document.getElementById('fax').value = customer.팩스번호 || '';
          document.getElementById('zipCode').value = customer.우편번호 || '';
          document.getElementById('address').value = customer.주소 || '';
          document.getElementById('addressDetail').value = customer.번지 || '';
          document.getElementById('bankCode').value = customer.은행코드 || '';
          document.getElementById('accountNo').value = customer.계좌번호 || '';
          document.getElementById('managerName').value = customer.담당자 || '';
          document.getElementById('status').value = customer.사용구분 || '0';
          document.getElementById('remark').value = customer.비고 || '';

          // 5. 폼에 수정 모드 표시를 위한 데이터 속성 추가
          const form = document.getElementById('customerForm');
          form.setAttribute('data-mode', 'edit');
          form.setAttribute('data-customer-code', customerCode);

          // 6. 모달 표시
          modal.style.display = 'flex';

          console.log('✅ 매출처 수정 모달 열기 완료');
        } catch (error) {
          console.error('❌ 매출처 수정 오류:', error);
          alert('매출처 수정 중 오류가 발생했습니다: ' + error.message);
        }
      }

      /**
       * 매출처 삭제 함수
       * @param {string} customerCode - 매출처코드
       */
      async function deleteCustomer(customerCode) {
        try {
          console.log('===== 매출처 삭제 시작 =====');
          console.log('매출처코드:', customerCode);

          // 1. 삭제 확인
          if (
            !confirm('정말로 이 매출처를 삭제하시겠습니까?\n\n삭제된 데이터는 복구할 수 없습니다.')
          ) {
            console.log('❌ 사용자가 삭제를 취소했습니다.');
            return;
          }

          // 2. API 호출로 매출처 삭제
          const result = await apiCall(`/customers/${customerCode}`, 'DELETE');

          if (!result.success) {
            throw new Error(result.message || '매출처 삭제에 실패했습니다.');
          }

          console.log('✅ 매출처 삭제 성공:', result);

          // 3. 성공 메시지 표시
          alert('매출처가 성공적으로 삭제되었습니다.');

          // 4. 목록 새로고침
          await loadCustomers(currentCustomerPage);

          console.log('✅ 매출처 목록 새로고침 완료');
        } catch (error) {
          console.error('❌ 매출처 삭제 오류:', error);
          alert('매출처 삭제 중 오류가 발생했습니다: ' + error.message);
        }
      }

      // 매출처 목록 로드
      async function loadCustomers(page = 1) {
        try {
          const searchValue = document.getElementById('customerSearch')?.value || '';
          const tbody = document.getElementById('customerTableBody');
          const pagination = document.getElementById('customerPagination');
          tbody.innerHTML =
            '<tr><td colspan="10" class="loading">데이터를 불러오는 중...</td></tr>';

          pagination.innerHTML = '';
          const effectivePageSize = getCustomerEffectivePageSize();
          currentCustomerPage = page;

          // ✅ 서버로 API 호출 (page, pageSize 함께 전송)
          const result = await apiCall('/customers', 'GET', {
            사업장코드: currentUser.사업장코드,
            search: searchValue,
            page,
            pageSize: effectivePageSize,
          });

          // const result = await apiCall(`/customers?사업장코드=${currentUser.사업장코드}&search=${searchValue}`);
          // const result = await apiCall(`/customers?사업장코드=${currentUser.사업장코드}&search=${searchValue}&page=${page}&pageSize=25`);

          if (result.success) {
            tbody.innerHTML = '';

            if (result.data.length === 0) {
              tbody.innerHTML = '<tr><td colspan="10" class="loading">데이터가 없습니다.</td></tr>';
              return;
            }

            const startNumber = (result.currentPage - 1) * customerPageSizeEffective + 1;

            result.data.forEach((customer, index) => {
              const statusClass = customer.사용구분 === 0 ? 'status-active' : 'status-pending';
              const statusText = customer.사용구분 === 0 ? '정상거래' : '거래보류';
              const rowNumber = startNumber + index;

              const tr = document.createElement('tr');
              tr.innerHTML = `
						    <td><input type="checkbox" class="customerCheckbox" value="${
                  customer.매출처코드
                }" onchange="toggleCustomerActionButtons(this)"></td>
							<td>${rowNumber}</td>
                            <td>${customer.매출처코드}</td>
                            <td>${customer.매출처명}</td>
                            <td>${customer.대표자명 || '-'}</td>
                            <td>${customer.사업자번호 || '-'}</td>
                            <td>${customer.전화번호 || '-'}</td>
                            <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                            <td>${customer.수정일자 || '-'}</td>
                            <td>
                        <div class="action-buttons" id="actions-${customer.매출처코드}">
                            <button class="btn-icon btn-view" onclick="viewCustomer('${
                              customer.매출처코드
                            }')">상세</button>
                            <button class="btn-icon btn-edit" style="display: none;" onclick="editCustomer('${
                              customer.매출처코드
                            }')">수정</button>
                            <button class="btn-icon btn-delete" style="display: none;" onclick="deleteCustomer('${
                              customer.매출처코드
                            }')">삭제</button>
                        </div>
                    </td>
                        `;
              tbody.appendChild(tr);
            });
          }

          renderCustomerPagination(result.currentPage, result.totalPages);
        } catch (error) {
          console.error('매출처 목록 로드 실패:', error);
          const tbody = document.getElementById('customerTableBody');
          tbody.innerHTML = `<tr><td colspan="10" class="loading" style="color: red;">오류: ${error.message}</td></tr>`;
        }
      }

      // 페이지네이션 렌더링
      function renderCustomerPagination(currentPage, totalPages) {
        const pagination = document.getElementById('customerPagination');
        pagination.innerHTML = '';

        if (totalPages <= 1) return;

        const maxButtons = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);

        if (endPage - startPage < maxButtons - 1) {
          startPage = Math.max(1, endPage - maxButtons + 1);
        }

        // 이전 버튼
        if (currentPage > 1) {
          const prev = document.createElement('button');
          prev.textContent = '〈';
          prev.onclick = () => loadCustomers(currentPage - 1);
          pagination.appendChild(prev);
        }

        // 페이지 번호 버튼
        for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement('button');
          btn.textContent = i;
          if (i === currentPage) btn.classList.add('active');
          btn.onclick = () => loadCustomers(i);
          pagination.appendChild(btn);
        }

        // 다음 버튼
        if (currentPage < totalPages) {
          const next = document.createElement('button');
          next.textContent = '〉';
          next.onclick = () => loadCustomers(currentPage + 1);
          pagination.appendChild(next);
        }
      }

      // 매입처 목록 로드
      async function loadSuppliers(page = 1) {
        try {
          const searchValue = document.getElementById('supplierSearch')?.value || '';
          const tbody = document.getElementById('supplierTableBody');
          const pagination = document.getElementById('supplierPagination');
          const effectivePageSize = getSupplierEffectivePageSize();
          currentSupplierPage = page;

          tbody.innerHTML = '<tr><td colspan="10" class="loading">Loading...</td></tr>';
          pagination.innerHTML = '';

          const result = await apiCall('/suppliers', 'GET', {
            사업장코드: currentUser.사업장코드,
            search: searchValue,
            page,
            pageSize: effectivePageSize,
          });

          if (!result.success) {
            throw new Error(result.message || '서버 오류');
          }

          tbody.innerHTML = '';

          if (result.data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="10" class="loading">데이터가 없습니다.</td></tr>';
            renderSupplierPagination(result.currentPage, result.totalPages);
            return;
          }

          const startNumber = (result.currentPage - 1) * supplierPageSizeEffective + 1;

          result.data.forEach((supplier, index) => {
            const statusClass = supplier.사용구분 === 0 ? 'status-active' : 'status-pending';
            const statusText = supplier.사용구분 === 0 ? '정상거래' : '거래보류';
            const rowNumber = startNumber + index;

            const tr = document.createElement('tr');
            tr.innerHTML = `
                    <td><input type="checkbox" class="supplierCheckbox" value="${
                      supplier.매입처코드
                    }"></td>
                    <td>${rowNumber}</td>
                    <td>${supplier.매입처코드}</td>
                    <td>${supplier.매입처명}</td>
                    <td>${supplier.대표자명 || '-'}</td>
                    <td>${supplier.사업자번호 || '-'}</td>
                    <td>${supplier.전화번호 || '-'}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>${supplier.작성자 || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-icon" onclick="viewSupplier('${
                              supplier.매입처코드
                            }')">상세</button>
                        </div>
                    </td>
                `;
            tbody.appendChild(tr);
          });

          renderSupplierPagination(result.currentPage, result.totalPages);
        } catch (error) {
          console.error('매입처 목록 로드 실패:', error);
          const tbody = document.getElementById('supplierTableBody');
          tbody.innerHTML = `<tr><td colspan="10" class="loading" style="color: red;">오류: ${error.message}</td></tr>`;
        }
      }

      // 페이지네이션 렌더링
      function renderSupplierPagination(currentPage, totalPages) {
        const pagination = document.getElementById('supplierPagination');
        pagination.innerHTML = '';

        if (totalPages <= 1) return;

        const maxButtons = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
        let endPage = Math.min(totalPages, startPage + maxButtons - 1);

        if (endPage - startPage < maxButtons - 1) {
          startPage = Math.max(1, endPage - maxButtons + 1);
        }

        // 이전 버튼
        if (currentPage > 1) {
          const prev = document.createElement('button');
          prev.textContent = '〈';
          prev.onclick = () => loadSuppliers(currentPage - 1);
          pagination.appendChild(prev);
        }

        // 페이지 번호 버튼
        for (let i = startPage; i <= endPage; i++) {
          const btn = document.createElement('button');
          btn.textContent = i;
          if (i === currentPage) btn.classList.add('active');
          btn.onclick = () => loadSuppliers(i);
          pagination.appendChild(btn);
        }

        // 다음 버튼
        if (currentPage < totalPages) {
          const next = document.createElement('button');
          next.textContent = '〉';
          next.onclick = () => loadSuppliers(currentPage + 1);
          pagination.appendChild(next);
        }
      }

      // 견적 목록 로드
      async function loadQuotations() {
        try {
          const searchValue = document.getElementById('quotationSearch')?.value || '';
          const tbody = document.getElementById('quotationTableBody');
          tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터를 불러오는 중...</td></tr>';

          const result = await apiCall(
            `/quotations?사업장코드=${currentUser.사업장코드}&search=${searchValue}`,
          );

          if (result.success) {
            tbody.innerHTML = '';

            if (result.data.length === 0) {
              tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터가 없습니다.</td></tr>';
              return;
            }

            result.data.forEach((quotation) => {
              const statusMap = {
                1: { class: 'status-pending', text: '진행중' },
                2: { class: 'status-completed', text: '승인' },
                3: { class: 'status-pending', text: '반려' },
              };
              const status = statusMap[quotation.상태코드] || statusMap[1];

              const tr = document.createElement('tr');
              tr.innerHTML = `
                            <td>Q${quotation.견적일자}-${quotation.견적번호}</td>
                            <td>${quotation.매출처명 || '-'}</td>
                            <td>${quotation.견적일자}</td>
                            <td>${quotation.출고희망일자 || '-'}</td>
                            <td>₩0</td>
                            <td>${quotation.사용자명 || '-'}</td>
                            <td><span class="status-badge ${status.class}">${
                status.text
              }</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon" onclick="viewQuotation('${
                                      quotation.견적일자
                                    }', ${quotation.견적번호})">상세</button>
                                </div>
                            </td>
                        `;
              tbody.appendChild(tr);
            });
          }
        } catch (error) {
          console.error('견적 목록 로드 실패:', error);
          const tbody = document.getElementById('quotationTableBody');
          tbody.innerHTML = `<tr><td colspan="8" class="loading" style="color: red;">오류: ${error.message}</td></tr>`;
        }
      }

      // 발주 목록 로드
      async function loadOrders() {
        try {
          const searchValue = document.getElementById('orderSearch')?.value || '';
          const tbody = document.getElementById('orderTableBody');
          tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터를 불러오는 중...</td></tr>';

          const result = await apiCall(
            `/orders?사업장코드=${currentUser.사업장코드}&search=${searchValue}`,
          );

          if (result.success) {
            tbody.innerHTML = '';

            if (result.data.length === 0) {
              tbody.innerHTML = '<tr><td colspan="8" class="loading">데이터가 없습니다.</td></tr>';
              return;
            }

            result.data.forEach((order) => {
              const statusMap = {
                1: { class: 'status-pending', text: '발주대기' },
                2: { class: 'status-pending', text: '발주완료' },
                3: { class: 'status-completed', text: '입고완료' },
              };
              const status = statusMap[order.상태코드] || statusMap[1];

              const tr = document.createElement('tr');
              tr.innerHTML = `
                            <td>PO${order.발주일자}-${order.발주번호}</td>
                            <td>${order.매입처명 || '-'}</td>
                            <td>${order.발주일자}</td>
                            <td>${order.입고희망일자 || '-'}</td>
                            <td>₩0</td>
                            <td>${order.사용자명 || '-'}</td>
                            <td><span class="status-badge ${status.class}">${
                status.text
              }</span></td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn-icon" onclick="viewOrder('${
                                      order.발주일자
                                    }', ${order.발주번호})">상세</button>
                                </div>
                            </td>
                        `;
              tbody.appendChild(tr);
            });
          }
        } catch (error) {
          console.error('발주 목록 로드 실패:', error);
          const tbody = document.getElementById('orderTableBody');
          tbody.innerHTML = `<tr><td colspan="8" class="loading" style="color: red;">오류: ${error.message}</td></tr>`;
        }
      }

      // 서브메뉴 토글
      function toggleSubmenu(element) {
        element.classList.toggle('open');
        const submenu = element.nextElementSibling;
        submenu.classList.toggle('open');
      }

      // 페이지 전환
      function showPage(pageName) {
        document.querySelectorAll('.page-content').forEach((page) => {
          page.classList.remove('active');
        });

        document.querySelectorAll('.menu-link').forEach((link) => {
          link.classList.remove('active');
        });
        document.querySelectorAll('.submenu-link').forEach((link) => {
          link.classList.remove('active');
        });

        const pageMap = {
          dashboard: {
            element: 'dashboardPage',
            title: '대시보드',
            menu: null,
            loadFunc: loadDashboardStats,
          },
          supplier: {
            element: 'supplierPage',
            title: '매입처관리',
            menu: 'purchase',
            loadFunc: loadSuppliers,
          },
          order: {
            element: 'orderPage',
            title: '발주관리',
            menu: 'purchase',
            loadFunc: loadOrders,
          },
          purchase: {
            element: 'purchasePage',
            title: '매입전표관리',
            menu: 'purchase',
            loadFunc: null,
          },
          customer: {
            element: 'customerPage',
            title: '매출처관리',
            menu: 'sales',
            loadFunc: loadCustomers,
          },
          quotation: {
            element: 'quotationPage',
            title: '견적관리',
            menu: 'sales',
            loadFunc: loadQuotations,
          },
          transaction: {
            element: 'transactionPage',
            title: '거래명세서관리',
            menu: 'sales',
            loadFunc: null,
          },
        };

        if (pageMap[pageName]) {
          document.getElementById(pageMap[pageName].element).classList.add('active');
          document.getElementById('pageTitle').textContent = pageMap[pageName].title;

          if (pageMap[pageName].menu === 'purchase') {
            document.getElementById('purchaseMenu').classList.add('open');
            document.getElementById('purchaseSubmenu').classList.add('open');
          } else if (pageMap[pageName].menu === 'sales') {
            document.getElementById('salesMenu').classList.add('open');
            document.getElementById('salesSubmenu').classList.add('open');
          }

          // 페이지별 데이터 로드
          if (currentUser && pageMap[pageName].loadFunc) {
            pageMap[pageName].loadFunc();
          }
        }
      }

      // 로그아웃
      async function logout() {
        if (confirm('로그아웃 하시겠습니까?')) {
          try {
            await apiCall('/auth/logout', 'POST', { userId: currentUser.사용자코드 });
          } catch (error) {
            console.error('로그아웃 에러:', error);
          }

          currentUser = null;
          document.getElementById('dashboard').classList.remove('active');
          document.getElementById('loginPage').style.display = 'flex';
          document.getElementById('loginForm').reset();
          document.getElementById('loginMessage').classList.remove('show');
        }
      }

      // 상세 조회 함수들
      async function viewCustomer(id) {
        try {
          const result = await apiCall(`/customers/${id}`);
          if (result.success) {
            alert(
              '매출처 정보:\n\n' +
                `매출처명: ${result.data.매출처명}\n` +
                `대표자: ${result.data.대표자명}\n` +
                `사업자번호: ${result.data.사업자번호}\n` +
                `전화번호: ${result.data.전화번호}\n` +
                `주소: ${result.data.주소} ${result.data.번지}`,
            );
          }
        } catch (error) {
          alert('매출처 조회 실패: ' + error.message);
        }
      }

      async function viewSupplier(id) {
        try {
          const result = await apiCall(`/suppliers/${id}`);
          if (result.success) {
            alert(
              '매입처 정보:\n\n' +
                `매입처명: ${result.data.매입처명}\n` +
                `대표자: ${result.data.대표자명}\n` +
                `사업자번호: ${result.data.사업자번호}\n` +
                `전화번호: ${result.data.전화번호}\n` +
                `주소: ${result.data.주소} ${result.data.번지}`,
            );
          }
        } catch (error) {
          alert('매입처 조회 실패: ' + error.message);
        }
      }

      async function viewQuotation(date, no) {
        try {
          const result = await apiCall(`/quotations/${date}/${no}`);
          if (result.success) {
            console.log('견적 상세:', result.data);
            alert('견적 정보가 콘솔에 출력되었습니다.');
          }
        } catch (error) {
          alert('견적 조회 실패: ' + error.message);
        }
      }

      async function viewOrder(date, no) {
        try {
          const result = await apiCall(`/orders/${date}/${no}`);
          if (result.success) {
            console.log('발주 상세:', result.data);
            alert('발주 정보가 콘솔에 출력되었습니다.');
          }
        } catch (error) {
          alert('발주 조회 실패: ' + error.message);
        }
      }

      // ==================== Google Sheets 내보내기 기능 ====================

      // 매출처 Google Sheets 내보내기
      function exportCustomersToExcel() {
        try {
          console.log('===== 매출처 Google Sheets 내보내기 시작 =====');

          // 선택된 행 가져오기
          const checkboxes = document.querySelectorAll('.customerCheckbox:checked');

          if (checkboxes.length === 0) {
            alert('선택된 매출처가 없습니다.');
            return;
          }

          // 선택된 레코드의 데이터 수집
          const selectedData = [];
          checkboxes.forEach((checkbox) => {
            const row = checkbox.closest('tr');
            const cells = row.querySelectorAll('td');

            selectedData.push({
              번호: cells[1].textContent.trim(),
              매출처코드: cells[2].textContent.trim(),
              매출처명: cells[3].textContent.trim(),
              대표자: cells[4].textContent.trim(),
              사업자번호: cells[5].textContent.trim(),
              연락처: cells[6].textContent.trim(),
              거래상태: cells[7].textContent.trim(),
              등록일: cells[8].textContent.trim(),
            });
          });

          console.log('선택된 데이터:', selectedData);

          // CSV 형식으로 변환
          const headers = [
            '번호',
            '매출처코드',
            '매출처명',
            '대표자',
            '사업자번호',
            '연락처',
            '거래상태',
            '등록일',
          ];
          let csvContent = '\uFEFF' + headers.join(',') + '\n'; // UTF-8 BOM 추가

          selectedData.forEach((data) => {
            const row = [
              data.번호,
              data.매출처코드,
              `"${data.매출처명}"`, // 쉼표가 포함될 수 있으므로 따옴표로 감싸기
              data.대표자,
              data.사업자번호,
              data.연락처,
              data.거래상태,
              data.등록일,
            ];
            csvContent += row.join(',') + '\n';
          });

          // Blob 생성 및 다운로드
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement('a');

          // 파일명 생성
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const date = String(now.getDate()).padStart(2, '0');
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          const seconds = String(now.getSeconds()).padStart(2, '0');
          const fileName = `매출처_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

          // 다운로드 실행
          if (navigator.msSaveBlob) {
            // IE 10+
            navigator.msSaveBlob(blob, fileName);
          } else {
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }

          console.log('✅ CSV 파일 다운로드 완료:', fileName);

          // Google Sheets 안내
          alert(
            `${selectedData.length}개의 매출처 정보가 CSV로 다운로드되었습니다.\n\n📊 Google Sheets로 가져오기:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드 탭\n3. 다운로드된 CSV 파일 선택`,
          );
        } catch (error) {
          console.error('❌ Google Sheets 내보내기 오류:', error);
          alert('내보내기 중 오류가 발생했습니다: ' + error.message);
        }
      }

      // 매입처 Google Sheets 내보내기
      function exportSuppliersToExcel() {
        try {
          console.log('===== 매입처 Google Sheets 내보내기 시작 =====');

          // 선택된 행 가져오기
          const checkboxes = document.querySelectorAll('.supplierCheckbox:checked');

          if (checkboxes.length === 0) {
            alert('선택된 매입처가 없습니다.');
            return;
          }

          // 선택된 레코드의 데이터 수집
          const selectedData = [];
          checkboxes.forEach((checkbox) => {
            const row = checkbox.closest('tr');
            const cells = row.querySelectorAll('td');

            selectedData.push({
              번호: cells[1].textContent.trim(),
              매입처코드: cells[2].textContent.trim(),
              매입처명: cells[3].textContent.trim(),
              대표자: cells[4].textContent.trim(),
              사업자번호: cells[5].textContent.trim(),
              연락처: cells[6].textContent.trim(),
              거래상태: cells[7].textContent.trim(),
              작성자: cells[8].textContent.trim(),
            });
          });

          console.log('선택된 데이터:', selectedData);

          // CSV 형식으로 변환
          const headers = [
            '번호',
            '매입처코드',
            '매입처명',
            '대표자',
            '사업자번호',
            '연락처',
            '거래상태',
            '작성자',
          ];
          let csvContent = '\uFEFF' + headers.join(',') + '\n'; // UTF-8 BOM 추가

          selectedData.forEach((data) => {
            const row = [
              data.번호,
              data.매입처코드,
              `"${data.매입처명}"`, // 쉼표가 포함될 수 있으므로 따옴표로 감싸기
              data.대표자,
              data.사업자번호,
              data.연락처,
              data.거래상태,
              data.작성자,
            ];
            csvContent += row.join(',') + '\n';
          });

          // Blob 생성 및 다운로드
          const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement('a');

          // 파일명 생성
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const date = String(now.getDate()).padStart(2, '0');
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          const seconds = String(now.getSeconds()).padStart(2, '0');
          const fileName = `매입처_${year}${month}${date}_${hours}${minutes}${seconds}.csv`;

          // 다운로드 실행
          if (navigator.msSaveBlob) {
            // IE 10+
            navigator.msSaveBlob(blob, fileName);
          } else {
            link.href = URL.createObjectURL(blob);
            link.download = fileName;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }

          console.log('✅ CSV 파일 다운로드 완료:', fileName);

          // Google Sheets 안내
          alert(
            `${selectedData.length}개의 매입처 정보가 CSV로 다운로드되었습니다.\n\n📊 Google Sheets로 가져오기:\n1. sheets.google.com 접속\n2. 파일 > 가져오기 > 업로드 탭\n3. 다운로드된 CSV 파일 선택`,
          );
        } catch (error) {
          console.error('❌ Google Sheets 내보내기 오류:', error);
          alert('내보내기 중 오류가 발생했습니다: ' + error.message);
        }
      }
    </script>

    <!-- HTML의 </body> 직전에 모달 HTML 추가 -->

    <!-- 매출처 신규등록 모달 -->
    <div
      id="customerModal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        "
      >
        <!-- 고정된 제목 영역 -->
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
          "
        >
          <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
            매출처 신규등록
          </h2>
          <button
            onclick="closeCustomerModal()"
            style="
              background: none;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: var(--text-gray);
            "
          >
            ×
          </button>
        </div>

        <form id="customerForm" onsubmit="submitCustomer(event)">
          <!-- 1. 매출처코드 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >매출처코드</label
            >
            <input
              type="text"
              id="customerCode"
              name="customerCode"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="자동생성"
            />
          </div>

          <!-- 2. 매출처명 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >매출처명 *</label
            >
            <input
              type="text"
              id="customerName"
              name="customerName"
              required
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="매출처명"
            />
          </div>

          <!-- 3. 대표자명 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >대표자명</label
            >
            <input
              type="text"
              id="ceoName"
              name="ceoName"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="대표자명"
            />
          </div>

          <!-- 4. 사업자번호 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >사업자번호</label
            >
            <input
              type="text"
              id="businessNo"
              name="businessNo"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="000-00-00000"
            />
          </div>

          <!-- 5. 업태 & 업종 (1:1 비율) -->
          <div
            style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px"
          >
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
                >업태</label
              >
              <input
                type="text"
                id="businessType"
                name="businessType"
                style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                "
                placeholder="업태"
              />
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
                >업종</label
              >
              <input
                type="text"
                id="businessCategory"
                name="businessCategory"
                style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                "
                placeholder="업종"
              />
            </div>
          </div>

          <!-- 6. 연락처 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >연락처</label
            >
            <input
              type="tel"
              id="phone"
              name="phone"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="010-0000-0000"
            />
          </div>

          <!-- 7. 팩스번호 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >팩스번호</label
            >
            <input
              type="tel"
              id="fax"
              name="fax"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="02-0000-0000"
            />
          </div>

          <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >우편번호</label
            >
            <div style="display: flex; gap: 8px">
              <input
                type="text"
                id="zipCode"
                name="zipCode"
                readonly
                style="
                  flex: 1;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                  background-color: #f5f5f5;
                "
                placeholder="00000"
              />
              <button
                type="button"
                onclick="execDaumPostcode()"
                style="
                  padding: 10px 20px;
                  background: var(--primary);
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  white-space: nowrap;
                "
              >
                찾기
              </button>
            </div>
          </div>

          <!-- 9. 주소 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >주소</label
            >
            <input
              type="text"
              id="address"
              name="address"
              readonly
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                background-color: #f5f5f5;
              "
              placeholder="주소"
            />
          </div>

          <!-- 10. 상세주소 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >상세주소</label
            >
            <input
              type="text"
              id="addressDetail"
              name="addressDetail"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="상세주소를 입력하세요"
            />
          </div>

          <!-- 11. 은행 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >은행</label
            >
            <select
              id="bankCode"
              name="bankCode"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="">선택하세요</option>
              <option value="01">한국은행</option>
              <option value="02">산업은행</option>
              <option value="03">기업은행</option>
              <option value="04">국민은행</option>
              <option value="05">농협</option>
              <option value="06">하나은행</option>
              <option value="07">우리은행</option>
              <option value="08">SC은행</option>
              <option value="09">씨티은행</option>
            </select>
          </div>

          <!-- 12. 계좌번호 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >계좌번호</label
            >
            <input
              type="text"
              id="accountNo"
              name="accountNo"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="계좌번호"
            />
          </div>

          <!-- 13. 담당자명 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >담당자명</label
            >
            <input
              type="text"
              id="managerName"
              name="managerName"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="담당자명"
            />
          </div>

          <!-- 14. 거래상태 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >거래상태</label
            >
            <select
              id="status"
              name="status"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="0">정상거래</option>
              <option value="1">거래보류</option>
            </select>
          </div>

          <!-- 15. 비고란 (전체 너비) -->
          <div style="margin-bottom: 24px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >비고란</label
            >
            <textarea
              id="remark"
              name="remark"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
                min-height: 80px;
              "
              placeholder="비고"
            ></textarea>
          </div>

          <!-- 버튼 영역 -->
          <div style="display: flex; gap: 12px; justify-content: flex-end">
            <button
              type="button"
              onclick="closeCustomerModal()"
              style="
                padding: 10px 24px;
                background: var(--bg-light);
                border: 1px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: var(--text-dark);
              "
            >
              취소
            </button>
            <button
              type="submit"
              style="
                padding: 10px 24px;
                background: var(--primary);
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
              "
            >
              등록
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- 매입처 신규등록 모달 -->
    <div
      id="supplierModal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: white;
          border-radius: 12px;
          padding: 32px;
          width: 90%;
          max-width: 600px;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        "
      >
        <!-- 고정된 제목 영역 -->
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            position: sticky;
            top: -32px;
            background: white;
            padding: 0 0 16px 0;
            border-bottom: 2px solid var(--border);
            z-index: 10;
          "
        >
          <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
            매입처 신규등록
          </h2>
          <button
            onclick="closeSupplierModal()"
            style="
              background: none;
              border: none;
              font-size: 24px;
              cursor: pointer;
              color: var(--text-gray);
            "
          >
            ×
          </button>
        </div>

        <form id="supplierForm" onsubmit="submitSupplier(event)">
          <!-- 1. 매입처코드 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >매입처코드</label
            >
            <input
              type="text"
              id="supplierCode"
              name="supplierCode"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="자동생성"
            />
          </div>

          <!-- 2. 매입처명 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >매입처명 *</label
            >
            <input
              type="text"
              id="supplierName"
              name="supplierName"
              required
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="매입처명"
            />
          </div>

          <!-- 3. 대표자명 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >대표자명</label
            >
            <input
              type="text"
              id="supplierCeoName"
              name="supplierCeoName"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="대표자명"
            />
          </div>

          <!-- 4. 사업자번호 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >사업자번호</label
            >
            <input
              type="text"
              id="supplierBusinessNo"
              name="supplierBusinessNo"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="000-00-00000"
            />
          </div>

          <!-- 5. 업태 & 업종 (1:1 비율) -->
          <div
            style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px"
          >
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
                >업태</label
              >
              <input
                type="text"
                id="supplierBusinessType"
                name="supplierBusinessType"
                style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                "
                placeholder="업태"
              />
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
                >업종</label
              >
              <input
                type="text"
                id="supplierBusinessCategory"
                name="supplierBusinessCategory"
                style="
                  width: 100%;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                "
                placeholder="업종"
              />
            </div>
          </div>

          <!-- 6. 연락처 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >연락처</label
            >
            <input
              type="tel"
              id="supplierPhone"
              name="supplierPhone"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="010-0000-0000"
            />
          </div>

          <!-- 7. 팩스번호 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >팩스번호</label
            >
            <input
              type="tel"
              id="supplierFax"
              name="supplierFax"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="02-0000-0000"
            />
          </div>

          <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >우편번호</label
            >
            <div style="display: flex; gap: 8px">
              <input
                type="text"
                id="supplierZipCode"
                name="supplierZipCode"
                readonly
                style="
                  flex: 1;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                  background-color: #f5f5f5;
                "
                placeholder="00000"
              />
              <button
                type="button"
                onclick="execDaumPostcode('supplier')"
                style="
                  padding: 10px 20px;
                  background: var(--primary);
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  white-space: nowrap;
                "
              >
                찾기
              </button>
            </div>
          </div>

          <!-- 9. 주소 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >주소</label
            >
            <input
              type="text"
              id="supplierAddress"
              name="supplierAddress"
              readonly
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                background-color: #f5f5f5;
              "
              placeholder="주소"
            />
          </div>

          <!-- 10. 상세주소 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >상세주소</label
            >
            <input
              type="text"
              id="supplierAddressDetail"
              name="supplierAddressDetail"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="상세주소를 입력하세요"
            />
          </div>

          <!-- 11. 은행 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >은행</label
            >
            <select
              id="supplierBankCode"
              name="supplierBankCode"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="">선택하세요</option>
              <option value="01">한국은행</option>
              <option value="02">산업은행</option>
              <option value="03">기업은행</option>
              <option value="04">국민은행</option>
              <option value="05">농협</option>
              <option value="06">하나은행</option>
              <option value="07">우리은행</option>
              <option value="08">SC은행</option>
              <option value="09">씨티은행</option>
            </select>
          </div>

          <!-- 12. 계좌번호 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >계좌번호</label
            >
            <input
              type="text"
              id="supplierAccountNo"
              name="supplierAccountNo"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="계좌번호"
            />
          </div>

          <!-- 13. 담당자명 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >담당자명</label
            >
            <input
              type="text"
              id="supplierManagerName"
              name="supplierManagerName"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="담당자명"
            />
          </div>

          <!-- 14. 거래상태 (전체 너비) -->
          <div style="margin-bottom: 16px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >거래상태</label
            >
            <select
              id="supplierStatus"
              name="supplierStatus"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="0">정상거래</option>
              <option value="1">거래보류</option>
            </select>
          </div>

          <!-- 15. 비고란 (전체 너비) -->
          <div style="margin-bottom: 24px">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >비고란</label
            >
            <textarea
              id="supplierRemark"
              name="supplierRemark"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
                min-height: 80px;
              "
              placeholder="비고"
            ></textarea>
          </div>

          <!-- 버튼 영역 -->
          <div style="display: flex; gap: 12px; justify-content: flex-end">
            <button
              type="button"
              onclick="closeSupplierModal()"
              style="
                padding: 10px 24px;
                background: var(--bg-light);
                border: 1px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: var(--text-dark);
              "
            >
              취소
            </button>
            <button
              type="submit"
              style="
                padding: 10px 24px;
                background: var(--primary);
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                cursor: pointer;
                color: white;
              "
            >
              등록
            </button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>

<!-- ========================================================= -->
<!-- 거래명세서관리 개선안 (UI & Modal & Script Hook Snippet) -->
<!-- ========================================================= -->

<!-- head 영역에 추가할 스크립트 -->
<script src="js/transaction.js" defer></script>

<!-- 거래명세서관리 섹션 (기존 transactionPage 대체용) -->
<div class="page-content" id="transactionPage">
  <div class="toolbar">
    <div class="toolbar-left" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center">
      <div style="display: flex; gap: 8px; align-items: center">
        <label for="transactionStartDate" style="font-size: 14px; color: var(--text-gray)">거래일자</label>
        <input type="date" id="transactionStartDate" class="form-control" style="width: 150px" />
        <span style="padding: 0 4px; color: var(--text-gray)">~</span>
        <input type="date" id="transactionEndDate" class="form-control" style="width: 150px" />
        <button class="btn btn-tertiary" id="transactionTodayBtn" type="button">오늘</button>
        <button class="btn btn-tertiary" id="transactionWeekBtn" type="button">7일</button>
        <button class="btn btn-tertiary" id="transactionMonthBtn" type="button">1개월</button>
      </div>
      <div style="display: flex; gap: 8px; align-items: center">
        <input
          type="text"
          id="transactionKeyword"
          class="form-control"
          style="width: 220px"
          placeholder="거래처명 또는 코드 검색"
        />
        <button class="btn btn-secondary" id="transactionSearchBtn" type="button">조회</button>
        <button class="btn btn-light" id="transactionResetBtn" type="button">초기화</button>
      </div>
    </div>
    <div class="toolbar-right" style="display: flex; gap: 8px">
      <button class="btn btn-success" id="transactionCreateBtn" type="button">
        <span>+</span> 거래명세서 등록
      </button>
      <button class="btn btn-secondary" id="transactionExportBtn" type="button">
        <span>📄</span> 엑셀
      </button>
    </div>
  </div>

  <div class="transaction-layout" style="display: flex; gap: 24px; align-items: stretch; margin-top: 24px">
    <section
      class="transaction-panel"
      style="
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #fff;
        border-radius: 16px;
        border: 1px solid var(--border);
        box-shadow: 0 16px 40px rgba(15, 23, 42, 0.05);
        padding: 20px;
      "
    >
      <header
        class="panel-header"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px"
      >
        <div>
          <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: var(--text-dark)">거래명세서 목록</h3>
          <p style="margin: 4px 0 0; font-size: 13px; color: var(--text-gray)">
            조회 조건에 해당하는 거래명세서 헤더 목록입니다.
          </p>
        </div>
        <div style="display: flex; gap: 12px">
          <span
            style="
              display: inline-flex;
              align-items: center;
              gap: 6px;
              font-size: 12px;
              background: var(--bg-light);
              color: var(--text-gray);
              padding: 6px 12px;
              border-radius: 999px;
            "
          >
            총 건수
            <strong id="transactionTotalCount" style="font-size: 14px; color: var(--text-dark)">0</strong>
          </span>
          <span
            style="
              display: inline-flex;
              align-items: center;
              gap: 6px;
              font-size: 12px;
              background: var(--bg-light);
              color: var(--text-gray);
              padding: 6px 12px;
              border-radius: 999px;
            "
          >
            총 금액
            <strong id="transactionTotalAmount" style="font-size: 14px; color: var(--primary)">0</strong>
          </span>
        </div>
      </header>

      <div class="table-container" style="flex: 1">
        <table class="data-table" id="transactionHeaderTable">
          <thead>
            <tr>
              <th style="width: 120px">거래일자</th>
              <th style="width: 140px">문서번호</th>
              <th style="width: 200px">거래처명</th>
              <th style="width: 140px">거래처코드</th>
              <th style="width: 120px">담당자</th>
              <th style="width: 140px">공급가액</th>
              <th style="width: 120px">부가세</th>
              <th style="width: 140px">합계금액</th>
              <th style="width: 120px">상태</th>
            </tr>
          </thead>
          <tbody id="transactionHeaderBody">
            <tr>
              <td colspan="9" class="loading">조회 조건을 선택하고 조회 버튼을 눌러 주세요.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" id="transactionPagination" style="margin-top: 16px"></div>
    </section>

    <section
      class="transaction-panel"
      style="
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #fff;
        border-radius: 16px;
        border: 1px solid var(--border);
        box-shadow: 0 16px 40px rgba(15, 23, 42, 0.05);
        padding: 20px;
      "
    >
      <header
        class="panel-header"
        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px"
      >
        <div>
          <h3 style="margin: 0; font-size: 18px; font-weight: 600; color: var(--text-dark)">상세 내역</h3>
          <p id="transactionDetailTitle" style="margin: 4px 0 0; font-size: 13px; color: var(--text-gray)">
            상단 목록에서 거래명세서를 선택하면 상세가 표시됩니다.
          </p>
        </div>
        <div style="display: flex; gap: 12px">
          <span
            style="
              display: inline-flex;
              align-items: center;
              gap: 6px;
              font-size: 12px;
              background: var(--bg-light);
              color: var(--text-gray);
              padding: 6px 12px;
              border-radius: 999px;
            "
          >
            품목 수
            <strong id="transactionDetailCount" style="font-size: 14px; color: var(--text-dark)">0</strong>
          </span>
          <span
            style="
              display: inline-flex;
              align-items: center;
              gap: 6px;
              font-size: 12px;
              background: var(--bg-light);
              color: var(--text-gray);
              padding: 6px 12px;
              border-radius: 999px;
            "
          >
            합계 수량
            <strong id="transactionDetailQuantity" style="font-size: 14px; color: var(--primary)">0</strong>
          </span>
        </div>
      </header>

      <div class="table-container" style="flex: 1">
        <table class="data-table" id="transactionDetailTable">
          <thead>
            <tr>
              <th style="width: 160px">자재분류</th>
              <th style="width: 200px">자재명</th>
              <th style="width: 120px">규격</th>
              <th style="width: 100px">단위</th>
              <th style="width: 120px">자재시세</th>
              <th style="width: 120px">수량</th>
              <th style="width: 120px">단가</th>
              <th style="width: 140px">공급가액</th>
              <th style="width: 140px">입출내역</th>
              <th style="width: 140px">비고</th>
            </tr>
          </thead>
          <tbody id="transactionDetailBody">
            <tr>
              <td colspan="10" class="loading">상세를 보려면 목록에서 거래명세서를 선택하세요.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>

<!-- 거래명세서 등록 모달 -->
<div id="transactionModal" class="modal-overlay" style="display: none">
  <div class="modal-content large">
    <div class="modal-header">
      <h2 id="transactionModalTitle">거래명세서 등록</h2>
      <button type="button" class="modal-close" onclick="closeTransactionModal()">×</button>
    </div>

    <form id="transactionForm">
      <section class="modal-section">
        <h3>기본 정보</h3>
        <div class="form-grid two-columns">
          <div class="form-group">
            <label for="transactionDate">거래일자 *</label>
            <input type="date" id="transactionDate" name="transactionDate" required />
          </div>
          <div class="form-group">
            <label for="transactionDocumentNo">문서번호</label>
            <input type="text" id="transactionDocumentNo" name="transactionDocumentNo" placeholder="자동 생성 또는 직접 입력" />
          </div>
          <div class="form-group">
            <label for="transactionCustomerCode">거래처 코드 *</label>
            <div class="input-with-button">
              <input type="text" id="transactionCustomerCode" name="transactionCustomerCode" required />
              <button type="button" class="btn btn-tertiary" id="transactionCustomerSearchBtn">검색</button>
            </div>
          </div>
          <div class="form-group">
            <label for="transactionCustomerName">거래처명 *</label>
            <input type="text" id="transactionCustomerName" name="transactionCustomerName" required />
          </div>
          <div class="form-group">
            <label for="transactionSalesUser">담당자</label>
            <input type="text" id="transactionSalesUser" name="transactionSalesUser" />
          </div>
          <div class="form-group">
            <label for="transactionMemo">비고</label>
            <input type="text" id="transactionMemo" name="transactionMemo" />
          </div>
        </div>
      </section>

      <section class="modal-section">
        <div class="modal-section-header">
          <h3>자재 내역</h3>
          <button type="button" class="btn btn-tertiary" id="transactionAddItemBtn">+ 품목 추가</button>
        </div>

        <div class="table-container compact">
          <table class="data-table" id="transactionItemTable">
            <thead>
              <tr>
                <th style="width: 160px">자재분류</th>
                <th style="width: 220px">자재명</th>
                <th style="width: 120px">규격</th>
                <th style="width: 100px">단위</th>
                <th style="width: 120px">시세</th>
                <th style="width: 120px">수량</th>
                <th style="width: 120px">단가</th>
                <th style="width: 140px">공급가액</th>
                <th style="width: 140px">입출내역</th>
                <th style="width: 60px">삭제</th>
              </tr>
            </thead>
            <tbody id="transactionItemBody">
              <tr class="empty-row">
                <td colspan="10" class="loading">품목을 추가해 주세요.</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="modal-section footer-section">
        <div class="footer-summary">
          <span>총 품목 <strong id="transactionModalItemCount">0</strong> 건</span>
          <span>총 수량 <strong id="transactionModalTotalQty">0</strong></span>
          <span>총 금액 <strong id="transactionModalTotalAmount">0</strong></span>
        </div>
        <div class="footer-actions">
          <button type="button" class="btn btn-light" onclick="closeTransactionModal()">취소</button>
          <button type="submit" class="btn btn-primary">저장</button>
        </div>
      </section>
    </form>
  </div>
</div>

<!-- showPage 매핑 변경 -->
<script>
  const transactionPageMapEntry = {
    element: 'transactionPage',
    title: '거래명세서관리',
    menu: 'sales',
    loadFunc: loadTransactionPage,
  };
</script>


