# 메뉴별 테이블 매핑 가이드

작성일: 2025-11-01

이 문서는 판매관리 시스템의 각 메뉴에서 사용하는 데이터베이스 테이블을 정리한 참조 가이드입니다.

---

## 📊 대시보드 (Dashboard)

**메뉴 경로**: 대시보드

**사용 테이블**:
- `견적` - 오늘의 견적서 조회
- `견적내역` - 견적 금액 계산
- `발주` - 오늘의 발주서 조회
- `발주내역` - 발주 금액 계산
- `자재입출내역` - 오늘의 거래명세서 조회
- `매출처` - 고객명 표시
- `매입처` - 공급업체명 표시
- `사용자` - 작성자명 표시

**주요 기능**:
- 오늘 등록된 견적서 목록 (번호, 매출처, 금액)
- 오늘 등록된 발주서 목록 (번호, 매입처, 금액)
- 오늘 등록된 거래명세서 목록 (번호, 매출처, 금액)

---

## 📚 장부관리 (Ledger Management)

### 1. 매입처장부관리 (Supplier Ledger)

**메뉴 경로**: 장부관리 > 매입처장부관리

**사용 테이블**:
- `미지급금내역` ⭐ **메인 테이블**
- `자재입출내역` (입출고구분 = 1, 매입)
- `매입처`
- `사용자`

**주요 필드**:
```sql
-- 미지급금내역
미지급금지급일자, 미지급금지급금액, 매입처코드,
결제방법, 만기일자, 어음번호, 적요

-- 자재입출내역 (세부내역)
거래일자, 거래번호, 입고수량, 입고단가, 입고부가,
분류코드, 세부코드, 자재코드
```

**계산식**:
```
총매입액 = SUM(입고수량 × 입고단가 + 입고부가) WHERE 입출고구분 = 1
총지급액 = SUM(미지급금지급금액)
미지급잔액 = 총매입액 - 총지급액
```

**구현 상태**: ✅ API 구현 완료 (POST /api/accounts-payable)

---

### 2. 매출처장부관리 (Customer Ledger)

**메뉴 경로**: 장부관리 > 매출처장부관리

**사용 테이블**:
- `미수금내역` ⭐ **메인 테이블** (❌ TODO - 테이블 미구현)
- `자재입출내역` (입출고구분 = 2, 매출)
- `매출처`
- `사용자`

**주요 필드**:
```sql
-- 미수금내역 (예정)
미수금발생일자, 미수금발생금액, 미수금입금일자, 미수금입금금액,
매출처코드, 결제방법, 만기일자, 어음번호, 적요

-- 자재입출내역 (세부내역)
거래일자, 거래번호, 출고수량, 출고단가, 출고부가,
분류코드, 세부코드, 자재코드
```

**계산식**:
```
총매출액 = SUM(출고수량 × 출고단가 + 출고부가) WHERE 입출고구분 = 2
총입금액 = SUM(미수금입금금액)
미수금잔액 = 총매출액 - 총입금액
```

**구현 상태**: ❌ TODO - 미수금내역 테이블 및 API 미구현

---

### 3. 미수금관리 (Accounts Receivable Management)

**메뉴 경로**: 장부관리 > 미수금관리

**사용 테이블**:
- `미수금내역` ⭐ **메인 테이블** (❌ TODO)
- `매출처`

**구현 상태**: ❌ TODO

---

### 4. 미지급금관리 (Accounts Payable Management)

**메뉴 경로**: 장부관리 > 미지급금관리

**사용 테이블**:
- `미지급금내역` ⭐ **메인 테이블**
- `매입처`

**구현 상태**: ✅ API 구현 완료

---

### 5. 현금출납관리 (Cash Management)

**메뉴 경로**: 장부관리 > 현금출납관리

**사용 테이블**:
- (현금 관련 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 6. 세금계산서관리 (Tax Invoice Management)

**메뉴 경로**: 장부관리 > 세금계산서관리

**사용 테이블**:
- `세금계산서` ⭐ **메인 테이블**
- `매출처`
- `매입처`

**주요 필드**:
```sql
작성일자, 공급가액, 세액, 합계금액,
매출처코드, 매입처코드, 전자세금계산서여부
```

**구현 상태**: ❌ TODO - 거래명세서 저장 시 자동 생성 기능 미구현

---

## 🛒 매입관리 (Purchase Management)

### 1. 발주관리 (Purchase Order Management)

**메뉴 경로**: 매입관리 > 발주관리

**사용 테이블**:
- `발주` ⭐ **마스터 테이블**
- `발주내역` ⭐ **디테일 테이블**
- `매입처`
- `자재`
- `사용자`
- `로그` (번호 생성용)

**주요 필드**:
```sql
-- 발주 (마스터)
사업장코드, 발주일자, 발주번호, 매입처코드,
입고희망일자, 제목, 적요, 상태코드, 사용구분,
수정일자, 사용자코드

-- 발주내역 (디테일)
사업장코드, 발주일자, 발주번호, 발주시간,
자재코드 (분류코드 + 세부코드),
발주량, 입고단가, 출고단가, 상태코드
```

**복합키**: `발주일자 + 발주번호`

**계산식**:
```
합계금액 = SUM(발주량 × 입고단가)
```

**구현 상태**: ✅ CRUD 전체 구현 완료

**API 엔드포인트**:
- GET `/api/orders` - 발주서 목록 조회
- GET `/api/orders/:date/:no` - 발주서 상세 조회
- POST `/api/orders` - 발주서 생성
- PUT `/api/orders/:date/:no` - 발주서 수정
- DELETE `/api/orders/:date/:no` - 발주서 삭제

---

### 2. 매입전표관리 (Purchase Statement Management)

**메뉴 경로**: 매입관리 > 매입전표관리

**사용 테이블**:
- `자재입출내역` ⭐ **메인 테이블** (입출고구분 = 1)
- `미지급금내역` ⭐ **자동 생성**
- `매입처`
- `자재`
- `사용자`
- `로그` (번호 생성용)

**주요 필드**:
```sql
-- 자재입출내역 (입출고구분 = 1, 매입)
사업장코드, 거래일자, 거래번호, 입출고구분,
매입처코드, 분류코드, 세부코드,
입고수량, 입고단가, 입고부가,
적요, 사용구분, 수정일자, 사용자코드

-- 미지급금내역 (자동 생성)
미지급금지급일자 = 거래일자
미지급금지급금액 = SUM(입고수량 × 입고단가 + 입고부가)
적요 = "매입전표 {거래일자}-{거래번호}"
```

**복합키**: `거래일자 + 거래번호`

**계산식**:
```
공급가액 = 입고수량 × 입고단가
부가세 = 입고부가 (10%)
합계금액 = 공급가액 + 부가세
```

**프로세스 흐름**:
```
매입전표 작성
    ↓
1. 자재입출내역 INSERT (입출고구분 = 1)
    ↓
2. 미지급금내역 자동 생성 (단일 트랜잭션)
```

**구현 상태**: ✅ CRUD 전체 구현 완료 (자동 미지급금 생성 포함)

**API 엔드포인트**:
- GET `/api/purchase-statements` - 매입전표 목록
- GET `/api/purchase-statements/:date/:no` - 상세 조회
- POST `/api/purchase-statements` - 생성 (미지급금 자동 생성)
- PUT `/api/purchase-statements/:date/:no` - 수정
- DELETE `/api/purchase-statements/:date/:no` - 삭제

---

### 3. 매입처관리 (Supplier Management)

**메뉴 경로**: 매입관리 > 매입처관리

**사용 테이블**:
- `매입처` ⭐ **메인 테이블**
- `사업장`

**주요 필드**:
```sql
사업장코드, 매입처코드, 매입처명,
사업자번호, 법인번호, 대표자명, 대표자주민번호,
개업일자, 우편번호, 주소, 번지,
업태, 업종, 전화번호, 팩스번호,
은행코드, 계좌번호, 계산서발행여부, 계산서발행율,
담당자명, 사용구분, 수정일자, 사용자코드, 비고란, 단가구분
```

**구현 상태**: ✅ CRUD 전체 구현 완료

**API 엔드포인트**:
- GET `/api/suppliers` - 목록 조회
- GET `/api/suppliers/:code` - 상세 조회
- POST `/api/suppliers` - 등록
- PUT `/api/suppliers/:code` - 수정
- DELETE `/api/suppliers/:code` - 삭제

---

## 💰 매출관리 (Sales Management)

### 1. 견적관리 (Quotation Management)

**메뉴 경로**: 매출관리 > 견적관리

**사용 테이블**:
- `견적` ⭐ **마스터 테이블**
- `견적내역` ⭐ **디테일 테이블**
- `매출처`
- `자재`
- `사용자`
- `로그` (번호 생성용)

**주요 필드**:
```sql
-- 견적 (마스터)
사업장코드, 견적일자, 견적번호, 매출처코드,
출고희망일자, 결제방법, 결제예정일자, 유효일수,
제목, 적요, 상태코드, 사용구분, 수정일자, 사용자코드

-- 견적내역 (디테일)
사업장코드, 견적일자, 견적번호, 견적시간,
자재코드, 매입처코드, 수량, 매출처코드,
계산서발행여부, 입고단가, 입고부가, 출고단가, 출고부가,
상태코드, 입고일자, 출고일자, 적요
```

**복합키**: `견적일자 + 견적번호`

**계산식**:
```
합계금액 = SUM(수량 × 출고단가 + 출고부가)
```

**구현 상태**: ✅ CRUD 전체 구현 완료

**API 엔드포인트**:
- GET `/api/quotations` - 견적서 목록 조회
- GET `/api/quotations/:date/:no` - 견적서 상세 조회
- POST `/api/quotations_add` - 견적서 생성
- PUT `/api/quotations/:date/:no` - 견적서 수정
- PUT `/api/quotations/:date/:no/details` - 견적 내역 수정
- DELETE `/api/quotations/:date/:no` - 견적서 삭제

---

### 2. 거래명세서관리 (Transaction Statement Management)

**메뉴 경로**: 매출관리 > 거래명세서관리

**사용 테이블**:
- `자재입출내역` ⭐ **메인 테이블** (입출고구분 = 2)
- `미수금내역` (❌ TODO - 자동 생성 미구현)
- `세금계산서` (❌ TODO - 자동 생성 미구현)
- `매출처`
- `자재`
- `사용자`
- `로그` (번호 생성용)

**주요 필드**:
```sql
-- 자재입출내역 (입출고구분 = 2, 매출)
사업장코드, 거래일자, 거래번호, 입출고구분,
매출처코드, 분류코드, 세부코드,
출고수량, 출고단가, 출고부가,
적요, 사용구분, 수정일자, 사용자코드
```

**복합키**: `거래일자 + 거래번호`

**계산식**:
```
공급가액 = 출고수량 × 출고단가
부가세 = 출고부가 (10%)
합계금액 = 공급가액 + 부가세
```

**프로세스 흐름** (현재):
```
거래명세서 작성
    ↓
✅ 1. 자재입출내역 INSERT (입출고구분 = 2)
    ↓
❌ 2. 세금계산서 생성 (TODO)
    ↓
❌ 3. 미수금내역 생성 (TODO)
```

**구현 상태**: ⚠️ 부분 구현
- ✅ 자재입출내역 CRUD 구현
- ❌ 세금계산서 자동 생성 미구현
- ❌ 미수금내역 자동 생성 미구현

**API 엔드포인트**:
- GET `/api/transactions` - 거래명세서 목록
- GET `/api/transactions/:date/:no` - 상세 조회
- GET `/api/transactions/price-history` - 단가 이력 조회
- POST `/api/transactions` - 생성
- PUT `/api/transactions/:date/:no` - 수정
- DELETE `/api/transactions/:date/:no` - 삭제

---

### 3. 매출처관리 (Customer Management)

**메뉴 경로**: 매출관리 > 매출처관리

**사용 테이블**:
- `매출처` ⭐ **메인 테이블**
- `사업장`

**주요 필드**:
```sql
사업장코드, 매출처코드, 매출처명,
사업자번호, 법인번호, 대표자명, 대표자주민번호,
개업일자, 우편번호, 주소, 번지,
업태, 업종, 전화번호, 팩스번호,
은행코드, 계좌번호, 계산서발행여부, 계산서발행율,
담당자명, 사용구분, 수정일자, 사용자코드, 비고란
```

**구현 상태**: ✅ CRUD 전체 구현 완료 (페이지네이션 지원)

**API 엔드포인트**:
- GET `/api/customers` - 목록 조회 (페이지네이션)
- GET `/api/customers/:code` - 상세 조회
- POST `/api/customers` - 등록
- PUT `/api/customers/:code` - 수정
- DELETE `/api/customers/:code` - 삭제

---

## 📦 자재관리 (Material Management)

### 1. 자재분류관리 (Material Category Management)

**메뉴 경로**: 자재관리 > 자재분류관리

**사용 테이블**:
- `자재분류` ⭐ **메인 테이블**

**주요 필드**:
```sql
분류코드, 분류명, 사용구분
```

**구현 상태**: ✅ 조회 API 구현

**API 엔드포인트**:
- GET `/api/material-categories` - 활성 분류 목록

---

### 2. 자재내역관리 (Material Management)

**메뉴 경로**: 자재관리 > 자재내역관리

**사용 테이블**:
- `자재` ⭐ **메인 테이블**
- `자재분류`
- `자재원장` (재고 정보)
- `자재시세` (가격 정보)

**주요 필드**:
```sql
-- 자재
사업장코드, 분류코드, 세부코드,
자재명, 규격, 단위, 비고란, 사용구분

-- 자재코드 구성
전체 자재코드 = 사업장코드(2) + 분류코드(2) + 세부코드(16)
예: "01" + "01" + "MOFS105" = "0101MOFS105"
```

**중요**:
- `자재` 테이블의 `세부코드` 필드는 사업장코드를 포함한 18자 (`01MOFS105`)
- `자재입출내역` 테이블의 `세부코드` 필드는 순수 세부코드 16자 (`MOFS105`)

**구현 상태**: ✅ CRUD 전체 구현 완료

**API 엔드포인트**:
- GET `/api/materials` - 목록 조회
- GET `/api/materials/:code` - 상세 조회 (원장 정보 포함)
- POST `/api/materials` - 등록
- PUT `/api/materials/:code` - 수정
- DELETE `/api/materials/:code` - 삭제 (소프트 삭제)
- GET `/api/materials/:materialCode/purchase-price-history/:supplierCode` - 매입가 이력
- GET `/api/materials/:materialCode/order-history/:supplierCode` - 발주 이력

---

### 3. 자재재고관리 (Inventory Management)

**메뉴 경로**: 자재관리 > 자재재고관리

**사용 테이블**:
- `자재입출내역` ⭐ **메인 테이블**
- `자재`
- `자재원장`

**주요 필드**:
```sql
-- 자재입출내역
입출고구분 (1=입고, 2=출고),
입고수량, 출고수량,
사업장코드, 분류코드, 세부코드
```

**계산식**:
```
현재고 = SUM(입고수량) - SUM(출고수량)
```

**구현 상태**: ✅ 집계 API 구현

**API 엔드포인트**:
- GET `/api/inventory/:workplace` - 사업장별 재고 집계

---

## 💼 회계관리 (Accounting Management)

### 1. 회계개정관리

**메뉴 경로**: 회계관리 > 회계개정관리

**사용 테이블**:
- (회계 관련 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 2. 현금출납내역관리

**메뉴 경로**: 회계관리 > 현금출납내역관리

**사용 테이블**:
- (현금출납 관련 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 3. 합계잔액시산표

**메뉴 경로**: 회계관리 > 합계잔액시산표

**사용 테이블**:
- (회계 관련 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 4. 대차대조표

**메뉴 경로**: 회계관리 > 대차대조표

**사용 테이블**:
- (회계 관련 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

## 🖨️ 출력물관리 (Print Management)

### 1. 자재대장출력관리

**메뉴 경로**: 출력물관리 > 자재대장출력관리

**사용 테이블**:
- `자재`
- `자재분류`
- `자재원장`

**구현 상태**: ❌ TODO

---

### 2. 매출처출력관리

**메뉴 경로**: 출력물관리 > 매출처출력관리

**사용 테이블**:
- `매출처`

**구현 상태**: ❌ TODO

---

### 3. 매입처출력관리

**메뉴 경로**: 출력물관리 > 매입처출력관리

**사용 테이블**:
- `매입처`

**구현 상태**: ❌ TODO

---

### 4. 발주서출력관리

**메뉴 경로**: 출력물관리 > 발주서출력관리

**사용 테이블**:
- `발주`
- `발주내역`
- `매입처`
- `자재`

**구현 상태**: ❌ TODO

---

### 5. 견적서출력관리

**메뉴 경로**: 출력물관리 > 견적서출력관리

**사용 테이블**:
- `견적`
- `견적내역`
- `매출처`
- `자재`

**구현 상태**: ❌ TODO

---

### 6. 세금계산서출력관리

**메뉴 경로**: 출력물관리 > 세금계산서출력관리

**사용 테이블**:
- `세금계산서`
- `매출처`
- `매입처`

**구현 상태**: ❌ TODO

---

## ⚙️ 설정관리 (Settings Management)

### 1. 용지설정관리

**메뉴 경로**: 설정관리 > 용지설정관리

**사용 테이블**:
- (용지 설정 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 2. 거래명세서설정관리

**메뉴 경로**: 설정관리 > 거래명세서설정관리

**사용 테이블**:
- (거래명세서 설정 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 3. 세금계산서설정관리

**메뉴 경로**: 설정관리 > 세금계산서설정관리

**사용 테이블**:
- (세금계산서 설정 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 4. 창고설정관리

**메뉴 경로**: 설정관리 > 창고설정관리

**사용 테이블**:
- (창고 설정 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

### 5. 부과세율설정관리

**메뉴 경로**: 설정관리 > 부과세율설정관리

**사용 테이블**:
- (세율 설정 테이블 - 확인 필요)

**구현 상태**: ❌ TODO

---

## 🔧 공통 테이블 (Common Tables)

### 사용자 관리

**테이블**: `사용자`

**주요 필드**:
```sql
사용자코드, 사용자명, 사용자권한,
사업장코드, 비밀번호 (bcrypt 해시),
로그인여부, 시작일시, 종료일시
```

**권한 코드**:
- `99` = 시스템 관리자 (전체 권한)
- `50` = 영업 관리자
- `40` = 구매 관리자
- `30` = 영업 담당
- `20` = 구매 담당
- `10` = 일반 사용자 (읽기 전용)

---

### 사업장 관리

**테이블**: `사업장`

**주요 필드**:
```sql
사업장코드, 사업장명, 사용구분
```

---

### 로그 (번호 생성기)

**테이블**: `로그`

**용도**: 문서 번호 자동 증가 (견적, 발주, 거래명세서)

**주요 필드**:
```sql
테이블명, 베이스코드 (사업장코드 + 일자),
최종로그 (마지막 번호), 수정일자, 사용자코드
```

**예시**:
```
테이블명: "견적"
베이스코드: "0120251101" (사업장 "01" + 일자 "20251101")
최종로그: 5 (오늘 5번째 견적서)
```

---

## 📋 테이블 관계도 요약

```
┌─────────────┐
│   사용자    │
└─────────────┘
       │
       ├─────────┬─────────┬─────────┐
       │         │         │         │
       ▼         ▼         ▼         ▼
    ┌────┐   ┌────┐   ┌─────┐   ┌─────┐
    │견적 │   │발주 │   │거래  │   │매입  │
    │    │   │    │   │명세서│   │전표  │
    └────┘   └────┘   └─────┘   └─────┘
       │         │         │         │
       │         │         └─────────┘
       │         │               │
       ▼         ▼               ▼
   ┌──────┐  ┌──────┐      ┌──────────┐
   │견적내역│  │발주내역│      │자재입출내역│
   └──────┘  └──────┘      └──────────┘
       │         │               │
       └─────────┴───────────────┘
                 │
                 ▼
            ┌────────┐
            │  자재   │
            └────────┘
                 │
                 ├────────┬────────┐
                 ▼        ▼        ▼
           ┌──────┐  ┌──────┐  ┌──────┐
           │자재원장│  │자재시세│  │자재분류│
           └──────┘  └──────┘  └──────┘

┌─────────┐          ┌─────────┐
│ 매출처  │          │ 매입처  │
└─────────┘          └─────────┘
     │                    │
     ├────────┐           ├────────┐
     ▼        ▼           ▼        ▼
┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐
│미수금 │  │견적   │  │미지급금│  │발주   │
│내역  │  │      │  │내역   │  │      │
└──────┘  └──────┘  └──────┘  └──────┘
```

---

## 📝 중요 참고사항

### 1. 자재코드 구조 차이

| 테이블 | 사업장코드 | 분류코드 | 세부코드 | 총 길이 |
|--------|-----------|---------|---------|---------|
| **자재** | 별도 필드 | 2자 | **18자** (사업장코드 포함) | - |
| **자재입출내역** | 별도 필드 | 2자 | **16자** (순수 코드) | - |
| **자재원장** | 별도 필드 | 2자 | 16자 | - |
| **자재시세** | 별도 필드 | 2자 | 16자 | - |

### 2. 입출고구분 (자재입출내역)

| 구분 | 값 | 의미 | 관련 업무 |
|------|---|------|----------|
| 입고 | 1 | 매입 | 매입전표 |
| 출고 | 2 | 매출 | 거래명세서 |

### 3. 소프트 삭제 패턴

대부분의 테이블은 `사용구분` 필드 사용:
- `0` = 활성/사용 중
- `1` = 삭제/비활성

### 4. 복합키 패턴

다음 테이블들은 복합키 사용:
- 견적: `견적일자 + 견적번호`
- 발주: `발주일자 + 발주번호`
- 거래명세서: `거래일자 + 거래번호`
- 매입전표: `거래일자 + 거래번호`

---

## 변경 이력

- **2025-11-01**: 초안 작성
  - 전체 메뉴 구조 및 테이블 매핑 정리
  - 구현 상태 표시
  - 테이블 관계도 추가