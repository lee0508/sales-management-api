# 거래명세서관리 백엔드 구현 메모

## 신규/수정이 필요한 엔드포인트

1. `GET /api/transactions`
   - 파라미터: `startDate`, `endDate`, `keyword`, `page`, `pageSize`, `사업장코드`.
   - 사용 테이블: `거래명세서`, `거래명세서상세`, `거래처`, 필요 시 `사업장`.
   - 응답: `{ success, data: { items: [ { 거래일자, 문서번호, 거래처명, 거래처코드, 담당자, 공급가액, 부가세, 합계금액, 상태 } ], totalCount } }`.
   - 정렬: 거래일자 DESC, 문서번호 DESC.

2. `GET /api/transactions/:documentNo`
   - 파라미터: 경로 `documentNo`, 필요 시 `사업장코드`.
   - 사용 테이블: `거래명세서상세` + 자재 마스터(`자재`, `자재분류`, `자재시세`, `자재입출내역`).
   - 응답: `{ success, data: { header, items: [ { 자재분류, 자재명, 규격, 단위, 자재시세, 수량, 단가, 공급가액, 입출내역, 비고 } ] } }`.

3. `POST /api/transactions`
   - Body: `{ 거래일자, 문서번호?, 거래처코드, 거래처명, 담당자?, 비고?, 품목: [ { 자재코드, 자재분류, 자재명, 규격, 단위, 수량, 단가, 공급가액, 입출내역?, 비고? } ] }`.
   - 트랜잭션으로 `거래명세서` + `거래명세서상세` 입력.
   - 문서번호 미입력 시 `거래명세서` PK 또는 별도 시퀀스로 생성.
   - 재고/입출내역 반영 필요 시 `자재입출내역` 연동.

4. `PUT /api/transactions/:documentNo`
   - 선택 구현. 헤더/상세 수정, 삭제 후 재입력 패턴 권장.

5. `DELETE /api/transactions/:documentNo`
   - 선택 구현. 상태 플래그(예: `삭제구분`) 업데이트 권장.

## 참고 테이블 및 주요 컬럼

- `거래명세서`
  - `사업장코드`, `문서번호`, `거래일자`, `거래처코드`, `거래처명`, `담당자`, `공급가액`, `부가세`, `합계금액`, `상태`, `비고` 등.
- `거래명세서상세`
  - `문서번호`, `순번`, `자재코드`, `수량`, `단가`, `공급가액`, `자재시세`, `입출내역`, `비고` 등.
- `자재`, `자재분류`, `자재시세`, `자재입출내역`
  - 자재 검색/자동완성 및 시세 정보 제공.

## 향후 체크리스트

- [ ] 로그인 사용자(`currentUser`)의 `사업장코드`와 연동.
- [ ] 날짜 컬럼 포맷: DB는 `YYYYMMDD` 문자열, API 응답 시 `YYYY-MM-DD` 변환 필요.
- [ ] 페이징 SQL: `OFFSET/FETCH` 또는 ROW_NUMBER 사용.
- [ ] 모달 저장 시 입력 검증 및 트랜잭션 처리.
- [ ] 자재 검색용 보조 API (`GET /api/materials?keyword=` 등) 제공.
