# 테이블 상세 가이드

작성일: 2025-11-01

이 문서는 판매관리 시스템의 주요 테이블 구조와 예시 데이터를 정리한 참조 가이드입니다.

---

## 📚 1. 장부관리 (Ledger Management)

### 1.1 매입처장부관리 (Supplier Ledger)

**사용 테이블**: `미지급금내역`, `미지급금원장`, `미지급금원장마감`

#### 테이블 1: 미지급금내역 (Accounts Payable Details)

**용도**: 매입처별 미지급금 발생 및 지급 내역 관리

**테이블 구조**:
```sql
CREATE TABLE 미지급금내역 (
    사업장코드 VARCHAR(2),           -- 사업장 코드 (예: "01")
    매입처코드 VARCHAR(8),           -- 매입처 코드 (예: "B041", "S097")
    미지급금지급일자 VARCHAR(8),      -- 지급 일자 (YYYYMMDD)
    미지급금지급시간 VARCHAR(9),      -- 지급 시간 (HHMMSSmmm)
    미지급금지급금액 MONEY,           -- 지급 금액
    결제방법 TINYINT,               -- 0=현금, 1=수표, 2=어음, 3=계좌이체 등
    만기일자 VARCHAR(8),            -- 어음 만기일자
    어음번호 VARCHAR(20),           -- 어음번호
    적요 VARCHAR(50),               -- 적요 (비고)
    수정일자 VARCHAR(8),            -- 수정일자
    사용자코드 VARCHAR(4)            -- 사용자 코드
)
```

**예시 데이터 (5건)**:
```json
[
  {
    "사업장코드": "01",
    "매입처코드": "B041",
    "미지급금지급일자": "20251101",
    "미지급금지급시간": "083403783",
    "미지급금지급금액": 0,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "매입전표 20251101-1",
    "수정일자": "20251101",
    "사용자코드": "0687"
  },
  {
    "사업장코드": "01",
    "매입처코드": "D001",
    "미지급금지급일자": "20251031",
    "미지급금지급시간": "083231040",
    "미지급금지급금액": 0,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "매입전표 20251031-16",
    "수정일자": "20251031",
    "사용자코드": "0687"
  },
  {
    "사업장코드": "01",
    "매입처코드": "S097",
    "미지급금지급일자": "20251015",
    "미지급금지급시간": "162234853",
    "미지급금지급금액": 256960,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "",
    "수정일자": "20251015",
    "사용자코드": "0682"
  },
  {
    "사업장코드": "01",
    "매입처코드": "H002",
    "미지급금지급일자": "20251014",
    "미지급금지급시간": "134448457",
    "미지급금지급금액": 1606000,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "상계",
    "수정일자": "20251014",
    "사용자코드": "0682"
  },
  {
    "사업장코드": "01",
    "매입처코드": "H086",
    "미지급금지급일자": "20251014",
    "미지급금지급시간": "133553860",
    "미지급금지급금액": 45000,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "",
    "수정일자": "20251014",
    "사용자코드": "0682"
  }
]
```

**주요 기능**:
- 매입전표 작성 시 자동 생성 (적요: "매입전표 {일자}-{번호}")
- 지급 처리 시 금액 업데이트
- 결제방법별 관리 (현금, 수표, 어음, 계좌이체)

**복합키**: `사업장코드 + 매입처코드 + 미지급금지급일자 + 미지급금지급시간`

---

### 1.2 매출처장부관리 (Customer Ledger)

**사용 테이블**: `미수금내역`, `미수금원장`, `미수금원장마감`

#### 테이블 1: 미수금내역 (Accounts Receivable Details)

**용도**: 매출처별 미수금 발생 및 입금 내역 관리

**테이블 구조**:
```sql
CREATE TABLE 미수금내역 (
    사업장코드 VARCHAR(2),           -- 사업장 코드
    매출처코드 VARCHAR(8),           -- 매출처 코드
    미수금입금일자 VARCHAR(8),        -- 입금 일자 (YYYYMMDD)
    미수금입금시간 VARCHAR(9),        -- 입금 시간 (HHMMSSmmm)
    미수금입금금액 MONEY,            -- 입금 금액
    결제방법 TINYINT,               -- 0=현금, 1=수표, 2=어음, 3=계좌이체 등
    만기일자 VARCHAR(8),            -- 어음 만기일자
    어음번호 VARCHAR(20),           -- 어음번호
    적요 VARCHAR(50),               -- 적요 (비고)
    수정일자 VARCHAR(8),            -- 수정일자
    사용자코드 VARCHAR(4)            -- 사용자 코드
)
```

**예시 데이터 (5건)**:
```json
[
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "미수금입금일자": "20110816",
    "미수금입금시간": "112422763",
    "미수금입금금액": 990000,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "",
    "수정일자": "20110818",
    "사용자코드": "0683"
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "미수금입금일자": "20111122",
    "미수금입금시간": "174740733",
    "미수금입금금액": 495000,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "",
    "수정일자": "20111123",
    "사용자코드": "0683"
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "미수금입금일자": "20111203",
    "미수금입금시간": "131720607",
    "미수금입금금액": 211200,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "",
    "수정일자": "20111206",
    "사용자코드": "0683"
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "미수금입금일자": "20111214",
    "미수금입금시간": "131923233",
    "미수금입금금액": 1595000,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "",
    "수정일자": "20111215",
    "사용자코드": "0683"
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "미수금입금일자": "20120315",
    "미수금입금시간": "132051810",
    "미수금입금금액": 176000,
    "결제방법": 0,
    "만기일자": "",
    "어음번호": "",
    "적요": "",
    "수정일자": "20120627",
    "사용자코드": "0683"
  }
]
```

**주요 특징**:
- **현재 구조**: 입금 내역만 저장 (미수금 발생 정보 없음)
- **필요한 개선**: 거래명세서 작성 시 미수금 발생 자동 기록 기능 추가 필요
- **계산 방식**:
  ```
  총미수금 = SUM(자재입출내역.출고금액) WHERE 입출고구분 = 2
  총입금액 = SUM(미수금내역.미수금입금금액)
  미수금잔액 = 총미수금 - 총입금액
  ```

**복합키**: `사업장코드 + 매출처코드 + 미수금입금일자 + 미수금입금시간`

#### 테이블 2: 미수금원장 (Receivables Ledger)

**용도**: 매출처별 미수금 집계 정보

**테이블 구조**:
```sql
CREATE TABLE 미수금원장 (
    사업장코드 VARCHAR(2),
    매출처코드 VARCHAR(8),
    최종미수금일자 VARCHAR(8),        -- 마지막 미수금 발생일
    최종입금일자 VARCHAR(8),          -- 마지막 입금일
    수정일자 VARCHAR(8),
    사용자코드 VARCHAR(4)
)
```

**현황**: 샘플 데이터 없음 (사용되지 않는 것으로 보임)

#### 테이블 3: 미수금원장마감 (Receivables Ledger Closing)

**용도**: 매출처별 월별 미수금 누계 관리

**테이블 구조**:
```sql
CREATE TABLE 미수금원장마감 (
    사업장코드 VARCHAR(2),
    매출처코드 VARCHAR(8),
    마감년월 VARCHAR(6),             -- YYYYMM 형식
    미수금누계금액 MONEY,            -- 해당 월 미수금 누계
    미수금입금누계금액 MONEY,        -- 해당 월 입금 누계
    수정일자 VARCHAR(8),
    사용자코드 VARCHAR(4)
)
```

**예시 데이터 (5건)**:
```json
[
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "마감년월": "201100",
    "미수금누계금액": 0,
    "미수금입금누계금액": 0,
    "수정일자": "20110415",
    "사용자코드": "0681"
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "마감년월": "201108",
    "미수금누계금액": 990000,
    "미수금입금누계금액": 990000,
    "수정일자": "",
    "사용자코드": ""
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "마감년월": "201111",
    "미수금누계금액": 495000,
    "미수금입금누계금액": 495000,
    "수정일자": "",
    "사용자코드": ""
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "마감년월": "201112",
    "미수금누계금액": 1806200,
    "미수금입금누계금액": 1806200,
    "수정일자": "",
    "사용자코드": ""
  },
  {
    "사업장코드": "01",
    "매출처코드": "A002",
    "마감년월": "201200",
    "미수금누계금액": 0,
    "미수금입금누계금액": 0,
    "수정일자": "",
    "사용자코드": ""
  }
]
```

**복합키**: `사업장코드 + 매출처코드 + 마감년월`

---

### 1.3 미수금관리 (Accounts Receivable Management)

**사용 테이블**: `미수금내역`, `미수금원장마감`, `매출처`

**주요 기능**:
- 매출처별 미수금 잔액 조회
- 입금 처리
- 결제방법별 관리
- 월별 집계 및 마감

**구현 상태**: ❌ TODO

---

### 1.4 미지급금관리 (Accounts Payable Management)

**사용 테이블**: `미지급금내역`, `미지급금원장마감`, `매입처`

**주요 기능**:
- 매입처별 미지급금 잔액 조회
- 지급 처리
- 결제방법별 관리
- 월별 집계 및 마감

**구현 상태**: ✅ 조회 API 구현 완료

---

## 📦 2. 자재관리 (Material Management)

### 2.1 자재분류관리 (Material Category Management)

**사용 테이블**: `자재분류`

#### 테이블: 자재분류 (Material Category)

**용도**: 자재 대분류 관리

**테이블 구조**:
```sql
CREATE TABLE 자재분류 (
    분류코드 VARCHAR(2),              -- 분류 코드 (예: "01")
    분류명 VARCHAR(30),               -- 분류명 (예: "자재")
    적요 VARCHAR(100),                -- 적요 (비고)
    사용구분 TINYINT,                -- 0=사용, 1=미사용
    수정일자 VARCHAR(8),
    사용자코드 VARCHAR(4)
)
```

**예시 데이터 (1건)**:
```json
{
  "분류코드": "01",
  "분류명": "자재",
  "적요": "",
  "사용구분": 0,
  "수정일자": "",
  "사용자코드": "8080"
}
```

**기본키**: `분류코드`

**주요 기능**:
- ✅ **신규 등록**: POST `/api/material-categories`
- ✅ **수정**: PUT `/api/material-categories/:code`
- ✅ **삭제**: DELETE `/api/material-categories/:code` (사용구분 = 1로 변경)
- ✅ **저장**: 등록/수정 시 자동 저장

**구현 상태**: ⚠️ 조회만 구현 (CRUD 추가 필요)

---

### 2.2 자재내역관리 (Material Details Management)

**사용 테이블**: `자재입출내역`, `자재`, `매입처`, `매출처`

#### 테이블: 자재입출내역 (Material Transaction History)

**용도**: 자재 입출고 거래 내역 (매입/매출 통합)

**주요 필드**:
```sql
입출고구분:
  1 = 매입 (입고) - 매입처코드 사용
  2 = 매출 (출고) - 매출처코드 사용
```

**주요 기능**:
- ✅ **날짜별 조회**:
  - `GET /api/transactions?startDate=20251101&endDate=20251101`
  - `GET /api/purchase-statements?startDate=20251101&endDate=20251101`

- ✅ **매입처별 조회**:
  - `GET /api/purchase-statements?supplierCode=B041`

- ✅ **매출처별 조회**:
  - `GET /api/transactions?customerCode=A002`

- ✅ **상세 보기**:
  - `GET /api/transactions/:date/:no` - 거래명세서 상세
  - `GET /api/purchase-statements/:date/:no` - 매입전표 상세

**구현 상태**: ✅ 전체 구현 완료

---

### 2.3 자재재고관리 (Inventory Management)

**사용 테이블**: `자재원장`, `자재원장마감`, `자재입출내역`

#### 테이블 1: 자재원장 (Material Ledger)

**용도**: 자재별 재고 및 가격 정보 관리

**테이블 구조**:
```sql
CREATE TABLE 자재원장 (
    사업장코드 VARCHAR(2),
    분류코드 VARCHAR(2),
    세부코드 VARCHAR(16),            -- 순수 세부코드 (사업장코드 제외)
    적정재고 MONEY,                  -- 적정 재고 수량
    최저재고 MONEY,                  -- 최저 재고 수량
    최종입고일자 VARCHAR(8),
    최종출고일자 VARCHAR(8),
    사용구분 TINYINT,
    수정일자 VARCHAR(8),
    사용자코드 VARCHAR(4),
    비고란 VARCHAR(100),
    주매입처코드 VARCHAR(8),
    입고단가1 MONEY,                 -- 주 매입 단가
    입고단가2 MONEY,
    입고단가3 MONEY,
    출고단가1 MONEY,                 -- 주 매출 단가
    출고단가2 MONEY,
    출고단가3 MONEY
)
```

**예시 데이터 (5건)**:
```json
[
  {
    "사업장코드": "01",
    "분류코드": "",
    "세부코드": "",
    "적정재고": 0,
    "최저재고": 0,
    "최종입고일자": "",
    "최종출고일자": "",
    "사용구분": 0,
    "수정일자": "20041118",
    "사용자코드": "0683",
    "비고란": "",
    "주매입처코드": "",
    "입고단가1": 0,
    "입고단가2": 0,
    "입고단가3": 0,
    "출고단가1": 0,
    "출고단가2": 0,
    "출고단가3": 0
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01BJ12",
    "적정재고": 0,
    "최저재고": 0,
    "최종입고일자": "20250908",
    "최종출고일자": "20250909",
    "사용구분": 0,
    "수정일자": "20220407",
    "사용자코드": "0687",
    "비고란": "",
    "주매입처코드": "",
    "입고단가1": 8250,
    "입고단가2": 0,
    "입고단가3": 0,
    "출고단가1": 13800,
    "출고단가2": 0,
    "출고단가3": 0
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01D601005",
    "적정재고": 0,
    "최저재고": 0,
    "최종입고일자": "20190711",
    "최종출고일자": "20170623",
    "사용구분": 0,
    "수정일자": "20091008",
    "사용자코드": "0683",
    "비고란": "",
    "주매입처코드": "",
    "입고단가1": 9000,
    "입고단가2": 0,
    "입고단가3": 0,
    "출고단가1": 8000,
    "출고단가2": 0,
    "출고단가3": 0
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01DS33",
    "적정재고": 0,
    "최저재고": 0,
    "최종입고일자": "20130822",
    "최종출고일자": "20130819",
    "사용구분": 0,
    "수정일자": "20091117",
    "사용자코드": "0683",
    "비고란": "",
    "주매입처코드": "",
    "입고단가1": 50000,
    "입고단가2": 0,
    "입고단가3": 0,
    "출고단가1": 37000,
    "출고단가2": 0,
    "출고단가3": 0
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01MOFS105",
    "적정재고": 0,
    "최저재고": 0,
    "최종입고일자": "20160127",
    "최종출고일자": "20160512",
    "사용구분": 0,
    "수정일자": "20160127",
    "사용자코드": "0683",
    "비고란": "",
    "주매입처코드": "",
    "입고단가1": 620000,
    "입고단가2": 0,
    "입고단가3": 0,
    "출고단가1": 680000,
    "출고단가2": 0,
    "출고단가3": 0
  }
]
```

**복합키**: `사업장코드 + 분류코드 + 세부코드`

#### 테이블 2: 자재원장마감 (Material Ledger Closing)

**용도**: 자재별 월별 입출고 누계 관리

**테이블 구조**:
```sql
CREATE TABLE 자재원장마감 (
    사업장코드 VARCHAR(2),
    분류코드 VARCHAR(2),
    세부코드 VARCHAR(16),
    마감년월 VARCHAR(6),             -- YYYYMM 형식
    입고누계수량 MONEY,              -- 해당 월 입고 누계
    출고누계수량 MONEY,              -- 해당 월 출고 누계
    수정일자 VARCHAR(8),
    사용자코드 VARCHAR(4)
)
```

**예시 데이터 (5건)**:
```json
[
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01BJ12",
    "마감년월": "201304",
    "입고누계수량": -3,
    "출고누계수량": 0,
    "수정일자": "",
    "사용자코드": ""
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01BJ12",
    "마감년월": "201305",
    "입고누계수량": 11,
    "출고누계수량": 0,
    "수정일자": "",
    "사용자코드": ""
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01BJ12",
    "마감년월": "201306",
    "입고누계수량": 18,
    "출고누계수량": 18,
    "수정일자": "",
    "사용자코드": ""
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01BJ12",
    "마감년월": "201307",
    "입고누계수량": 10,
    "출고누계수량": 0,
    "수정일자": "",
    "사용자코드": ""
  },
  {
    "사업장코드": "01",
    "분류코드": "01",
    "세부코드": "01BJ12",
    "마감년월": "201308",
    "입고누계수량": 5,
    "출고누계수량": 1,
    "수정일자": "",
    "사용자코드": ""
  }
]
```

**복합키**: `사업장코드 + 분류코드 + 세부코드 + 마감년월`

**재고 계산 방식**:
```
현재고 = 전월이월재고 + 당월입고수량 - 당월출고수량

-- 실시간 재고 계산 (자재입출내역 기준)
SELECT
  사업장코드, 분류코드, 세부코드,
  SUM(CASE WHEN 입출고구분 = 1 THEN 입고수량 ELSE 0 END) AS 총입고수량,
  SUM(CASE WHEN 입출고구분 = 2 THEN 출고수량 ELSE 0 END) AS 총출고수량,
  SUM(CASE WHEN 입출고구분 = 1 THEN 입고수량 ELSE 0 END) -
  SUM(CASE WHEN 입출고구분 = 2 THEN 출고수량 ELSE 0 END) AS 현재고
FROM 자재입출내역
WHERE 사용구분 = 0
GROUP BY 사업장코드, 분류코드, 세부코드
```

**주요 기능**:
- ✅ **날짜별 입출고 수량 계산**:
  - `GET /api/inventory/:workplace`
  - 자재입출내역에서 실시간 집계

- ❌ **월별 마감 처리** (TODO):
  - 매월 말일에 자재원장마감 테이블 업데이트
  - 전월 데이터 기준 이월재고 계산

**구현 상태**: ⚠️ 실시간 조회만 구현 (마감 처리 미구현)

---

## 📋 테이블 관계 요약

### 장부관리
```
미지급금내역 ─┬─ 매입처
              └─ 미지급금원장마감

미수금내역 ───┬─ 매출처
              └─ 미수금원장마감
```

### 자재관리
```
자재 ──┬─ 자재분류
       ├─ 자재원장 ──── 자재원장마감
       └─ 자재입출내역
```

---

## 변경 이력

- **2025-11-01**: 초안 작성
  - 장부관리 테이블 구조 및 예시 데이터 정리
  - 자재관리 테이블 구조 및 예시 데이터 정리
  - 계산 공식 및 쿼리 예시 추가