<!-- 매출처 신규등록 모달 -->
<div
  id="customerModal"
  style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  "
>
  <div
    style="
      background: white;
      border-radius: 12px;
      padding: 32px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    "
  >
    <!-- 고정된 제목 영역 -->
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        position: sticky;
        top: -32px;
        background: white;
        padding: 0 0 16px 0;
        border-bottom: 2px solid var(--border);
        z-index: 10;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
        매출처 신규등록
      </h2>
      <button
        onclick="closeCustomerModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        "
        onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
        onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';"
      >
        ×
      </button>
    </div>

    <form id="customerForm" onsubmit="submitCustomer(event)">
      <!-- 1. 매출처코드 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >매출처코드</label
        >
        <input
          type="text"
          id="customerCode"
          name="customerCode"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="자동생성"
        />
      </div>

      <!-- 2. 매출처명 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >매출처명 *</label
        >
        <input
          type="text"
          id="customerName"
          name="customerName"
          required
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="매출처명"
        />
      </div>

      <!-- 3. 대표자명 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >대표자명</label
        >
        <input
          type="text"
          id="ceoName"
          name="ceoName"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="대표자명"
        />
      </div>

      <!-- 4. 사업자번호 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >사업자번호</label
        >
        <input
          type="text"
          id="businessNo"
          name="businessNo"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="000-00-00000"
        />
      </div>

      <!-- 5. 업태 & 업종 (1:1 비율) -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
            >업태</label
          >
          <input
            type="text"
            id="businessType"
            name="businessType"
            style="
              width: 100%;
              padding: 12px 16px;
              border: 2px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="업태"
          />
        </div>
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
            >업종</label
          >
          <input
            type="text"
            id="businessCategory"
            name="businessCategory"
            style="
              width: 100%;
              padding: 12px 16px;
              border: 2px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="업종"
          />
        </div>
      </div>

      <!-- 6. 연락처 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >연락처</label
        >
        <input
          type="tel"
          id="phone"
          name="phone"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="010-0000-0000"
        />
      </div>

      <!-- 7. 팩스번호 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >팩스번호</label
        >
        <input
          type="tel"
          id="fax"
          name="fax"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="02-0000-0000"
        />
      </div>

      <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >우편번호</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="text"
            id="zipCode"
            name="zipCode"
            readonly
            style="
              flex: 1;
              padding: 12px 16px;
              border: 2px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
              background-color: #f5f5f5;
            "
            placeholder="00000"
          />
          <button
            type="button"
            onclick="execDaumPostcode()"
            style="
              padding: 10px 20px;
              background: var(--primary);
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              white-space: nowrap;
            "
          >
            찾기
          </button>
        </div>
      </div>

      <!-- 9. 주소 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >주소</label
        >
        <input
          type="text"
          id="address"
          name="address"
          readonly
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background-color: #f5f5f5;
          "
          placeholder="주소"
        />
      </div>

      <!-- 10. 상세주소 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >상세주소</label
        >
        <input
          type="text"
          id="addressDetail"
          name="addressDetail"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="상세주소를 입력하세요"
        />
      </div>

      <!-- 11. 은행 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >은행</label
        >
        <select
          id="bankCode"
          name="bankCode"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
        >
          <option value="">선택하세요</option>
          <option value="01">한국은행</option>
          <option value="02">산업은행</option>
          <option value="03">기업은행</option>
          <option value="04">국민은행</option>
          <option value="05">농협</option>
          <option value="06">하나은행</option>
          <option value="07">우리은행</option>
          <option value="08">SC은행</option>
          <option value="09">씨티은행</option>
        </select>
      </div>

      <!-- 12. 계좌번호 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >계좌번호</label
        >
        <input
          type="text"
          id="accountNo"
          name="accountNo"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="계좌번호"
        />
      </div>

      <!-- 13. 담당자명 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >담당자명</label
        >
        <input
          type="text"
          id="managerName"
          name="managerName"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="담당자명"
        />
      </div>

      <!-- 14. 거래상태 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >거래상태</label
        >
        <select
          id="status"
          name="status"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
        >
          <option value="0">정상거래</option>
          <option value="1">거래보류</option>
        </select>
      </div>

      <!-- 15. 비고란 (전체 너비) -->
      <div style="margin-bottom: 24px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >비고란</label
        >
        <textarea
          id="remark"
          name="remark"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
          "
          placeholder="비고"
        ></textarea>
      </div>

      <!-- 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end">
        <button
          type="button"
          onclick="closeCustomerModal()"
          style="
            padding: 10px 24px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-dark);
          "
        >
          취소
        </button>
        <button
          type="submit"
          style="
            padding: 10px 24px;
            background: var(--primary);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: white;
          "
        >
          등록
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 매출처 삭제 확인 모달 -->
<div id="customerDeleteModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <!-- 헤더 -->
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        position: sticky;
        top: -32px;
        background: white;
        padding: 0 0 16px 0;
        border-bottom: 2px solid var(--border);
        z-index: 10;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
        매출처 삭제
      </h2>
      <button
        onclick="closeCustomerDeleteModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        "
        onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
        onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';"
      >
        ×
      </button>
    </div>

    <!-- 삭제할 매출처 정보 표시 -->
    <div id="customerDeleteContent" style="margin-bottom: 24px">
      <!-- 매출처 정보가 여기에 동적으로 로드됩니다 -->
    </div>

    <!-- 경고 메시지 -->
    <div
      style="
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 24px;
      "
    >
      <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6">
        <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.<br />
        삭제된 데이터는 복구할 수 없습니다.
      </p>
    </div>

    <!-- 버튼 영역 -->
    <div style="display: flex; gap: 12px; justify-content: flex-end">
      <button
        type="button"
        onclick="closeCustomerDeleteModal()"
        style="
          padding: 10px 24px;
          background: var(--bg-light);
          border: 1px solid var(--border);
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: var(--text-dark);
        "
      >
        취소
      </button>
      <button
        type="button"
        onclick="confirmDeleteCustomer()"
        style="
          padding: 10px 24px;
          background: #dc3545;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
        "
      >
        삭제
      </button>
    </div>
  </div>
</div>

<!-- 매출처 상세보기 모달 -->
<div id="customerDetailModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700">매출처 상세정보</h2>
      <button
        onclick="closeCustomerDetailModal()"
        style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999"
      >
        ×
      </button>
    </div>

    <div
      id="customerDetailContent"
      style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px"
    >
      <!-- 상세 정보가 여기에 동적으로 로드됩니다 -->
    </div>

    <div style="margin-top: 24px; display: flex; justify-content: flex-end">
      <button onclick="closeCustomerDetailModal()" class="btn btn-secondary">닫기</button>
    </div>
  </div>
</div>

<!-- 견적서 작성/수정 모달 -->
<div id="quotationModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto">
    <!-- 헤더 -->
    <div
      id="quotationModalHeader"
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        position: sticky;
        top: -32px;
        background: white;
        padding: 0 0 16px 0;
        border-bottom: 2px solid var(--border);
        z-index: 10;
        user-select: none;
      "
    >
      <h2
        style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)"
        id="quotationModalTitle"
      >
        견적서 작성
      </h2>
      <button
        onclick="closeQuotationModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        "
        onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
        onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';"
      >
        ×
      </button>
    </div>

    <form id="quotationForm" onsubmit="submitQuotation(event)">
      <!-- 마스터 정보 섹션 -->
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 24px">
        <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600">기본 정보</h3>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px">
          <!-- 견적일자 -->
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >견적일자 *</label
            >
            <input
              type="date"
              id="quotationDate"
              required
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            />
          </div>

          <!-- 출고희망일자 -->
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >출고희망일자</label
            >
            <input
              type="date"
              id="deliveryDate"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            />
          </div>

          <!-- 매출처 선택 -->
          <div style="grid-column: 1 / -1">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >매출처 *</label
            >
            <div style="display: flex; gap: 8px">
              <!-- 숨겨진 매출처 코드 필드 (실제 값 저장용) -->
              <input type="hidden" id="selectedCustomerCode" />

              <!-- 통합 검색 입력란 -->
              <input
                type="text"
                id="selectedCustomerName"
                required
                style="
                  flex: 1;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                "
                placeholder="매출처 코드 또는 이름 입력 후 엔터"
                onkeypress="if(event.key === 'Enter') { event.preventDefault(); openCustomerSearchModal(); }"
              />
              <button
                type="button"
                onclick="openCustomerSearchModal()"
                style="
                  padding: 10px 20px;
                  background: var(--primary);
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  white-space: nowrap;
                "
              >
                검색
              </button>
            </div>
            <!-- 선택된 매출처 정보 표시 -->
            <div
              id="selectedCustomerInfo"
              style="
                display: none;
                margin-top: 8px;
                padding: 8px 12px;
                background: #f0f9ff;
                border-radius: 6px;
                border: 1px solid #bfdbfe;
              "
            >
              <span style="font-size: 12px; color: #3b82f6; font-weight: 600">선택된 매출처:</span>
              <span
                id="selectedCustomerDisplay"
                style="margin-left: 8px; font-weight: 600; color: #1e40af"
              ></span>
            </div>
          </div>

          <!-- 제목 -->
          <div style="grid-column: 1 / -1">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >제목</label
            >
            <input
              type="text"
              id="quotationTitle"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="견적서 제목을 입력하세요"
            />
          </div>

          <!-- 적요 -->
          <div style="grid-column: 1 / -1">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >적요</label
            >
            <textarea
              id="quotationRemark"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
                min-height: 80px;
              "
              placeholder="비고사항을 입력하세요"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- 상세내역 섹션 -->
      <div style="margin-bottom: 24px">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
          "
        >
          <h3 style="margin: 0; font-size: 18px; font-weight: 600">견적 상세내역</h3>
          <button
            type="button"
            onclick="openMaterialSearchModal()"
            style="
              padding: 8px 16px;
              background: #007bff;
              color: white;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
            "
          >
            + 자재 추가
          </button>
        </div>

        <!-- 상세내역 테이블 -->
        <div style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px">
          <table id="quotationDetailTable" style="width: 100%; border-collapse: collapse">
            <thead style="background: #f8f9fa">
              <tr>
                <th
                  style="
                    padding: 12px;
                    text-align: left;
                    border-bottom: 2px solid var(--border);
                    width: 40px;
                  "
                >
                  순번
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                  자재코드
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                  자재명
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                  규격
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 100px;
                  "
                >
                  수량
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 120px;
                  "
                >
                  단가
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 120px;
                  "
                >
                  공급가
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 100px;
                  "
                >
                  부가세
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: center;
                    border-bottom: 2px solid var(--border);
                    width: 60px;
                  "
                >
                  삭제
                </th>
              </tr>
            </thead>
            <tbody id="quotationDetailTableBody">
              <tr>
                <td colspan="9" style="padding: 40px; text-align: center; color: #999">
                  자재 추가 버튼을 클릭하여 견적 상세내역을 입력하세요
                </td>
              </tr>
            </tbody>
            <tfoot style="background: #f8f9fa; font-weight: 600">
              <tr>
                <td
                  colspan="6"
                  style="padding: 12px; text-align: right; border-top: 2px solid var(--border)"
                >
                  합계
                </td>
                <td
                  id="totalSupplyPrice"
                  style="padding: 12px; text-align: right; border-top: 2px solid var(--border)"
                >
                  0
                </td>
                <td
                  id="totalVat"
                  style="padding: 12px; text-align: right; border-top: 2px solid var(--border)"
                >
                  0
                </td>
                <td style="padding: 12px; border-top: 2px solid var(--border)"></td>
              </tr>
              <tr>
                <td colspan="6" style="padding: 12px; text-align: right">총액</td>
                <td
                  colspan="2"
                  id="grandTotal"
                  style="padding: 12px; text-align: right; color: #007bff; font-size: 16px"
                >
                  0
                </td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <!-- 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end">
        <button
          type="button"
          onclick="closeQuotationModal()"
          style="
            padding: 10px 24px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-dark);
          "
        >
          취소
        </button>
        <button
          type="submit"
          style="
            padding: 10px 24px;
            background: var(--primary);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: white;
          "
        >
          견적서 등록
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ✅ 매출처 검색 모달 -->
<div id="customerSearchModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 800px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      "
    >
      <h3 style="margin: 0">매출처 검색</h3>
      <button
        onclick="closeCustomerSearchModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        "
      >
        ×
      </button>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 16px">
      <input
        type="text"
        id="quotationCustomerSearchInput"
        placeholder="매출처명 또는 코드 검색"
        onkeypress="if(event.key === 'Enter') searchQuotationCustomers()"
        style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px"
      />
      <button
        onclick="searchQuotationCustomers()"
        style="
          padding: 10px 20px;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        "
      >
        검색
      </button>
    </div>

    <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px">
      <table id="customerSearchTable" style="width: 100%; border-collapse: collapse">
        <thead style="background: #f8f9fa; position: sticky; top: 0">
          <tr>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">코드</th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
              매출처명
            </th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
              전화번호
            </th>
            <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb">
              선택
            </th>
          </tr>
        </thead>
        <tbody id="customerSearchTableBody">
          <tr>
            <td colspan="4" style="padding: 40px; text-align: center; color: #999">
              검색 버튼을 클릭하여 매출처를 검색하세요
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ✅ 자재 선택 모달 (견적서 작성용) -->
<div id="materialSearchModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 900px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      "
    >
      <h3 style="margin: 0">자재 검색 및 추가</h3>
      <button
        onclick="closeMaterialSearchModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        "
      >
        ×
      </button>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 16px">
      <input
        type="text"
        id="materialSearchInput2"
        placeholder="자재명 또는 코드 검색"
        onkeypress="if(event.key === 'Enter') searchMaterialsForQuotation()"
        style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px"
      />
      <button
        onclick="searchMaterialsForQuotation()"
        style="
          padding: 10px 20px;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        "
      >
        검색
      </button>
    </div>

    <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px">
      <table id="materialSearchTable" style="width: 100%; border-collapse: collapse">
        <thead style="background: #f8f9fa; position: sticky; top: 0">
          <tr>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
              자재코드
            </th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
              자재명
            </th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">규격</th>
            <th style="padding: 10px; text-align: right; border-bottom: 2px solid #e5e7eb">
              출고단가
            </th>
            <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb">
              이전단가
            </th>
            <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb">
              선택
            </th>
          </tr>
        </thead>
        <tbody id="materialSearchTableBody">
          <tr>
            <td colspan="6" style="padding: 40px; text-align: center; color: #999">
              검색 버튼을 클릭하여 자재를 검색하세요
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ✅ 자재 선택 모달 (기존 - 견적 수정용) -->
<div id="materialSelectModal" class="modal hidden">
  <div class="modal-content large">
    <span id="closeMaterialModal" class="close">&times;</span>
    <h3>자재 선택</h3>

    <div style="display: flex; gap: 10px; margin-bottom: 10px">
      <input
        type="text"
        id="materialSearch"
        placeholder="자재명 또는 코드 검색"
        class="form-input"
        style="flex: 1"
      />
      <button class="btn btn-primary" onclick="searchMaterials()">검색</button>
    </div>

    <table id="materialTable" class="display" style="width: 100%">
      <thead>
        <tr>
          <th>자재코드</th>
          <th>자재명</th>
          <th>규격</th>
          <th>단가</th>
          <th>선택</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- 테스트용 간단한 모달 -->
<div id="testSimpleModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      "
    >
      <h3 style="margin: 0">자재 목록 (테스트)</h3>
      <button
        onclick="closeTestSimpleModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        "
      >
        ×
      </button>
    </div>
    <div style="padding: 40px; text-align: center; color: #666">테스트용 간단한 모달입니다.</div>
  </div>
</div>

<!-- 신규 견적서용 품목 추가 모달 -->
<div id="newQuotationMaterialModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 600px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 추가</h2>
      <button
        onclick="closeNewQuotationMaterialModal()"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <div style="display: flex; flex-direction: column; gap: 16px">
      <!-- 자재 검색 영역 -->
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >자재 검색</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="text"
            id="newMaterialSearchInput"
            style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="자재명 또는 품목코드로 검색"
            onkeypress="if(event.key === 'Enter') searchNewMaterials()"
          />
          <button
            onclick="searchNewMaterials()"
            style="
              padding: 10px 20px;
              background: #3b82f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            "
            onmouseover="this.style.background='#2563eb';"
            onmouseout="this.style.background='#3b82f6';"
          >
            검색
          </button>
        </div>
      </div>

      <!-- 검색 결과 테이블 -->
      <div id="newMaterialSearchResults" style="display: none">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >검색 결과 (클릭하여 선택)</label
        >
        <div
          style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px"
        >
          <table style="width: 100%; border-collapse: collapse">
            <thead style="background: #f9fafb; position: sticky; top: 0">
              <tr>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  품목코드
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  품명
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  규격
                </th>
              </tr>
            </thead>
            <tbody id="newMaterialSearchTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- 선택된 자재 정보 -->
      <div
        id="newSelectedMaterialInfo"
        style="
          display: none;
          background: #f0f9ff;
          padding: 12px;
          border-radius: 8px;
          border: 2px solid #bfdbfe;
        "
      >
        <div style="display: flex; justify-content: space-between; align-items: center">
          <div>
            <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px">
              선택된 자재
            </div>
            <div style="font-weight: 600; color: #1e40af" id="newSelectedMaterialName">-</div>
            <div
              style="font-size: 12px; color: #6b7280; margin-top: 2px"
              id="newSelectedMaterialCode"
            >
              -
            </div>
          </div>
          <button
            onclick="clearNewSelectedMaterial()"
            style="
              padding: 6px 12px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 12px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            "
          >
            취소
          </button>
        </div>
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >수량</label
        >
        <input
          type="number"
          id="newDetailQuantity"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="수량 입력"
          value="1"
          min="0"
          step="0.01"
        />
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >출고단가</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="number"
            id="newDetailPrice"
            style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="단가 입력"
            value="0"
            min="0"
            step="0.01"
          />
          <button
            onclick="showNewPriceHistory()"
            style="
              padding: 10px 16px;
              background: #8b5cf6;
              border: none;
              border-radius: 8px;
              font-size: 13px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            "
            onmouseover="this.style.background='#7c3aed';"
            onmouseout="this.style.background='#8b5cf6';"
          >
            이전 단가
          </button>
        </div>
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >금액 (자동계산)</label
        >
        <input
          type="text"
          id="newDetailAmount"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: #f9fafb;
          "
          readonly
          value="0"
        />
      </div>
    </div>

    <div
      style="
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <button
        onclick="closeNewQuotationMaterialModal()"
        style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb';"
        onmouseout="this.style.background='#f3f4f6';"
      >
        취소
      </button>
      <button
        onclick="confirmNewQuotationMaterialAdd()"
        style="
          padding: 12px 24px;
          background: #10b981;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#059669';"
        onmouseout="this.style.background='#10b981';"
      >
        추가하기
      </button>
    </div>
  </div>
</div>

<!-- 신규 견적서 전용 단가 이력 모달 -->
<div
  id="newQuotationPriceHistoryModal"
  class="modal"
  style="display: none; position: fixed; z-index: 10000"
>
  <div class="modal-content" style="max-width: 700px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">출고단가 이력</h2>
      <button
        id="closeNewPriceHistoryModal"
        onclick="closeNewPriceHistoryModal()"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <!-- 자재 정보 -->
    <div
      style="
        background: #fef3c7;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 16px;
        border: 2px solid #fbbf24;
      "
    >
      <div style="display: flex; justify-content: space-between; align-items: center">
        <div>
          <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px">
            선택된 자재
          </div>
          <div style="font-weight: 600; color: #78350f" id="newPriceHistoryMaterialName">-</div>
          <div
            style="font-size: 12px; color: #92400e; margin-top: 2px"
            id="newPriceHistoryMaterialCode"
          >
            -
          </div>
        </div>
      </div>
    </div>

    <!-- ✅ 탭 메뉴 -->
    <div style="display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 2px solid #e5e7eb">
      <button
        id="newTabActualPrice"
        onclick="switchNewPriceHistoryTab('actual')"
        style="
          padding: 12px 20px;
          background: #3b82f6;
          border: none;
          border-bottom: 3px solid #3b82f6;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
          flex: 1;
        "
      >
        실제 출고가
      </button>
      <button
        id="newTabQuotationPrice"
        onclick="switchNewPriceHistoryTab('quotation')"
        style="
          padding: 12px 20px;
          background: transparent;
          border: none;
          border-bottom: 3px solid transparent;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s;
          flex: 1;
        "
        onmouseover="if(this.id !== 'newTabActualPrice' || this.style.background === 'transparent') this.style.color='#1f2937';"
        onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';"
      >
        견적 제안가
      </button>
    </div>

    <!-- 이력 테이블 -->
    <div style="margin-bottom: 16px">
      <label
        id="newPriceHistoryLabel"
        style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
      >
        이 거래처에 실제 출고한 이력 (클릭하여 단가 선택)
      </label>
      <div
        style="max-height: 300px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px"
      >
        <table id="newPriceHistoryTable" style="width: 100%; border-collapse: collapse">
          <thead
            id="newPriceHistoryTableHead"
            style="background: #f9fafb; position: sticky; top: 0"
          >
            <tr>
              <th
                style="
                  padding: 10px;
                  text-align: left;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                출고일자
              </th>
              <th
                style="
                  padding: 10px;
                  text-align: right;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                출고단가
              </th>
              <th
                style="
                  padding: 10px;
                  text-align: right;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                출고수량
              </th>
              <th
                style="
                  padding: 10px;
                  text-align: center;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                적요
              </th>
            </tr>
          </thead>
          <tbody id="newPriceHistoryTableBody">
            <tr>
              <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af">
                이력이 없습니다
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div
      style="
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding-top: 16px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <button
        onclick="closeNewPriceHistoryModal()"
        style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb';"
        onmouseout="this.style.background='#f3f4f6';"
      >
        닫기
      </button>
    </div>
  </div>
</div>

<!-- 매입처 신규등록 모달 -->
<div
  id="supplierModal"
  style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  "
>
  <div
    style="
      background: white;
      border-radius: 12px;
      padding: 32px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    "
  >
    <!-- 고정된 제목 영역 -->
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        position: sticky;
        top: -32px;
        background: white;
        padding: 0 0 16px 0;
        border-bottom: 2px solid var(--border);
        z-index: 10;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
        매입처 신규등록
      </h2>
      <button
        onclick="closeSupplierModal()"
        style="
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: var(--text-gray);
        "
      >
        ×
      </button>
    </div>

    <form id="supplierForm" onsubmit="submitSupplier(event)">
      <!-- 1. 매입처코드 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >매입처코드</label
        >
        <input
          type="text"
          id="supplierCode"
          name="supplierCode"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="자동생성"
        />
      </div>

      <!-- 2. 매입처명 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >매입처명 *</label
        >
        <input
          type="text"
          id="supplierName"
          name="supplierName"
          required
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="매입처명"
        />
      </div>

      <!-- 3. 대표자명 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >대표자명</label
        >
        <input
          type="text"
          id="supplierCeoName"
          name="supplierCeoName"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="대표자명"
        />
      </div>

      <!-- 4. 사업자번호 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >사업자번호</label
        >
        <input
          type="text"
          id="supplierBusinessNo"
          name="supplierBusinessNo"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="000-00-00000"
        />
      </div>

      <!-- 5. 업태 & 업종 (1:1 비율) -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px">
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
            >업태</label
          >
          <input
            type="text"
            id="supplierBusinessType"
            name="supplierBusinessType"
            style="
              width: 100%;
              padding: 12px 16px;
              border: 2px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="업태"
          />
        </div>
        <div>
          <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
            >업종</label
          >
          <input
            type="text"
            id="supplierBusinessCategory"
            name="supplierBusinessCategory"
            style="
              width: 100%;
              padding: 12px 16px;
              border: 2px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="업종"
          />
        </div>
      </div>

      <!-- 6. 연락처 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >연락처</label
        >
        <input
          type="tel"
          id="supplierPhone"
          name="supplierPhone"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="010-0000-0000"
        />
      </div>

      <!-- 7. 팩스번호 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >팩스번호</label
        >
        <input
          type="tel"
          id="supplierFax"
          name="supplierFax"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="02-0000-0000"
        />
      </div>

      <!-- 8. 우편번호 (전체 너비, 찾기 버튼 포함) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >우편번호</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="text"
            id="supplierZipCode"
            name="supplierZipCode"
            readonly
            style="
              flex: 1;
              padding: 12px 16px;
              border: 2px solid var(--border);
              border-radius: 8px;
              font-size: 14px;
              background-color: #f5f5f5;
            "
            placeholder="00000"
          />
          <button
            type="button"
            onclick="execDaumPostcode('supplier')"
            style="
              padding: 10px 20px;
              background: var(--primary);
              color: white;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              white-space: nowrap;
            "
          >
            찾기
          </button>
        </div>
      </div>

      <!-- 9. 주소 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >주소</label
        >
        <input
          type="text"
          id="supplierAddress"
          name="supplierAddress"
          readonly
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background-color: #f5f5f5;
          "
          placeholder="주소"
        />
      </div>

      <!-- 10. 상세주소 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >상세주소</label
        >
        <input
          type="text"
          id="supplierAddressDetail"
          name="supplierAddressDetail"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="상세주소를 입력하세요"
        />
      </div>

      <!-- 11. 은행 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >은행</label
        >
        <select
          id="supplierBankCode"
          name="supplierBankCode"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
        >
          <option value="">선택하세요</option>
          <option value="01">한국은행</option>
          <option value="02">산업은행</option>
          <option value="03">기업은행</option>
          <option value="04">국민은행</option>
          <option value="05">농협</option>
          <option value="06">하나은행</option>
          <option value="07">우리은행</option>
          <option value="08">SC은행</option>
          <option value="09">씨티은행</option>
        </select>
      </div>

      <!-- 12. 계좌번호 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >계좌번호</label
        >
        <input
          type="text"
          id="supplierAccountNo"
          name="supplierAccountNo"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="계좌번호"
        />
      </div>

      <!-- 13. 담당자명 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >담당자명</label
        >
        <input
          type="text"
          id="supplierManagerName"
          name="supplierManagerName"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="담당자명"
        />
      </div>

      <!-- 14. 거래상태 (전체 너비) -->
      <div style="margin-bottom: 16px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >거래상태</label
        >
        <select
          id="supplierStatus"
          name="supplierStatus"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
          "
        >
          <option value="0">정상거래</option>
          <option value="1">거래보류</option>
        </select>
      </div>

      <!-- 15. 비고란 (전체 너비) -->
      <div style="margin-bottom: 24px">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
          >비고란</label
        >
        <textarea
          id="supplierRemark"
          name="supplierRemark"
          style="
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
          "
          placeholder="비고"
        ></textarea>
      </div>

      <!-- 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end">
        <button
          type="button"
          onclick="closeSupplierModal()"
          style="
            padding: 10px 24px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-dark);
          "
        >
          취소
        </button>
        <button
          type="submit"
          style="
            padding: 10px 24px;
            background: var(--primary);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: white;
          "
        >
          등록
        </button>
      </div>
    </form>
  </div>
</div>

<!-- 매입처 상세보기 모달 -->
<div id="supplierDetailModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700">매입처 상세정보</h2>
      <button
        onclick="closeSupplierDetailModal()"
        style="background: none; border: none; font-size: 28px; cursor: pointer; color: #999"
      >
        ×
      </button>
    </div>

    <div
      id="supplierDetailContent"
      style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px"
    >
      <!-- 상세 정보가 여기에 동적으로 로드됩니다 -->
    </div>

    <div style="margin-top: 24px; display: flex; justify-content: flex-end">
      <button onclick="closeSupplierDetailModal()" class="btn btn-secondary">닫기</button>
    </div>
  </div>
</div>

<!-- 매입처 삭제 확인 모달 -->
<div id="supplierDeleteModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <!-- 헤더 -->
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        position: sticky;
        top: -32px;
        background: white;
        padding: 0 0 16px 0;
        border-bottom: 2px solid var(--border);
        z-index: 10;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)">
        매입처 삭제
      </h2>
      <button
        onclick="closeSupplierDeleteModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        "
        onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
        onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';"
      >
        ×
      </button>
    </div>

    <!-- 삭제할 매입처 정보 표시 -->
    <div id="supplierDeleteContent" style="margin-bottom: 24px">
      <!-- 매입처 정보가 여기에 동적으로 로드됩니다 -->
    </div>

    <!-- 경고 메시지 -->
    <div
      style="
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 24px;
      "
    >
      <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6">
        <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.<br />
        삭제된 데이터는 복구할 수 없습니다.
      </p>
    </div>

    <!-- 버튼 영역 -->
    <div style="display: flex; gap: 12px; justify-content: flex-end">
      <button
        type="button"
        onclick="closeSupplierDeleteModal()"
        style="
          padding: 10px 24px;
          background: var(--bg-light);
          border: 1px solid var(--border);
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: var(--text-dark);
        "
      >
        취소
      </button>
      <button
        type="button"
        onclick="confirmDeleteSupplier()"
        style="
          padding: 10px 24px;
          background: #dc3545;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
        "
      >
        삭제
      </button>
    </div>
  </div>
</div>

<!-- ========================= -->
<!-- 발주관리 모달들 -->
<!-- ========================= -->

<!-- 발주 상세보기 모달 -->
<div id="orderDetailModal" class="modal hidden">
  <div class="modal-content large" style="max-width: 1000px; max-height: 90vh; overflow-y: auto">
    <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">발주 상세 보기</h2>
      <button
        id="closeOrderDetailModal"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <!-- 발주 상세 정보 (동적으로 로드) -->
    <div id="orderDetailContent">
      <!-- order.js에서 동적으로 채워집니다 -->
    </div>
  </div>
</div>

<!-- 발주 작성/수정 모달 -->
<div id="orderModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto">
    <!-- ✅ 헤더 영역 -->
    <div
      id="orderModalHeader"
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        position: sticky;
        top: -32px;
        background: white;
        padding: 0 0 16px 0;
        border-bottom: 2px solid var(--border);
        z-index: 10;
        user-select: none;
      "
    >
      <h2
        id="orderModalTitle"
        style="margin: 0; font-size: 24px; font-weight: 700; color: var(--text-dark)"
      >
        발주서 작성
      </h2>
      <button
        onclick="closeOrderModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: #666;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        "
        onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
        onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';"
      >
        ×
      </button>
    </div>

    <form id="orderForm" onsubmit="submitNewOrder(event)">
      <!-- ✅ 발주 마스터 정보 (카드 스타일) -->
      <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 24px">
        <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600">기본 정보</h3>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
          <!-- 발주일자 -->
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >발주일자 *</label
            >
            <input
              type="date"
              id="orderDate"
              required
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            />
          </div>

          <!-- 입고희망일자 -->
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >입고희망일자</label
            >
            <input
              type="date"
              id="orderDeliveryDate"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            />
          </div>

          <!-- 매입처 선택 -->
          <div style="grid-column: 1 / -1">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >매입처 *</label
            >
            <div style="display: flex; gap: 8px">
              <!-- 숨겨진 매입처 코드 필드 (실제 값 저장용) -->
              <input type="hidden" id="selectedSupplierCode" />

              <!-- 통합 검색 입력란 -->
              <input
                type="text"
                id="selectedSupplierName"
                required
                style="
                  flex: 1;
                  padding: 12px 16px;
                  border: 2px solid var(--border);
                  border-radius: 8px;
                  font-size: 14px;
                "
                placeholder="매입처 코드 또는 이름 입력 후 엔터"
                onkeypress="if(event.key === 'Enter') { event.preventDefault(); openSupplierSearchModal(); }"
              />
              <button
                type="button"
                onclick="openSupplierSearchModal()"
                style="
                  padding: 10px 20px;
                  background: var(--primary);
                  color: white;
                  border: none;
                  border-radius: 8px;
                  font-size: 14px;
                  font-weight: 500;
                  cursor: pointer;
                  white-space: nowrap;
                "
              >
                검색
              </button>
            </div>
            <!-- 선택된 매입처 정보 표시 -->
            <div
              id="selectedSupplierInfo"
              style="
                display: none;
                margin-top: 8px;
                padding: 8px 12px;
                background: #f0f9ff;
                border-radius: 6px;
                border: 1px solid #bfdbfe;
              "
            >
              <span style="font-size: 12px; color: #3b82f6; font-weight: 600">선택된 매입처:</span>
              <span
                id="selectedSupplierDisplay"
                style="margin-left: 8px; font-weight: 600; color: #1e40af"
              ></span>
            </div>
          </div>

          <!-- 결제방법 -->
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >결제방법</label
            >
            <select
              id="orderPaymentMethod"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="">선택</option>
              <option value="현금">현금</option>
              <option value="계좌이체">계좌이체</option>
              <option value="어음">어음</option>
              <option value="카드">카드</option>
            </select>
          </div>

          <!-- 상태 -->
          <div>
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >상태</label
            >
            <select
              id="orderStatus"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
            >
              <option value="0">작성중</option>
              <option value="1">발주완료</option>
              <option value="2">입고완료</option>
            </select>
          </div>

          <!-- 제목 -->
          <div style="grid-column: 1 / -1">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >제목</label
            >
            <input
              type="text"
              id="orderTitle"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
              "
              placeholder="발주서 제목을 입력하세요"
            />
          </div>

          <!-- 적요 -->
          <div style="grid-column: 1 / -1">
            <label style="display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px"
              >적요</label
            >
            <textarea
              id="orderRemarks"
              style="
                width: 100%;
                padding: 12px 16px;
                border: 2px solid var(--border);
                border-radius: 8px;
                font-size: 14px;
                resize: vertical;
                min-height: 80px;
              "
              placeholder="비고사항을 입력하세요"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- ✅ 발주 품목 내역 -->
      <div style="margin-bottom: 24px">
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
          "
        >
          <h3 style="margin: 0; font-size: 18px; font-weight: 600">발주 상세내역</h3>
          <button
            type="button"
            onclick="openOrderMaterialSearchModal()"
            style="
              padding: 8px 16px;
              background: #007bff;
              color: white;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
            "
          >
            + 자재 추가
          </button>
        </div>

        <div
          id="newOrderDetailTableContainer"
          style="overflow-x: auto; border: 1px solid var(--border); border-radius: 8px"
        >
          <table id="orderDetailTable" style="width: 100%; border-collapse: collapse">
            <thead style="background: #f8f9fa">
              <tr>
                <th
                  style="
                    padding: 12px;
                    text-align: left;
                    border-bottom: 2px solid var(--border);
                    width: 40px;
                  "
                >
                  순번
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                  자재코드
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                  자재명
                </th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid var(--border)">
                  규격
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 100px;
                  "
                >
                  수량
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 120px;
                  "
                >
                  단가
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 120px;
                  "
                >
                  공급가
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: right;
                    border-bottom: 2px solid var(--border);
                    width: 100px;
                  "
                >
                  부가세
                </th>
                <th
                  style="
                    padding: 12px;
                    text-align: center;
                    border-bottom: 2px solid var(--border);
                    width: 60px;
                  "
                >
                  삭제
                </th>
              </tr>
            </thead>
            <tbody id="newOrderDetailTableBody">
              <tr>
                <td colspan="9" style="padding: 40px; text-align: center; color: #999">
                  자재 추가 버튼을 클릭하여 발주 상세내역을 입력하세요
                </td>
              </tr>
            </tbody>
            <tfoot style="background: #f8f9fa; font-weight: 600">
              <tr>
                <td
                  colspan="6"
                  style="padding: 12px; text-align: right; border-top: 2px solid var(--border)"
                >
                  합계
                </td>
                <td
                  id="orderTotalSupplyPrice"
                  style="padding: 12px; text-align: right; border-top: 2px solid var(--border)"
                >
                  0
                </td>
                <td
                  id="orderTotalVat"
                  style="padding: 12px; text-align: right; border-top: 2px solid var(--border)"
                >
                  0
                </td>
                <td style="padding: 12px; border-top: 2px solid var(--border)"></td>
              </tr>
              <tr>
                <td colspan="6" style="padding: 12px; text-align: right">총액</td>
                <td
                  colspan="2"
                  id="orderGrandTotal"
                  style="padding: 12px; text-align: right; color: #007bff; font-size: 16px"
                >
                  0
                </td>
                <td></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>

      <!-- 버튼 영역 -->
      <div style="display: flex; gap: 12px; justify-content: flex-end">
        <button
          type="button"
          onclick="closeOrderModal()"
          style="
            padding: 10px 24px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
          "
        >
          취소
        </button>
        <button
          type="submit"
          style="
            padding: 10px 24px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
          "
        >
          발주서 저장
        </button>
      </div>
    </form>
  </div>
</div>

<!-- ✅ 매입처 검색 모달 -->
<div id="supplierSearchModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 800px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      "
    >
      <h3 style="margin: 0">매입처 검색</h3>
      <button
        onclick="closeSupplierSearchModal()"
        style="
          background: #f0f0f0;
          border: none;
          font-size: 24px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
        "
      >
        ×
      </button>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 16px">
      <input
        type="text"
        id="orderSupplierSearchInput"
        placeholder="매입처명 또는 코드 검색"
        onkeypress="if(event.key === 'Enter') searchOrderSuppliers()"
        style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px"
      />
      <button
        onclick="searchOrderSuppliers()"
        style="
          padding: 10px 20px;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 6px;
          cursor: pointer;
        "
      >
        검색
      </button>
    </div>

    <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 6px">
      <table id="supplierSearchTable" style="width: 100%; border-collapse: collapse">
        <thead style="background: #f8f9fa; position: sticky; top: 0">
          <tr>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">코드</th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
              매입처명
            </th>
            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e5e7eb">
              전화번호
            </th>
            <th style="padding: 10px; text-align: center; border-bottom: 2px solid #e5e7eb">
              선택
            </th>
          </tr>
        </thead>
        <tbody id="supplierSearchTableBody">
          <tr>
            <td colspan="4" style="padding: 40px; text-align: center; color: #999">
              검색 버튼을 클릭하여 매입처를 검색하세요
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- 신규 발주서용 품목 추가 모달 -->
<div id="newOrderMaterialModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 600px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 추가</h2>
      <button
        onclick="closeNewOrderMaterialModal()"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <div style="display: flex; flex-direction: column; gap: 16px">
      <!-- 자재 검색 영역 -->
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >자재 검색</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="text"
            id="newOrderMaterialSearchInput"
            style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="자재명 또는 품목코드로 검색"
            onkeypress="if(event.key === 'Enter') searchNewOrderMaterials()"
          />
          <button
            onclick="searchNewOrderMaterials()"
            style="
              padding: 10px 20px;
              background: #3b82f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            "
            onmouseover="this.style.background='#2563eb';"
            onmouseout="this.style.background='#3b82f6';"
          >
            검색
          </button>
        </div>
      </div>

      <!-- 검색 결과 테이블 -->
      <div id="newOrderMaterialSearchResults" style="display: none">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >검색 결과</label
        >
        <div
          style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px"
        >
          <table style="width: 100%; border-collapse: collapse">
            <thead style="background: #f9fafb; position: sticky; top: 0">
              <tr>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  품목코드
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  품명
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  규격
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: right;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  입고단가
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: center;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  선택
                </th>
              </tr>
            </thead>
            <tbody id="newOrderMaterialSearchTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- 선택된 자재 정보 -->
      <div
        id="newOrderSelectedMaterialInfo"
        style="
          display: none;
          background: #f0f9ff;
          padding: 12px;
          border-radius: 8px;
          border: 2px solid #bfdbfe;
        "
      >
        <div style="display: flex; justify-content: space-between; align-items: center">
          <div>
            <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px">
              선택된 자재
            </div>
            <div style="font-weight: 600; color: #1e40af" id="newOrderSelectedMaterialName">-</div>
            <div
              style="font-size: 12px; color: #6b7280; margin-top: 2px"
              id="newOrderSelectedMaterialCode"
            >
              -
            </div>
          </div>
          <button
            onclick="clearNewOrderSelectedMaterial()"
            style="
              padding: 6px 12px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 12px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            "
          >
            취소
          </button>
        </div>
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >수량</label
        >
        <input
          type="number"
          id="newOrderDetailQuantity"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="수량 입력"
          value="1"
          min="0"
          step="0.01"
        />
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >입고단가</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="number"
            id="newOrderDetailPrice"
            style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="단가 입력"
            value="0"
            min="0"
            step="0.01"
          />
          <button
            onclick="showNewOrderPriceHistory()"
            style="
              padding: 10px 16px;
              background: #8b5cf6;
              border: none;
              border-radius: 8px;
              font-size: 13px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            "
            onmouseover="this.style.background='#7c3aed';"
            onmouseout="this.style.background='#8b5cf6';"
          >
            이전 단가
          </button>
        </div>
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >금액 (자동계산)</label
        >
        <input
          type="text"
          id="newOrderDetailAmount"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: #f9fafb;
          "
          readonly
          value="0"
        />
      </div>
    </div>

    <div
      style="
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <button
        onclick="closeNewOrderMaterialModal()"
        style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb';"
        onmouseout="this.style.background='#f3f4f6';"
      >
        취소
      </button>
      <button
        onclick="confirmNewOrderMaterialAdd()"
        style="
          padding: 12px 24px;
          background: #10b981;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#059669';"
        onmouseout="this.style.background='#10b981';"
      >
        추가하기
      </button>
    </div>
  </div>
</div>

<!-- 발주 수정 모달 -->
<div id="orderEditModal" class="modal" style="display: none">
  <div class="modal-content large" style="max-width: 1200px; max-height: 90vh; overflow-y: auto">
    <!-- ✅ 헤더 영역 (제목 + 닫기 버튼) -->
    <div
      id="orderEditModalHeader"
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 24px; font-weight: 700; color: #1f2937">발주 수정</h2>
      <button
        id="closeOrderEditModalBtn"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <!-- ✅ 발주 기본 정보 (카드 스타일) -->
    <div
      style="
        background: #f9fafb;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 24px;
        border: 1px solid #e5e7eb;
      "
    >
      <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: #374151">
        기본 정보
      </h3>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px">
        <div style="display: flex; align-items: center">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280">발주번호</span>
          <span id="editOrderNo" style="color: #1f2937; font-weight: 600">-</span>
        </div>
        <div style="display: flex; align-items: center">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280">발주일자</span>
          <span id="editOrderDate" style="color: #1f2937">-</span>
        </div>
        <div style="display: flex; align-items: center">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280">매입처명</span>
          <span id="editSupplierName" style="color: #1f2937">-</span>
        </div>
        <div style="display: flex; align-items: center">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280">입고희망일자</span>
          <input
            type="date"
            id="editOrderDeliveryDate"
            style="
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            "
          />
        </div>
        <div style="display: flex; align-items: center">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280">결제방법</span>
          <select
            id="editOrderPaymentMethod"
            style="
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            "
          >
            <option value="">선택</option>
            <option value="현금">현금</option>
            <option value="카드">카드</option>
            <option value="계좌이체">계좌이체</option>
            <option value="어음">어음</option>
          </select>
        </div>
        <div style="display: flex; align-items: center">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280">상태</span>
          <select
            id="editOrderStatus"
            style="
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            "
          >
            <option value="0">발주대기</option>
            <option value="1">발주완료</option>
            <option value="2">입고완료</option>
          </select>
        </div>
        <div style="display: flex; align-items: center; grid-column: 1 / -1">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280">제목</span>
          <input
            type="text"
            id="editOrderTitle"
            style="
              flex: 1;
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
            "
            placeholder="발주 제목"
          />
        </div>
        <div style="display: flex; align-items: flex-start; grid-column: 1 / -1">
          <span style="min-width: 100px; font-weight: 500; color: #6b7280; padding-top: 8px"
            >적요</span
          >
          <textarea
            id="editOrderRemark"
            rows="2"
            style="
              flex: 1;
              padding: 8px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 6px;
              font-size: 14px;
              resize: vertical;
            "
            placeholder="발주 적요"
          ></textarea>
        </div>
      </div>
    </div>

    <!-- ✅ 발주 상세 목록 -->
    <div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 16px;
        "
      >
        <h3 style="margin: 0; font-size: 16px; font-weight: 600; color: #374151">발주 품목 내역</h3>
        <div style="display: flex; gap: 8px">
          <button
            type="button"
            onclick="addOrderDetailRowInEdit()"
            style="
              padding: 8px 16px;
              background: #10b981;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            "
            onmouseover="this.style.background='#059669';"
            onmouseout="this.style.background='#10b981';"
          >
            + 품목 추가
          </button>
          <button
            type="button"
            onclick="deleteSelectedOrderDetails()"
            style="
              padding: 8px 16px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
            "
            onmouseover="this.style.background='#dc2626';"
            onmouseout="this.style.background='#ef4444';"
          >
            선택 삭제
          </button>
        </div>
      </div>

      <table id="orderEditDetailTable" class="display" style="width: 100%">
        <thead>
          <tr>
            <th style="width: 40px">
              <input type="checkbox" id="selectAllEditOrderDetails" />
            </th>
            <th style="width: 50px">순번</th>
            <th>자재코드</th>
            <th>자재명</th>
            <th>규격</th>
            <th>발주량</th>
            <th>입고단가</th>
            <th>출고단가</th>
            <th style="width: 120px">관리</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- ✅ 버튼 영역 -->
    <div
      style="
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <button
        type="button"
        onclick="closeOrderEditModal()"
        style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb';"
        onmouseout="this.style.background='#f3f4f6';"
      >
        취소
      </button>
      <button
        type="button"
        onclick="submitOrderEdit()"
        style="
          padding: 12px 24px;
          background: #2563eb;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#1d4ed8';"
        onmouseout="this.style.background='#2563eb';"
      >
        수정 완료
      </button>
    </div>
  </div>
</div>

<!-- 발주 삭제 확인 모달 -->
<div id="orderDeleteModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <!-- 헤더 -->
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">발주 삭제</h2>
      <button
        onclick="closeOrderDeleteModal()"
        style="
          background: #f0f0f0;
          border: none;
          cursor: pointer;
          color: #666;
          width: 36px;
          height: 36px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        "
        onmouseover="this.style.background='#e0e0e0'; this.style.color='#333';"
        onmouseout="this.style.background='#f0f0f0'; this.style.color='#666';"
      >
        ×
      </button>
    </div>

    <!-- 삭제할 발주 정보 표시 -->
    <div id="orderDeleteContent" style="margin-bottom: 24px">
      <!-- 발주 정보가 여기에 동적으로 로드됩니다 -->
    </div>

    <!-- 경고 메시지 -->
    <div
      style="
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 24px;
      "
    >
      <p style="margin: 0; color: #856404; font-size: 14px; line-height: 1.6">
        <strong>⚠️ 경고:</strong> 이 작업은 되돌릴 수 없습니다.<br />
        삭제된 데이터는 복구할 수 없습니다.
      </p>
    </div>

    <!-- 버튼 영역 -->
    <div style="display: flex; gap: 12px; justify-content: flex-end">
      <button
        type="button"
        onclick="closeOrderDeleteModal()"
        style="
          padding: 10px 24px;
          background: var(--bg-light);
          border: 1px solid var(--border);
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: var(--text-dark);
        "
      >
        취소
      </button>
      <button
        type="button"
        onclick="confirmDeleteOrder()"
        style="
          padding: 10px 24px;
          background: #dc3545;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
        "
      >
        삭제
      </button>
    </div>
  </div>
</div>

<!-- 발주 품목 추가 모달 -->
<div id="orderDetailAddModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 600px">
    <div
      id="orderDetailAddModalHeader"
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 추가</h2>
      <button
        id="closeOrderDetailAddModal"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <div style="display: flex; flex-direction: column; gap: 16px">
      <!-- ✅ 자재 검색 영역 -->
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >자재 검색</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="text"
            id="orderMaterialSearchInput"
            style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="자재명 또는 품목코드로 검색"
            onkeypress="if(event.key === 'Enter') searchOrderMaterials()"
          />
          <button
            onclick="searchOrderMaterials()"
            style="
              padding: 10px 20px;
              background: #3b82f6;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            "
            onmouseover="this.style.background='#2563eb';"
            onmouseout="this.style.background='#3b82f6';"
          >
            검색
          </button>
        </div>
      </div>

      <!-- ✅ 검색 결과 테이블 -->
      <div id="orderMaterialSearchResults" style="display: none">
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >검색 결과 (클릭하여 선택)</label
        >
        <div
          style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px"
        >
          <table id="orderMaterialSearchTable" style="width: 100%; border-collapse: collapse">
            <thead style="background: #f9fafb; position: sticky; top: 0">
              <tr>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  품목코드
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  품명
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: left;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  규격
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: right;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  입고단가
                </th>
                <th
                  style="
                    padding: 8px;
                    text-align: center;
                    border-bottom: 1px solid #e5e7eb;
                    font-size: 13px;
                  "
                >
                  선택
                </th>
              </tr>
            </thead>
            <tbody id="orderMaterialSearchTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- ✅ 선택된 자재 정보 -->
      <div
        id="selectedOrderMaterialInfo"
        style="
          display: none;
          background: #f0f9ff;
          padding: 12px;
          border-radius: 8px;
          border: 2px solid #bfdbfe;
        "
      >
        <div style="display: flex; justify-content: space-between; align-items: center">
          <div>
            <div style="font-size: 12px; color: #3b82f6; font-weight: 600; margin-bottom: 4px">
              선택된 자재
            </div>
            <div style="font-weight: 600; color: #1e40af" id="selectedOrderMaterialName">-</div>
            <div
              style="font-size: 12px; color: #6b7280; margin-top: 2px"
              id="selectedOrderMaterialCode"
            >
              -
            </div>
          </div>
          <button
            onclick="clearSelectedOrderMaterial()"
            style="
              padding: 6px 12px;
              background: #ef4444;
              border: none;
              border-radius: 6px;
              font-size: 12px;
              font-weight: 500;
              cursor: pointer;
              color: white;
            "
          >
            취소
          </button>
        </div>
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >발주 수량</label
        >
        <input
          type="number"
          id="addOrderDetailQuantity"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="발주 수량 입력"
          value="1"
          min="0"
          step="0.01"
        />
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >입고단가</label
        >
        <div style="display: flex; gap: 8px">
          <input
            type="number"
            id="addOrderDetailInPrice"
            style="
              flex: 1;
              padding: 10px 12px;
              border: 2px solid #e5e7eb;
              border-radius: 8px;
              font-size: 14px;
            "
            placeholder="입고단가 입력"
            value="0"
            min="0"
            step="0.01"
          />
          <button
            onclick="showEditOrderPriceHistory()"
            style="
              padding: 10px 16px;
              background: #f59e0b;
              border: none;
              border-radius: 8px;
              font-size: 14px;
              font-weight: 500;
              cursor: pointer;
              color: white;
              transition: all 0.2s;
              white-space: nowrap;
            "
            onmouseover="this.style.background='#d97706';"
            onmouseout="this.style.background='#f59e0b';"
          >
            이전단가
          </button>
        </div>
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >입고단가</label
        >
        <input
          type="number"
          id="addOrderDetailOutPrice"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          "
          placeholder="입고단가 입력"
          value="0"
          min="0"
          step="0.01"
        />
      </div>
    </div>

    <div
      style="
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <button
        onclick="closeOrderDetailAddModal()"
        style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb';"
        onmouseout="this.style.background='#f3f4f6';"
      >
        취소
      </button>
      <button
        onclick="confirmAddOrderDetail()"
        style="
          padding: 12px 24px;
          background: #10b981;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#059669';"
        onmouseout="this.style.background='#10b981';"
      >
        추가하기
      </button>
    </div>
  </div>
</div>

<!-- 발주 품목 수정 모달 -->
<div id="orderDetailEditModal" class="modal" style="display: none">
  <div class="modal-content" style="max-width: 500px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">품목 수정</h2>
      <button
        id="closeOrderDetailEditModal"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <div style="display: flex; flex-direction: column; gap: 16px">
      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >자재명</label
        >
        <input
          type="text"
          id="editOrderDetailMaterialName"
          readonly
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            background: #f9fafb;
          "
        />
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >발주량</label
        >
        <input
          type="number"
          id="editOrderDetailQuantity"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          "
          min="0"
          step="0.01"
        />
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >입고단가</label
        >
        <input
          type="number"
          id="editOrderDetailInPrice"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          "
          min="0"
          step="0.01"
        />
      </div>

      <div>
        <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
          >출고단가</label
        >
        <input
          type="number"
          id="editOrderDetailOutPrice"
          style="
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
          "
          min="0"
          step="0.01"
        />
      </div>
    </div>

    <div
      style="
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 24px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <button
        onclick="closeOrderDetailEditModal()"
        style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb';"
        onmouseout="this.style.background='#f3f4f6';"
      >
        취소
      </button>
      <button
        onclick="confirmEditOrderDetail()"
        style="
          padding: 12px 24px;
          background: #3b82f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#2563eb';"
        onmouseout="this.style.background='#3b82f6';"
      >
        수정하기
      </button>
    </div>
  </div>
</div>

<!-- ✅ 발주 입고단가 이력 모달 -->
<div id="orderPriceHistoryModal" class="modal" style="display: none; z-index: 10000">
  <div class="modal-content" style="max-width: 700px">
    <div
      style="
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid #e5e7eb;
      "
    >
      <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937">입고단가 이력</h2>
      <button
        id="closeOrderPriceHistoryModal"
        onclick="closeOrderPriceHistoryModal()"
        style="
          width: 36px;
          height: 36px;
          border-radius: 50%;
          background: #f3f4f6;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 20px;
          color: #6b7280;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb'; this.style.color='#1f2937';"
        onmouseout="this.style.background='#f3f4f6'; this.style.color='#6b7280';"
      >
        &times;
      </button>
    </div>

    <!-- 자재 정보 -->
    <div
      style="
        background: #fef3c7;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 16px;
        border: 2px solid #fbbf24;
      "
    >
      <div style="display: flex; justify-content: space-between; align-items: center">
        <div>
          <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 4px">
            선택된 자재
          </div>
          <div style="font-weight: 600; color: #78350f" id="orderPriceHistoryMaterialName">-</div>
          <div
            style="font-size: 12px; color: #92400e; margin-top: 2px"
            id="orderPriceHistoryMaterialCode"
          >
            -
          </div>
        </div>
      </div>
    </div>

    <!-- ✅ 탭 메뉴 -->
    <div style="display: flex; gap: 8px; margin-bottom: 16px; border-bottom: 2px solid #e5e7eb">
      <button
        id="tabActualPurchasePrice"
        onclick="switchOrderPriceHistoryTab('actual')"
        style="
          padding: 12px 20px;
          background: #3b82f6;
          border: none;
          border-bottom: 3px solid #3b82f6;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: white;
          transition: all 0.2s;
          flex: 1;
        "
      >
        실제 입고가
      </button>
      <button
        id="tabOrderPrice"
        onclick="switchOrderPriceHistoryTab('order')"
        style="
          padding: 12px 20px;
          background: transparent;
          border: none;
          border-bottom: 3px solid transparent;
          font-size: 14px;
          font-weight: 600;
          cursor: pointer;
          color: #6b7280;
          transition: all 0.2s;
          flex: 1;
        "
        onmouseover="if(this.style.background === 'transparent') this.style.color='#1f2937';"
        onmouseout="if(this.style.background === 'transparent') this.style.color='#6b7280';"
      >
        발주 제안가
      </button>
    </div>

    <!-- 이력 테이블 -->
    <div style="margin-bottom: 16px">
      <label
        id="orderPriceHistoryLabel"
        style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151"
      >
        이 거래처에 실제 입고한 이력 (클릭하여 단가 선택)
      </label>
      <div
        style="max-height: 300px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px"
      >
        <table id="orderPriceHistoryTable" style="width: 100%; border-collapse: collapse">
          <thead
            id="orderPriceHistoryTableHead"
            style="background: #f9fafb; position: sticky; top: 0"
          >
            <tr>
              <th
                style="
                  padding: 10px;
                  text-align: left;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                입고일자
              </th>
              <th
                style="
                  padding: 10px;
                  text-align: right;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                입고단가
              </th>
              <th
                style="
                  padding: 10px;
                  text-align: right;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                입고수량
              </th>
              <th
                style="
                  padding: 10px;
                  text-align: center;
                  border-bottom: 2px solid #e5e7eb;
                  font-size: 13px;
                "
              >
                적요
              </th>
            </tr>
          </thead>
          <tbody id="orderPriceHistoryTableBody">
            <tr>
              <td colspan="4" style="padding: 40px; text-align: center; color: #9ca3af">
                이력이 없습니다
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div
      style="
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        padding-top: 16px;
        border-top: 2px solid #e5e7eb;
      "
    >
      <button
        onclick="closeOrderPriceHistoryModal()"
        style="
          padding: 12px 24px;
          background: #f3f4f6;
          border: none;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          color: #374151;
          transition: all 0.2s;
        "
        onmouseover="this.style.background='#e5e7eb';"
        onmouseout="this.style.background='#f3f4f6';"
      >
        닫기
      </button>
    </div>
  </div>
</div>

<!-- ========================= -->
<!-- 거래명세서관리 페이지 -->
<!-- ========================= -->
<div class="page-content" id="transactionPage">
  <div class="toolbar">
    <div class="toolbar-left">
      <!-- 기준일자 -->
      <input type="date" id="transactionDate" class="form-input" />
      <!-- 거래처 선택 -->
      <select id="customerSelect" class="form-input">
        <option value="">전체 거래처</option>
      </select>
      <button class="btn btn-secondary" onclick="loadTransactions()">조회</button>
    </div>
    <div class="toolbar-right">
      <button class="btn btn-success" onclick="openTransactionModal()">
        <span>+</span> 신규 등록
      </button>
    </div>
  </div>

  <!-- 거래명세서 목록 -->
  <div class="table-container">
    <table class="data-table" id="transactionHeaderTable">
      <thead>
        <tr>
          <th><input type="checkbox" id="selectAllTransactions" /></th>
          <th>거래번호</th>
          <th>거래일자</th>
          <th>거래처명</th>
          <th>공급가액</th>
          <th>부가세</th>
          <th>합계금액</th>
          <th>담당자</th>
          <th>비고</th>
        </tr>
      </thead>
      <tbody id="transactionHeaderBody">
        <tr>
          <td colspan="9" class="loading">데이터를 불러오는 중...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- 거래명세서 상세내역 -->
  <div class="table-container" style="margin-top: 20px">
    <h4>📦 상세 품목 내역</h4>
    <table class="data-table" id="transactionDetailTable">
      <thead>
        <tr>
          <th>품목코드</th>
          <th>품명</th>
          <th>규격</th>
          <th>단위</th>
          <th>수량</th>
          <th>단가</th>
          <th>공급가액</th>
          <th>부가세</th>
          <th>합계금액</th>
          <th>단가조회</th>
        </tr>
      </thead>
      <tbody id="transactionDetailBody">
        <tr>
          <td colspan="10" class="loading">거래명세서를 선택하세요.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ========================= -->
<!-- 거래명세서 신규등록 모달 -->
<!-- ========================= -->
<div id="transactionModal" class="modal hidden">
  <div class="modal-content">
    <h3>거래명세서 신규등록</h3>

    <div class="form-group">
      <label>거래일자</label>
      <input type="date" id="newTransactionDate" />
    </div>

    <div class="form-group">
      <label>매출처</label>
      <div style="display: flex; gap: 8px">
        <input type="text" id="newCustomerName" placeholder="매출처 선택" readonly />
        <button class="btn btn-secondary" onclick="openCustomerModal()">조회</button>
      </div>
    </div>

    <div class="form-group">
      <label>자재추가</label>
      <button class="btn btn-primary" onclick="openItemModal()">자재조회</button>
    </div>

    <div id="newTransactionItems"></div>

    <div style="margin-top: 16px; text-align: right">
      <button class="btn btn-success" onclick="saveTransaction()">저장</button>
      <button class="btn btn-secondary" onclick="closeTransactionModal()">닫기</button>
    </div>
  </div>
</div>

<!-- ========================= -->
<!-- 자재조회 모달 -->
<!-- ========================= -->
<div id="itemModal" class="modal hidden">
  <div class="modal-content">
    <h3>자재 조회</h3>
    <input type="text" id="itemSearch" placeholder="자재명 또는 코드 검색..." />
    <button class="btn btn-secondary" onclick="searchItems()">검색</button>
    <table class="data-table">
      <thead>
        <tr>
          <th>코드</th>
          <th>자재명</th>
          <th>규격</th>
          <th>단위</th>
          <th>선택</th>
        </tr>
      </thead>
      <tbody id="itemTableBody">
        <tr>
          <td colspan="5">검색 결과가 없습니다.</td>
        </tr>
      </tbody>
    </table>
    <div style="text-align: right">
      <button class="btn btn-secondary" onclick="closeItemModal()">닫기</button>
    </div>
  </div>
</div>

<!-- ========================= -->
<!-- 매출처조회 모달 -->
<!-- ========================= -->
<div id="customerModal" class="modal hidden">
  <div class="modal-content">
    <h3>매출처 조회</h3>
    <input type="text" id="customerSearchSimple" placeholder="매출처명 검색..." />
    <button class="btn btn-secondary" onclick="searchCustomers()">검색</button>
    <table class="data-table">
      <thead>
        <tr>
          <th>코드</th>
          <th>매출처명</th>
          <th>사업자번호</th>
          <th>연락처</th>
          <th>선택</th>
        </tr>
      </thead>
      <tbody id="customerTableBodyModal">
        <tr>
          <td colspan="5">검색 결과가 없습니다.</td>
        </tr>
      </tbody>
    </table>
    <div style="text-align: right">
      <button class="btn btn-secondary" onclick="closeCustomerModal()">닫기</button>
    </div>
  </div>
</div>

<!-- ========================= -->
<!-- 단가조회 모달 -->
<!-- ========================= -->
<div id="priceModal" class="modal hidden">
  <div class="modal-content">
    <h3>최근 1년 거래단가 조회</h3>
    <table class="data-table">
      <thead>
        <tr>
          <th>거래일자</th>
          <th>매출처</th>
          <th>자재명</th>
          <th>수량</th>
          <th>단가</th>
        </tr>
      </thead>
      <tbody id="priceTableBody">
        <tr>
          <td colspan="5">데이터를 불러오는 중...</td>
        </tr>
      </tbody>
    </table>
    <div style="text-align: right">
      <button class="btn btn-secondary" onclick="closePriceModal()">닫기</button>
    </div>
  </div>
</div>

<!-- 거래명세서 미리보기 모달 style="width: 800px" -->
<div id="previewModal" class="modal">
  <div class="modal-content" style="display: none">
    <span class="close" onclick="closePreviewModal()">&times;</span>
    <h2>거래명세서 미리보기</h2>

    <div id="previewHeader">
      <p><strong>거래일자:</strong> <span id="previewDate"></span></p>
      <p><strong>거래번호:</strong> <span id="previewNo"></span></p>
      <p><strong>거래처명:</strong> <span id="previewCustomer"></span></p>
    </div>

    <table class="table preview-table">
      <thead>
        <tr>
          <th>자재명</th>
          <th>규격</th>
          <th>단위</th>
          <th>수량</th>
          <th>단가</th>
          <th>공급가액</th>
          <th>부가세</th>
          <th>합계금액</th>
        </tr>
      </thead>
      <tbody id="previewBody"></tbody>
    </table>

    <div class="preview-total">
      <p><strong>총 공급가액:</strong> <span id="previewSubtotal"></span> 원</p>
      <p><strong>총 부가세:</strong> <span id="previewTax"></span> 원</p>
      <p><strong>총 합계금액:</strong> <span id="previewTotal"></span> 원</p>
    </div>

    <div style="text-align: right; margin-top: 15px">
      <button class="btn btn-primary" onclick="printPreview()">🖨 인쇄</button>
      <button class="btn btn-secondary" onclick="closePreviewModal()">닫기</button>
    </div>
  </div>
</div>
