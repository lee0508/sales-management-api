================================================================================
판매관리 시스템 - 배포 전 필수 보안 수정사항
================================================================================

작성일: 2025-10-25
대상: 온프레미스 방식 각 업체별 개별 설치
목표: Google Cloud 마이그레이션 대비

================================================================================
📋 현재 배포 계획
================================================================================

배포 방식: 온프레미스 (각 업체 독립 서버)
데이터베이스: MS SQL Server 2008 R2 (업체별 독립)

A업체 (독립)              B업체 (독립)              C업체 (독립)
├── MS SQL 2008 R2       ├── MS SQL 2008 R2       ├── MS SQL 2008 R2
├── YmhDB               ├── YmhDB               ├── YmhDB
└── Node.js 서버        └── Node.js 서버        └── Node.js 서버

향후 계획: Google Cloud로 마이그레이션


================================================================================
🚨 치명적 보안 문제 (즉시 해결 필요)
================================================================================

1. 데이터베이스 자격증명 노출 ⭐⭐⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 문제:
- 파일: server.js (14-30줄)
- 코드에 sa 계정과 비밀번호 하드코딩
- 모든 업체가 동일한 비밀번호 사용

위험도:
- 소스코드 유출 시 모든 업체 DB 해킹 가능
- GitHub 실수 업로드 시 전세계 공개
- 직원 퇴사/노트북 분실 시 비밀번호 노출

해결 방법:
→ Phase 1에서 .env 파일로 분리 (진행 예정)


2. SQL Injection 취약점 ⭐⭐⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

공격 가능 위치:
- server.js:217-218 (매출처 검색)
- server.js:236-237 (사업장 필터)
- server.js:532-537 (매입처 검색)
- 기타 문자열 연결 쿼리 다수

공격 시나리오:
검색어: '; DROP TABLE 견적; --
결과: 견적 테이블 삭제!

영향:
- 내부 직원이 악의적으로 데이터 삭제/변조 가능
- 같은 네트워크의 누구나 공격 가능

해결 방법:
→ Phase 1에서 모든 쿼리를 parameterized query로 변경 (진행 예정)


3. 인증 시스템 부재 ⭐⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- API 엔드포인트 보호 없음
- 같은 네트워크의 누구나 접근 가능
- http://192.168.1.100:3000/api/quotations → 모든 견적 조회 가능

위험 시나리오:
- 퇴사 예정 직원의 데이터 유출
- 방문자 노트북에서 데이터 다운로드
- 내부 네트워크 침입 시 전체 데이터 접근

해결 방법:
→ Phase 1에서 세션 기반 인증 추가 (진행 예정)


4. 비밀번호 평문 저장 ⭐⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- 사용자 테이블에 비밀번호 그대로 저장
- 예: INSERT INTO 사용자 VALUES ('user1', '1234')

문제:
- DB 백업 유출 시 모든 비밀번호 노출
- DB 관리자가 모든 사용자 비밀번호 확인 가능
- 사용자가 다른 서비스에서도 같은 비밀번호 사용 시 피해 확산

해결 방법:
→ Phase 1에서 bcrypt로 해싱 (진행 예정)


================================================================================
⚠️ 추가 고려사항
================================================================================

5. MS SQL Server 2008 R2 지원 종료 ⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

문제:
- 2008 R2는 2019년 7월 지원 종료
- 보안 패치 없음
- 새로운 취약점 발견 시 대응 불가

권장:
- SQL Server 2019 이상 권장
- 최소 2016 이상 사용


6. 업데이트 배포 프로세스 없음 ⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

문제:
- 버그 수정 시 각 업체마다 수동 배포
- 10개 업체 = 10번 배포 작업
- 버전 불일치 관리 복잡

해결 방안:
A. 자동 업데이트 시스템 (앱 시작 시 버전 체크)
B. Docker 컨테이너 (docker pull & restart)
C. 설치 패키지 (installer.exe로 자동 업데이트)


7. 원격 모니터링 부재 ⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

문제:
- 각 업체 서버 상태 파악 불가
- 에러 발생해도 모름
- 고객이 전화해야 문제 인지

해결:
- 중앙 모니터링 서버로 상태 전송 (1분마다)
- 에러 로그 자동 수집
- 알림 시스템 (이메일/SMS)


8. 백업 자동화 없음 ⭐⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

문제:
- 각 업체가 수동 백업 의존
- 잊어버리면 데이터 유실 위험
- 랜섬웨어 공격 시 복구 불가

해결:
- 매일 자동 백업 (새벽 2시)
- 클라우드 저장소로 자동 업로드
- 7일 보관 정책


================================================================================
🎯 단계별 수정 계획
================================================================================

Phase 1: 필수 보안 (1주) ⭐⭐⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ 환경변수로 DB 설정 분리
□ SQL Injection 모두 수정
□ 비밀번호 해싱
□ 기본 인증 추가

Phase 2: 배포 준비 (1주) ⭐⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ 설치 스크립트 작성
□ 설정 파일 템플릿
□ 설치 가이드 문서
□ 업체별 .env 생성 도구

Phase 3: 운영 편의성 (2주) ⭐⭐⭐
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ 자동 백업 시스템
□ 에러 로그 수집
□ 모니터링 대시보드
□ 업데이트 시스템


================================================================================
📦 온프레미스 설치 패키지 구조
================================================================================

sales-management-system/
├── app/
│   ├── server.js
│   ├── package.json
│   ├── js/
│   ├── css/
│   └── index.html
├── config/
│   ├── .env.template          ← 각 업체별 수정 필요
│   └── setup-wizard.js        ← 설정 마법사
├── database/
│   ├── schema.sql             ← DB 스키마
│   └── migrations/            ← 버전별 마이그레이션
├── scripts/
│   ├── install.bat            ← Windows 설치
│   ├── backup.bat             ← 백업 스크립트
│   ├── update.bat             ← 업데이트 스크립트
│   └── test-db.js             ← DB 연결 테스트
├── docs/
│   ├── 설치가이드.pdf
│   ├── 사용자매뉴얼.pdf
│   └── 관리자가이드.pdf
└── README.md


================================================================================
🔄 Google Cloud 마이그레이션 대비
================================================================================

현재부터 준비해야 할 사항:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 환경변수 사용 (로컬/클라우드 동일)
   - DB_SERVER: localhost → Cloud SQL IP
   - 코드 변경 없이 설정만 변경

2. 파일 저장소 추상화
   - 로컬: LocalStorage
   - 클라우드: GoogleCloudStorage
   - 인터페이스만 교체

3. 로그를 Cloud Logging으로 전송 가능하게
   - 로컬에서도 JSON 로그 형식 사용
   - 클라우드 이전 시 즉시 연동

마이그레이션 로드맵:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1단계: 온프레미스 (현재)
   ├── 앱: 각 업체 서버
   └── DB: 로컬 SQL Server

2단계: 하이브리드 (6개월 후)
   ├── 앱: 로컬 서버
   └── DB: Cloud SQL (백업만 클라우드)

3단계: 풀 클라우드 (1년 후)
   ├── 앱: Cloud Run
   ├── DB: Cloud SQL
   └── 파일: Cloud Storage


================================================================================
✅ 배포 전 체크리스트
================================================================================

보안
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ DB 비밀번호를 .env로 분리했는가?
□ SQL Injection 취약점을 모두 수정했는가?
□ 비밀번호를 해싱하는가?
□ API 인증을 추가했는가?
□ HTTPS를 사용하는가? (또는 내부망 제한)

설치
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ 설치 스크립트가 있는가?
□ 설치 가이드 문서가 있는가?
□ .env.template이 있는가?
□ DB 연결 테스트 스크립트가 있는가?
□ 각 업체별 고유 비밀번호 생성 도구가 있는가?

운영
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ 자동 백업이 설정되는가?
□ 에러 로그가 수집되는가?
□ 업데이트 방법이 정해졌는가?
□ 원격 지원 방법이 있는가?
□ 모니터링이 설정되는가?

문서
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
□ 사용자 매뉴얼
□ 관리자 가이드
□ 설치 가이드
□ 트러블슈팅 가이드
□ FAQ


================================================================================
📞 지원 및 연락처
================================================================================

기술 지원: [연락처 입력]
긴급 연락: [연락처 입력]
업데이트 공지: [웹사이트 또는 이메일]


================================================================================
끝
================================================================================
